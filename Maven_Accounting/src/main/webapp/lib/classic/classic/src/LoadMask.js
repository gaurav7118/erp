Ext.define("Ext.LoadMask",{extend:"Ext.Component",alias:"widget.loadmask",mixins:["Ext.util.StoreHolder"],uses:["Ext.data.StoreManager"],isLoadMask:true,msg:"Loading...",msgCls:Ext.baseCSSPrefix+"mask-loading",msgWrapCls:Ext.baseCSSPrefix+"mask-msg",useMsg:true,useTargetEl:false,cls:Ext.baseCSSPrefix+"mask",componentCls:Ext.baseCSSPrefix+"border-box",ariaRole:"status",focusable:true,tabIndex:0,autoEl:{tag:"div",role:"status"},childEls:["msgWrapEl","msgEl","msgTextEl"],renderTpl:['<div id="{id}-msgWrapEl" data-ref="msgWrapEl" class="{[values.$comp.msgWrapCls]}">','<div id="{id}-msgEl" data-ref="msgEl" class="{[values.$comp.msgCls]} ',Ext.baseCSSPrefix,'mask-msg-inner {childElCls}">','<div id="{id}-msgTextEl" data-ref="msgTextEl" class="',Ext.baseCSSPrefix,"mask-msg-text",'{childElCls}">{msg}</div>',"</div>","</div>"],maskOnDisable:false,skipLayout:true,constructor:function(B){var C=this,A;if(arguments.length===2){if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("Ext.LoadMask: LoadMask now uses a standard 1 arg constructor: use the target config")}A=C.target=B;B=arguments[1]}else{A=B.target}if(B.maskCls){Ext.log.warn("Ext.LoadMask property maskCls is deprecated, use msgWrapCls instead");B.msgWrapCls=B.msgWrapCls||B.maskCls}C.callParent([B]);if(A.isComponent){C.ownerCt=A;C.hidden=true;C.renderTo=C.getMaskTarget();C.external=C.renderTo===Ext.getBody();C.bindComponent(A)}else{if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("Ext.LoadMask: LoadMask for elements has been deprecated, use Ext.dom.Element.mask & Ext.dom.Element.unmask")}A=Ext.get(A);C.isElement=true;C.renderTo=C.target}C.render(C.renderTo);if(C.store){C.bindStore(C.store,true)}},initRenderData:function(){var A=this.callParent(arguments);A.msg=this.msg||"";return A},onRender:function(){this.callParent(arguments);this.maskEl=this.el},bindComponent:function(A){var C=this,B={scope:this,resize:C.sizeMask};if(C.external){B.added=C.onComponentAdded;B.removed=C.onComponentRemoved;if(A.floating){B.move=C.sizeMask;C.activeOwner=A}else{if(A.ownerCt){C.onComponentAdded(A.ownerCt)}}}C.mon(A,B);if(C.external){C.mon(Ext.GlobalEvents,{show:C.onContainerShow,hide:C.onContainerHide,expand:C.onContainerExpand,collapse:C.onContainerCollapse,scope:C})}},onComponentAdded:function(A){var B=this;delete B.activeOwner;B.floatParent=A;if(!A.floating){A=A.up("[floating]")}if(A){B.activeOwner=A;B.mon(A,"move",B.sizeMask,B);B.mon(A,"tofront",B.onOwnerToFront,B)}else{B.preventBringToFront=true}A=B.floatParent.ownerCt;if(B.rendered&&B.isVisible()&&A){B.floatOwner=A;B.mon(A,"afterlayout",B.sizeMask,B,{single:true})}},onComponentRemoved:function(A){var C=this,D=C.activeOwner,B=C.floatOwner;if(D){C.mun(D,"move",C.sizeMask,C);C.mun(D,"tofront",C.onOwnerToFront,C)}if(B){C.mun(B,"afterlayout",C.sizeMask,C)}delete C.activeOwner;delete C.floatOwner},afterRender:function(){var A=this;A.callParent(arguments);if(Ext.isIE){A.el.on("mousedown",A.onMouseDown,A)}this.el.skipGarbageCollection=true},onMouseDown:function(B){var A=this.el;if(B.within(A)){B.preventDefault();A.focus()}},onOwnerToFront:function(A,B){this.el.setStyle("zIndex",B+1)},onContainerShow:function(A){if(!this.isHierarchicallyHidden()){this.onComponentShow()}},onContainerHide:function(A){if(this.isHierarchicallyHidden()){this.onComponentHide()}},onContainerExpand:function(A){if(!this.isHierarchicallyHidden()){this.onComponentShow()}},onContainerCollapse:function(A){if(this.isHierarchicallyHidden()){this.onComponentHide()}},onComponentHide:function(){var A=this;if(A.rendered&&A.isVisible()){A.hide();A.showNext=true}},onComponentShow:function(){if(this.showNext){this.show()}delete this.showNext},sizeMask:function(){var B=this,C=B.activeOwner||B.target,A=B.external?B.getOwner().el:B.getMaskTarget();if(B.rendered&&B.isVisible()){if(B.external){if(!B.isElement&&C.floating){B.onOwnerToFront(C,C.el.getZIndex())}B.el.setSize(A.getSize()).alignTo(A,"tl-tl")}B.msgWrapEl.center(B.el)}},bindStore:function(A,B){var C=this;Ext.destroy(C.proxyListeners);C.mixins.storeholder.bindStore.apply(C,arguments);A=C.store;if(A){while(A.getSource){A=A.getSource()}if(!A.loadsSynchronously()){C.proxyListeners=A.getProxy().on({exception:C.onLoad,scope:C,destroyable:true})}if(A.isLoading()){C.onBeforeLoad()}}},getStoreListeners:function(B){var D=this.onLoad,C=this.onBeforeLoad,A={cachemiss:C,cachefilled:{fn:D,buffer:100}};if(!B.loadsSynchronously()){A.beforeload=C;A.load=D}return A},onDisable:function(){this.callParent(arguments);if(this.loading){this.onLoad()}},getOwner:function(){return this.ownerCt||this.ownerCmp||this.floatParent},getMaskTarget:function(){var A=this.getOwner();if(this.isElement){return this.target}return this.useTargetEl?A.getTargetEl():(A.getMaskTarget()||Ext.getBody())},onBeforeLoad:function(){var C=this,A=C.getOwner(),B;if(!C.disabled){C.loading=true;if(A.componentLayoutCounter){C.maybeShow()}else{B=A.afterComponentLayout;A.afterComponentLayout=function(){A.afterComponentLayout=B;B.apply(A,arguments);C.maybeShow()}}}},maybeShow:function(){var B=this,A=B.getOwner();if(!A.isVisible(true)){B.showNext=true}else{if(B.loading&&A.rendered){B.show()}}},hide:function(){var B=this,A=B.ownerCt;if(B.isElement){A.unmask();B.fireEvent("hide",this);return }if(A){A.enableTabbing();A.setMasked(false)}delete B.showNext;return B.callParent(arguments)},show:function(){var A=this;if(A.isElement){A.ownerCt.mask(this.useMsg?this.msg:"",this.msgCls);A.fireEvent("show",this);return }return A.callParent(arguments)},afterShow:function(){var B=this,A=B.ownerCt;B.loading=true;B.callParent(arguments);A.disableTabbing();A.setMasked(true);B.el.restoreTabbableState();B.syncMaskState()},syncMaskState:function(){var C=this,B=C.ownerCt,A=C.el;if(C.isVisible()){if(C.hasOwnProperty("msgWrapCls")){A.dom.className=C.msgWrapCls}if(C.useMsg){C.msgTextEl.setHtml(C.msg)}else{C.msgEl.hide()}if(C.shim||Ext.useShims){A.enableShim(null,true)}else{A.disableShim()}if(B.el.contains(Ext.Element.getActiveElement())){C.focus()}C.sizeMask()}},onLoad:function(){this.loading=false;this.hide()},beforeDestroy:function(){this.ownerCt=null;this.bindStore(null);this.callParent()},onDestroy:function(){var A=this;if(A.isElement){A.ownerCt.unmask()}A.callParent()}})