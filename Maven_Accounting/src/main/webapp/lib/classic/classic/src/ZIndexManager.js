Ext.define("Ext.ZIndexManager",{alternateClassName:"Ext.WindowGroup",requires:["Ext.util.SorterCollection","Ext.util.FilterCollection","Ext.GlobalEvents"],statics:{zBase:9000,activeCounter:0},constructor:function(A){var B=this;B.id=Ext.id(null,"zindex-mgr-");B.zIndexStack=new Ext.util.Collection({sorters:{sorterFn:function(E,D){var C=(E.alwaysOnTop||0)-(D.alwaysOnTop||0);if(!C){C=E.getActiveCounter()-D.getActiveCounter()}return C}},filters:{filterFn:function(C){return C.isVisible()}}});B.zIndexStack.addObserver(B);B.front=null;B.globalListeners=Ext.GlobalEvents.on({beforehide:B.onComponentShowHide,show:B.onComponentShowHide,scope:B,destroyable:true});if(A){if(A.isContainer){A.on("resize",B.onContainerResize,B);B.zseed=Ext.Number.from(B.rendered?A.getEl().getStyle("zIndex"):undefined,B.getNextZSeed());B.targetEl=A.getTargetEl();B.container=A}else{Ext.on("resize",B.onContainerResize,B);B.zseed=B.getNextZSeed();B.targetEl=Ext.get(A)}}else{B.zseed=B.getNextZSeed();Ext.onInternalReady(function(){Ext.on("resize",B.onContainerResize,B);B.targetEl=Ext.getBody()})}},getId:function(){return this.id},getNextZSeed:function(){return(Ext.ZIndexManager.zBase+=10000)},setBase:function(A){this.zseed=A;return this.onCollectionSort()},onCollectionSort:function(){var H=this,D=H.front,G=D&&D.containsFocus,I=H.zseed,J=H.zIndexStack.getRange(),F=J.length,C,E,B,A,K=false;for(C=0;C<F;C++){E=J[C];I=E.setZIndex(I);if(!E.hidden){A=E;if(E.modal){B=E}}}if(A!==D){if(D&&!D.destroying){D.setActive(false)}if(A){K=A.isFocusable(true)&&(A.modal||(A.focusOnToFront&&!A.preventFocusOnActivate));A.setActive(true,K)}}H.front=A;if(B){H.showModalMask(B)}else{H.hideModalMask()}return I},onComponentUpdate:function(A){if(this.zIndexStack.contains(A)){this.zIndexStack.sort()}},onComponentRender:function(A){this.zIndexStack.itemChanged(A,"hidden")},onComponentShowHide:function(A){var B=this.zIndexStack;if(A.isFloating()&&!this.hidingAll&&(B.getSource()||B).contains(A)){B.itemChanged(A,"hidden");B.sort()}},register:function(A){var B=this;if(A.zIndexManager){A.zIndexManager.unregister(A)}A.zIndexManager=B;if(!A.rendered){A.on("render",B.onComponentRender,B,{single:true})}B.zIndexStack.add(A)},unregister:function(A){var B=this;delete A.zIndexManager;A.un("render",B.onComponentRender,B);B.zIndexStack.remove(A);B.onCollectionSort()},get:function(A){return A.isComponent?A:this.zIndexStack.get(A)},bringToFront:function(B,E){var C=this,G=C.zIndexStack,A=G.last(),D,F;B=C.get(B);if(!B||G.find("alwaysOnTop",true)){return false}F=B.preventFocusOnActivate;B.preventFocusOnActivate=E;B.setActiveCounter(++Ext.ZIndexManager.activeCounter);B.preventFocusOnActivate=F;D=G.last();return(D===B&&D!==A)},sendToBack:function(A){A=this.get(A);if(A){A.setActiveCounter(0)}return A||null},hideAll:function(){var C=this.zIndexStack.getRange(),A=C.length,B;this.hidingAll=true;for(B=0;B<A;B++){C[B].hide()}this.hidingAll=false},hide:function(){var F=this,E=Ext.Element.getActiveElement(),D=F.tempHidden=F.zIndexStack.getRange(),A=D.length,C,B;F.focusRestoreElement=null;for(C=0;C<A;C++){B=D[C];if(B.el.contains(E)){F.focusRestoreElement=E}B.el.hide();B.hidden=true}},show:function(){var D=this,C,E=D.tempHidden,A=E?E.length:0,B;for(C=0;C<A;C++){B=E[C];B.el.show();B.hidden=false;B.setPosition(B.x,B.y)}D.tempHidden=null;if(D.focusRestoreElement){D.focusRestoreElement.focus()}},getActive:function(){return this.zIndexStack.last()},getBy:function(B,A){return this.zIndexStack.filterBy(B,A).getRange()},each:function(B,A){this.zIndexStack.each(B,A)},eachBottomUp:function(F,E){var B=this.zIndexStack.getRange(),D,A=B.length,C;for(D=0;D<A;D++){C=B[D];if(C.isComponent&&F.call(E||C,C)===false){return }}},eachTopDown:function(E,D){var A=this.zIndexStack.getRange(),C,B;for(C=A.length;C-->0;){B=A[C];if(B.isComponent&&E.call(D||B,B)===false){return }}},destroy:function(){var D=this,B=D.zIndexStack.getRange(),A=B.length,C;for(C=0;C<A;C++){Ext.destroy(B[C])}if(D.container){D.container.un("resize",D.onContainerResize,D)}else{if(D.targetEl){Ext.un("resize",D.onContainerResize,D)}}Ext.destroy(D.mask,D.maskShim,D.zIndexStack,D.globalListeners);D.zIndexStack=D.container=D.targetEl=D.globalListeners=null;D.callParent()},privates:{getMaskBox:function(){var A=this.mask.maskTarget;if(A.dom===document.body){return{height:Math.max(document.body.scrollHeight,Ext.dom.Element.getDocumentHeight()),width:Math.max(document.body.scrollWidth,document.documentElement.clientWidth),x:0,y:0}}else{return A.getBox()}},onContainerResize:function(){var C=this,B=C.mask,A=C.maskShim,D;if(B&&B.isVisible()){B.hide();if(A){A.hide()}D=C.getMaskBox();if(A){A.setSize(D);A.show()}B.setSize(D);B.show()}},onMaskClick:function(){if(this.front){this.front.focus()}},showModalMask:function(B){var D=this,H=B.el,G=H.getStyle("zIndex")-4,C=B.floatParent?B.floatParent.getTargetEl():B.container,A=D.mask,F=D.maskShim,E;if(!A){D.mask=A=Ext.getBody().createChild({"data-sticky":true,role:"presentation",cls:Ext.baseCSSPrefix+"mask "+Ext.baseCSSPrefix+"border-box",style:"height:0;width:0"});A.setVisibilityMode(Ext.Element.DISPLAY);A.on("click",D.onMaskClick,D)}else{D.hideModalMask()}A.maskTarget=C;E=D.getMaskBox();if(F){F.setStyle("zIndex",G);F.show();F.setBox(E)}A.setStyle("zIndex",G);C.saveTabbableState({excludeRoot:H});A.show();A.setBox(E)},hideModalMask:function(){var B=this.mask,A=this.maskShim;if(B&&B.isVisible()){B.maskTarget.restoreTabbableState();B.maskTarget=undefined;B.hide();if(A){A.hide()}}}}},function(){Ext.WindowManager=Ext.WindowMgr=new this()})