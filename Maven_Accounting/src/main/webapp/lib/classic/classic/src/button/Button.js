Ext.define("Ext.button.Button",{alias:"widget.button",extend:"Ext.Component",requires:["Ext.dom.ButtonElement","Ext.button.Manager","Ext.menu.Manager","Ext.util.ClickRepeater","Ext.util.TextMetrics"],mixins:["Ext.mixin.Queryable","Ext.util.KeyboardInteractive"],alternateClassName:"Ext.Button",config:{iconAlign:"left",text:null,textAlign:"center",arrowVisible:true},isButton:true,_syncFrameHeight:true,liquidLayout:true,hidden:false,disabled:false,pressed:false,tabIndex:0,enableToggle:false,menuAlign:"tl-bl?",showEmptyMenu:false,clickEvent:"click",preventDefault:true,handleMouseEvents:true,tooltipType:"qtip",baseCls:Ext.baseCSSPrefix+"btn",hrefTarget:"_blank",destroyMenu:true,focusable:true,ariaRole:"button",keyHandlers:{SPACE:"onEnterKey",ENTER:"onEnterKey",DOWN:"onDownKey"},defaultBindProperty:"text",childEls:["btnEl","btnWrap","btnInnerEl","btnIconEl","arrowEl"],publishes:{pressed:1},_btnWrapCls:Ext.baseCSSPrefix+"btn-wrap",_btnCls:Ext.baseCSSPrefix+"btn-button",_baseIconCls:Ext.baseCSSPrefix+"btn-icon-el",_glyphCls:Ext.baseCSSPrefix+"btn-glyph",_innerCls:Ext.baseCSSPrefix+"btn-inner",_textCls:Ext.baseCSSPrefix+"btn-text",_noTextCls:Ext.baseCSSPrefix+"btn-no-text",_hasIconCls:Ext.baseCSSPrefix+"btn-icon",_pressedCls:Ext.baseCSSPrefix+"btn-pressed",overCls:Ext.baseCSSPrefix+"btn-over",_disabledCls:Ext.baseCSSPrefix+"btn-disabled",_menuActiveCls:Ext.baseCSSPrefix+"btn-menu-active",_arrowElCls:Ext.baseCSSPrefix+"btn-arrow-el",_focusCls:Ext.baseCSSPrefix+"btn-focus",_arrowFocusCls:Ext.baseCSSPrefix+"arrow-focus",renderTpl:'<span id="{id}-btnWrap" data-ref="btnWrap" role="presentation" unselectable="on" style="{btnWrapStyle}" class="{btnWrapCls} {btnWrapCls}-{ui} {splitCls}{childElCls}"><span id="{id}-btnEl" data-ref="btnEl" role="presentation" unselectable="on" style="{btnElStyle}" class="{btnCls} {btnCls}-{ui} {textCls} {noTextCls} {hasIconCls} {iconAlignCls} {textAlignCls} {btnElAutoHeightCls}{childElCls}"><tpl if="iconBeforeText">{[values.$comp.renderIcon(values)]}</tpl><span id="{id}-btnInnerEl" data-ref="btnInnerEl" unselectable="on" class="{innerCls} {innerCls}-{ui}{childElCls}">{text}</span><tpl if="!iconBeforeText">{[values.$comp.renderIcon(values)]}</tpl></span></span>{[values.$comp.getAfterMarkup ? values.$comp.getAfterMarkup(values) : ""]}<tpl if="closable"><span id="{id}-closeEl" data-ref="closeEl" class="{baseCls}-close-btn"><tpl if="closeText"> {closeText}</tpl></span></tpl><tpl if="split"><span id="{id}-arrowEl" class="{arrowElCls}" data-ref="arrowEl" role="button" hidefocus="on" unselectable="on"<tpl if="tabIndex != null"> tabindex="{tabIndex}"</tpl><tpl foreach="arrowElAttributes"> {$}="{.}"</tpl>>{arrowElText}</span></tpl>',iconTpl:'<span id="{id}-btnIconEl" data-ref="btnIconEl" role="presentation" unselectable="on" class="{baseIconCls} {baseIconCls}-{ui} {iconCls} {glyphCls}{childElCls}" style="<tpl if="iconUrl">background-image:url({iconUrl});</tpl><tpl if="glyph && glyphFontFamily">font-family:{glyphFontFamily};</tpl>"><tpl if="glyph">&#{glyph};</tpl></span>',scale:"small",allowedScales:["small","medium","large"],arrowAlign:"right",arrowCls:"arrow",maskOnDisable:false,shrinkWrap:3,frame:true,autoEl:{tag:"a",hidefocus:"on",unselectable:"on"},hasFrameTable:function(){return this.href&&this.frameTable},frameTableListener:function(){if(!this.disabled){this.doNavigate()}},doNavigate:function(){if(this.hrefTarget==="_blank"){window.open(this.getHref(),this.hrefTarget)}else{location.href=this.getHref()}},_triggerRegion:{},initComponent:function(){var A=this;if(!A.isSplitButton&&A.menu&&Ext.enableAriaButtons&&!Ext.slicer&&Ext.enableAria){if(A.enableToggle||A.toggleGroup){Ext.log.warn("According to WAI-ARIA 1.0 Authoring guide (http://www.w3.org/TR/wai-aria-practices/#menubutton), menu button '"+A.id+"' behavior will conflict with toggling.")}if(A.href){Ext.log.warn("According to WAI-ARIA 1.0 Authoring guide (http://www.w3.org/TR/wai-aria-practices/#menubutton), menu button '"+A.id+"' cannot behave as a link.")}if(A.handler||A.hasListeners.hasOwnProperty("click")){Ext.log.warn("According to WAI-ARIA 1.0 Authoring guide (http://www.w3.org/TR/wai-aria-practices/#menubutton), menu button '"+A.id+"' should display the menu on SPACE and ENTER keys, which will conflict with the button handler.")}}A.addCls(Ext.baseCSSPrefix+"unselectable");A.callParent();if(A.menu){A.split=true;A.setMenu(A.menu,false,true)}if(A.url){A.href=A.url}A.configuredWithPreventDefault=A.hasOwnProperty("preventDefault");if(A.href&&!A.configuredWithPreventDefault){A.preventDefault=false}if(Ext.isString(A.toggleGroup)&&A.toggleGroup!==""){A.enableToggle=true}if(A.html&&!A.text){A.text=A.html;delete A.html}},getElConfig:function(){var C=this,B=C.callParent(),A=C.getHref(),D=C.hrefTarget;if(B.tag==="a"){if(!C.disabled){B.tabIndex=C.tabIndex}if(A){if(!C.disabled){B.href=A;if(D){B.target=D}}}}if(!C.ariaStaticRoles[C.ariaRole]){if(C.menu&&!C.isSplitButton){B["aria-haspopup"]=true}if(C.enableToggle){B["aria-pressed"]=!!C.pressed}}return B},beforeRender:function(){this.callParent();if(this.pressed){this.addCls(this._pressedCls)}},initRenderData:function(){return Ext.apply(this.callParent(),this.getTemplateArgs())},getMenu:function(){return this.menu||null},setMenu:function(H,G,E){var F=this,B=F.menu,A=F.isSplitButton?F.arrowEl&&F.arrowEl.dom:F.ariaEl.dom,C,D;if(B&&!E){if(G!==false&&F.destroyMenu){B.destroy()}B.ownerCmp=null}if(H){C=H.isMenu;H=Ext.menu.Manager.get(H,{ownerCmp:F});H.setOwnerCmp(F,C);H.menuClickBuffer=250;F.mon(H,{scope:F,show:F.onMenuShow,hide:F.onMenuHide});if(!B&&F.getArrowVisible()){F.split=true;if(F.rendered){F._addSplitCls();F.updateLayout()}}F.menu=H;if(A){A.setAttribute("aria-haspopup",true);A.setAttribute("aria-owns",H.id)}else{D=F.isSplitButton?(F.ariaArrowElAttributes||(F.ariaArrowElAttributes={})):(F.ariaRenderAttributes||(F.ariaRenderAttributes={}));D["aria-haspopup"]=true;D["aria-owns"]=H.id}}else{if(F.rendered){A.removeAttribute("aria-haspopup");A.removeAttribute("aria-owns");F._removeSplitCls();F.updateLayout()}else{D=F.isSplitButton?F.ariaArrowElAttributes:F.ariaRenderAttributes;if(D){delete D["aria-haspopup"];delete D["aria-owns"]}}F.split=false;F.menu=null}},onRender:function(){var C=this,D,A,B;C.callParent(arguments);A=C.el;if(C.tooltip){C.setTooltip(C.tooltip,true)}if(C.handleMouseEvents){B={scope:C,mouseover:C.onMouseOver,mouseout:C.onMouseOut,mousedown:C.onMouseDown};if(C.split){B.mousemove=C.onMouseMove}}else{B={scope:C}}if(Ext.supports.Touch){B.touchstart=C.onTouchStart}if(C.repeat){C.mon(new Ext.util.ClickRepeater(A,Ext.isObject(C.repeat)?C.repeat:{}),"click",C.onRepeatClick,C)}else{if(B[C.clickEvent]){D=true}else{B[C.clickEvent]=C.onClick}}C.mon(A,B);if(C.hasFrameTable()){C.mon(C.frameTable,"click",C.frameTableListener,C)}if(D){C.mon(A,C.clickEvent,C.onClick,C)}Ext.button.Manager.register(C)},onFocusLeave:function(A){this.callParent([A]);if(this.menu){this.menu.hide()}},getTemplateArgs:function(){var H=this,C=H._btnCls,E=H._baseIconCls,A=H.getIconAlign(),I=H.glyph,G=Ext._glyphFontFamily,J=H.text,D=H._hasIcon(),F=H._hasIconCls,B;if(typeof I==="string"){B=I.split("@");I=B[0];G=B[1]}return{split:H.isSplitButton,innerCls:H._innerCls,splitCls:H.getArrowVisible()?H.getSplitCls():"",iconUrl:H.icon,iconCls:H.iconCls,glyph:I,glyphCls:I?H._glyphCls:"",glyphFontFamily:G,text:J||"&#160;",closeText:H.closeText,textCls:J?H._textCls:"",noTextCls:J?"":H._noTextCls,hasIconCls:D?F:"",btnWrapCls:H._btnWrapCls,btnWrapStyle:H.width?"table-layout:fixed;":"",btnElStyle:H.height?"height:auto;":"",btnCls:C,baseIconCls:E,iconBeforeText:A==="left"||A==="top",iconAlignCls:D?(F+"-"+A):"",textAlignCls:C+"-"+H.getTextAlign(),arrowElCls:H._arrowElCls,tabIndex:H.tabIndex}},renderIcon:function(A){return this.getTpl("iconTpl").apply(A)},setHref:function(A){var B=this,D=B.hrefTarget,C;B.href=A;if(!B.configuredWithPreventDefault){B.preventDefault=!A}if(B.rendered){C=B.el.dom;if(!A||B.disabled){C.removeAttribute("href");C.removeAttribute("hrefTarget")}else{C.href=B.getHref();if(D){C.target=D}}}},getHref:function(){var B=this,A=B.href;return A?Ext.urlAppend(A,Ext.Object.toQueryString(Ext.apply({},B.params,B.baseParams))):false},setParams:function(C){var A=this,B;A.params=C;if(A.rendered){B=A.el.dom;if(A.disabled){B.removeAttribute("href")}else{B.href=A.getHref()||""}}},getSplitCls:function(){var A=this;return A.split?(A.baseCls+"-"+A.arrowCls)+" "+(A.baseCls+"-"+A.arrowCls+"-"+A.arrowAlign):""},setIcon:function(B){B=B||"";var C=this,A=C.btnIconEl,D=C.icon||"";C.icon=B;if(B!==D){if(A){A.setStyle("background-image",B?"url("+B+")":"");C._syncHasIconCls();if(C.didIconStateChange(D,B)){C.updateLayout()}}C.fireEvent("iconchange",C,D,B)}return C},setIconCls:function(B){B=B||"";var D=this,A=D.btnIconEl,C=D.iconCls||"";D.iconCls=B;if(C!==B){if(A){A.removeCls(C);A.addCls(B);D._syncHasIconCls();if(D.didIconStateChange(C,B)){D.updateLayout()}}D.fireEvent("iconchange",D,C,B)}return D},setGlyph:function(F){F=F||0;var E=this,B=E.btnIconEl,C=E.glyph,G=E._glyphCls,A,D;E.glyph=F;if(B){if(typeof F==="string"){D=F.split("@");F=D[0];A=D[1]||Ext._glyphFontFamily}if(!F){B.dom.innerHTML="";B.removeCls(G)}else{if(C!==F){B.dom.innerHTML="&#"+F+";";B.addCls(G)}}if(A){B.setStyle("font-family",A)}E._syncHasIconCls();if(E.didIconStateChange(C,F)){E.updateLayout()}}E.fireEvent("glyphchange",E,E.glyph,C);return E},setTooltip:function(C,A){var B=this;if(B.rendered){if(!A||!C){B.clearTip()}if(C){if(Ext.quickTipsActive&&Ext.isObject(C)){Ext.tip.QuickTipManager.register(Ext.apply({target:B.el.id},C));B.tooltip=C}else{B.el.dom.setAttribute(B.getTipAttr(),C)}}}else{B.tooltip=C}return B},updateIconAlign:function(F,D){var C=this,B,A,E;if(C.rendered){B=C.btnEl;A=C.btnIconEl;E=C._hasIconCls;if(D){B.removeCls(E+"-"+D)}B.addCls(E+"-"+F);if(F==="top"||F==="left"){B.insertFirst(A)}else{B.appendChild(A)}C.updateLayout()}},updateTextAlign:function(E,D){var C=this,B=C.btnEl,A=C._btnCls;if(C.rendered){B.removeCls(A+"-"+D);B.addCls(A+"-"+E)}},getTipAttr:function(){return this.tooltipType==="qtip"?"data-qtip":"title"},getRefItems:function(A){var C=this.menu,B;if(C){B=C.getRefItems(A);B.unshift(C)}return B||[]},clearTip:function(){var B=this,A=B.el;if(Ext.quickTipsActive&&Ext.isObject(B.tooltip)){Ext.tip.QuickTipManager.unregister(A)}else{A.dom.removeAttribute(B.getTipAttr())}},beforeDestroy:function(){var A=this;if(A.rendered){A.clearTip()}Ext.destroy(A.repeater);A.callParent()},onDestroy:function(){var A=this,B=A.menu;if(A.rendered){Ext.destroy(A.keyMap);delete A.keyMap}if(B&&A.destroyMenu){A.menu=Ext.destroy(B)}Ext.button.Manager.unregister(A);A.callParent()},setHandler:function(B,A){this.handler=B;if(arguments.length>1){this.scope=A}return this},updateText:function(D,A){D=D==null?"":String(D);A=A||"";var C=this,E=C.btnInnerEl,B=C.btnEl;if(C.rendered){E.setHtml(D||"&#160;");B[D?"addCls":"removeCls"](C._textCls);B[D?"removeCls":"addCls"](C._noTextCls);C.updateLayout()}C.fireEvent("textchange",C,A,D)},didIconStateChange:function(A,C){var B=Ext.isEmpty(C);return Ext.isEmpty(A)?!B:B},click:function(A){return this.onClick(A)},setPressed:function(A){return this.toggle(A!==false)},toggle:function(D,B){var C=this,A=C.ariaEl.dom;D=D===undefined?!C.pressed:!!D;if(C.fireEvent("beforetoggle",C,D)!==false){if(D!==C.pressed){C[D?"addCls":"removeCls"](C._pressedCls);C.pressed=D;if(A){A.setAttribute("aria-pressed",D)}if(!B){C.fireEvent("toggle",C,D);Ext.callback(C.toggleHandler,C.scope,[C,D],0,C);if(C.reference&&C.publishState){C.publishState("pressed",D)}}}}return C},maybeShowMenu:function(A){if(this.menu){this.showMenu(A)}},showMenu:function(A){var C=this,D=C.menu,B=!A||A.pointerType;if(D&&C.rendered){if(C.tooltip&&Ext.quickTipsActive&&C.getTipAttr()!=="title"){Ext.tip.QuickTipManager.getQuickTip().cancelShow(C.el)}if(D.isVisible()){if(B){D.hide()}else{D.focus()}}else{if(!A||C.showEmptyMenu||D.items.getCount()>0){D.autoFocus=!B;D.showBy(C.el,C.menuAlign)}}}return C},hideMenu:function(){if(this.hasVisibleMenu()){this.menu.hide()}return this},hasVisibleMenu:function(){var A=this.menu;return A&&A.rendered&&A.isVisible()},onRepeatClick:function(A,B){this.onClick(B)},onTouchStart:function(A){this.doPreventDefault(A)},onEnterKey:function(A){this.onClick(A);A.stopEvent();return false},onClick:function(B){var A=this;A.doPreventDefault(B);if(B.type!=="keydown"&&B.button){return }if(!A.disabled){A.doToggle();A.maybeShowMenu(B);A.fireHandler(B)}},doPreventDefault:function(A){if(A&&(this.preventDefault||(this.disabled&&this.getHref()))){A.preventDefault()}},fireHandler:function(B){var A=this;if(A.fireEvent("click",A,B)!==false&&!A.destroyed){Ext.callback(A.handler,A.scope,[A,B],0,A)}},doToggle:function(){var A=this;if(A.enableToggle&&(A.allowDepress!==false||!A.pressed)){A.toggle()}},onMouseOver:function(B){var A=this;if(!A.disabled&&!B.within(A.el,true,true)){A.onMouseEnter(B)}},onMouseOut:function(B){var A=this;if(!B.within(A.el,true,true)){if(A.overMenuTrigger){A.onMenuTriggerOut(B)}A.onMouseLeave(B)}},onMouseMove:function(C){var A=this,B=A.overMenuTrigger;if(A.split){if(A.isWithinTrigger(C)){if(!B){A.onMenuTriggerOver(C)}}else{if(B){A.onMenuTriggerOut(C)}}}},isWithinTrigger:function(D){var C=this,B=C.el,E,A;E=(C.arrowAlign==="right")?D.getX()-C.getX():D.getY()-B.getY();A=C.getTriggerRegion();return E>A.begin&&E<A.end},getTriggerRegion:function(){var D=this,E=D._triggerRegion,C=D.arrowAlign==="right",B=C?"getRight":"getBottom",A=C?D.getWidth():D.getHeight();E.begin=A-(D.el[B]()-D.btnEl[B]());E.end=A;return E},onMouseEnter:function(A){this.fireEvent("mouseover",this,A)},onMouseLeave:function(A){this.fireEvent("mouseout",this,A)},onMenuTriggerOver:function(C){var B=this,A=B.arrowTooltip;B.overMenuTrigger=true;if(B.split&&A){B.btnWrap.dom.setAttribute(B.getTipAttr(),A)}B.fireEvent("menutriggerover",B,B.menu,C)},onMenuTriggerOut:function(B){var A=this;delete A.overMenuTrigger;if(A.split&&A.arrowTooltip){A.btnWrap.dom.setAttribute(A.getTipAttr(),"")}A.fireEvent("menutriggerout",A,A.menu,B)},onEnable:function(){var B=this,A=B.href,D=B.hrefTarget,C=B.el.dom;B.callParent();B.removeCls(B._disabledCls);C.setAttribute("tabIndex",B.tabIndex);if(A){C.href=A}if(D){C.target=D}},onDisable:function(){var A=this,B=A.el.dom;A.callParent();A.addCls(A._disabledCls);A.removeCls(A.overCls);B.removeAttribute("tabIndex");if(A.href){B.removeAttribute("href")}if(A.hrefTarget){B.removeAttribute("target")}},setScale:function(C){var A=this,B=A.ui.replace("-"+A.scale,"");if(!Ext.Array.contains(A.allowedScales,C)){throw ("#setScale: scale must be an allowed scale ("+A.allowedScales.join(", ")+")")}A.scale=C;A.setUI(B)},setUI:function(B){var A=this;if(A.scale&&!B.match(A.scale)){B=B+"-"+A.scale}A.callParent([B])},onMouseDown:function(B){var A=this;if(Ext.isIE||B.pointerType==="touch"){Ext.defer(function(){var C=A.getFocusEl();if(C&&!B.defaultPrevented){C.focus()}},1)}if(!A.disabled&&B.button===0){Ext.button.Manager.onButtonMousedown(A,B);A.addCls(A._pressedCls)}},onMouseUp:function(B){var A=this;if(!A.destroyed&&B.button===0){if(!A.pressed){A.removeCls(A._pressedCls)}}},onMenuShow:function(){var A=this;A.addCls(A._menuActiveCls);A.fireEvent("menushow",A,A.menu)},onMenuHide:function(B){var A=this;A.removeCls(A._menuActiveCls);A.fireEvent("menuhide",A,A.menu)},onDownKey:function(B){var A=this;if(A.menu&&!A.disabled){A.showMenu(B);B.stopEvent();return false}},updateArrowVisible:function(B){var A=this;if(A.rendered){if(B){if(A.menu||A.isSplitButton){A.split=true;A._addSplitCls()}}else{A._removeSplitCls();A.split=false}}return B},privates:{addOverCls:function(){if(!this.disabled){this.addCls(this.overCls)}},_addSplitCls:function(){var A=this;A.btnWrap.addCls(A.getSplitCls())},getTdCls:function(){return Ext.baseCSSPrefix+"button-"+this.ui+"-"+this.scale+"-cell"},removeOverCls:function(){this.removeCls(this.overCls)},_removeSplitCls:function(){var A=this;A.btnWrap.removeCls(A.getSplitCls())},_syncHasIconCls:function(){var B=this,A=B.btnEl,C=B._hasIconCls;if(A){A[B._hasIcon()?"addCls":"removeCls"]([C,C+"-"+B.iconAlign])}},_hasIcon:function(){return !!(this.icon||this.iconCls||this.glyph)},wrapPrimaryEl:function(A){this.el=new Ext.dom.ButtonElement(A);this.callParent([A])}}})