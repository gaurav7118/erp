Ext.define("Ext.dashboard.Dashboard",{extend:"Ext.panel.Panel",xtype:"dashboard",requires:["Ext.layout.container.Dashboard","Ext.dashboard.DropZone","Ext.dashboard.Column","Ext.dashboard.Part"],isDashboard:true,cls:Ext.baseCSSPrefix+"dashboard",bodyCls:Ext.baseCSSPrefix+"dashboard-body",defaultType:"dashboard-column",scrollable:true,layout:null,stateful:false,idSeed:1,config:{parts:null},renderConfig:{maxColumns:4},initComponent:function(){var A=this;if(!A.layout){A.layout={type:"dashboard"}}A.callParent()},applyParts:function(B,C){if(!C){C=new Ext.util.Collection({decoder:Ext.Factory.part})}var D,A;for(D in B){A=B[D];if(Ext.isString(A)){A={type:A}}A.id=D;A.dashboard=this;C.add(A)}return C},getPart:function(A){var B=this.getParts();return B.getByKey(A)},addNew:function(C,B,E){var D=this,A=D.getPart(C);A.displayForm(null,null,function(F){F.type=C;D.addView(F,B,E)})},addView:function(J,E,H){var G=this,F=G.query("dashboard-column"),C=F.length,D=E||0,I=J.id?J:G.createView(J),A=G.columnWidths,B;if(!C){B=G.add(0,G.createColumn({columnWidth:(Ext.isArray(A)?A[0]:1)}));F=[B];C=1}if(D>=C){D=C-1;H=1}if(!H){B=F[D];if(B){return B.add(I)}}if(H>0){++D}B=G.createColumn();if(A){B.columnWidth=A[D]||(A[D]=1)}if(!B.items){B.items=[]}B.items.push(I);B=G.add(B);return B.items.first()},createColumn:function(A){var B=this.cycleLayout;return Ext.apply({items:[],bubbleEvents:["add","remove","childmove","resize"],listeners:{remove:this.onRemoveItem,expand:B,collapse:B,scope:this}},A)},createView:function(C){var E=this,D=C.type,B=E.getPart(D),A=B.createView(C);if(!A.id){A.id=E.id+"_"+D+(E.idSeed++)}A.bubbleEvents=Ext.Array.from(A.bubbleEvents).concat(["expand","collapse"]);A.stateful=E.stateful;return A},initEvents:function(){this.callParent();this.dd=new Ext.dashboard.DropZone(this,this.dropConfig)},cycleLayout:function(){this.updateLayout()},beforeDestroy:function(){if(this.dd){Ext.destroy(this.dd)}this.callParent()},applyState:function(F){delete F.items;var E=this;E.callParent([F]);var B=F.columnWidths,A=E.items.items,D=A.length,C,G;if(B){G=B.length;E.columnWidths=[];for(C=0;C<D;++C){E.columnWidths.push(A[C].columnWidth=(C<G)?B[C]:(1/D))}}},getState:function(){var F=this,B=[],A=F.items.items,G=F.callParent()||{},E=A.length,C,D;for(C=0;C<E;++C){if(!(D=A[C]).isSplitter){B.push(D.columnWidth)}}G.columnWidths=B;G.idSeed=F.idSeed;G.items=F.serializeItems();F.columnWidths=B;return G},initItems:function(){var B=this,A=B.defaultContent,C;if(B.stateful){C=Ext.state.Manager.get(B.getStateId());A=(C&&C.items)||A}if(!B.items&&A){B.items=B.deserializeItems(A)}B.callParent()},deserializeItems:function(F){var I=this,C=F.length,E=[],A=I.columnWidths,L=I.getMaxColumns(),D,H,B,G,K,J;for(G=0;G<C;++G){J=F[G];H=Math.min(J.columnIndex||0,L-1);delete J.columnIndex;if(!(D=E[H])){E[H]=D=I.createColumn();B=A&&A[H];if(B){D.columnWidth=B}}K=I.createView(J);D.items.push(K)}for(G=0,C=E.length;G<C;++G){D=E[G];if(!D.columnWidth){D.columnWidth=1/C}}return E},serializeItem:function(A){return Ext.apply({type:A.part.id,id:A.id,columnIndex:A.columnIndex},A._partConfig)},serializeItems:function(){var J=this,I=J.items.items,B=I.length,H=[],G=0,A,F,E,K,D,C;for(E=0;E<B;++E){K=I[E];if(!K.isSplitter){F=K.items.items;for(D=0,C=F.length;D<C;++D){A=F[D];A.columnIndex=G;H.push(J.serializeItem(A))}++G}}return H},onRemoveItem:function(A,B){if(B.stateful&&!B.isMoving){Ext.state.Manager.clear(B.getStateId())}}})