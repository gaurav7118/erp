Ext.define("Ext.dd.DragTracker",{uses:["Ext.util.Region"],mixins:{observable:"Ext.util.Observable"},active:false,trackOver:false,tolerance:5,autoStart:false,constructor:function(A){var B=this;Ext.apply(B,A);B.dragRegion=new Ext.util.Region(0,0,0,0);if(B.el){B.initEl(B.el)}B.mixins.observable.constructor.call(B);if(B.disabled){B.disable()}},initEl:function(B){var C=this,A=C.delegate;C.el=B=Ext.get(B);if(A&&A.isElement){C.handle=A}C.delegate=C.handle?undefined:C.delegate;if(!C.handle){C.handle=B}C.handleListeners={scope:C,delegate:C.delegate,mousedown:C.onMouseDown,dragstart:C.onDragStart};if(!Ext.supports.TouchEvents&&(C.trackOver||C.overCls)){Ext.apply(C.handleListeners,{mouseover:C.onMouseOver,mouseout:C.onMouseOut})}C.mon(C.handle,C.handleListeners);C.keyNav=new Ext.util.KeyNav({target:B,up:C.onResizeKeyDown,left:C.onResizeKeyDown,right:C.onResizeKeyDown,down:C.onResizeKeyDown,scope:C})},disable:function(){this.disabled=true},enable:function(){this.disabled=false},destroy:function(){var A=this;A.endDrag({});A.el=A.handle=A.onBeforeStart=A.onStart=A.onDrag=A.onEnd=null;A.callParent()},onMouseOver:function(H,G){var E=this,F,D,C,A,B;if(!E.disabled){if(H.within(H.target,true,true)||E.delegate){F=E.handleCls;E.mouseIsOut=false;if(F){for(C=0,A=E.handleEls.length;C<A;C++){D=E.handleEls[C];B=D.delegateCls;if(!B){B=D.delegateCls=[F,"-",D.region,"-over"].join("")}D.addCls([B,E.overCls])}}E.fireEvent("mouseover",E,H,E.delegate?H.getTarget(E.delegate,G):E.handle)}}},onMouseOut:function(E){var D=this,C,B,A;if(D.mouseIsDown){D.mouseIsOut=true}else{if(D.handleCls){for(B=0,A=D.handleEls.length;B<A;B++){C=D.handleEls[B];C.removeCls([C.delegateCls,D.overCls])}}D.fireEvent("mouseout",D,E)}},onMouseDown:function(C,B){var A=this;if(A.disabled||C.dragTracked){return }A.dragTarget=A.delegate?B:A.handle.dom;A.startXY=A.lastXY=C.getXY();A.startRegion=Ext.fly(A.dragTarget).getRegion();if(A.fireEvent("mousedown",A,C)===false||A.fireEvent("beforedragstart",A,C)===false||A.onBeforeStart(C)===false){return }A.mouseIsDown=true;C.dragTracked=true;A.el.setCapture();C.stopPropagation();if(A.preventDefault!==false){C.preventDefault()}Ext.getDoc().on({scope:A,capture:true,mouseup:A.onMouseUp,mousemove:A.onMouseMove,selectstart:A.stopSelect});A.dragEnded=false;if(!A.tolerance){A.triggerStart()}else{if(A.autoStart){A.timer=Ext.defer(A.triggerStart,A.autoStart===true?1000:A.autoStart,A,[C])}}},onMouseMove:function(E,D){var B=this,C=E.getXY(),A=B.startXY;E.stopPropagation();if(B.preventDefault!==false){E.preventDefault()}if(B.dragEnded){return }B.lastXY=C;if(!B.active){if(Math.max(Math.abs(A[0]-C[0]),Math.abs(A[1]-C[1]))>B.tolerance){B.triggerStart(E)}else{return }}if(B.fireEvent("mousemove",B,E)===false){B.onMouseUp(E)}else{B.onDrag(E);B.fireEvent("drag",B,E)}},onMouseUp:function(B){var A=this;A.mouseIsDown=false;if(A.mouseIsOut){A.mouseIsOut=false;A.onMouseOut(B)}if(A.preventDefault!==false){B.preventDefault()}if(Ext.isIE&&document.releaseCapture){document.releaseCapture()}A.fireEvent("mouseup",A,B);A.endDrag(B)},endDrag:function(C){var B=this,A=B.active;Ext.getDoc().un({mousemove:B.onMouseMove,mouseup:B.onMouseUp,selectstart:B.stopSelect,capture:true,scope:B});B.clearStart();B.active=false;if(A){B.dragEnded=true;B.onEnd(C);B.fireEvent("dragend",B,C)}B._constrainRegion=null},triggerStart:function(B){var A=this;A.clearStart();A.active=true;A.onStart(B);A.fireEvent("dragstart",A,B)},clearStart:function(){var A=this.timer;if(A){clearTimeout(A);this.timer=null}},stopSelect:function(A){A.stopEvent();return false},onBeforeStart:function(A){},onStart:function(A){},onDrag:function(A){},onEnd:function(A){},getDragTarget:function(){return this.dragTarget},getDragCt:function(){return this.el},getConstrainRegion:function(){var A=this;if(A.constrainTo){if(A.constrainTo instanceof Ext.util.Region){return A.constrainTo}if(!A._constrainRegion){A._constrainRegion=Ext.fly(A.constrainTo).getViewRegion()}}else{if(!A._constrainRegion){A._constrainRegion=A.getDragCt().getViewRegion()}}return A._constrainRegion},getXY:function(A){return A?this.constrainModes[A](this,this.lastXY):this.lastXY},getOffset:function(C){var B=this.getXY(C),A=this.startXY;return[B[0]-A[0],B[1]-A[1]]},onDragStart:function(A){A.stopPropagation()},constrainModes:{point:function(B,D){var C=B.dragRegion,A=B.getConstrainRegion();if(!A){return D}C.x=C.left=C[0]=C.right=D[0];C.y=C.top=C[1]=C.bottom=D[1];C.constrainTo(A);return[C.left,C.top]},dragTarget:function(C,F){var B=C.startXY,E=C.startRegion.copy(),A=C.getConstrainRegion(),D;if(!A){return F}E.translateBy(F[0]-B[0],F[1]-B[1]);if(E.right>A.right){F[0]+=D=(A.right-E.right);E.left+=D}if(E.left<A.left){F[0]+=(A.left-E.left)}if(E.bottom>A.bottom){F[1]+=D=(A.bottom-E.bottom);E.top+=D}if(E.top<A.top){F[1]+=(A.top-E.top)}return F}}})