Ext.define("Ext.form.Labelable",{extend:"Ext.Mixin",requires:["Ext.XTemplate","Ext.overrides.dom.Element"],isLabelable:true,mixinConfig:{id:"labelable",on:{beforeRender:"beforeLabelRender",onRender:"onLabelRender"}},config:{childEls:["labelEl","bodyEl","errorEl","errorWrapEl","ariaErrorEl"]},labelableRenderTpl:["{beforeLabelTpl}",'<label id="{id}-labelEl" data-ref="labelEl" class="{labelCls} {labelCls}-{ui} {labelClsExtra} ','{childElCls} {unselectableCls}" style="{labelStyle}"<tpl if="inputId">',' for="{inputId}"</tpl> {labelAttrTpl}>','<span class="{labelInnerCls} {labelInnerCls}-{ui}" style="{labelInnerStyle}">',"{beforeLabelTextTpl}",'<tpl if="fieldLabel">{fieldLabel}','<tpl if="labelSeparator">{labelSeparator}</tpl>',"</tpl>","{afterLabelTextTpl}","</span>","</label>","{afterLabelTpl}",'<div id="{id}-bodyEl" data-ref="bodyEl" role="presentation"',' class="{baseBodyCls} {baseBodyCls}-{ui}<tpl if="fieldBodyCls">',' {fieldBodyCls} {fieldBodyCls}-{ui}</tpl> {growCls} {extraFieldBodyCls}"','<tpl if="bodyStyle"> style="{bodyStyle}"</tpl>>',"{beforeBodyEl}","{beforeSubTpl}","{[values.$comp.getSubTplMarkup(values)]}","{afterSubTpl}","{afterBodyEl}",'<div id="{id}-ariaErrorEl" data-ref="ariaErrorEl" role="alert" aria-live="polite"',' class="'+Ext.baseCSSPrefix+'hidden-clip">',"</div>","</div>",'<tpl if="renderError">','<div id="{id}-errorWrapEl" data-ref="errorWrapEl" class="{errorWrapCls} {errorWrapCls}-{ui}',' {errorWrapExtraCls}" style="{errorWrapStyle}">','<div role="presentation" id="{id}-errorEl" data-ref="errorEl" ','class="{errorMsgCls} {invalidMsgCls} {invalidMsgCls}-{ui}" ','data-anchorTarget="{tipAnchorTarget}">',"</div>","</div>","</tpl>",{disableFormats:true}],activeErrorsTpl:undefined,htmlActiveErrorsTpl:['<tpl if="errors && errors.length">','<ul class="{listCls}">','<tpl for="errors"><li>{.}</li></tpl>',"</ul>","</tpl>"],plaintextActiveErrorsTpl:['<tpl if="errors && errors.length">','<tpl for="errors"><tpl if="xindex &gt; 1">\n</tpl>{.}</tpl>',"</tpl>"],isFieldLabelable:true,formItemCls:Ext.baseCSSPrefix+"form-item",labelCls:Ext.baseCSSPrefix+"form-item-label",topLabelCls:Ext.baseCSSPrefix+"form-item-label-top",rightLabelCls:Ext.baseCSSPrefix+"form-item-label-right",labelInnerCls:Ext.baseCSSPrefix+"form-item-label-inner",topLabelSideErrorCls:Ext.baseCSSPrefix+"form-item-label-top-side-error",errorMsgCls:Ext.baseCSSPrefix+"form-error-msg",errorWrapCls:Ext.baseCSSPrefix+"form-error-wrap",errorWrapSideCls:Ext.baseCSSPrefix+"form-error-wrap-side",errorWrapUnderCls:Ext.baseCSSPrefix+"form-error-wrap-under",errorWrapUnderSideLabelCls:Ext.baseCSSPrefix+"form-error-wrap-under-side-label",baseBodyCls:Ext.baseCSSPrefix+"form-item-body",invalidIconCls:Ext.baseCSSPrefix+"form-invalid-icon",invalidUnderCls:Ext.baseCSSPrefix+"form-invalid-under",noLabelCls:Ext.baseCSSPrefix+"form-item-no-label",fieldBodyCls:"",invalidCls:Ext.baseCSSPrefix+"form-invalid",fieldLabel:undefined,labelAlign:"left",labelWidth:100,labelPad:5,labelSeparator:":",hideLabel:false,hideEmptyLabel:true,preventMark:false,autoFitErrors:true,msgTarget:"qtip",msgTargets:{qtip:1,title:1,under:1,side:1,none:1},noWrap:true,labelableInsertions:["beforeBodyEl","afterBodyEl","beforeLabelTpl","afterLabelTpl","beforeSubTpl","afterSubTpl","beforeLabelTextTpl","afterLabelTextTpl","labelAttrTpl"],statics:{initTip:function(){var B=this.tip,A,C;if(B){return }A={id:"ext-form-error-tip",sticky:true,ui:"form-invalid"};if(Ext.supports.Touch){A.dismissDelay=0;A.anchor="top";A.showDelay=0;A.listeners={beforeshow:function(){this.minWidth=Ext.fly(this.anchorTarget).getWidth()}}}B=this.tip=Ext.create("Ext.tip.QuickTip",A);C=Ext.apply({},B.tagConfig);C.attribute="errorqtip";B.setTagConfig(C)},destroyTip:function(){this.tip=Ext.destroy(this.tip)}},initLabelable:function(){var A=this,B=A.padding;if(B){A.padding=undefined;A.extraMargins=Ext.Element.parseBox(B)}if(Ext.isIE8){A.restoreDisplay=Ext.Function.createDelayed(A.doRestoreDisplay,0,A)}if(!A.activeErrorsTpl){if(A.msgTarget==="title"){A.activeErrorsTpl=A.plaintextActiveErrorsTpl}else{A.activeErrorsTpl=A.htmlActiveErrorsTpl}}A.addCls([A.formItemCls,A.formItemCls+"-"+A.ui]);A.lastActiveError="";A.enableBubble("errorchange")},trimLabelSeparator:function(){var C=this,D=C.labelSeparator,A=C.fieldLabel||"",B=A.substr(A.length-1);return B===D?A.slice(0,-1):A},getFieldLabel:function(){return this.trimLabelSeparator()},setFieldLabel:function(D){D=D||"";var E=this,F=E.labelSeparator,C=E.labelEl,B=E.errorWrapEl,H=(E.labelAlign!=="top"),A=E.noLabelCls,G=E.errorWrapUnderSideLabelCls;E.fieldLabel=D;if(E.rendered){if(Ext.isEmpty(D)&&E.hideEmptyLabel){E.addCls(A);if(H&&B){B.removeCls(G)}}else{if(F){D=E.trimLabelSeparator()+F}C.dom.firstChild.innerHTML=D;E.removeCls(A);if(H&&B){B.addCls(G)}}E.updateLayout()}},setHideLabel:function(A){var B=this;if(A!==B.hideLabel){B.hideLabel=A;if(B.rendered){B[A?"addCls":"removeCls"](B.noLabelCls);B.updateLayout()}}},setHideEmptyLabel:function(A){var C=this,B;if(A!==C.hideEmptyLabel){C.hideEmptyLabel=A;if(C.rendered&&!C.hideLabel){B=A&&!C.getFieldLabel();C[B?"addCls":"removeCls"](C.noLabelCls);C.updateLayout()}}},getInsertionRenderData:function(D,E){var B=E.length,A,C;while(B--){A=E[B];C=this[A];if(C){if(typeof C!=="string"){if(!C.isTemplate){C=Ext.XTemplate.getTpl(this,A)}C=C.apply(D)}}D[A]=C||""}return D},getLabelableRenderData:function(){var O=this,R=O.labelAlign,E=(R==="top"),L=(R==="right"),I=(O.msgTarget==="side"),F=(O.msgTarget==="under"),Q=O.errorMsgCls,G=O.labelPad,N=O.labelWidth,B=O.labelClsExtra||"",H=I?O.errorWrapSideCls:O.errorWrapUnderCls,A="",K="",D=O.hasVisibleLabel(),M=O.autoFitErrors,J=O.defaultBodyWidth,C,P;if(E){B+=" "+O.topLabelCls;if(G){K="padding-bottom:"+G+"px;"}if(I&&!M){B+=" "+O.topLabelSideErrorCls}}else{if(L){B+=" "+O.rightLabelCls}if(G){A+=O.getHorizontalPaddingStyle()+G+"px;"}A+="width:"+(N+(G?G:0))+"px;";K="width:"+N+"px"}if(D){if(!E&&F){H+=" "+O.errorWrapUnderSideLabelCls}}if(J){C="min-width:"+J+"px;max-width:"+J+"px;"}P={id:O.id,inputId:O.getInputId(),labelCls:O.labelCls,labelClsExtra:B,labelStyle:A+(O.labelStyle||""),labelInnerStyle:K,labelInnerCls:O.labelInnerCls,unselectableCls:Ext.Element.unselectableCls,bodyStyle:C,baseBodyCls:O.baseBodyCls,fieldBodyCls:O.fieldBodyCls,extraFieldBodyCls:O.extraFieldBodyCls,errorWrapCls:O.errorWrapCls,errorWrapExtraCls:H,renderError:I||F,invalidMsgCls:I?O.invalidIconCls:F?O.invalidUnderCls:"",errorMsgCls:Q,growCls:O.grow?O.growCls:"",tipAnchorTarget:O.id+"-inputEl",errorWrapStyle:(I&&!M)?"visibility:hidden":"display:none",fieldLabel:O.getFieldLabel(),labelSeparator:O.labelSeparator};O.getInsertionRenderData(P,O.labelableInsertions);return P},getHorizontalPaddingStyle:function(){return"padding-right:"},beforeLabelRender:function(){var A=this;A.setFieldDefaults(A.getInherited().fieldDefaults);if(A.ownerLayout){A.addCls(Ext.baseCSSPrefix+A.ownerLayout.type+"-form-item")}if(!A.hasVisibleLabel()){A.addCls(A.noLabelCls)}},onLabelRender:function(){var D=this,C={},F=Ext.Element,A=D.errorWrapEl,E,B;if(A){A.setVisibilityMode((D.msgTarget==="side"&&!D.autoFitErrors)?F.VISIBILITY:F.DISPLAY)}if(D.extraMargins){E=D.el.getMargin();for(B in E){if(E.hasOwnProperty(B)){C["margin-"+B]=(E[B]+D.extraMargins[B])+"px"}}D.el.setStyle(C)}},hasVisibleLabel:function(){if(this.hideLabel){return false}return !(this.hideEmptyLabel&&!this.getFieldLabel())},getSubTplMarkup:function(){return""},getInputId:function(){return""},getActiveError:function(){return this.activeError||""},hasActiveError:function(){return !!this.getActiveError()},setActiveError:function(A){this.setActiveErrors(A)},getActiveErrors:function(){return this.activeErrors||[]},setActiveErrors:function(H){var F=this,G=F.errorWrapEl,D=F.msgTarget,C=D==="side",J=D==="qtip",A,B,E,I;H=Ext.Array.from(H);E=F.getTpl("activeErrorsTpl");F.activeErrors=H;B=F.activeError=E.apply({fieldLabel:F.fieldLabel,errors:H,listCls:Ext.baseCSSPrefix+"list-plain"});F.renderActiveError();if(F.rendered){A=F.getActionEl();if(C){F.errorEl.dom.setAttribute("data-errorqtip",B)}else{if(J){A.dom.setAttribute("data-errorqtip",B)}else{if(D==="title"){A.dom.setAttribute("title",B)}}}if(D!=="title"){F.ariaErrorEl.dom.innerHTML=H.join(". ");A.dom.setAttribute("aria-describedby",F.ariaErrorEl.id)}if(C||J){Ext.form.Labelable.initTip()}if(!F.msgTargets[D]){I=Ext.get(D);if(I){I.dom.innerHTML=B}}}if(G){G.setVisible(H.length>0);if(C&&F.autoFitErrors){F.labelEl.addCls(F.topLabelSideErrorCls)}F.updateLayout()}},unsetActiveError:function(){var E=this,B=E.errorWrapEl,C=E.msgTarget,A=E.restoreDisplay,D,F;if(E.hasActiveError()){delete E.activeError;delete E.activeErrors;E.renderActiveError();if(E.rendered){D=E.getActionEl();if(C==="qtip"){D.dom.removeAttribute("data-errorqtip")}else{if(C==="title"){D.dom.removeAttribute("title")}}if(C!=="title"){E.ariaErrorEl.dom.innerHTML="";D.dom.removeAttribute("aria-describedby")}if(!E.msgTargets[C]){F=Ext.get(C);if(F){F.dom.innerHTML=""}}if(B){B.hide();if(C==="side"&&E.autoFitErrors){E.labelEl.removeCls(E.topLabelSideErrorCls)}E.updateLayout();if(A){E.el.dom.style.display="block";E.restoreDisplay()}}}}},doRestoreDisplay:function(){var A=this.el;if(A&&A.dom){A.dom.style.display=""}},renderActiveError:function(){var C=this,B=C.getActiveError(),A=!!B;if(B!==C.lastActiveError){C.lastActiveError=B;C.fireEvent("errorchange",C,B)}if(C.rendered&&!C.destroyed&&!C.preventMark){C.toggleInvalidCls(A);if(C.errorEl){C.errorEl.dom.innerHTML=B}}},toggleInvalidCls:function(A){this.el[A?"addCls":"removeCls"](this.invalidCls)},setFieldDefaults:function(B){var A;for(A in B){if(!this.hasOwnProperty(A)){this[A]=B[A]}}}},function(){if(Ext.supports.Touch){this.prototype.msgTarget="side"}})