Ext.define("Ext.form.field.Picker",{extend:"Ext.form.field.Text",alias:"widget.pickerfield",alternateClassName:"Ext.form.Picker",requires:["Ext.util.KeyNav"],config:{triggers:{picker:{handler:"onTriggerClick",scope:"this"}}},renderConfig:{editable:true},isPickerField:true,matchFieldWidth:true,pickerAlign:"tl-bl?",openCls:Ext.baseCSSPrefix+"pickerfield-open",isExpanded:false,applyTriggers:function(B){var C=this,A=B.picker;if(!A.cls){A.cls=C.triggerCls}return C.callParent([B])},getSubTplData:function(B){var C=this,D,A;D=C.callParent([B]);if(C.ariaRole){A=D.inputElAriaAttributes;if(A){A["aria-haspopup"]=true;A["aria-expanded"]=false}}return D},initEvents:function(){var A=this;A.callParent();A.keyNav=new Ext.util.KeyNav(A.inputEl,{down:A.onDownArrow,esc:{handler:A.onEsc,scope:A,defaultEventAction:false},scope:A,forceKeyDown:true});if(Ext.isGecko){A.inputEl.dom.setAttribute("autocomplete","off")}},updateEditable:function(A,C){var B=this;if(!A){B.inputEl.on("click",B.onTriggerClick,B)}else{B.inputEl.un("click",B.onTriggerClick,B)}B.callParent([A,C])},onEsc:function(A){if(Ext.isIE){A.preventDefault()}if(this.isExpanded){this.collapse();A.stopEvent()}},onDownArrow:function(B){var A=this;if((B.time-A.lastDownArrow)>150){delete A.lastDownArrow}if(!A.isExpanded){B.stopEvent();A.onTriggerClick();A.lastDownArrow=B.time}else{if(!B.isStopped&&(B.time-A.lastDownArrow)<150){delete A.lastDownArrow}}},expand:function(){var D=this,B,A,C,E;if(D.rendered&&!D.isExpanded&&!D.destroyed){B=D.bodyEl;C=D.getPicker();E=Ext.getDoc();C.setMaxHeight(C.initialConfig.maxHeight);if(D.matchFieldWidth){C.setWidth(D.bodyEl.getWidth())}C.show();D.isExpanded=true;D.alignPicker();B.addCls(D.openCls);if(D.ariaRole){A=D.ariaEl.dom;A.setAttribute("aria-owns",C.listEl?C.listEl.id:C.el.id);A.setAttribute("aria-expanded",true)}D.touchListeners=E.on({translate:false,touchstart:D.collapseIf,scope:D,delegated:false,destroyable:true});D.scrollListeners=Ext.on({scroll:D.onGlobalScroll,scope:D,destroyable:true});Ext.on("resize",D.alignPicker,D,{buffer:1});D.fireEvent("expand",D);D.onExpand()}},onExpand:Ext.emptyFn,alignPicker:function(){if(!this.destroyed){var A=this.getPicker();if(A.isVisible()&&A.isFloating()){this.doAlign()}}},doAlign:function(){var D=this,C=D.picker,A="-above",B;D.picker.alignTo(D.triggerWrap,D.pickerAlign,D.pickerOffset);B=C.el.getY()<D.inputEl.getY();D.bodyEl[B?"addCls":"removeCls"](D.openCls+A);C[B?"addCls":"removeCls"](C.baseCls+A)},collapse:function(){var D=this;if(D.isExpanded&&!D.destroyed&&!D.destroying){var C=D.openCls,B=D.picker,A="-above";B.hide();D.isExpanded=false;D.bodyEl.removeCls([C,C+A]);B.el.removeCls(B.baseCls+A);if(D.ariaRole){D.ariaEl.dom.setAttribute("aria-expanded",false)}D.touchListeners.destroy();D.scrollListeners.destroy();Ext.un("resize",D.alignPicker,D);D.fireEvent("collapse",D);D.onCollapse()}},onCollapse:Ext.emptyFn,collapseIf:function(B){var A=this;if(!A.destroyed&&!B.within(A.bodyEl,false,true)&&!A.owns(B.target)&&!Ext.fly(B.target).isFocusable()){A.collapse()}},getPicker:function(){var B=this,A=B.picker;if(!A){B.creatingPicker=true;B.picker=A=B.createPicker();A.ownerCmp=B;delete B.creatingPicker}return B.picker},onFocusLeave:function(A){this.collapse();this.callParent([A])},getRefItems:function(){var A=[];if(this.picker){A[0]=this.picker}return A},createPicker:Ext.emptyFn,onTriggerClick:function(B){var A=this;if(!A.readOnly&&!A.disabled){if(A.isExpanded){A.collapse()}else{A.expand()}}},beforeDestroy:function(){var B=this,A=B.picker;B.callParent();Ext.un("resize",B.alignPicker,B);Ext.destroy(B.keyNav,A);if(A){B.picker=A.pickerField=null}},privates:{onGlobalScroll:function(A){var B,D,C=this.el;if(A.getElement().contains(C)){B=A.getPosition();D=C.getScrollIntoViewXY(A.getElement(),B.x,B.y);if(this.up("[fixed]")||D.y!==B.y||D.x!==B.x){this.collapse()}}}}})