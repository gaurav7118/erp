Ext.define("Ext.form.field.Text",{extend:"Ext.form.field.Base",alias:"widget.textfield",requires:["Ext.form.field.VTypes","Ext.form.trigger.Trigger","Ext.util.TextMetrics"],alternateClassName:["Ext.form.TextField","Ext.form.Text"],config:{hideTrigger:false,triggers:undefined},renderConfig:{editable:true},growMin:30,growMax:800,growAppend:"W",allowBlank:true,validateBlank:false,allowOnlyWhitespace:true,minLength:0,maxLength:Number.MAX_VALUE,minLengthText:"The minimum length for this field is {0}",maxLengthText:"The maximum length for this field is {0}",blankText:"This field is required",regexText:"",emptyText:"",emptyCls:Ext.baseCSSPrefix+"form-empty-field",requiredCls:Ext.baseCSSPrefix+"form-required-field",valueContainsPlaceholder:false,ariaRole:"textbox",repeatTriggerClick:false,triggerWrapCls:Ext.baseCSSPrefix+"form-trigger-wrap",triggerWrapFocusCls:Ext.baseCSSPrefix+"form-trigger-wrap-focus",triggerWrapInvalidCls:Ext.baseCSSPrefix+"form-trigger-wrap-invalid",fieldBodyCls:Ext.baseCSSPrefix+"form-text-field-body",inputWrapCls:Ext.baseCSSPrefix+"form-text-wrap",inputWrapFocusCls:Ext.baseCSSPrefix+"form-text-wrap-focus",inputWrapInvalidCls:Ext.baseCSSPrefix+"form-text-wrap-invalid",growCls:Ext.baseCSSPrefix+"form-text-grow",needArrowKeys:true,squashMouseUp:{mouseup:function(){},translate:false,single:true,preventDefault:true},childEls:["triggerWrap","inputWrap"],preSubTpl:['<div id="{cmpId}-triggerWrap" data-ref="triggerWrap"',' role="presentation" class="{triggerWrapCls} {triggerWrapCls}-{ui}">','<div id={cmpId}-inputWrap data-ref="inputWrap"',' role="presentation" class="{inputWrapCls} {inputWrapCls}-{ui}">'],postSubTpl:["</div>",'<tpl for="triggers">{[values.renderTrigger(parent)]}</tpl>',"</div>"],initComponent:function(){var B=this,A=B.emptyCls;if(B.allowOnlyWhitespace===false){B.allowBlank=false}if(B.size){Ext.log.warn('Ext.form.field.Text "size" config was deprecated in Ext 5.0. Please specify a "width" or use a layout instead.')}if(B.size){B.defaultBodyWidth=B.size*6.5+20}if(!B.onTrigger1Click){B.onTrigger1Click=B.onTriggerClick}B.callParent();if(B.readOnly){B.setReadOnly(B.readOnly)}B.fieldFocusCls=B.baseCls+"-focus";B.emptyUICls=A+" "+A+"-"+B.ui;B.addStateEvents("change")},initEvents:function(){var B=this,A=B.inputEl;B.callParent();if(B.selectOnFocus||B.emptyText){B.mon(A,"mousedown",B.onMouseDown,B)}if(B.maskRe||(B.vtype&&B.disableKeyFilter!==true&&(B.maskRe=Ext.form.field.VTypes[B.vtype+"Mask"]))){B.mon(A,"keypress",B.filterKeys,B)}if(B.enableKeyEvents){B.mon(A,{scope:B,keyup:B.onKeyUp,keydown:B.onKeyDown,keypress:B.onKeyPress})}},isEqual:function(B,A){return this.isEqualAsString(B,A)},onChange:function(B,A){this.callParent(arguments);this.autoSize()},getSubTplData:function(C){var D=this,F=D.getRawValue(),H=D.emptyText&&F.length<1,A=D.maxLength,G,E,B;if(D.enforceMaxLength){if(A===Number.MAX_VALUE){A=undefined}}else{A=undefined}if(H){if(Ext.supports.Placeholder){G=D.emptyText}else{F=D.emptyText;D.valueContainsPlaceholder=true}}E=Ext.apply(D.callParent([C]),{triggerWrapCls:D.triggerWrapCls,inputWrapCls:D.inputWrapCls,triggers:D.orderedTriggers,maxLength:A,readOnly:!D.editable||D.readOnly,placeholder:G,value:F,fieldCls:D.fieldCls+((H&&(G||F))?" "+D.emptyUICls:"")+(D.allowBlank?"":" "+D.requiredCls)});B=E.inputElAriaAttributes;if(B){B["aria-required"]=!D.allowBlank}return E},onRender:function(){var C=this,B=C.getTriggers(),D=[],E,A;if(Ext.supports.FixedTableWidthBug){C.el._needsTableWidthFix=true}C.callParent();if(B){this.invokeTriggers("onFieldRender");for(E in B){D.push(B[E].el)}A=C.triggerEl=C.triggerCell=new Ext.CompositeElement(D,true)}C.inputCell=C.inputWrap},afterRender:function(){var A=this;A.autoSize();A.callParent();A.invokeTriggers("afterFieldRender")},onMouseDown:function(){if(!this.hasFocus){Ext.getDoc().on(this.squashMouseUp)}},applyTriggers:function(G){var H=this,C=H.getHideTrigger(),J=H.readOnly,K=H.orderedTriggers=[],I=H.repeatTriggerClick,B,F,D,A,E;if(H.rendered){Ext.raise("Cannot set triggers after field has already been rendered.")}if((H.triggerCls&&!G)||H.trigger1Cls){Ext.log.warn("Ext.form.field.Text: 'triggerCls' and 'trigger<n>Cls' are deprecated.  Use 'triggers' instead.")}if(!G){G={};if(H.triggerCls&&!H.trigger1Cls){H.trigger1Cls=H.triggerCls}for(E=1;A=H["trigger"+E+"Cls"];E++){G["trigger"+E]={cls:A,extraCls:Ext.baseCSSPrefix+"trigger-index-"+E,handler:"onTrigger"+E+"Click",compat4Mode:true,scope:H}}}for(B in G){if(G.hasOwnProperty(B)){F=G[B];F.field=H;F.id=B;if((J&&F.hideOnReadOnly!==false)||(C&&F.hidden!==false)){F.hidden=true}if(I&&(F.repeatClick!==false)){F.repeatClick=true}D=G[B]=Ext.form.trigger.Trigger.create(F);K.push(D)}}Ext.Array.sort(K,Ext.form.trigger.Trigger.weightComparator);return G},invokeTriggers:function(A,C){var E=this,D=E.getTriggers(),F,B;if(D){for(F in D){if(D.hasOwnProperty(F)){B=D[F];B[A].apply(B,C||[])}}}},getTrigger:function(A){return this.getTriggers()[A]},updateHideTrigger:function(A){this.invokeTriggers(A?"hide":"show")},updateEditable:function(A,B){this.setReadOnlyAttr(!A||this.readOnly)},setReadOnly:function(F){var D=this,C=D.getTriggers(),B=D.getHideTrigger(),A,E;F=!!F;D.callParent([F]);if(D.rendered){D.setReadOnlyAttr(F||!D.editable)}if(C){for(E in C){A=C[E];if(A.hideOnReadOnly===true||(A.hideOnReadOnly!==false&&!B)){A.setVisible(!F)}}}},setReadOnlyAttr:function(D){var B=this,A="readonly",C=B.inputEl.dom;if(D){C.setAttribute(A,A)}else{C.removeAttribute(A)}if(B.ariaRole){B.ariaEl.dom.setAttribute("aria-readonly",!!D)}},processRawValue:function(C){var B=this,E=B.stripCharsRe,A,D;if(E){if(!E.global){A="g";A+=(E.ignoreCase)?"i":"";A+=(E.multiline)?"m":"";E=new RegExp(E.source,A)}D=C.replace(E,"");if(D!==C){B.setRawValue(D);C=D}}return C},onDisable:function(){this.callParent();if(Ext.isIE){this.inputEl.dom.unselectable="on"}},onEnable:function(){this.callParent();if(Ext.isIE){this.inputEl.dom.unselectable=""}},onKeyDown:function(A){this.fireEvent("keydown",this,A)},onKeyUp:function(A){this.fireEvent("keyup",this,A)},onKeyPress:function(A){this.fireEvent("keypress",this,A)},reset:function(){this.callParent();this.applyEmptyText()},applyEmptyText:function(){var B=this,A=B.emptyText,C;if(B.rendered&&A){C=B.getRawValue().length<1&&!B.hasFocus;if(Ext.supports.Placeholder){B.inputEl.dom.placeholder=A}else{if(C){B.setRawValue(A);B.valueContainsPlaceholder=true}}if(C){B.inputEl.addCls(B.emptyUICls)}else{B.inputEl.removeCls(B.emptyUICls)}B.autoSize()}},getEmptyText:function(){return this.emptyText},setEmptyText:function(D){var C=this,E=C.inputEl,B=E&&E.dom,A=D||"";if(D){C.emptyText=A;C.applyEmptyText()}else{if(B){if(Ext.supports.Placeholder){B.removeAttribute("placeholder")}else{if(B.value!==C.getRawValue()){B.value="";E.removeCls(C.emptyUICls)}}C.valueContainsPlaceholder=false}}C.emptyText=A;return C},afterFirstLayout:function(){this.callParent();if(Ext.isIE&&this.disabled){var A=this.inputEl;if(A){A.dom.unselectable="on"}}},toggleInvalidCls:function(A){var B=A?"addCls":"removeCls";this.callParent();this.triggerWrap[B](this.triggerWrapInvalidCls);this.inputWrap[B](this.inputWrapInvalidCls)},beforeFocus:function(){var B=this,C=B.inputEl,A=B.emptyText,D;B.callParent(arguments);if((A&&!Ext.supports.Placeholder)&&(C.dom.value===B.emptyText&&B.valueContainsPlaceholder)){B.setRawValue("");D=true;C.removeCls(B.emptyUICls);B.valueContainsPlaceholder=false}else{if(Ext.supports.Placeholder){C.removeCls(B.emptyUICls)}}},onFocus:function(B){var A=this;A.callParent(arguments);if(A.selectOnFocus){A.inputEl.dom.select()}if(A.emptyText){A.autoSize()}A.addCls(A.fieldFocusCls);A.triggerWrap.addCls(A.triggerWrapFocusCls);A.inputWrap.addCls(A.inputWrapFocusCls);A.invokeTriggers("onFieldFocus",[B])},onBlur:function(B){var A=this;A.callParent(arguments);A.removeCls(A.fieldFocusCls);A.triggerWrap.removeCls(A.triggerWrapFocusCls);A.inputWrap.removeCls(A.inputWrapFocusCls);A.invokeTriggers("onFieldBlur",[B])},completeEdit:function(A){this.callParent([A]);this.applyEmptyText()},filterKeys:function(B){if((B.ctrlKey&&!B.altKey)||B.isSpecialKey()){return }var A=String.fromCharCode(B.getCharCode());if(!this.maskRe.test(A)){B.stopEvent()}},getState:function(){return this.addPropertyToState(this.callParent(),"value")},applyState:function(A){this.callParent(arguments);if(A.hasOwnProperty("value")){this.setValue(A.value)}},getRawValue:function(){var B=this,A=B.callParent();if(A===B.emptyText&&B.valueContainsPlaceholder){A=""}return A},setValue:function(B){var A=this,C=A.inputEl;if(C&&A.emptyText&&!Ext.isEmpty(B)){C.removeCls(A.emptyUICls);A.valueContainsPlaceholder=false}A.callParent(arguments);A.applyEmptyText();return A},getErrors:function(K){K=arguments.length?(K==null?"":K):this.processRawValue(this.getRawValue());var F=this,I=F.callParent([K]),A=F.validator,D=F.vtype,G=Ext.form.field.VTypes,H=F.regex,J=Ext.String.format,B,E,C;if(Ext.isFunction(A)){B=A.call(F,K);if(B!==true){I.push(B)}}E=F.allowOnlyWhitespace?K:Ext.String.trim(K);if(E.length<1||(K===F.emptyText&&F.valueContainsPlaceholder)){if(!F.allowBlank){I.push(F.blankText)}if(!F.validateBlank){return I}C=true}if(!C&&K.length<F.minLength){I.push(J(F.minLengthText,F.minLength))}if(K.length>F.maxLength){I.push(J(F.maxLengthText,F.maxLength))}if(D){if(!G[D](K,F)){I.push(F.vtypeText||G[D+"Text"])}}if(H&&!H.test(K)){I.push(F.regexText||F.invalidText)}return I},selectText:function(G,B){var F=this,D=F.getRawValue(),A=D.length,E=F.inputEl.dom,C;if(A>0){G=G===undefined?0:Math.min(G,A);B=B===undefined?A:Math.min(B,A);if(E.setSelectionRange){E.setSelectionRange(G,B)}else{if(E.createTextRange){C=E.createTextRange();C.moveStart("character",G);C.moveEnd("character",B-A);C.select()}}}},getGrowWidth:function(){return this.inputEl.dom.value},autoSize:function(){var C=this,B,G,E,F,A,D;if(C.grow&&C.rendered&&C.getSizeModel().width.auto){F=C.inputEl;B=C.getTriggers();E=0;D=Ext.util.Format.htmlEncode(C.getGrowWidth()||(C.hasFocus?"":C.emptyText)||"");D+=C.growAppend;for(G in B){E+=B[G].el.getWidth()}A=F.getTextWidth(D)+E+C.inputWrap.getBorderWidth("lr")+C.triggerWrap.getBorderWidth("lr");A=Math.min(Math.max(A,C.growMin),C.growMax);C.bodyEl.setWidth(A);C.updateLayout();C.fireEvent("autosize",C,A)}},onDestroy:function(){var A=this;A.invokeTriggers("destroy");Ext.destroy(A.triggerRepeater);A.callParent()},onTriggerClick:Ext.emptyFn,privates:{getTdType:function(){return"textfield"}},deprecated:{5:{methods:{getTriggerWidth:function(){var B=this.getTriggers(),A=0,C;if(B&&this.rendered){for(C in B){if(B.hasOwnProperty(C)){A+=B[C].el.getWidth()}}}return A}}}}})