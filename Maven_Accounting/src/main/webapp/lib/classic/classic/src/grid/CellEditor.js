Ext.define("Ext.grid.CellEditor",{extend:"Ext.Editor",isCellEditor:true,alignment:"l-l!",hideEl:false,cls:Ext.baseCSSPrefix+"small-editor "+Ext.baseCSSPrefix+"grid-editor "+Ext.baseCSSPrefix+"grid-cell-editor",treeNodeSelector:"."+Ext.baseCSSPrefix+"tree-node-text",shim:false,shadow:false,setGrid:function(B){var D=this,C=D.grid,A;if(B!==C){A={beforeitemupdate:D.beforeItemUpdate,itemupdate:D.onItemUpdate,scope:D};if(C){C.getView().un(A)}D.grid=B;B.getView().on(A)}},beforeViewRefresh:function(A){var B=this,C=B.el&&B.el.dom;if(C){B.wasAllowBlur=B.allowBlur;if(B.editing){A.cellFocused=false;B.allowBlur=false}if(C.parentNode){A.refreshing=true;C.parentNode.removeChild(C)}}},onViewRefresh:function(B){var D=this,E=D.el&&D.el.dom,A,C=D.context;if(E){A=B.getCellByPosition(C,true);if(!A){D.allowBlur=D.wasAllowBlur;D.completeEdit();Ext.getDetachedBody().dom.appendChild(E);return }C.node=B.getNode(C.record);C.row=B.getRow(C.record);C.cell=A;C.rowIdx=B.indexOf(C.row);A.insertBefore(E,A.firstChild);D.boundEl=D.container=Ext.get(A);D.realign(true);if(D.editing){if(Ext.isIE){Ext.defer(function(){if(!D.destroyed){D.allowBlur=D.wasAllowBlur;D.field.focus()}},10)}else{D.allowBlur=D.wasAllowBlur;D.field.focus()}}}},beforeItemUpdate:function(C,D,E,B){var H=this,G=H.context,A=B.length,F;if(C===G.record){for(F=0;F<A;F++){if(B[F]===G.column){H.needsFixOnItemUpdate=true;H.beforeViewRefresh(G.view);return }}}},onItemUpdate:function(B,C,D){var A=this.context.view;if(this.needsFixOnItemUpdate){this.needsFixOnItemUpdate=A.refreshing=false;this.onViewRefresh(A)}},startEdit:function(B,C,A){this.context=this.editingPlugin.context;this.callParent([B,C,A])},onShow:function(){var A=this,B=A.boundEl.down(A.context.view.innerSelector);if(B){if(A.isForTree){B=B.child(A.treeNodeSelector)}B.hide()}A.callParent(arguments)},onFocusEnter:function(){var B=this.context,A=B.view;B.node=A.getNode(B.record);B.row=A.getRow(B.record);B.cell=B.getCell(true);B.rowIdx=A.indexOf(B.row);this.realign(true);this.callParent(arguments);this.focusEnterEvent=null},onEditComplete:function(A){if(A){this.restoreCell()}this.callParent(arguments)},onHide:function(){this.restoreCell();this.callParent(arguments)},onSpecialKey:function(G,F){var E=this,C=F.getKey(),B=E.completeOnEnter&&C===F.ENTER,D=E.cancelOnEsc&&C===F.ESC,A=E.editingPlugin.view;if(B||D){F.stopEvent();if(B){E.completeEdit(true)}else{if(D){E.cancelEdit(true)}}A.getNavigationModel().setPosition(E.context,null,F);A.ownerGrid.setActionableMode(false)}},getRefOwner:function(){return this.column&&this.column.getView()},restoreCell:function(){var A=this,B=A.boundEl.down(A.context.view.innerSelector);if(B){if(A.isForTree){B=B.child(A.treeNodeSelector)}B.show()}},afterRender:function(){var A=this,B=A.field;A.callParent(arguments);if(B.isCheckbox){B.mon(B.inputEl,{mousedown:A.onCheckBoxMouseDown,click:A.onCheckBoxClick,scope:A})}},onCheckBoxMouseDown:function(){this.completeEdit=Ext.emptyFn},onCheckBoxClick:function(){delete this.completeEdit;this.field.focus(false,10)},realign:function(D){var I=this,F=I.boundEl,G=F.down(I.context.view.innerSelector),K=G.dom.firstChild,B=F.getWidth(),C=Ext.Array.clone(I.offsets),A=I.grid,H,J="",E=!K||(K.nodeType===3&&!(Ext.String.trim(J=K.data).length));if(I.isForTree){H=I.getTreeNodeOffset(G);B-=Math.abs(H);C[0]+=H}if(A.columnLines){B-=F.getBorderWidth("rl")}if(D===true){I.field.setWidth(B)}if(E){G.dom.innerHTML="X"}I.alignTo(F,I.alignment,C);if(E){G.dom.firstChild.data=J}},getTreeNodeOffset:function(A){return A.child(this.treeNodeSelector).getOffsetsTo(A)[0]}})