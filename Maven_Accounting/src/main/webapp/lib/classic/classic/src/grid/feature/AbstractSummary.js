Ext.define("Ext.grid.feature.AbstractSummary",{extend:"Ext.grid.feature.Feature",alias:"feature.abstractsummary",summaryRowCls:Ext.baseCSSPrefix+"grid-row-summary",readDataOptions:{recordCreator:Ext.identityFn},summaryRowTpl:{fn:function(B,A,C){if(A.record.isSummary&&this.summaryFeature.showSummaryRow){this.summaryFeature.outputSummaryRecord(A.record,A,B,C)}else{this.nextTpl.applyOut(A,B,C)}},priority:1000},showSummaryRow:true,init:function(){var A=this;A.view.summaryFeature=A;A.rowTpl=A.view.self.prototype.rowTpl;A.view.addRowTpl(A.summaryRowTpl).summaryFeature=A;A.summaryData={};A.groupInfo={};if(!A.summaryTableCls){A.summaryTableCls=Ext.baseCSSPrefix+"grid-item"}A.summaryRowSelector="."+A.summaryRowCls},bindStore:function(B,A){var C=this;Ext.destroy(C.readerListeners);if(C.remoteRoot){C.readerListeners=A.getProxy().getReader().on({scope:C,destroyable:true,rawdata:C.onReaderRawData})}},onReaderRawData:function(A){this.summaryRows=null;this.readerRawData=A},toggleSummaryRow:function(E,A){var D=this,C=D.showSummaryRow,B;E=E!=null?!!E:!D.showSummaryRow;D.showSummaryRow=E;if(E&&E!==C){D.updateSummaryRow=true}if(D.lockingPartner){if(!A){D.lockingPartner.toggleSummaryRow(E,true);B=true}}else{B=true}if(B){D.grid.ownerGrid.getView().refresh()}},createRenderer:function(E,B){var F=this,C=B.ownerGroup,A=C?F.summaryData[C]:F.summaryData,D=E.dataIndex||E.getItemId();return function(H,G){return E.summaryRenderer?E.summaryRenderer(B.data[D],A,D,G):B.data[D]}},outputSummaryRecord:function(F,J,D){var G=J.view,A=G.rowValues,C=J.columns||G.headerCt.getVisibleGridColumns(),I=C.length,E,B,H={view:G,record:F,rowStyle:"",rowClasses:[this.summaryRowCls],itemClasses:[],recordIndex:-1,rowId:G.getRowId(F),columns:C};for(E=0;E<I;E++){B=C[E];B.savedRenderer=B.renderer;if(B.summaryType||B.summaryRenderer){B.renderer=this.createRenderer(B,F)}else{B.renderer=Ext.emptyFn}}G.rowValues=H;G.self.prototype.rowTpl.applyOut(H,D,parent);G.rowValues=A;for(E=0;E<I;E++){B=C[E];B.renderer=B.savedRenderer;B.savedRenderer=null}},getSummary:function(A,B,F,E){var D=!!E,C=D?E:A;if(B){if(Ext.isFunction(B)){if(D){return C.aggregate(F,B)}else{return C.aggregate(B,null,false,[F])}}switch(B){case"count":return C.count(F);case"min":return C.min(F);case"max":return C.max(F);case"sum":return C.sum(F);case"average":return C.average(F);default:return""}}},getRawData:function(){var A=this.readerRawData;if(A){return A}return this.view.getStore().getProxy().getReader().rawData},generateSummaryData:function(B){var F=this,L=F.summaryRows,I={},H={},G,D,A,C,E,L,K,J;if(!L){A=F.getRawData();if(!A){return }G=F.view.store.getProxy().getReader();D=Ext.create("reader."+G.type,G.getConfig());D.setRootProperty(F.remoteRoot);L=D.getRoot(A);if(L){K=[];if(!Ext.isArray(L)){L=[L]}E=L.length;for(C=0;C<E;++C){J=D.extractRecordData(L[C],F.readDataOptions);K.push(J)}F.summaryRows=L=K}D.destroy();F.readerRawData=null}if(L){for(C=0,E=L.length;C<E;C++){I=L[C];if(B){H[I[B]]=I}}}return B?H:I},setSummaryData:function(C,D,B,E){var A=this.summaryData;if(E){if(!A[E]){A[E]={}}A[E][D]=B}else{A[D]=B}},destroy:function(){Ext.destroy(this.readerListeners);this.readerRawData=this.summaryRows=null;this.callParent()}})