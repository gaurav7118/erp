Ext.define("Ext.grid.feature.RowBody",{extend:"Ext.grid.feature.Feature",alias:"feature.rowbody",rowBodyCls:Ext.baseCSSPrefix+"grid-row-body",rowBodyHiddenCls:Ext.baseCSSPrefix+"grid-row-body-hidden",rowBodyTdSelector:"td."+Ext.baseCSSPrefix+"grid-cell-rowbody",eventPrefix:"rowbody",eventSelector:"tr."+Ext.baseCSSPrefix+"grid-rowbody-tr",colSpanDecrement:0,bodyBefore:false,outerTpl:{fn:function(C,B,D){var A=B.view,E=A.rowValues;this.rowBody.setup(B.rows,E);this.nextTpl.applyOut(B,C,D);this.rowBody.cleanup(B.rows,E)},priority:100},extraRowTpl:["{%","if(this.rowBody.bodyBefore) {","values.view.renderColumnSizer(values, out);","} else {","this.nextTpl.applyOut(values, out, parent);","}","values.view.rowBodyFeature.setupRowData(values.record, values.recordIndex, values);","%}",'<tr class="'+Ext.baseCSSPrefix+'grid-rowbody-tr {rowBodyCls}" {ariaRowAttr}>','<td class="'+Ext.baseCSSPrefix+"grid-td "+Ext.baseCSSPrefix+'grid-cell-rowbody" colspan="{rowBodyColspan}" {ariaCellAttr}>','<div class="'+Ext.baseCSSPrefix+'grid-rowbody {rowBodyDivCls}" {ariaCellInnerAttr}>{rowBody}</div>',"</td>","</tr>","{%","if(this.rowBody.bodyBefore) {","this.nextTpl.applyOut(values, out, parent);","}","%}",{priority:100,beginRowSync:function(A){A.add("rowBody",this.owner.eventSelector)},syncContent:function(C,F,B){var A=this.owner,D=Ext.fly(C).down(A.eventSelector,true),E;if(D&&(E=Ext.fly(F).down(A.eventSelector,true))){Ext.fly(D).syncContent(E)}}}],init:function(B){var C=this,A=C.view=B.getView();B.variableRowHeight=A.variableRowHeight=true;A.rowBodyFeature=C;B.mon(A,{element:"el",click:C.onClick,scope:C});A.headerCt.on({columnschanged:C.onColumnsChanged,scope:C});A.addTpl(C.outerTpl).rowBody=C;A.addRowTpl(Ext.XTemplate.getTpl(this,"extraRowTpl")).rowBody=C;C.callParent(arguments)},onClick:function(C){var B=this,A=C.getTarget(B.eventSelector);if(A&&Ext.fly(A=(A.previousSibling||A.nextSibling)).is(B.view.rowSelector)){C.target=A;B.view.handleEvent(C)}},getSelectedRow:function(A,C){var B=A.getNode(C);if(B){return Ext.fly(B).down(this.eventSelector)}return null},onColumnsChanged:function(D){var B=this.view.el.query(this.rowBodyTdSelector),E=D.getVisibleGridColumns().length,A=B.length,C;for(C=0;C<A;++C){B[C].setAttribute("colSpan",E)}},setupRowData:function(A,C,B){if(this.getAdditionalData){Ext.apply(B,this.getAdditionalData(A.data,C,A,B))}},setup:function(A,B){B.rowBodyCls=this.rowBodyCls;B.rowBodyColspan=this.view.headerCt.visibleColumnManager.getColumns().length-this.colSpanDecrement},cleanup:function(A,B){B.rowBodyCls=B.rowBodyColspan=B.rowBody=null}})