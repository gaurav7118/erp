Ext.define("Ext.grid.filters.filter.Date",{extend:"Ext.grid.filters.filter.TriFilter",alias:"grid.filter.date",uses:["Ext.picker.Date","Ext.menu.DatePicker"],type:"date",config:{fields:{lt:{text:"Before"},gt:{text:"After"},eq:{text:"On"}},pickerDefaults:{xtype:"datepicker",border:0},updateBuffer:0,dateFormat:undefined},itemDefaults:{xtype:"menucheckitem",selectOnFocus:true,width:125,menu:{layout:"auto",plain:true}},applyDateFormat:function(A){return A||Ext.Date.defaultFormat},createMenu:function(B){var I=this,J={scope:I,checkchange:I.onCheckChange},A=I.menuItems,F,C,D,E,H,L,M,G,K;I.callParent(arguments);C=I.getItemDefaults();F=I.getFields();D=Ext.apply({minDate:I.minDate,maxDate:I.maxDate,format:I.dateFormat,listeners:{scope:I,select:I.onMenuSelect}},I.getPickerDefaults());I.fields={};for(E=0,H=A.length;E<H;E++){L=A[E];if(L!=="-"){G={menu:{xtype:"datemenu",hideOnClick:false,pickerCfg:Ext.apply({itemId:L},D)}};if(C){Ext.merge(G,C)}if(F){Ext.merge(G,F[L])}M=I.menu.add(G);K=I.fields[L]=M.down("datepicker");K.filter=I.filter[L];K.filterKey=L;M.on(J)}else{I.menu.add(L)}}},getPicker:function(A){return this.fields[A]},onCheckChange:function(D,C){var B=D.down("datepicker").filter,A;if(!C&&B.getValue()){A={};A[B.getOperator()]=null;this.setValue(A)}},onFilterRemove:function(B){var A={};A[B]=null;this.setValue(A);this.fields[B].up("menuitem").setChecked(false,true)},onStateRestore:function(A){A.setSerializer(this.getSerializer());A.setConvert(this.convertDateOnly)},getFilterConfig:function(A,B){A=this.callParent([A,B]);A.serializer=this.getSerializer();A.convert=this.convertDateOnly;return A},convertDateOnly:function(B){var A=null;if(B){A=Ext.Date.clearTime(B,true).getTime()}return A},getSerializer:function(){var A=this;return function(C){var B=C.value;if(B){C.value=Ext.Date.format(B,A.getDateFormat())}}},onMenuSelect:function(F,C){var G=this,E=G.fields,B=G.filter,H=E[F.itemId],A=E.gt,D=E.lt,J=E.eq,I={};H.up("menuitem").setChecked(true,true);if(H===J){D.up("menuitem").setChecked(false,true);A.up("menuitem").setChecked(false,true)}else{J.up("menuitem").setChecked(false,true);if(H===A&&(+D.value<+C)){D.up("menuitem").setChecked(false,true);if(B.lt.getValue()!=null){I.lt=null}}else{if(H===D&&(+A.value>+C)){A.up("menuitem").setChecked(false,true);if(B.gt.getValue()!=null){I.gt=null}}}}I[H.filterKey]=C;G.setValue(I);F.up("menu").hide()}})