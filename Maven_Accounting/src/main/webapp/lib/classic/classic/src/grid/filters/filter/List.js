Ext.define("Ext.grid.filters.filter.List",{extend:"Ext.grid.filters.filter.SingleFilter",alias:"grid.filter.list",type:"list",operator:"in",itemDefaults:{checked:false,hideOnClick:false},idField:"id",labelField:"text",labelIndex:null,loadingText:"Loading...",loadOnShow:true,single:false,plain:true,constructor:function(A){var C=this,B;C.callParent([A]);if(C.itemDefaults.checked){Ext.raise("The itemDefaults.checked config is not supported, use the value config instead.")}C.labelIndex=C.labelIndex||C.column.dataIndex;if(!C.options&&(C.value!=null)&&C.active){B=C.getGridStore();if(!B.isEmptyStore){B.on(C.getGridStoreListeners())}C.grid.on("reconfigure",C.onReconfigure,C);C.inferOptionsFromGridStore=true}},destroy:function(){var C=this,A=C.store,B=C.autoStore,D=C.gridStoreListeners;if(A){if(B||A.autoDestroy){A.destroy()}else{A.un("load",C.bindMenuStore,C)}C.store=null}if(C.inferOptionsFromGridStore){C.grid.un("reconfigure",C.onReconfigure,C)}if(D){C.getGridStore().un(D);C.gridStoreListeners=null}C.callParent()},activateMenu:function(){var E=this,F=E.filter.getValue(),C,D,A,B;if(!F||!F.length){return }C=E.menu.items;for(D=0,A=C.length;D<A;D++){B=C.getAt(D);if(Ext.Array.indexOf(F,B.value)>-1){B.setChecked(true,true)}}},bindMenuStore:function(A){var B=this;if(B.grid.destroyed||B.preventFilterRemoval){return }B.createListStore(A);B.createMenuItems(B.store);B.loaded=true},createListStore:function(L){var G=this,K=G.store,H=L.isStore,B=G.idField,D=G.labelField,I=false,A,C,E,F,J;if(H){if(L!==G.getGridStore()){I=true;K=G.store=L}else{G.autoStore=true;A=G.getOptionsFromStore(L)}}else{A=[];for(E=0,F=L.length;E<F;E++){J=L[E];switch(Ext.typeOf(J)){case"array":A.push(J);break;case"object":A.push(J);break;default:if(J!=null){C={};C[B]=J;C[D]=J;A.push(C)}}}}if(!I){if(K){K.destroy()}K=G.store=new Ext.data.Store({fields:[B,D],data:A});if(!G.gridStoreListeners){G.getGridStore().on(G.getGridStoreListeners())}G.loaded=true}G.setStoreFilter(K)},createMenu:function(C){var E=this,D=E.getGridStore(),A=E.store,B=E.options,F;if(A){E.store=A=Ext.StoreManager.lookup(A)}E.callParent([C]);F=E.menu;if(A){if(!A.getCount()){F.add({text:E.loadingText,iconCls:Ext.baseCSSPrefix+"mask-msg-text"});F.on("show",E.show,E);A.on("load",E.bindMenuStore,E,{single:true})}else{E.createMenuItems(A)}}else{if(B){E.bindMenuStore(B)}else{if(D.getCount()||D.isFiltered()){E.bindMenuStore(D)}else{D.on("load",E.bindMenuStore,E,{single:true})}}}},createMenuItems:function(O){var M=this,C=M.menu,L=O.getCount(),G=Ext.Array.contains,N,D,J,K,B,A,H,F,I,P,E;if(L&&C){N={checkchange:M.onCheckChange,scope:M};D=M.getItemDefaults();C.suspendLayouts();C.removeAll(true);K=M.single?Ext.id():null;A=M.idField;F=M.labelField;E=[];for(I=0;I<L;I++){J=O.getAt(I);B=J.get(A);H=J.get(F);if(H==null||G(E,B)){continue}E.push(H);P=C.add(Ext.apply({text:H,group:K,value:B,listeners:N},D))}C.resumeLayouts(true)}},getFilterConfig:function(A,B){A.value=A.value||[];return this.callParent([A,B])},getGridStoreListeners:function(){var A=this;return A.gridStoreListeners={scope:A,add:A.onDataChanged,refresh:A.onDataChanged,remove:A.onDataChanged,update:A.onDataChanged}},getOptionsFromStore:function(L){var J=this,G=L.getData(),B={},H=[],K=J.dataIndex,A=J.labelIndex,I,F,D,M,C,E;if(L.isFiltered()&&!L.remoteFilter){G=G.getSource()}I=G.items;D=I.length;for(F=0;F<D;++F){M=I[F].data;C=M[K];E=M[A];if(E===undefined){E=C}if(!B[C]){B[C]=1;H.push([C,E])}}return H},onCheckChange:function(){var B=this,A=B.updateBuffer;if(A){B.task.delay(A,null,null)}else{B.setValue()}},onDataChanged:function(A){if(!this.preventDefault){this.bindMenuStore(A)}},onReconfigure:function(B,A){if(A){this.bindMenuStore(A)}},setStoreFilter:function(A){var C=this,D=C.value,B=C.filter;if(D){if(!Ext.isArray(D)){D=[D]}B.setValue(D)}if(C.active){C.preventFilterRemoval=true;C.addStoreFilter(B);C.preventFilterRemoval=false}},setValue:function(){var E=this,C=E.menu.items,F=[],D,A,B;E.preventDefault=true;for(D=0,A=C.length;D<A;D++){B=C.getAt(D);if(B.checked){F.push(B.value)}}E.filter.setValue(F);A=F.length;if(A&&E.active){E.updateStoreFilter()}else{E.setActive(!!A)}E.preventDefault=false},show:function(){var A=this.store;if(this.loadOnShow&&!this.loaded&&!A.hasPendingLoad()){A.load()}}})