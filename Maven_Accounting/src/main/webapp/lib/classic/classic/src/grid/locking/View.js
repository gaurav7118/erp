Ext.define("Ext.grid.locking.View",{alternateClassName:"Ext.grid.LockingView",requires:["Ext.view.AbstractView","Ext.view.Table"],mixins:["Ext.util.Observable","Ext.util.StoreHolder","Ext.util.Focusable"],isLockingView:true,loadMask:true,eventRelayRe:/^(beforeitem|beforecontainer|item|container|cell|refresh)/,constructor:function(A){var C=Ext,E=this,D,B;E.ownerGrid=A.ownerGrid;E.ownerGrid.view=E;E.navigationModel=A.locked.xtype==="treepanel"?new C.tree.NavigationModel(E):new C.grid.NavigationModel(E);A.locked.viewConfig.bindStore=C.emptyFn;A.normal.viewConfig.bindStore=E.subViewBindStore;A.normal.viewConfig.isNormalView=A.locked.viewConfig.isLockedView=true;A.locked.viewConfig.beforeLayout=A.normal.viewConfig.beforeLayout=E.beforeLayout;A.locked.viewConfig.navigationModel=A.normal.viewConfig.navigationModel=E.navigationModel;E.lockedGrid=E.ownerGrid.lockedGrid=C.ComponentManager.create(A.locked);E.lockedView=D=E.lockedGrid.getView();E.selModel=A.normal.viewConfig.selModel=D.getSelectionModel();if(E.lockedGrid.isTree){E.lockedView.animate=false;A.normal.store=D.store;A.normal.viewConfig.stripeRows=E.lockedView.stripeRows;A.normal.rowLines=E.lockedGrid.rowLines}E.normalGrid=E.ownerGrid.normalGrid=C.ComponentManager.create(A.normal);D.lockingPartner=B=E.normalView=E.normalGrid.getView();B.lockingPartner=D;E.loadMask=(A.loadMask!==undefined)?A.loadMask:E.loadMask;E.mixins.observable.constructor.call(E);E.lockedViewEventRelayers=E.relayEvents(D,C.view.Table.events);E.normalViewEventRelayers=E.relayEvents(B,C.view.Table.events.concat(C.view.Table.normalSideEvents));B.on({scope:E,itemmouseleave:E.onItemMouseLeave,itemmouseenter:E.onItemMouseEnter});D.on({scope:E,itemmouseleave:E.onItemMouseLeave,itemmouseenter:E.onItemMouseEnter});E.ownerGrid.on({render:E.onPanelRender,scope:E});E.loadingText=B.loadingText;E.loadingCls=B.loadingCls;E.loadingUseMsg=B.loadingUseMsg;E.itemSelector=E.getItemSelector();E.all=B.all;E.bindStore(B.dataSource,true,"dataSource")},subViewBindStore:function(B){var C=this,A;if(C.destroying||C.destroyed){return }A=C.getSelectionModel();A.bindStore(B);A.bindComponent(C)},beforeLayout:function(){var C=this.ownerCt.ownerLockable.view,B=C.lockedGrid.view,A=C.normalGrid.view;if(!C.relayingOperation){if(C.lockedGrid.isVisible()){if(B.refreshNeeded){B.doFirstRefresh(B.dataSource)}}if(A.refreshNeeded){A.doFirstRefresh(A.dataSource)}}},onPanelRender:function(){var C=this,B=C.loadMask,A={target:C.ownerGrid,msg:C.loadingText,msgCls:C.loadingCls,useMsg:C.loadingUseMsg,store:C.ownerGrid.store};C.el=C.ownerGrid.getTargetEl();C.rendered=true;C.initFocusableEvents();C.fireEvent("render",C);if(B){if(Ext.isObject(B)){A=Ext.apply(A,B)}C.loadMask=new Ext.LoadMask(A)}},getRefOwner:function(){return this.ownerGrid},getVisibleColumnManager:function(){return this.ownerGrid.getVisibleColumnManager()},getTopLevelVisibleColumnManager:function(){return this.ownerGrid.getVisibleColumnManager()},getGridColumns:function(){return this.getVisibleColumnManager().getColumns()},getEl:function(A){return this.getViewForColumn(A).getEl()},getCellSelector:function(){return this.normalView.getCellSelector()},getItemSelector:function(){return this.normalView.getItemSelector()},getViewForColumn:function(B){var A=this.lockedView,C;A.headerCt.cascade(function(D){if(D===B){C=true;return false}});return C?A:this.normalView},onItemMouseEnter:function(C,B){var F=this,D=F.lockedView,A=F.normalView,E;if(C.trackOver){if(C!==D){A=D}E=A.getNode(B);A.highlightItem(E)}},onItemMouseLeave:function(C,B){var E=this,D=E.lockedView,A=E.normalView;if(C.trackOver){if(C!==D){A=D}A.clearHighlight()}},relayFn:function(C,B){B=B||[];var D=this,A=D.lockedView;D.relayingOperation=true;A[C].apply(A,B);A=D.normalView;A[C].apply(A,B);D.relayingOperation=false},getSelectionModel:function(){return this.normalView.getSelectionModel()},getNavigationModel:function(){return this.navigationModel},getStore:function(){return this.ownerGrid.store},onBindStore:function(A,B,F){var E=this,D=E.lockedView,C=E.normalView;if(C.componentLayoutCounter&&!(D.blockRefresh&&C.blockRefresh)){Ext.suspendLayouts();D.doFirstRefresh(A);C.doFirstRefresh(A);Ext.resumeLayouts(true)}},getStoreListeners:function(){var A=this;return{priority:1000,refresh:A.onDataRefresh,replace:A.onReplace,add:A.onAdd,remove:A.onRemove,update:A.onUpdate,clear:A.onDataRefresh,beginupdate:A.onBeginUpdate,endupdate:A.onEndUpdate}},onBeginUpdate:function(){Ext.suspendLayouts();this.relayFn("onBeginUpdate",arguments);Ext.resumeLayouts(true)},onEndUpdate:function(){Ext.suspendLayouts();this.relayFn("onEndUpdate",arguments);Ext.resumeLayouts(true)},onDataRefresh:function(){Ext.suspendLayouts();this.relayFn("onDataRefresh",arguments);Ext.resumeLayouts(true)},onReplace:function(){Ext.suspendLayouts();this.relayFn("onReplace",arguments);Ext.resumeLayouts(true)},onAdd:function(){Ext.suspendLayouts();this.relayFn("onAdd",arguments);Ext.resumeLayouts(true)},onRemove:function(){Ext.suspendLayouts();this.relayFn("onRemove",arguments);Ext.resumeLayouts(true)},setActionableMode:function(D,B){var A,C;if(D){if(!B){B=this.getNavigationModel().getPosition()}if(B){B=B.clone();B.view=C=B.column.getView();A=C.setActionableMode(D,B);if(A!==false&&C.lockingPartner.grid.isVisible()){C.lockingPartner.setActionableMode(D,B);if(!C.lockingPartner.actionableMode){C.setActionableMode(false);A=false}}return A}else{return false}}else{this.relayFn("setActionableMode",[false])}},onUpdate:function(){Ext.suspendLayouts();this.relayFn("onUpdate",arguments);Ext.resumeLayouts(true)},refresh:function(){Ext.suspendLayouts();this.relayFn("refresh",arguments);Ext.resumeLayouts(true)},refreshView:function(){Ext.suspendLayouts();this.relayFn("refreshView",arguments);Ext.resumeLayouts(true)},getNode:function(A){return this.normalView.getNode(A)},getRow:function(A){return this.normalView.getRow(A)},getCell:function(B,C){var A=this.getViewForColumn(C),D=A.getRow(B);return Ext.fly(D).down(C.getCellSelector())},indexOf:function(B){var A=this.lockedView.indexOf(B);if(!A){A=this.normalView.indexOf(B)}return A},focus:function(){var A=this.ownerGrid.down(">tablepanel:not(hidden)>tableview");if(A){A.focus()}},focusRow:function(C){var A,B=this.getNavigationModel().lastFocused;A=B?B.view:this.normalView;A.focusRow(C)},focusCell:function(A){A.view.focusCell(A)},onRowFocus:function(){this.relayFn("onRowFocus",arguments)},isVisible:function(A){return this.ownerGrid.isVisible(A)},getFocusEl:function(){var A,B=this.getNavigationModel().lastFocused;A=B?B.view:this.normalView;return A.getFocusEl()},getCellInclusive:function(D,B){var A=D.column,C=this.lockedGrid.getColumnManager().getColumns().length;if(A>=C){D=Ext.apply({},D);D.column-=C;return this.normalView.getCellInclusive(D,B)}else{return this.lockedView.getCellInclusive(D,B)}},getHeaderByCell:function(A){if(A){return this.getVisibleColumnManager().getHeaderById(A.getAttribute("data-columnId"))}return false},onRowSelect:function(){this.relayFn("onRowSelect",arguments)},onRowDeselect:function(){this.relayFn("onRowDeselect",arguments)},onCellSelect:function(A){A.column.getView().onCellSelect({record:A.record,column:A.column})},onCellDeselect:function(A){A.column.getView().onCellDeselect({record:A.record,column:A.column})},getCellByPosition:function(E,C){var D=this,A=E.view,B=E.column;if(A===D){E=new Ext.grid.CellContext(B.getView()).setPosition(E.record,E.column)}return A.getCellByPosition(E,C)},getRecord:function(B){var A=this.lockedView.getRecord(B);if(!A){A=this.normalView.getRecord(B)}return A},scrollBy:function(){var A=this.normalView;A.scrollBy.apply(A,arguments)},ensureVisible:function(){var A=this.normalView;A.ensureVisible.apply(A,arguments)},disable:function(){this.relayFn("disable",arguments)},enable:function(){this.relayFn("enable",arguments)},addElListener:function(){this.relayFn("addElListener",arguments)},refreshNode:function(){this.relayFn("refreshNode",arguments)},addRowCls:function(){this.relayFn("addRowCls",arguments)},removeRowCls:function(){this.relayFn("removeRowCls",arguments)},destroy:function(){var A=this;A.rendered=false;A.bindStore(null,false,"dataSource");Ext.destroy(A.lockedViewEventRelayers,A.normalViewEventRelayers);A.lockedViewEventRelayers=A.normalViewEventRelayers=null;A.callParent();Ext.destroy(A.loadMask,A.navigationModel,A.selModel);A.lockedView.lockingPartner=A.normalView.lockingPartner=null;A.lockedGrid=A.lockedView=A.normalGrid=A.normalView=null;A.loadMask=A.navigationModel=A.selModel=A.headerCt=null;A.ownerGrid=A.storeListeners=null}},function(){this.borrow(Ext.Component,["up"]);this.borrow(Ext.view.AbstractView,["doFirstRefresh","applyFirstRefresh"]);this.borrow(Ext.view.Table,["cellSelector","selectedCellCls","selectedItemCls"])})