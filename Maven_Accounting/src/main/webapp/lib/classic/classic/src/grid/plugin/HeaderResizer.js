Ext.define("Ext.grid.plugin.HeaderResizer",{extend:"Ext.plugin.Abstract",requires:["Ext.dd.DragTracker","Ext.util.Region"],alias:"plugin.gridheaderresizer",disabled:false,config:{dynamic:false},colHeaderCls:Ext.baseCSSPrefix+"column-header",minColWidth:40,maxColWidth:1000,eResizeCursor:"col-resize",init:function(B){var A=this;A.headerCt=B;B.on("render",A.afterHeaderRender,A,{single:A});if(!A.minColWidth){A.self.prototype.minColWidth=Ext.grid.column.Column.prototype.minWidth}},destroy:function(){var B=this,A=B.tracker;if(A){A.destroy();B.tracker=null}B.headerCt.un("render",B.afterHeaderRender,B);B.headerCt=null;B.callParent()},afterHeaderRender:function(){var B=this,C=B.headerCt,A=C.el;C.mon(A,"mousemove",B.onHeaderCtMouseMove,B);B.markerOwner=B.ownerGrid=B.headerCt.up("tablepanel").ownerGrid;B.tracker=new Ext.dd.DragTracker({disabled:B.disabled,onBeforeStart:B.onBeforeStart.bind(B),onStart:B.onStart.bind(B),onDrag:B.onDrag.bind(B),onEnd:B.onEnd.bind(B),tolerance:3,autoStart:300,el:A})},onHeaderCtMouseMove:function(B){var A=this;if(A.headerCt.dragging||A.disabled){if(A.activeHd){A.activeHd.el.dom.style.cursor="";delete A.activeHd}}else{if(B.pointerType!=="touch"){A.findActiveHeader(B)}}},findActiveHeader:function(E){var F=this,C=F.headerCt,H=E.getTarget("."+F.colHeaderCls,C.el,true),I=F.ownerGrid,A=I.ownerLockable,J,G,B,D;F.activeHd=null;if(H){J=Ext.getCmp(H.id);if(J.isAtEndEdge(E)){if(C.visibleColumnManager.getColumns().length===1&&C.forceFit){return }G=J}else{if(J.isAtStartEdge(E)){B=C.visibleColumnManager.getColumns();D=J.isGroupHeader?J.getGridColumns()[0]:J;G=B[Ext.Array.indexOf(B,D)-1];if(!G&&A&&!I.isLocked){B=A.lockedGrid.headerCt.visibleColumnManager.getColumns();G=B[B.length-1]}}}if(G){if(G.isGroupHeader){B=G.getGridColumns();G=B[B.length-1]}if(G&&!(G.fixed||(G.resizable===false))){F.activeHd=G;J.el.dom.style.cursor=F.eResizeCursor;if(J.triggerEl){J.triggerEl.dom.style.cursor=F.eResizeCursor}}}else{J.el.dom.style.cursor="";if(J.triggerEl){J.triggerEl.dom.style.cursor=""}}}return F.activeHd},onBeforeStart:function(B){var A=this;A.dragHd=A.activeHd||B.pointerType==="touch"&&A.findActiveHeader(B);if(A.dragHd&&!A.headerCt.dragging){A.xDelta=A.dragHd.getX()+A.dragHd.getWidth()-A.tracker.getXY()[0];A.tracker.constrainTo=A.getConstrainRegion();return true}else{A.headerCt.dragging=false;return false}},getConstrainRegion:function(){var F=this,B=F.dragHd.el,E,G=F.ownerGrid,D=G.getSizeModel().width,C=D.shrinkWrap?F.headerCt.getWidth()-F.headerCt.visibleColumnManager.getColumns().length*F.minColWidth:F.maxColWidth,A;if(F.headerCt.forceFit){E=F.dragHd.nextNode("gridcolumn:not([hidden]):not([isGroupHeader])");if(E&&F.headerInSameGrid(E)){C=B.getWidth()+(E.getWidth()-F.minColWidth)}}else{if(G.isLocked&&D.shrinkWrap){C=F.dragHd.up("[scrollerOwner]").getTargetEl().getWidth(true)-G.getWidth()-(G.ownerLockable.normalGrid.visibleColumnManager.getColumns().length*F.minColWidth+Ext.getScrollbarSize().width)}}A=F.adjustConstrainRegion(B.getRegion(),0,0,0,F.minColWidth);A.right=B.getX()+C;return A},onStart:function(F){var G=this,E=G.dragHd,B=E.el.getWidth(),D=E.getRootHeaderCt(),J,I,C,A,H,K;G.headerCt.dragging=true;G.origWidth=B;if(!G.dynamic){C=G.markerOwner;if(C.frame&&C.resizable){G.gridOverflowSetting=C.el.dom.style.overflow;C.el.dom.style.overflow="hidden"}J=G.getLeftMarkerX(C);A=C.getLhsMarker();H=C.getRhsMarker();K=G.ownerGrid.body.getHeight()+D.getHeight();I=D.getOffsetsTo(C)[1]-C.el.getBorderWidth("t");A.dom.style.cursor=G.eResizeCursor;H.dom.style.cursor=G.eResizeCursor;A.setLocalY(I);H.setLocalY(I);A.setHeight(K);H.setHeight(K);G.setMarkerX(A,J);G.setMarkerX(H,J+B)}},onDrag:function(B){var A=this;if(A.dynamic){A.doResize()}else{A.setMarkerX(A.getMovingMarker(A.markerOwner),A.calculateDragX(A.markerOwner))}},getMovingMarker:function(A){return A.getRhsMarker()},onEnd:function(B){var A=this,C=A.markerOwner;A.headerCt.dragging=false;if(A.dragHd){if(!A.dynamic){if("gridOverflowSetting" in A){C.el.dom.style.overflow=A.gridOverflowSetting}A.setMarkerX(C.getLhsMarker(),-9999);A.setMarkerX(C.getRhsMarker(),-9999)}A.doResize();if(B.pointerType!=="touch"){A.dragHd=null;A.activeHd.el.dom.style.cursor=A.eResizeCursor}else{A.dragHd=A.activeHd=null}}A.headerCt.blockNextEvent()},doResize:function(){var C=this,B=C.dragHd,A,D=C.tracker.getOffset("point");if(B&&D[0]){if(B.flex){delete B.flex}Ext.suspendLayouts();C.adjustColumnWidth(D[0]-C.xDelta);if(C.headerCt.forceFit){A=B.nextNode("gridcolumn:not([hidden]):not([isGroupHeader])");if(A&&!C.headerInSameGrid(A)){A=null}if(A){delete A.flex;A.setWidth(A.getWidth()-D[0])}}Ext.resumeLayouts(true)}},headerInSameGrid:function(B){var A=this.dragHd.up("tablepanel");return !!B.up(A)},disable:function(){var A=this.tracker;this.disabled=true;if(A){A.disable()}},enable:function(){var A=this.tracker;this.disabled=false;if(A){A.enable()}},calculateDragX:function(A){return this.tracker.getXY("point")[0]+this.xDelta-A.getX()-A.el.getBorderWidth("l")},getLeftMarkerX:function(A){return this.dragHd.getX()-A.getX()-A.el.getBorderWidth("l")-1},setMarkerX:function(B,A){B.setLocalX(A)},adjustConstrainRegion:function(E,C,D,A,B){return E.adjust(C,D,A,B)},adjustColumnWidth:function(A){this.dragHd.setWidth(this.origWidth+A)}})