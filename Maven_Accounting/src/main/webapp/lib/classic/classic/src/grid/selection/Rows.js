Ext.define("Ext.grid.selection.Rows",{extend:"Ext.grid.selection.Selection",requires:["Ext.util.Collection"],type:"rows",isRows:true,clone:function(){var B=this,A=new B.self(B.view);if(B.selectedRecords){A.selectedRecords=B.selectedRecords.clone()}if(B.rangeStart){A.setRangeStart(B.rangeStart);A.setRangeEnd(B.rangeEnd)}return A},add:function(A){if(!(A.isModel)){Ext.raise("Row selection must be passed a record")}var B=this.selectedRecords||(this.selectedRecords=this.createRecordCollection());if(!B.byInternalId.get(A.internalId)){B.add(A);this.view.onRowSelect(A)}},remove:function(A){if(!(A.isModel)){Ext.raise("Row selection must be passed a record")}var B=this;if(B.selectedRecords&&B.selectedRecords.byInternalId.get(A.internalId)){B.selectedRecords.remove(A);B.view.onRowDeselect(A);B.allSelected=false;return true}},contains:function(C){if(!C||!C.isModel){return false}var E=this,B=false,F=E.selectedRecords,A,D;if(E.allSelected){E.add(C);return true}if(F){B=!!F.byInternalId.get(C.internalId)}if(!B&&E.rangeStart!=null){D=E.getRange();A=E.view.dataSource.indexOf(C);B=A>=D[0]&&A<=D[1]}return B},getCount:function(){var E=this,F=E.selectedRecords,A=F?F.getCount():0,C=E.getRange(),D,B=E.view.dataSource;for(D=C[0];D<=C[1];D++){if(!F||!F.byInternalId.get(B.getAt(D).internalId)){A++}}return A},getRecords:function(){var A=this.selectedRecords;return A?A.getRange():[]},selectAll:function(){var A=this;A.clear();A.setRangeStart(0);A.setRangeEnd(A.view.dataSource.getCount()-1);A.addRange();A.allSelected=true},getFirstRowIndex:function(){return this.getCount()?this.view.dataSource.indexOf(this.selectedRecords.first()):0},getLastRowIndex:function(){return this.getCount()?this.view.dataSource.indexOf(this.selectedRecords.first()):-1},eachRow:function(B,A){var C=this.selectedRecords;if(C){C.each(B,A||this)}},eachColumn:function(E,D){var C=this.view.getVisibleColumnManager().getColumns(),A=C.length,B;if(this.selectedRecords){for(B=0;B<A;B++){if(E.call(this||D,C[B],B)===false){return }}}},eachCell:function(H,L){var G=this,J=G.selectedRecords,I=G.view,B=I.ownerGrid.getVisibleColumnManager().getColumns(),K,E,C,A,F,M,D=false;if(B){K=B.length;A=new Ext.grid.CellContext(I);if(J){J.each(function(N){A.setRow(N);for(E=0;E<K;E++){A.setColumn(B[E]);if(H.call(L||G,A,A.colIdx,A.rowIdx)===false){D=true;return false}}})}if(!D&&G.rangeStart!=null){F=G.getRange();G.view.dataSource.getRange(F[0],F[1],{callback:function(N){M=N.length;for(E=0;!D&&E<M;E++){A.setRow(N[E]);for(C=0;!D&&C<K;C++){A.setColumn(B[C]);if(H.call(L||G,A,A.colIdx,A.rowIdx)===false){D=true}}}}})}}},beginUpdate:function(){var A=this.selectedRecords;if(A){A.beginUpdate()}},endUpdate:function(){var A=this.selectedRecords;if(A){A.endUpdate()}},destroy:function(){this.selectedRecords=Ext.destroy(this.selectedRecords);this.callParent()},privates:{clear:function(){var B=this,A=B.view;B.allSelected=false;if(B.selectedRecords){B.eachRow(function(C){A.onRowDeselect(C)});B.selectedRecords.clear()}},isAllSelected:function(){return !!this.allSelected},setRangeStart:function(A){this.allSelected=false;this.rangeStart=this.rangeEnd=A;this.view.onRowSelect(A)},setRangeEnd:function(C){var G=this,F,E,A,K,H=G.view,I=H.dataSource,J=H.all,D=G.selectedRecords,B;G.rangeEnd=C;F=G.getRange();E=G.lastRange||F;for(A=Math.max(Math.min(F[0],E[0]),J.startIndex),C=Math.min(Math.max(F[1],E[1]),J.endIndex);A<=C;A++){K=J.item(A);if(A<F[0]||A>F[1]){if(D&&(B=D.byInternalId.get(I.getAt(A).internalId))){D.remove(B)}H.onRowDeselect(A)}else{H.onRowSelect(A)}}G.lastRange=F},extendRange:function(B){var D=this,A=D.view.dataSource,C;for(C=B.start.rowIdx;C<=B.end.rowIdx;C++){D.add(A.getAt(C))}},getRange:function(){var B=this.rangeStart,A=this.rangeEnd;if(B==null){return[0,-1]}else{if(B<=A){return[B,A]}}return[A,B]},getRangeSize:function(){var A=this.getRange();return A[1]-A[0]+1},createRecordCollection:function(){var B=this.view.dataSource,A=new Ext.util.Collection({rootProperty:"data",extraKeys:{byInternalId:{rootProperty:false,property:"internalId"}},sorters:[function(D,C){return B.indexOf(D)-B.indexOf(C)}]});return A},addRange:function(){var C=this,A,B;if(C.rangeStart!=null){A=C.getRange();B=C.selectedRecords||(C.selectedRecords=C.createRecordCollection());C.view.dataSource.getRange(A[0],A[1],{callback:function(D){B.add.apply(B,D)}});C.setRangeStart(C.lastRange=null)}},onSelectionFinish:function(){var B=this,A=B.getContiguousSelection();if(A){B.view.getSelectionModel().onSelectionFinish(B,new Ext.grid.CellContext(B.view).setPosition(A[0],0),new Ext.grid.CellContext(B.view).setPosition(A[1],B.view.getVisibleColumnManager().getColumns().length-1))}else{B.view.getSelectionModel().onSelectionFinish(B)}},getContiguousSelection:function(){var B=this.view.dataSource,D,A,C;if(this.selectedRecords){D=Ext.Array.sort(this.selectedRecords.getRange(),function(F,E){return B.indexOf(F)-B.indexOf(E)});A=D.length;if(A){for(C=1;C<A;C++){if(B.indexOf(D[C])!==B.indexOf(D[C-1])+1){return false}}return[B.indexOf(D[0]),B.indexOf(D[A-1])]}}}}})