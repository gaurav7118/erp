Ext.define("Ext.grid.selection.SelectionExtender",{extend:"Ext.dd.DragTracker",maskBox:{},constructor:function(A){var B=this;if(A.view.rendered){B.initSelectionExtender(A)}else{B.view=A.view;A.view.on({render:B.initSelectionExtender,args:[A],scope:B})}},initSelectionExtender:function(A){var B=this,C=Ext.dom.Element.DISPLAY;B.el=A.view.el;B.handle=A.view.ownerGrid.body.createChild({cls:Ext.baseCSSPrefix+"ssm-extender-drag-handle",style:"display:none"}).setVisibilityMode(C);B.handle.on({contextmenu:function(D){D.stopEvent()}});B.mask=B.el.createChild({cls:Ext.baseCSSPrefix+"ssm-extender-mask",style:"display:none"}).setVisibilityMode(C);B.superclass.constructor.call(B,A);B.mask.skipGarbageCollection=B.handle.skipGarbageCollection=true;B.viewListeners=B.view.on({scroll:B.onViewScroll,scope:B,destroyable:true});B.gridListeners=B.view.ownerGrid.on({columnResize:B.alignHandle,scope:B,destroyable:true});B.extendX=!!(B.axes&1);B.extendY=!!(B.axes&2)},setHandle:function(C,B){var A=this;if(!A.view.rendered){A.view.on({render:A.initSelectionExtender,args:[C,B],scope:A});return }A.firstPos=C;A.lastPos=B;if(C&&B){if(A.curPos){A.curPos.setPosition(B)}else{A.curPos=B.clone()}if(C&&B){A.alignHandle()}}else{A.disable()}},alignHandle:function(){var B=this,A=B.lastPos&&B.lastPos.getCell();if(A){B.enable();B.handle.alignTo(A,"c-br")}else{B.disable()}},enable:function(){this.handle.show();this.callParent()},disable:function(){this.handle.hide();this.mask.hide();this.callParent()},onDrag:function(H){if(H.target===this.mask.dom){this.mask.hide();H.target=document.elementFromPoint.apply(document,H.getXY());this.mask.show()}var G=this,C=G.view,B=C.el.getY(),E=C.el.getX(),F=H.getTarget(G.view.getCellSelector()),D=G.scrollTask||(G.scrollTask=Ext.util.TaskManager.newTask({run:G.doAutoScroll,scope:G,interval:10})),A=G.scrollBy||(G.scrollBy=[]);if(!G.el.contains(H.target)){A[0]=A[1]=0;return D.stop()}if(G.lastXY[1]>B+C.el.getHeight(true)-15){if(G.extendY){A[1]=3;D.start()}}else{if(G.lastXY[1]<B+10){if(G.extendY){A[1]=-3;D.start()}}else{if(G.lastXY[0]>E+C.el.getWidth(true)-15){if(G.extendX){A[0]=3;D.start()}}else{if(G.lastXY[0]<E+10){if(G.extendX){A[0]=-3;D.start()}}else{A[0]=A[1]=0;D.stop()}}}}if(F&&F!==G.lastOverCell){G.lastOverCell=F;G.syncMaskOnCell(F)}},doAutoScroll:function(){var B=this,A=B.view,C;A.scrollBy.apply(A,B.scrollBy);C=document.elementFromPoint.apply(document,B.lastXY);if(C){C=Ext.fly(C).up(A.cellSelector);if(C&&C!==B.lastOverCell){B.lastOverCell=C;B.syncMaskOnCell(C)}}},onEnd:function(B){var A=this;if(A.scrollTask){A.scrollTask.stop()}if(A.extensionDescriptor){A.disable();A.view.getSelectionModel().extendSelection(A.extensionDescriptor)}},onViewScroll:function(){var A=this;if(A.active&&A.lastOverCell){A.syncMaskOnCell(A.lastOverCell)}if(A.firstPos){A.alignHandle()}},syncMaskOnCell:function(E){var G=this,I=G.view,J=I.all,B=G.curPos,F=G.maskBox,K,A=G.firstPos.clone(),H=G.lastPos.clone(),D=G.firstPos.clone(),C=G.lastPos.clone();A.setRow(Math.min(Math.max(A.rowIdx,J.startIndex),J.endIndex));H.setRow(Math.min(Math.max(H.rowIdx,J.startIndex),J.endIndex));G.selectionRegion=K=A.getCell().getRegion().union(H.getCell().getRegion());B.setPosition(I.getRecord(E),I.getHeaderByCell(E));E=Ext.fly(E);G.mask.dom.style.borderTopWidth=G.mask.dom.style.borderRightWidth=G.mask.dom.style.borderBottomWidth=G.mask.dom.style.borderLeftWidth="";if(B.rowIdx<G.firstPos.rowIdx&&G.extendY){G.extensionDescriptor={type:"rows",start:D.setRow(B.rowIdx),end:C.setRow(G.firstPos.rowIdx-1),rows:B.rowIdx-G.firstPos.rowIdx,mousePosition:G.lastXY};G.mask.dom.style.borderBottomWidth="0";F.x=K.x;F.y=E.getY();F.width=K.right-K.left;F.height=K.top-E.getY()}else{if(B.rowIdx>G.lastPos.rowIdx&&G.extendY){G.extensionDescriptor={type:"rows",start:D.setRow(G.lastPos.rowIdx+1),end:C.setRow(B.rowIdx),rows:B.rowIdx-G.lastPos.rowIdx,mousePosition:G.lastXY};G.mask.dom.style.borderTopWidth="0";F.x=K.x;F.y=K.bottom;F.width=K.right-K.left;F.height=E.getRegion().bottom-K.bottom}else{if(B.colIdx<G.firstPos.colIdx&&G.extendX){G.extensionDescriptor={type:"columns",start:D.setColumn(B.colIdx),end:C.setColumn(G.firstPos.colIdx-1),columns:B.colIdx-G.firstPos.colIdx,mousePosition:G.lastXY};G.mask.dom.style.borderRightWidth="0";F.x=E.getX();F.y=K.top;F.width=K.left-E.getX();F.height=K.bottom-K.top}else{if(B.colIdx>G.lastPos.colIdx&&G.extendX){G.extensionDescriptor={type:"columns",start:D.setColumn(G.lastPos.colIdx+1),end:C.setColumn(B.colIdx),columns:B.colIdx-G.lastPos.colIdx,mousePosition:G.lastXY};G.mask.dom.style.borderLeftWidth="0";F.x=K.right;F.y=K.top;F.width=E.getRegion().right-K.right;F.height=K.bottom-K.top}else{G.extensionDescriptor=null}}}}if(I.ownerGrid.hasListeners.selectionextenderdrag){I.ownerGrid.fireEvent("selectionextenderdrag",I.ownerGrid,I.getSelectionModel().getSelected(),G.extensionDescriptor)}if(G.extensionDescriptor){G.mask.show();G.mask.setBox(F)}else{G.mask.hide()}},destroy:function(){var A=this;Ext.destroy(A.gridListeners,A.viewListeners,A.mask,A.handle);A.callParent()}})