Ext.define("Ext.layout.ContextItem",{heightModel:null,widthModel:null,sizeModel:null,optOut:false,ownerSizePolicy:null,boxChildren:null,boxParent:null,children:[],dirty:null,dirtyCount:0,hasRawContent:true,isContextItem:true,isTopLevel:false,consumersContentHeight:0,consumersContentWidth:0,consumersContainerHeight:0,consumersContainerWidth:0,consumersHeight:0,consumersWidth:0,ownerCtContext:null,remainingChildDimensions:0,props:null,state:null,wrapsComponent:false,constructor:function(Q){var R=this,O=Ext.layout.SizeModel.sizeModels,J=O.configured,I=O.shrinkWrap,B,P,M,L,F,D,S,E,N,K,C,H,G,A;Ext.apply(R,Q);S=R.target;B=R.el;R.id=S.id;R.flushedProps={};R.props=F={};R.styles={};if(!S.isComponent){P=B.lastBox}else{R.wrapsComponent=true;R.framing=S.frameSize||null;R.isComponentChild=S.ownerLayout&&S.ownerLayout.isComponentLayout;P=S.lastBox;M=S.ownerCt;if(M&&(L=M.el&&R.context.items[M.el.id])){R.ownerCtContext=L}R.sizeModel=D=S.getSizeModel(L&&L.widthModel.pairsByHeightOrdinal[L.heightModel.ordinal]);R.widthModel=H=D.width;R.heightModel=G=D.height;if(P&&P.invalid===false){K=(S.width===(E=P.width));C=(S.height===(N=P.height));if(H===I&&G===I){A=true}else{if(H===J&&K){A=G===I||(G===J&&C)}}if(A){R.optOut=true;F.width=E;F.height=N}}}R.lastBox=P},init:function(H,C){var Q=this,A=Q.props,D=Q.dirty,J=Q.ownerCtContext,M=Q.target.ownerLayout,G=!Q.state,R=H||G,E,L,K,N,B,S,T=Q.heightModel,F=Q.widthModel,I,O,P=0;Q.dirty=Q.invalid=false;Q.props={};Q.remainingChildDimensions=0;if(Q.boxChildren){Q.boxChildren.length=0}if(!G){Q.clearAllBlocks("blocks");Q.clearAllBlocks("domBlocks")}if(!Q.wrapsComponent){return R}S=Q.target;Q.state={};if(G){if(S.beforeLayout&&S.beforeLayout!==Ext.emptyFn){S.beforeLayout()}if(!J&&(N=S.ownerCt)){J=Q.context.items[N.el.id]}if(J){Q.ownerCtContext=J;Q.isBoxParent=M&&M.isItemBoxParent(Q)}else{Q.isTopLevel=true}Q.frameBodyContext=Q.getEl("frameBody")}else{J=Q.ownerCtContext;Q.isTopLevel=!J;E=Q.children;for(L=0,K=E.length;L<K;++L){E[L].init(true)}}Q.hasRawContent=!(S.isContainer&&S.items.items.length>0);if(H){Q.widthModel=Q.heightModel=null;B=S.getSizeModel(J&&J.widthModel.pairsByHeightOrdinal[J.heightModel.ordinal]);if(G){Q.sizeModel=B}Q.widthModel=B.width;Q.heightModel=B.height;if(J&&!Q.isComponentChild){if(M.needsItemSize||!S.liquidLayout){J.remainingChildDimensions+=2}else{if(Q.widthModel.calculated){++J.remainingChildDimensions}if(Q.heightModel.calculated){++J.remainingChildDimensions}}}}else{if(A){Q.recoverProp("x",A,D);Q.recoverProp("y",A,D);if(Q.widthModel.calculated){Q.recoverProp("width",A,D)}else{if("width" in A){++P}}if(Q.heightModel.calculated){Q.recoverProp("height",A,D)}else{if("height" in A){++P}}if(J&&!Q.isComponentChild){J.remainingChildDimensions+=P}}}if(A&&M&&M.manageMargins){Q.recoverProp("margin-top",A,D);Q.recoverProp("margin-right",A,D);Q.recoverProp("margin-bottom",A,D);Q.recoverProp("margin-left",A,D)}if(C){I=C.heightModel;O=C.widthModel;if(O&&I&&F&&T){if(F.shrinkWrap&&T.shrinkWrap){if(O.constrainedMax&&I.constrainedMin){I=null}}}if(O){Q.widthModel=O}if(I){Q.heightModel=I}if(C.state){Ext.apply(Q.state,C.state)}}return R},initContinue:function(E){var G=this,D=G.ownerCtContext,A=G.target,C=G.widthModel,F=A.getInherited(),B;if(C.fixed){F.inShrinkWrapTable=false}else{delete F.inShrinkWrapTable}if(E){if(D&&C.shrinkWrap){B=D.isBoxParent?D:D.boxParent;if(B){B.addBoxChild(G)}}else{if(C.natural){G.boxParent=D}}}return E},initDone:function(D){var B=this,A=B.props,C=B.state;if(B.remainingChildDimensions===0){A.containerChildrenSizeDone=true}if(D){A.containerLayoutDone=true}if(B.boxChildren&&B.boxChildren.length&&B.widthModel.shrinkWrap){B.el.setWidth(10000);C.blocks=(C.blocks||0)+1}},initAnimation:function(){var B=this,C=B.target,A=B.ownerCtContext;if(A&&A.isTopLevel){B.animatePolicy=C.ownerLayout.getAnimatePolicy(B)}else{if(!A&&C.isCollapsingOrExpanding&&C.animCollapse){B.animatePolicy=C.componentLayout.getAnimatePolicy(B)}}if(B.animatePolicy){B.context.queueAnimation(B)}},addBlock:function(B,D,E){var C=this,F=C[B]||(C[B]={}),A=F[E]||(F[E]={});if(!A[D.id]){A[D.id]=D;++D.blockCount;++C.context.blockCount}},addBoxChild:function(D){var C=this,B,A=D.widthModel;D.boxParent=this;D.measuresBox=A.shrinkWrap?D.hasRawContent:A.natural;if(D.measuresBox){B=C.boxChildren;if(B){B.push(D)}else{C.boxChildren=[D]}}},addPositionStyles:function(D,B){var A=B.x,E=B.y,C=0;if(A!==undefined){D.left=A+"px";++C}if(E!==undefined){D.top=E+"px";++C}return C},addTrigger:function(F,G){var E=this,A=G?"domTriggers":"triggers",H=E[A]||(E[A]={}),B=E.context,D=B.currentLayout,C=H[F]||(H[F]={});if(!C[D.id]){C[D.id]=D;++D.triggerCount;C=B.triggers[G?"dom":"data"];(C[D.id]||(C[D.id]=[])).push({item:this,prop:F});if(E.props[F]!==undefined){if(!G||!(E.dirty&&(F in E.dirty))){++D.firedTriggers}}}},boxChildMeasured:function(){var B=this,C=B.state,A=(C.boxesMeasured=(C.boxesMeasured||0)+1);if(A===B.boxChildren.length){C.clearBoxWidth=1;++B.context.progressCount;B.markDirty()}},borderNames:["border-top-width","border-right-width","border-bottom-width","border-left-width"],marginNames:["margin-top","margin-right","margin-bottom","margin-left"],paddingNames:["padding-top","padding-right","padding-bottom","padding-left"],trblNames:["top","right","bottom","left"],cacheMissHandlers:{borderInfo:function(A){var B=A.getStyles(A.borderNames,A.trblNames);B.width=B.left+B.right;B.height=B.top+B.bottom;return B},marginInfo:function(A){var B=A.getStyles(A.marginNames,A.trblNames);B.width=B.left+B.right;B.height=B.top+B.bottom;return B},paddingInfo:function(B){var A=B.frameBodyContext||B,C=A.getStyles(B.paddingNames,B.trblNames);C.width=C.left+C.right;C.height=C.top+C.bottom;return C}},checkCache:function(A){return this.cacheMissHandlers[A](this)},clearAllBlocks:function(A){var C=this[A],B;if(C){for(B in C){this.clearBlocks(A,B)}}},clearBlocks:function(C,F){var G=this[C],B=G&&G[F],D,E,A;if(B){delete G[F];D=this.context;for(A in B){E=B[A];--D.blockCount;if(!--E.blockCount&&!E.pending&&!E.done){D.queueLayout(E)}}}},block:function(A,B){this.addBlock("blocks",A,B)},domBlock:function(A,B){this.addBlock("domBlocks",A,B)},fireTriggers:function(B,F){var G=this[B],D=G&&G[F],C=this.context,E,A;if(D){for(A in D){E=D[A];++E.firedTriggers;if(!E.done&&!E.blockCount&&!E.pending){C.queueLayout(E)}}}},flush:function(){var B=this,A=B.dirty,C=B.state,D=B.el;B.dirtyCount=0;if("attributes" in B){D.set(B.attributes);delete B.attributes}if("innerHTML" in B){D.innerHTML=B.innerHTML;delete B.innerHTML}if(C&&C.clearBoxWidth){C.clearBoxWidth=0;B.el.setStyle("width",null);if(!--C.blocks){B.context.queueItemLayouts(B)}}if(A){delete B.dirty;B.writeProps(A,true)}},flushAnimations:function(){var M=this,C=M.previousSize,J,L,E,G,F,D,H,K,I,A,B;if(C){J=M.target;L=J.getAnimationProps();E=L.duration;G=Ext.Object.getKeys(M.animatePolicy);F=Ext.apply({},{from:{},to:{},duration:E||Ext.fx.Anim.prototype.duration},L);for(D=0,H=0,K=G.length;H<K;H++){I=G[H];A=C[I];B=M.peek(I);if(A!==B){I=M.translateProps[I]||I;F.from[I]=A;F.to[I]=B;++D}}if(D){if(M.isCollapsingOrExpanding===1){J.componentLayout.undoLayout(M)}else{M.writeProps(F.from)}M.el.animate(F);F=Ext.fx.Manager.getFxQueue(M.el.id)[0];J.$layoutAnim=F;F.on({afteranimate:function(){delete J.$layoutAnim;if(J.destroying||J.destroyed){return }if(M.isCollapsingOrExpanding===1){J.componentLayout.redoLayout(M);J.afterCollapse(true)}else{if(M.isCollapsingOrExpanding===2){J.afterExpand(true)}}if(J.hasListeners.afterlayoutanimation){J.fireEvent("afterlayoutanimation",J)}}})}}},getBorderInfo:function(){var A=this,B=A.borderInfo;if(!B){A.borderInfo=B=A.checkCache("borderInfo")}return B},getEl:function(C,A){var E=this,F,D,B;if(C){if(C.dom){D=C}else{F=E.target;if(A){F=A}D=F[C];if(typeof D==="function"){D=D.call(F);if(D===E.el){return this}}}if(D){B=E.context.getEl(E,D)}}return B||null},getFrameInfo:function(){var C=this,D=C.frameInfo,B,A;if(!D){B=C.framing;A=C.getBorderInfo();C.frameInfo=D=B?{top:B.top+A.top,right:B.right+A.right,bottom:B.bottom+A.bottom,left:B.left+A.left,width:B.width+A.width,height:B.height+A.height}:A}return D},getMarginInfo:function(){var D=this,F=D.marginInfo,B,A,E,C;if(!F){if(!D.wrapsComponent){F=D.checkCache("marginInfo")}else{B=D.target;E=B.ownerLayout;C=E?E.id:null;A=E&&E.manageMargins;F=B.margin$;if(F&&F.ownerId!==C){F=null}if(!F){F=D.parseMargins(B,B.margin)||D.checkCache("marginInfo");if(A){D.setProp("margin-top",0);D.setProp("margin-right",0);D.setProp("margin-bottom",0);D.setProp("margin-left",0)}F.ownerId=C;B.margin$=F}F.width=F.left+F.right;F.height=F.top+F.bottom}D.marginInfo=F}return F},clearMarginCache:function(){delete this.marginInfo;delete this.target.margin$},getPaddingInfo:function(){var A=this,B=A.paddingInfo;if(!B){A.paddingInfo=B=A.checkCache("paddingInfo")}return B},getProp:function(C){var B=this,A=B.props[C];B.addTrigger(C);return A},getDomProp:function(C){var B=this,A=(B.dirty&&(C in B.dirty))?undefined:B.props[C];B.addTrigger(C,true);return A},getStyle:function(A){var C=this,B=C.styles,E,D;if(A in B){D=B[A]}else{E=C.styleInfo[A];D=C.el.getStyle(A);if(E&&E.parseInt){D=parseInt(D,10)||0}B[A]=D}return D},getStyles:function(M,B){var K=this,E=K.styles,N={},F=0,D=M.length,I,H,J,A,C,G,O,L;B=B||M;for(I=0;I<D;++I){A=M[I];if(A in E){N[B[I]]=E[A];++F;if(I&&F===1){H=M.slice(0,I);J=B.slice(0,I)}}else{if(F){(H||(H=[])).push(A);(J||(J=[])).push(B[I])}}}if(F<D){H=H||M;J=J||B;G=K.styleInfo;O=K.el.getStyle(H);for(I=H.length;I--;){A=H[I];C=G[A];L=O[A];if(C&&C.parseInt){L=parseInt(L,10)||0}N[J[I]]=L;E[A]=L}}return N},hasProp:function(A){return this.getProp(A)!=null},hasDomProp:function(A){return this.getDomProp(A)!=null},invalidate:function(A){this.context.queueInvalidate(this,A)},markDirty:function(){if(++this.dirtyCount===1){this.context.queueFlush(this)}},onBoxMeasured:function(){var A=this.boxParent,B=this.state;if(A&&A.widthModel.shrinkWrap&&!B.boxMeasured&&this.measuresBox){B.boxMeasured=1;A.boxChildMeasured()}},parseMargins:function(A,D){if(D===true){D=5}var C=typeof D,B;if(C==="string"||C==="number"){B=A.parseBox(D)}else{if(D){B={top:0,right:0,bottom:0,left:0};if(D){D=Ext.apply(B,A.parseBox(D))}}}return B},peek:function(A){return this.props[A]},recalculateSizeModel:function(){var E=this,F=E.target,C=F.componentLayout,B=E.ownerCtContext,A=C.ownerContext,D;C.ownerContext=null;E.sizeModel=D=F.getSizeModel(B&&B.widthModel.pairsByHeightOrdinal[B.heightModel.ordinal]);E.widthModel=D.width;E.heightModel=D.height;if(A){C.ownerContext=E}},recoverProp:function(F,B,A){var E=this,D=E.props,C;if(F in B){D[F]=B[F];if(A&&F in A){C=E.dirty||(E.dirty={});C[F]=A[F]}}},redo:function(B){var E=this,C,A,D;E.revertProps(E.props);if(B&&E.wrapsComponent){if(E.childItems){for(D=0,C=E.childItems,A=C.length;D<A;D++){C[D].redo(B)}}for(D=0,C=E.children,A=C.length;D<A;D++){C[D].redo()}}},removeEl:function(B,A){var D=this,E,C;if(B){if(B.dom){C=B}else{E=D.target;if(A){E=A}C=E[B];if(typeof C==="function"){C=C.call(E);if(C===D.el){return this}}}if(C){D.context.removeEl(C,D)}}},revertProps:function(D){var A,B=this.flushedProps,C={};for(A in D){if(B.hasOwnProperty(A)){C[A]=D[A]}}this.writeProps(C)},setAttribute:function(A,C){var B=this;if(!B.attributes){B.attributes={}}B.attributes[A]=C;B.markDirty()},setBox:function(B){var A=this;if("left" in B){A.setProp("x",B.left)}if("top" in B){A.setProp("y",B.top)}A.setSize(B.width,B.height)},setContentHeight:function(A,B){if(!B&&this.hasRawContent){return 1}return this.setProp("contentHeight",A)},setContentWidth:function(B,A){if(!A&&this.hasRawContent){return 1}return this.setProp("contentWidth",B)},setContentSize:function(C,A,B){return this.setContentWidth(C,B)+this.setContentHeight(A,B)===2},setProp:function(D,C,A){var B=this,F=typeof C,E;if(F==="undefined"||(F==="number"&&isNaN(C))){return 0}if(B.props[D]===C){return 1}B.props[D]=C;++B.context.progressCount;if(A===false){B.fireTriggers("domTriggers",D);B.clearBlocks("domBlocks",D)}else{E=B.styleInfo[D];if(E){if(!B.dirty){B.dirty={}}B.dirty[D]=C;B.markDirty()}}B.fireTriggers("triggers",D);B.clearBlocks("blocks",D);return 1},setHeight:function(J,A){var F=this,D=F.target,C=F.ownerCtContext,G,E,B,I,H;if(J<0){J=0}if(!F.wrapsComponent){if(!F.setProp("height",J,A)){return NaN}}else{B=F.collapsedVert?0:(D.minHeight||0);J=Ext.Number.constrain(J,B,D.maxHeight);I=F.props.height;if(!F.setProp("height",J,A)){return NaN}if(C&&!F.isComponentChild&&isNaN(I)){H=--C.remainingChildDimensions;if(!H){C.setProp("containerChildrenSizeDone",true)}}G=F.frameBodyContext;if(G){E=F.getFrameInfo();G[F.el.vertical?"setWidth":"setHeight"](J-E.height,A)}}return J},setWidth:function(B,A){var H=this,F=H.target,E=H.ownerCtContext,I,G,D,C,J;if(B<0){B=0}if(!H.wrapsComponent){if(!H.setProp("width",B,A)){return NaN}}else{D=H.collapsedHorz?0:(F.minWidth||0);B=Ext.Number.constrain(B,D,F.maxWidth);C=H.props.width;if(!H.setProp("width",B,A)){return NaN}if(E&&!H.isComponentChild&&isNaN(C)){J=--E.remainingChildDimensions;if(!J){E.setProp("containerChildrenSizeDone",true)}}I=H.frameBodyContext;if(I){G=H.getFrameInfo();I.setWidth(B-G.width,A)}}return B},setSize:function(C,A,B){this.setWidth(C,B);this.setHeight(A,B)},translateProps:{x:"left",y:"top"},undo:function(B){var E=this,C,A,D;E.revertProps(E.lastBox);if(B&&E.wrapsComponent){if(E.childItems){for(D=0,C=E.childItems,A=C.length;D<A;D++){C[D].undo(B)}}for(D=0,C=E.children,A=C.length;D<A;D++){C[D].undo()}}},unsetProp:function(B){var A=this.dirty;delete this.props[B];if(A){delete A[B]}},writeProps:function(E,D){if(!(E&&typeof E==="object")){Ext.Logger.warn("writeProps expected dirtyProps to be an object");return }var R=this,C=R.el,H={},F=0,B=R.styleInfo,Q,I,L,N=E.width,J=E.height,S=R.target,G,A,M,O,P,K;if("displayed" in E){C.setDisplayed(E.displayed)}for(I in E){if(D){R.fireTriggers("domTriggers",I);R.clearBlocks("domBlocks",I);R.flushedProps[I]=1}Q=B[I];if(Q&&Q.dom){if(Q.suffix&&(L=parseInt(E[I],10))){H[I]=L+Q.suffix}else{H[I]=E[I]}++F}}if("x" in E||"y" in E){if(S.isComponent){S.setPosition(E.x,E.y)}else{F+=R.addPositionStyles(H,E)}}if(R.wrapsComponent&&Ext.isIE9){if((G=N!==undefined&&R.hasOverflowY)||(A=J!==undefined&&R.hasOverflowX)){M=R.isAbsolute;if(M===undefined){M=false;K=R.target.getTargetEl();P=K.getStyle("position");R.isAbsolute=M=(P==="absolute")}if(M){O=Ext.getScrollbarSize();if(G){N=parseInt(N,10)+O.width;H.width=N+"px";++F}if(A){J=parseInt(J,10)+O.height;H.height=J+"px";++F}}}}if(F){C.setStyle(H)}},debugHooks:{$enabled:false,addBlock:function(A,B,C){(B.blockedBy||(B.blockedBy={}))[this.id+"."+C+(A.substring(0,3)==="dom"?":dom":"")]=1;return this.callParent(arguments)},addBoxChild:function(C){var A=this.callParent(arguments),D=this.boxChildren,B;if(D&&D.length===1){B=this.context.boxParents||(this.context.boxParents=new Ext.util.MixedCollection());B.add(this)}return A},addTrigger:function(C,D){var B=this.context.currentLayout,A;this.callParent(arguments);A=this.context.triggersByLayoutId;(A[B.id]||(A[B.id]={}))[this.id+"."+C+(D?":dom":"")]={item:this,name:C}},checkAuthority:function(F){var D=this,A=D[F+"Model"],C=D.context.currentLayout,B,E;if(C===D.target.ownerLayout){B=A.calculated}else{if(C.isComponentLayout){B=D.isTopLevel||A.auto||A.configured}}if(!B){E=D.context.getLayoutName(C);Ext.log(E+" cannot set "+F)}},clearBlocks:function(C,F){var G=this[C],B=G&&G[F],D=this.id+"."+F+(C.substring(0,3)==="dom"?":dom":""),E,A;if(B){for(A in B){E=B[A];delete E.blockedBy[D]}}return this.callParent(arguments)},getEl:function(A){var B=this.callParent(arguments);if(B&&B!==this&&B.parent!==this){Ext.raise({msg:"Got element from wrong component"})}return B},init:function(){var B=this,A;A=B.callParent(arguments);if(B.context.logOn.initItem){Ext.log(B.id," consumers: content=",B.consumersContentWidth,"/",B.consumersContentHeight,", container=",B.consumersContainerWidth,"/",B.consumersContainerHeight,", size=",B.consumersWidth,"/",B.consumersHeight)}return A},invalidate:function(){if(this.wrapsComponent){if(this.context.logOn.invalidate){Ext.log("invalidate: ",this.id)}}else{Ext.raise({msg:"Cannot invalidate an element contextItem"})}return this.callParent(arguments)},setProp:function(F,E,B){var D=this,C=D.context.currentLayout,H=D.context.getLayoutName(C),G=D.id+"."+F,A;if(E!==null){A=D.setBy||(D.setBy={});if(!A[F]){A[F]=H}else{if(A[F]!==H){Ext.log({level:"warn"},"BAD! ",G," set by ",A[F]," and ",H)}}}if(D.context.logOn.setProp){if(typeof E!=="undefined"&&!isNaN(E)&&D.props[F]!==E){Ext.log("set ",G," = ",E," (",B,")")}}return this.callParent(arguments)},setHeight:function(A,B,C){if(!C&&this.wrapsComponent){this.checkAuthority("height")}return this.callParent(arguments)},setWidth:function(B,A,C){if(!C&&this.wrapsComponent){this.checkAuthority("width")}return this.callParent(arguments)}}},function(){var C={dom:true,parseInt:true,suffix:"px"},B={dom:true},A={dom:false};this.prototype.styleInfo={containerChildrenSizeDone:A,containerLayoutDone:A,displayed:A,done:A,x:A,y:A,columnsChanged:A,rowHeights:A,viewOverflowY:A,left:C,top:C,right:C,bottom:C,width:C,height:C,"border-top-width":C,"border-right-width":C,"border-bottom-width":C,"border-left-width":C,"margin-top":C,"margin-right":C,"margin-bottom":C,"margin-left":C,"padding-top":C,"padding-right":C,"padding-bottom":C,"padding-left":C,"line-height":B,display:B,clear:B}})