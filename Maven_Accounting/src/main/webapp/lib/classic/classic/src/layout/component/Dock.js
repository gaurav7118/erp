Ext.define("Ext.layout.component.Dock",{extend:"Ext.layout.component.Component",alias:"layout.dock",alternateClassName:"Ext.layout.component.AbstractDock",type:"dock",horzAxisProps:{name:"horz",oppositeName:"vert",dockBegin:"left",dockEnd:"right",horizontal:true,marginBegin:"margin-left",maxSize:"maxWidth",minSize:"minWidth",pos:"x",setSize:"setWidth",shrinkWrapDock:"shrinkWrapDockWidth",size:"width",sizeModel:"widthModel"},vertAxisProps:{name:"vert",oppositeName:"horz",dockBegin:"top",dockEnd:"bottom",horizontal:false,marginBegin:"margin-top",maxSize:"maxHeight",minSize:"minHeight",pos:"y",setSize:"setHeight",shrinkWrapDock:"shrinkWrapDockHeight",size:"height",sizeModel:"heightModel"},initializedBorders:-1,horizontalCollapsePolicy:{width:true,x:true},verticalCollapsePolicy:{height:true,y:true},finishRender:function(){var B=this,C,A;B.callParent();C=B.getRenderTarget();A=B.getDockedItems();B.finishRenderItems(C,A)},isItemBoxParent:function(A){return true},isItemShrinkWrap:function(A){return true},noBorderClasses:[Ext.baseCSSPrefix+"docked-noborder-top",Ext.baseCSSPrefix+"docked-noborder-right",Ext.baseCSSPrefix+"docked-noborder-bottom",Ext.baseCSSPrefix+"docked-noborder-left"],noBorderClassesSides:{top:Ext.baseCSSPrefix+"docked-noborder-top",right:Ext.baseCSSPrefix+"docked-noborder-right",bottom:Ext.baseCSSPrefix+"docked-noborder-bottom",left:Ext.baseCSSPrefix+"docked-noborder-left"},borderWidthProps:{top:"border-top-width",right:"border-right-width",bottom:"border-bottom-width",left:"border-left-width"},_itemCls:Ext.baseCSSPrefix+"docked",handleItemBorders:function(){var K=this,A=K.owner,J,O,G=K.lastDockedItems,F=K.borders,B=A.dockedItems.generation,C=K.noBorderClassesSides,L=K.borderWidthProps,E,I,N,M,H,D=K.collapsed;if(K.initializedBorders===B||(A.border&&!A.manageBodyBorders)||(A.collapsed&&A.collapseMode==="mini")){return }K.initializedBorders=B;K.collapsed=false;K.lastDockedItems=O=K.getLayoutItems();K.collapsed=D;J={top:[],right:[],bottom:[],left:[]};for(E=0,I=O.length;E<I;E++){N=O[E];M=N.dock;if(N.ignoreBorderManagement){continue}if(!J[M].satisfied){J[M].push(N);J[M].satisfied=true}if(!J.top.satisfied&&M!=="bottom"){J.top.push(N)}if(!J.right.satisfied&&M!=="left"){J.right.push(N)}if(!J.bottom.satisfied&&M!=="top"){J.bottom.push(N)}if(!J.left.satisfied&&M!=="right"){J.left.push(N)}}if(G){for(E=0,I=G.length;E<I;E++){N=G[E];if(!N.destroyed&&!N.ignoreBorderManagement&&!A.manageBodyBorders){N.removeCls(K.noBorderClasses)}}}if(F){for(H in F){if(A.manageBodyBorders&&F[H].satisfied){A.setBodyStyle(L[H],"")}}}for(H in J){I=J[H].length;if(!A.manageBodyBorders){for(E=0;E<I;E++){J[H][E].addCls(C[H])}if((!J[H].satisfied&&!A.bodyBorder)||A.bodyBorder===false){A.addBodyCls(C[H])}else{A.removeBodyCls(C[H])}}else{if(J[H].satisfied){A.setBodyStyle(L[H],"1px")}}}K.borders=J},beforeLayoutCycle:function(F){var C=this,B=C.owner,G=C.sizeModels.shrinkWrap,E=B.shrinkWrapDock,D,A;if(B.collapsed){if(B.collapsedVertical()){A=true;F.measureDimensions=1}else{D=true;F.measureDimensions=2}}F.collapsedVert=A;F.collapsedHorz=D;if(A){F.heightModel=G}else{if(D){F.widthModel=G}}E=E===true?3:(E||0);F.shrinkWrapDockHeight=(E&1)&&F.heightModel.shrinkWrap;F.shrinkWrapDockWidth=(E&2)&&F.widthModel.shrinkWrap},beginLayout:function(D){var J=this,C=J.owner,N=J.getLayoutItems(),B=D.context,F=N.length,I=J.lastCollapsedState,K,H,M,A,E,G,L;J.callParent(arguments);G=C.getCollapsed();if(G!==I&&I!==undefined){if(J.owner.collapsed){D.isCollapsingOrExpanding=1;C.addClsWithUI(C.collapsedCls)}else{D.isCollapsingOrExpanding=2;C.removeClsWithUI(C.collapsedCls);D.lastCollapsedState=J.lastCollapsedState}}J.lastCollapsedState=G;D.dockedItems=K=[];for(H=0;H<F;H++){M=N[H];if(M.rendered){L=M.dock;A=B.getCmp(M);A.dockedAt={x:0,y:0};A.offsets=E=Ext.Element.parseBox(M.offsets||0);A.horizontal=L==="top"||L==="bottom";E.width=E.left+E.right;E.height=E.top+E.bottom;K.push(A)}}D.bodyContext=D.getEl("body")},beginLayoutCycle:function(B){var E=this,J=B.dockedItems,D=J.length,A=E.owner,F=A.frameBody,I=E.lastHeightModel,C,H,G;E.callParent(arguments);if(E.owner.manageHeight){if(E.lastBodyDisplay){A.body.dom.style.display=E.lastBodyDisplay=""}}else{if(E.lastBodyDisplay!=="inline-block"){A.body.dom.style.display=E.lastBodyDisplay="inline-block"}if(I&&I.shrinkWrap&&!B.heightModel.shrinkWrap){A.body.dom.style.marginBottom=""}}if(B.widthModel.auto){if(B.widthModel.shrinkWrap){A.el.setWidth(null)}A.body.setWidth(null);if(F){F.setWidth(null)}}if(B.heightModel.auto){A.body.setHeight(null);if(F){F.setHeight(null)}}if(B.collapsedVert){B.setContentHeight(0)}else{if(B.collapsedHorz){B.setContentWidth(0)}}for(C=0;C<D;C++){H=J[C].target;G=H.dock;if(G==="right"){H.setLocalX(0)}else{if(G!=="left"){continue}}}},calculate:function(D){var K=this,C=K.measureAutoDimensions(D,D.measureDimensions),B=D.state,J=B.horzDone,E=B.vertDone,F=D.bodyContext,I,A,H,G,L;D.borderInfo||D.getBorderInfo();D.paddingInfo||D.getPaddingInfo();D.frameInfo||D.getFrameInfo();F.borderInfo||F.getBorderInfo();F.paddingInfo||F.getPaddingInfo();if(!D.frameBorder){if(!(I=D.framing)){D.frameBorder=D.borderInfo;D.framePadding=D.paddingInfo}else{D.frameBorder=I.border;D.framePadding=I.padding}}A=!J&&K.createAxis(D,C.contentWidth,D.widthModel,K.horzAxisProps,D.collapsedHorz);H=!E&&K.createAxis(D,C.contentHeight,D.heightModel,K.vertAxisProps,D.collapsedVert);for(G=0,L=D.dockedItems.length;L--;++G){if(A){K.dockChild(D,A,L,G)}if(H){K.dockChild(D,H,L,G)}}if(A&&K.finishAxis(D,A)){B.horzDone=J=A}if(H&&K.finishAxis(D,H)){B.vertDone=E=H}if(J&&E&&K.finishConstraints(D,J,E)){K.finishPositions(D,J,E)}else{K.done=false}},createAxis:function(O,I,E,L,D){var T=this,S=0,B=T.owner,F=B[L.maxSize],C=B[L.minSize]||0,M=L.dockBegin,H=L.dockEnd,Q=L.pos,K=L.size,J=F!=null,N=E.shrinkWrap,A,R,P,G;if(N){if(D){G=0}else{A=O.bodyContext;G=I+A.borderInfo[K]}}else{R=O.frameBorder;P=O.framePadding;S=R[M]+P[M];G=O.getProp(K)-(R[H]+P[H])}return{shrinkWrap:E.shrinkWrap,sizeModel:E,initialBegin:S,begin:S,end:G,collapsed:D,horizontal:L.horizontal,ignoreFrameBegin:null,ignoreFrameEnd:null,initialSize:G-S,maxChildSize:0,hasMinMaxConstraints:(C||J)&&E.shrinkWrap,minSize:C,maxSize:J?F:1000000000,bodyPosProp:T.owner.manageHeight?Q:L.marginBegin,dockBegin:M,dockEnd:H,posProp:Q,sizeProp:K,setSize:L.setSize,shrinkWrapDock:O[L.shrinkWrapDock],sizeModelName:L.sizeModel,dockedPixelsEnd:0}},dockChild:function(B,C,K,E){var F=this,A=B.dockedItems[C.shrinkWrap?K:E],H=A.target,I=H.dock,D=C.sizeProp,G,J;if(H.ignoreParentFrame&&B.isCollapsingOrExpanding){A.clearMarginCache()}if(!A.marginInfo){A.getMarginInfo()}if(I===C.dockBegin){if(C.shrinkWrap){G=F.dockOutwardBegin(B,A,H,C)}else{G=F.dockInwardBegin(B,A,H,C)}}else{if(I===C.dockEnd){if(C.shrinkWrap){G=F.dockOutwardEnd(B,A,H,C)}else{G=F.dockInwardEnd(B,A,H,C)}}else{if(C.shrinkWrapDock){J=A.getProp(D)+A.marginInfo[D];C.maxChildSize=Math.max(C.maxChildSize,J);G=0}else{G=F.dockStretch(B,A,H,C)}}}A.dockedAt[C.posProp]=G},dockInwardBegin:function(B,A,I,D){var F=D.begin,E=D.sizeProp,C=I.ignoreParentFrame,G,J,H;if(C){D.ignoreFrameBegin=A;H=I.dock;G=B.frameBorder[H];F-=G+B.framePadding[H]}if(!I.overlay){J=A.getProp(E)+A.marginInfo[E];D.begin+=J;if(C){D.begin-=G}}return F},dockInwardEnd:function(E,D,C,B){var H=B.sizeProp,A=D.getProp(H)+D.marginInfo[H],G=B.end-A,F;if(!C.overlay){B.end=G}if(C.ignoreParentFrame){B.ignoreFrameEnd=D;F=E.frameBorder[C.dock];G+=F+E.framePadding[C.dock];B.end+=F}return G},dockOutwardBegin:function(E,D,C,B){var G=B.begin,F=B.sizeProp,A;if(B.collapsed){B.ignoreFrameBegin=B.ignoreFrameEnd=D}else{if(C.ignoreParentFrame){B.ignoreFrameBegin=D}}if(!C.overlay){A=D.getProp(F)+D.marginInfo[F];G-=A;B.begin=G}return G},dockOutwardEnd:function(E,D,C,B){var G=B.end,F=B.sizeProp,A;A=D.getProp(F)+D.marginInfo[F];if(B.collapsed){B.ignoreFrameBegin=B.ignoreFrameEnd=D}else{if(C.ignoreParentFrame){B.ignoreFrameEnd=D}}if(!C.overlay){B.end=G+A;B.dockedPixelsEnd+=A}return G},dockStretch:function(C,B,L,D){var M=L.dock,I=D.sizeProp,A=M==="top"||M==="bottom",H=C.frameBorder,E=B.offsets,K=C.framePadding,G=A?"right":"bottom",O=A?"left":"top",J=D.begin+E[O],F,N;if(L.stretch!==false){N=D.end-J-E[G];if(L.ignoreParentFrame){J-=K[O]+H[O];N+=K[I]+H[I]}F=B.marginInfo;N-=F[I];B[D.setSize](N)}return J},finishAxis:function(L,E){if(isNaN(E.maxChildSize)){return false}var D=E.begin,O=E.end-D,G=E.collapsed,V=E.setSize,J=E.dockBegin,T=E.dockEnd,N=L.framePadding,Q=L.frameBorder,F=Q[J],R=L.framing,M=R&&R[J],B=G?0:N[J],I=E.sizeProp,S=E.ignoreFrameBegin,P=E.ignoreFrameEnd,A=L.bodyContext,K=Math.max(F+B-M,0),C,W,U,H;if(E.shrinkWrap){W=E.initialSize;if(R){U=-D+F+B;C=U-M-K}else{C=-D;U=C+B}if(!G){O+=N[I]}if(S){U-=F;C-=F;S.dockedAt[E.posProp]-=B}else{O+=F}if(G){}else{if(P){P.dockedAt[E.posProp]+=N[T]}else{O+=Q[T]}}E.size=O;if(!E.horizontal&&!this.owner.manageHeight){H=false}}else{if(R){U=0;C=D-M-K}else{U=-F;C=D-B-F}W=O}E.delta=U;A[V](W,H);A.setProp(E.bodyPosProp,C);return !isNaN(O)},beforeInvalidateShrinkWrapDock:function(C,B){var A=B.axis.sizeModelName;if(!C[A].constrainedMin){C[A]=Ext.layout.SizeModel.calculated}},afterInvalidateShrinkWrapDock:function(D,A){var B=A.axis,C=A.layout,E;if(D[B.sizeModelName].calculated){E=C.dockStretch(A.ownerContext,D,D.target,B);D.setProp(B.posProp,B.delta+E)}},finishConstraints:function(J,C,O){var R=this,Q=R.sizeModels,N=C.shrinkWrap,P=O.shrinkWrap,A=R.owner,H,L,M,F,G,K,B,D,E,I;if(N){K=C.size;B=C.collapsed?0:C.minSize;D=C.maxSize;E=C.maxChildSize;I=Math.max(K,E);if(I>D){G=Q.constrainedMax;M=D}else{if(I<B){G=Q.constrainedMin;M=B}else{if(K<E){G=Q.constrainedDock;A.dockConstrainedWidth=M=E}else{M=K}}}}if(P){K=O.size;B=O.collapsed?0:O.minSize;D=O.maxSize;E=O.maxChildSize;I=Math.max(K,E+K-O.initialSize);if(I>D){F=Q.constrainedMax;L=D}else{if(I<B){F=Q.constrainedMin;L=B}else{if(K<E){F=Q.constrainedDock;A.dockConstrainedHeight=L=E}else{if(!J.collapsedVert&&!A.manageHeight){H=false;J.bodyContext.setProp("margin-bottom",O.dockedPixelsEnd)}L=K}}}}if(G||F){if(G&&F&&G.constrainedMax&&F.constrainedByMin){J.invalidate({widthModel:G});return false}if(!J.widthModel.calculatedFromShrinkWrap&&!J.heightModel.calculatedFromShrinkWrap){J.invalidate({widthModel:G,heightModel:F});return false}}else{R.invalidateAxes(J,C,O)}if(N){J.setWidth(M);if(G){J.widthModel=G}}if(P){J.setHeight(L,H);if(F){J.heightModel=F}}return true},invalidateAxes:function(F,A,J){var N=this.beforeInvalidateShrinkWrapDock,B=this.afterInvalidateShrinkWrapDock,E=A.end-A.begin,Q=J.initialSize,C=A.shrinkWrapDock&&A.maxChildSize<=E,K=J.shrinkWrapDock&&J.maxChildSize<=Q,O,L,I,D,P,M,G,H;if(C||K){if(K){J.begin=J.initialBegin;J.end=J.begin+J.initialSize}O=F.dockedItems;for(I=0,L=O.length;I<L;++I){D=O[I];M=D.horizontal;G=null;if(C&&M){H=A.sizeProp;P=E;G=A}else{if(K&&!M){H=J.sizeProp;P=Q;G=J}}if(G){P-=D.getMarginInfo()[H];if(P!==D.props[H]){D.invalidate({before:N,after:B,axis:G,ownerContext:F,layout:this})}}}}},finishPositions:function(D,A,G){var I=D.dockedItems,C=I.length,F=A.delta,E=G.delta,H,B;for(H=0;H<C;++H){B=I[H];B.setProp("x",F+B.dockedAt.x);B.setProp("y",E+B.dockedAt.y)}},finishedLayout:function(B){var A=this,C=B.target;A.callParent(arguments);if(!B.animatePolicy){if(B.isCollapsingOrExpanding===1){C.afterCollapse(false)}else{if(B.isCollapsingOrExpanding===2){C.afterExpand(false)}}}},getAnimatePolicy:function(C){var B=this,A,D;if(C.isCollapsingOrExpanding===1){A=B.lastCollapsedState}else{if(C.isCollapsingOrExpanding===2){A=C.lastCollapsedState}}if(A==="left"||A==="right"){D=B.horizontalCollapsePolicy}else{if(A==="top"||A==="bottom"){D=B.verticalCollapsePolicy}}return D},getDockedItems:function(C,L){var H=this,E=(C==="visual"),I=E?Ext.ComponentQuery.query("[rendered]",H.owner.dockedItems.items):H.owner.dockedItems.items,G=I&&I.length&&C!==false,B,K,J,F,D,A;if(L==null){J=G&&!E?I.slice():I}else{J=[];for(F=0,A=I.length;F<A;++F){K=I[F].dock;D=(K==="top"||K==="left");if(L?D:!D){J.push(I[F])}}G=G&&J.length}if(G){B=(C=C||"render")==="render";Ext.Array.sort(J,function(N,M){var O,P;if(B&&((O=H.owner.dockOrder[N.dock])!==(P=H.owner.dockOrder[M.dock]))){if(!(O+P)){return O-P}}O=H.getItemWeight(N,C);P=H.getItemWeight(M,C);if((O!==undefined)&&(P!==undefined)){return O-P}return 0})}return J||[]},getItemWeight:function(B,A){var C=B.weight||this.owner.defaultDockWeights[B.dock];return C[A]||C},getLayoutItems:function(){var E=this,B,F,D,C,A;if(E.owner.collapsed){A=E.owner.getCollapsedDockedItems()}else{B=E.getDockedItems("visual");F=B.length;A=[];for(C=0;C<F;C++){D=B[C];if(!D.hidden){A.push(D)}}}return A},measureContentWidth:function(A){var B=A.bodyContext;return B.el.getWidth()-B.getBorderInfo().width},measureContentHeight:function(A){var B=A.bodyContext;return B.el.getHeight()-B.getBorderInfo().height},redoLayout:function(C){var B=this,A=B.owner;if(C.isCollapsingOrExpanding===1){if(A.reExpander){A.reExpander.el.show()}A.addClsWithUI(A.collapsedCls);C.redo(true)}else{if(C.isCollapsingOrExpanding===2){A.removeClsWithUI(A.collapsedCls);C.bodyContext.redo()}}},renderChildren:function(){var B=this,A=B.getDockedItems(),C=B.getRenderTarget();B.handleItemBorders();B.renderItems(A,C)},renderItems:function(G,Q){var P=this,A=P.owner,D={},N=G.length,E=A.body,B=!!A.frameSize,M=A.bodyContainer,F,C,I,L,H,K,O,R,J;if(N){for(K=0;K<N;K++){O=G[K];D[O.id]=O}C=P.getRenderTarget().dom.childNodes;I=C.length;H=0;for(K=0;K<I;++K){L=C[K];if(B){J=L===E.dom||L===M;if(!J&&Ext.fly(L).contains(E)){J=true;A.bodyContainer=L}}else{J=L===E.dom}if(J){F=K;break}if(D[L.id]){++H}}if(!J){Ext.log.error("Dock layout error for "+A.id+": bodyEl not found!")}F-=H;for(K=0;K<N;++K){O=G[K];R=F+K;if(O.dock==="right"||O.dock==="bottom"){++R}if(!O.rendered){P.renderItem(O,Q,R)}else{if(!P.isValidParent(O,Q,R)){P.moveItem(O,Q,R)}}}}},undoLayout:function(C){var B=this,A=B.owner;if(C.isCollapsingOrExpanding===1){if(A.reExpander){A.reExpander.el.hide()}A.removeClsWithUI(A.collapsedCls);C.undo(true)}else{if(C.isCollapsingOrExpanding===2){A.addClsWithUI(A.collapsedCls);C.bodyContext.undo()}}},sizePolicy:{nostretch:{setsWidth:0,setsHeight:0},horz:{shrinkWrap:{setsWidth:1,setsHeight:0,readsWidth:1},stretch:{setsWidth:1,setsHeight:0}},vert:{shrinkWrap:{setsWidth:0,setsHeight:1,readsHeight:1},stretch:{setsWidth:0,setsHeight:1}},stretchV:{setsWidth:0,setsHeight:1},autoStretchH:{readsWidth:1,setsWidth:1,setsHeight:0},autoStretchV:{readsHeight:1,setsWidth:0,setsHeight:1}},getItemSizePolicy:function(D,F){var C=this,G=C.sizePolicy,E=C.owner.shrinkWrapDock,B,A;if(D.stretch===false){return G.nostretch}B=D.dock;A=(B==="left"||B==="right");E=E===true?3:(E||0);if(A){G=G.vert;E=E&1}else{G=G.horz;E=E&2}if(E){if(!F){F=C.owner.getSizeModel()}if(F[A?"height":"width"].shrinkWrap){return G.shrinkWrap}}return G.stretch},configureItem:function(A,B){this.callParent(arguments);A.addCls(this._itemCls);if(!A.ignoreBorderManagement){A.addClsWithUI(this.getDockCls(A.dock))}},getDockCls:function(A){return"docked-"+A},afterRemove:function(A){var B;this.callParent(arguments);A.removeCls(this._itemCls);if(!A.ignoreBorderManagement){A.removeClsWithUI(this.getDockCls(A.dock))}B=A.el.dom;if(!A.destroying&&B){B.parentNode.removeChild(B)}this.childrenChanged=true},borderCollapseMap:{},getBorderCollapseTable:function(){var D=this,F=D.borderCollapseMap,A=D.owner,B=A.baseCls,E=A.ui,C;F=F[B]||(F[B]={});C=F[E];if(!C){B+="-"+E+"-outer-border-";F[E]=C=[0,B+"l",B+"b",B+"bl",B+"r",B+"rl",B+"rb",B+"rbl",B+"t",B+"tl",B+"tb",B+"tbl",B+"tr",B+"trl",B+"trb",B+"trbl"]}return C}})