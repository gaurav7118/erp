Ext.define("Ext.layout.container.Border",{extend:"Ext.layout.container.Container",alias:"layout.border",alternateClassName:"Ext.layout.BorderLayout",requires:["Ext.resizer.BorderSplitter","Ext.fx.Anim","Ext.layout.container.border.Region"],targetCls:Ext.baseCSSPrefix+"border-layout-ct",itemCls:[Ext.baseCSSPrefix+"border-item",Ext.baseCSSPrefix+"box-item"],type:"border",isBorderLayout:true,padding:undefined,percentageRe:/(\d+)%/,horzPositionProp:"left",padOnContainerProp:"left",padNotOnContainerProp:"right",axisProps:{horz:{borderBegin:"west",borderEnd:"east",horizontal:true,posProp:"x",sizeProp:"width",sizePropCap:"Width"},vert:{borderBegin:"north",borderEnd:"south",horizontal:false,posProp:"y",sizeProp:"height",sizePropCap:"Height"}},centerRegion:null,manageMargins:true,panelCollapseAnimate:true,panelCollapseMode:"placeholder",regionWeights:{north:20,south:10,center:0,west:-10,east:-20},beginAxis:function(K,B,U){var S=this,C=S.axisProps[U],P=!C.horizontal,J=C.sizeProp,N=0,A=K.childItems,F=A.length,R,O,M,G,Q,E,I,L,D,T,H;for(O=0;O<F;++O){M=A[O];Q=M.target;M.layoutPos={};if(Q.region){M.region=E=Q.region;M.isCenter=Q.isCenter;M.isHorz=Q.isHorz;M.isVert=Q.isVert;M.weight=Q.weight||S.regionWeights[E]||0;Q.weight=M.weight;B[Q.id]=M;if(Q.isCenter){R=M;G=Q.flex;K.centerRegion=R;continue}if(P!==M.isVert){continue}M.reverseWeighting=(E===C.borderEnd);L=Q[J];D=typeof L;if(!Q.collapsed){if(D==="string"&&(I=S.percentageRe.exec(L))){M.percentage=parseInt(I[1],10)}else{if(Q.flex){N+=M.flex=Q.flex}}}}}if(R){T=R.target;if((H=T.placeholderFor)){if(!G&&P===H.collapsedVertical()){G=0;R.collapseAxis=U}}else{if(T.collapsed&&(P===T.collapsedVertical())){G=0;R.collapseAxis=U}}}if(G==null){G=1}N+=G;return Ext.apply({before:P?"top":"left",totalFlex:N},C)},beginLayout:function(D){var J=this,I=J.getLayoutItems(),E=J.padding,K=typeof E,N=false,O,M,B,G,F,A,C,H,L;if(D.heightModel.shrinkWrap){Ext.raise("Border layout does not currently support shrinkWrap height. Please specify a height on component: "+J.owner.id+", or use a container layout that sets the component's height.")}if(D.widthModel.shrinkWrap){Ext.raise("Border layout does not currently support shrinkWrap width. Please specify a width on component: "+J.owner.id+", or use a container layout that sets the component's width.")}if(E){if(K==="string"||K==="number"){E=Ext.util.Format.parseBox(E)}}else{E=D.getEl("getTargetEl").getPaddingInfo();N=true}D.outerPad=E;D.padOnContainer=N;for(G=0,B=I.length;G<B;++G){M=I[G];A=J.getSplitterTarget(M);if(A){C=undefined;H=!!M.hidden;if(!A.split){if(A.isCollapsingOrExpanding){C=!!A.collapsed}}else{if(H!==A.hidden){C=!A.hidden}}if(C){M.show()}else{if(C===false){M.hide()}}}}J.callParent(arguments);I=D.childItems;B=I.length;F={};D.borderAxisHorz=J.beginAxis(D,F,"horz");D.borderAxisVert=J.beginAxis(D,F,"vert");for(G=0;G<B;++G){O=I[G];A=J.getSplitterTarget(O.target);if(A){L=F[A.id];if(!L){L=D.getEl(A.el,J);L.region=A.region}O.collapseTarget=A=L;O.weight=A.weight;O.reverseWeighting=A.reverseWeighting;A.splitter=O;O.isHorz=A.isHorz;O.isVert=A.isVert}}J.sortWeightedItems(I,"reverseWeighting");J.setupSplitterNeighbors(I)},calculate:function(D){var K=this,A=K.getContainerSize(D),H=D.childItems,C=H.length,B=D.borderAxisHorz,I=D.borderAxisVert,E=D.outerPad,M=D.padOnContainer,G,O,J,N,L,F;B.begin=E[K.padOnContainerProp];I.begin=E.top;L=B.end=B.flexSpace=A.width+(M?E[K.padOnContainerProp]:-E[K.padNotOnContainerProp]);F=I.end=I.flexSpace=A.height+(M?E.top:-E.bottom);for(G=0;G<C;++G){O=H[G];J=O.getMarginInfo();if(O.isHorz||O.isCenter){B.addUnflexed(J.width);L-=J.width}if(O.isVert||O.isCenter){I.addUnflexed(J.height);F-=J.height}if(!O.flex&&!O.percentage){if(O.isHorz||(O.isCenter&&O.collapseAxis==="horz")){N=O.getProp("width");B.addUnflexed(N);if(O.collapseTarget){L-=N}}else{if(O.isVert||(O.isCenter&&O.collapseAxis==="vert")){N=O.getProp("height");I.addUnflexed(N);if(O.collapseTarget){F-=N}}}}}for(G=0;G<C;++G){O=H[G];J=O.getMarginInfo();if(O.percentage){if(O.isHorz){N=Math.ceil(L*O.percentage/100);N=O.setWidth(N);B.addUnflexed(N)}else{if(O.isVert){N=Math.ceil(F*O.percentage/100);N=O.setHeight(N);I.addUnflexed(N)}}}}for(G=0;G<C;++G){O=H[G];if(!O.isCenter){K.calculateChildAxis(O,B);K.calculateChildAxis(O,I)}}if(K.finishAxis(D,I)+K.finishAxis(D,B)<2){K.done=false}else{K.finishPositions(H)}},calculateChildAxis:function(K,C){var A=K.collapseTarget,G="set"+C.sizePropCap,E=C.sizeProp,D=K.getMarginInfo()[E],I,B,F,H,J;if(A){I=A.region}else{I=K.region;F=K.flex}B=I===C.borderBegin;if(!B&&I!==C.borderEnd){K[G](C.end-C.begin-D);H=C.begin}else{if(F){J=Math.ceil(C.flexSpace*(F/C.totalFlex));J=K[G](J)}else{if(K.percentage){J=K.peek(E)}else{J=K.getProp(E)}}J+=D;if(B){H=C.begin;C.begin+=J}else{C.end=H=C.end-J}}K.layoutPos[C.posProp]=H},eachItem:function(G,D,C){var F=this,A=F.getLayoutItems(),B=0,E;if(Ext.isFunction(G)){D=G;C=D}for(B;B<A.length;B++){E=A[B];if(!G||E.region===G){if(D.call(C,E)===false){break}}}},finishAxis:function(D,C){var B=C.end-C.begin,A=D.centerRegion;if(A){A["set"+C.sizePropCap](B-A.getMarginInfo()[C.sizeProp]);A.layoutPos[C.posProp]=C.begin}return Ext.isNumber(B)?1:0},finishPositions:function(E){var C=E.length,B,A,D=this.horzPositionProp;for(B=0;B<C;++B){A=E[B];A.setProp("x",A.layoutPos.x+A.marginInfo[D]);A.setProp("y",A.layoutPos.y+A.marginInfo.top)}},getLayoutItems:function(){var A=this.owner,E=(A&&A.items&&A.items.items)||[],D=E.length,B=[],C=0,F,G;for(;C<D;C++){F=E[C];G=F.placeholderFor;if(F.hidden||((!F.floated||F.isCollapsingOrExpanding===2)&&!(G&&G.isCollapsingOrExpanding===2))){B.push(F)}}return B},getPlaceholder:function(A){return A.getPlaceholder&&A.getPlaceholder()},getMaxWeight:function(A){return this.getMinMaxWeight(A)},getMinWeight:function(A){return this.getMinMaxWeight(A,true)},getMinMaxWeight:function(D,A){var B=this,C=null;B.eachItem(D,function(E){if(E.hasOwnProperty("weight")){if(C===null){C=E.weight;return }if((A&&E.weight<C)||E.weight>C){C=E.weight}}},this);return C},getSplitterTarget:function(B){var A=B.collapseTarget;if(A&&A.collapsed){return A.placeholder||A}return A},isItemBoxParent:function(A){return true},isItemShrinkWrap:function(A){return true},insertSplitter:function(D,C,F,B){var G=D.region,E=Ext.apply({xtype:"bordersplitter",collapseTarget:D,id:D.id+"-splitter",hidden:F,canResize:D.splitterResize!==false,splitterFor:D,synthetic:true},B),A=C+((G==="south"||G==="east")?0:1);if(D.collapseMode==="mini"){E.collapsedCls=D.collapsedCls}D.splitter=this.owner.add(A,E)},getMoveAfterIndex:function(B){var A=this.callParent(arguments);if(B.splitter){A++}return A},moveItemBefore:function(A,C){var B;if(C&&C.splitter){B=C.region;if(B==="south"||B==="east"){C=C.splitter}}return this.callParent([A,C])},onAdd:function(I,D){var F=this,C=I.placeholderFor,H=I.region,E,G,A,B;F.callParent(arguments);if(H){Ext.apply(I,F.regionFlags[H]);if(F.owner.isViewport){I.isViewportBorderChild=true}if(I.initBorderRegion){I.initBorderRegion()}E=H==="center";if(E){if(F.centerRegion){Ext.raise("Cannot have multiple center regions in a BorderLayout.")}F.centerRegion=I}else{G=I.split;A=!!I.hidden;if(typeof G==="object"){B=G;G=true}if((I.isHorz||I.isVert)&&(G||I.collapseMode==="mini")){F.insertSplitter(I,D,A||!G,B)}}if(!E&&!I.hasOwnProperty("collapseMode")){I.collapseMode=F.panelCollapseMode}if(!I.hasOwnProperty("animCollapse")){if(I.collapseMode!=="placeholder"){I.animCollapse=false}else{I.animCollapse=F.panelCollapseAnimate}}}else{if(C){Ext.apply(I,F.regionFlags[C.region]);I.region=C.region;I.weight=C.weight}}},onDestroy:function(){this.centerRegion=null;this.callParent()},onRemove:function(B,D){var E=this,H=B.region,F=B.splitter,A=E.owner,G=A.destroying,C;if(H){if(B.isCenter){E.centerRegion=null}delete B.isCenter;delete B.isHorz;delete B.isVert;if(F&&!A.destroying){A.doRemove(F,true)}delete B.splitter}E.callParent(arguments);if(!G&&!D&&B.rendered){C=B.getEl();if(C){C.setStyle("top","");C.setStyle(E.horzPositionProp,"")}}},regionMeta:{center:{splitterDelta:0},north:{splitterDelta:1},south:{splitterDelta:-1},west:{splitterDelta:1},east:{splitterDelta:-1}},regionFlags:{center:{isCenter:true,isHorz:false,isVert:false},north:{isCenter:false,isHorz:false,isVert:true,collapseDirection:"top"},south:{isCenter:false,isHorz:false,isVert:true,collapseDirection:"bottom"},west:{isCenter:false,isHorz:true,isVert:false,collapseDirection:"left"},east:{isCenter:false,isHorz:true,isVert:false,collapseDirection:"right"}},setupSplitterNeighbors:function(J){var M={},E=J.length,L=this.touchedRegions,G,F,A,I,D,H,K,B,C;for(G=0;G<E;++G){H=J[G].target;K=H.region;if(H.isCenter){A=H}else{if(K){C=L[K];for(F=0,I=C.length;F<I;++F){D=M[C[F]];if(D){D.neighbors.push(H)}}if(H.placeholderFor){B=H.placeholderFor.splitter}else{B=H.splitter}if(B){B.neighbors=[]}M[K]=B}}}if(A){C=L.center;for(F=0,I=C.length;F<I;++F){D=M[C[F]];if(D){D.neighbors.push(A)}}}},touchedRegions:{center:["north","south","east","west"],north:["north","east","west"],south:["south","east","west"],east:["east","north","south"],west:["west","north","south"]},sizePolicies:{vert:{readsWidth:0,readsHeight:1,setsWidth:1,setsHeight:0},horz:{readsWidth:1,readsHeight:0,setsWidth:0,setsHeight:1},flexAll:{readsWidth:0,readsHeight:0,setsWidth:1,setsHeight:1}},getItemSizePolicy:function(E){var D=this,A=this.sizePolicies,C,B,F,G;if(E.isCenter){G=E.placeholderFor;if(G){if(G.collapsedVertical()){return A.vert}return A.horz}if(E.collapsed){if(E.collapsedVertical()){return A.vert}return A.horz}return A.flexAll}C=E.collapseTarget;if(C){return C.isVert?A.vert:A.horz}if(E.region){if(E.isVert){B=E.height;F=A.vert}else{B=E.width;F=A.horz}if(E.flex||(typeof B==="string"&&D.percentageRe.test(B))){return A.flexAll}return F}return D.autoSizePolicy}},function(){var A={addUnflexed:function(C){this.flexSpace=Math.max(this.flexSpace-C,0)}},B=this.prototype.axisProps;Ext.apply(B.horz,A);Ext.apply(B.vert,A)})