Ext.define("Ext.layout.container.boxOverflow.Menu",{extend:"Ext.layout.container.boxOverflow.None",requires:["Ext.toolbar.Separator","Ext.button.Button"],alternateClassName:"Ext.layout.boxOverflow.Menu",alias:["box.overflow.menu","box.overflow.Menu"],noItemsMenuText:'<div class="'+Ext.baseCSSPrefix+'toolbar-no-items" role="menuitem">(None)</div>',menuCls:Ext.baseCSSPrefix+"box-menu",constructor:function(A){var B=this;B.callParent([A]);B.menuItems=[]},beginLayout:function(A){this.callParent([A]);this.clearOverflow(A)},beginLayoutCycle:function(B,A){this.callParent([B,A]);if(!A){this.clearOverflow(B);this.layout.cacheChildItems(B)}},onRemove:function(A){Ext.Array.remove(this.menuItems,A)},clearItem:function(A){var B=A.menu;if(A.isButton&&B){A.setMenu(B,false)}},getSuffixConfig:function(){var D=this,C=D.layout,A=C.owner,B=A.id;D.menu=new Ext.menu.Menu({listeners:{scope:D,beforeshow:D.beforeMenuShow}});D.menuTrigger=new Ext.button.Button({id:B+"-menu-trigger",cls:D.menuCls+"-after "+Ext.baseCSSPrefix+"toolbar-item",plain:A.usePlainButtons,ownerCt:A,ownerLayout:C,iconCls:Ext.baseCSSPrefix+D.getOwnerType(A)+"-more-icon",ui:A.defaultButtonUI||"default",menu:D.menu,showEmptyMenu:true,getSplitCls:function(){return""}});return D.menuTrigger.getRenderTree()},getOverflowCls:function(A){return this.menuCls+"-body-"+A},handleOverflow:function(C){var B=this,A=B.layout;B.showTrigger(C);if(A.direction!=="vertical"){B.menuTrigger.setLocalY((C.state.boxPlan.maxSize-B.menuTrigger[A.names.getHeight]())/2)}return{reservedSpace:B.triggerTotalWidth}},captureChildElements:function(){var A=this,C=A.menuTrigger,B=A.layout.names;if(C.rendering){C.finishRender();A.triggerTotalWidth=C[B.getWidth]()+C.el.getMargin(B.parallelMargins)}},clearOverflow:function(G){var F=this,B=F.menuItems,E=B.length,A=F.layout.owner,H=A._asLayoutRoot,D,C;A.suspendLayouts();F.captureChildElements();F.hideTrigger();A.resumeLayouts();for(C=0;C<E;C++){D=B[C];D.suspendLayouts();D.show();F.clearItem(D);D.resumeLayouts(H)}B.length=0},showTrigger:function(D){var N=this,J=N.layout,B=J.owner,M=J.names,Q=M.x,F=M.width,O=D.state.boxPlan,C=O.targetSize[F],H=D.childItems,G=N.menuTrigger,A=N.menuItems,P,I,E,L,K;G.suspendLayouts();G.show();G.resumeLayouts(N._asLayoutRoot);C-=N.triggerTotalWidth;B.suspendLayouts();for(E=0,K=A.length;E<K;++E){N.clearItem(A[E])}A.length=0;for(E=0,K=H.length;E<K;E++){P=H[E];L=P.props;if(L[Q]+L[F]>C){I=P.target;N.menuItems.push(I);I.hide()}}B.resumeLayouts()},hideTrigger:function(){var A=this.menuTrigger;if(A){A.hide()}},beforeMenuShow:function(H){var G=this,B=G.menuItems,D=0,A=B.length,F,E,C=function(J,I){return J.isXType("buttongroup")&&!(I instanceof Ext.toolbar.Separator)};H.suspendLayouts();H.removeAll(false);for(;D<A;D++){F=B[D];if(!D&&(F instanceof Ext.toolbar.Separator)){continue}if(E&&(C(F,E)||C(E,F))){H.add("-")}G.addComponentToMenu(H,F);E=F}if(H.items.length<1){H.add(G.noItemsMenuText)}H.resumeLayouts()},createMenuConfig:function(C,A){var B=Ext.apply({},C.initialConfig),D=C.toggleGroup;Ext.copy(B,C,["iconCls","icon","itemId","disabled","handler","scope","menu","tabIndex"]);Ext.applyIf(B,{text:C.overflowText||C.text,hideOnClick:A,destroyMenu:false,listeners:null});B.masterComponent=C;if(C.isFormField){B.value=C.getValue();B.listeners={change:function(G,F,E){G.masterComponent.setValue(F)}};C.on("change",function(G,F,E){G.overflowClone.setValue(F)})}else{if(D||C.enableToggle){Ext.apply(B,{hideOnClick:false,group:D,checked:C.pressed,handler:function(E,F){E.masterComponent.onClick(F)}})}}if(C.isButton&&!C.changeListenersAdded){C.on({textchange:this.onButtonAttrChange,iconchange:this.onButtonAttrChange,toggle:this.onButtonToggle});C.changeListenersAdded=true}delete B.margin;delete B.ownerCt;delete B.xtype;delete B.id;delete B.itemId;return B},onButtonAttrChange:function(A){var B=A.overflowClone;B.suspendLayouts();B.setText(A.text);B.setIcon(A.icon);B.setIconCls(A.iconCls);B.resumeLayouts(true)},onButtonToggle:function(A,B){if(A.overflowClone.checked!==B){A.overflowClone.setChecked(B)}},addComponentToMenu:function(F,C){var E=this,D,B,A;if(C instanceof Ext.toolbar.Fill){return }else{if(C instanceof Ext.toolbar.Separator){F.add("-")}else{if(C.overflowClone){F.add(C.overflowClone)}else{if(C.isComponent){if(C.isXType("splitbutton")){C.overflowClone=F.add(E.createMenuConfig(C,true))}else{if(C.isXType("button")){C.overflowClone=F.add(E.createMenuConfig(C,!C.menu))}else{if(C.isXType("buttongroup")){B=C.items.items;A=B.length;for(D=0;D<A;D++){E.addComponentToMenu(F,B[D])}}else{C.overflowClone=F.add(Ext.create(Ext.getClassName(C),E.createMenuConfig(C)))}}}}}}}},destroy:function(){var B=this,A=B.menuTrigger;if(A&&!B.layout.owner.items.contains(A)){delete A.ownerCt}B.menu=B.menuTrigger=Ext.destroy(B.menu,A);B.callParent()}})