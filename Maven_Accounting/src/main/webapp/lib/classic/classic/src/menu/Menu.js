Ext.define("Ext.menu.Menu",{extend:"Ext.panel.Panel",alias:"widget.menu",requires:["Ext.layout.container.VBox","Ext.menu.CheckItem","Ext.menu.Item","Ext.menu.Manager","Ext.menu.Separator"],mixins:["Ext.util.FocusableContainer"],enableKeyNav:true,allowOtherMenus:false,ariaRole:"menu",floating:true,constrain:true,hidden:true,hideMode:"visibility",ignoreParentClicks:false,isMenu:true,showSeparator:true,minWidth:undefined,defaultMinWidth:120,defaultAlign:"tl-bl?",focusOnToFront:false,bringParentToFront:false,defaultFocus:":focusable",menuClickBuffer:0,baseCls:Ext.baseCSSPrefix+"menu",_iconSeparatorCls:Ext.baseCSSPrefix+"menu-icon-separator",_itemCmpCls:Ext.baseCSSPrefix+"menu-item-cmp",layout:{type:"vbox",align:"stretchmax",overflowHandler:"Scroller"},initComponent:function(){var C=this,A=[Ext.baseCSSPrefix+"menu"],D=C.bodyCls?[C.bodyCls]:[],E=C.floating!==false,B={element:"el",click:C.onClick,mouseover:C.onMouseOver,scope:C};if(Ext.supports.Touch){B.pointerdown=C.onMouseOver}C.on(B);C.on({beforeshow:C.onBeforeShow,scope:C});if(C.plain){A.push(Ext.baseCSSPrefix+"menu-plain")}C.cls=A.join(" ");D.push(Ext.baseCSSPrefix+"menu-body",Ext.dom.Element.unselectableCls);C.bodyCls=D.join(" ");if(E){if(C.minWidth===undefined){C.minWidth=C.defaultMinWidth}}else{C.hidden=!!C.initialConfig.hidden;C.constrain=false}C.callParent(arguments);Ext.override(C.getLayout(),{configureItem:C.configureItem})},initFloatConstrain:Ext.emptyFn,getInherited:function(){var A=this.callParent();A.hidden=this.hidden;return A},beforeRender:function(){var A=this;A.callParent(arguments);if(!A.getSizeModel().width.shrinkWrap){A.layout.align="stretch"}if(A.floating){A.ariaRenderAttributes=A.ariaRenderAttributes||{};A.ariaRenderAttributes["aria-expanded"]=!!A.autoShow}},onBoxReady:function(){var B=this,C=B._iconSeparatorCls,A=B.focusableKeyNav;if(A){A.map.processEventScope=B;A.map.processEvent=function(D){if(D.keyCode===D.ESC){D.target=this.el.dom}return D};A.map.addBinding([{key:Ext.event.Event.ESC,handler:B.onEscapeKey,scope:B},{key:/[\w]/,handler:B.onShortcutKey,scope:B,shift:false,ctrl:false,alt:false}])}else{B.escapeKeyNav=new Ext.util.KeyNav(B.el,{eventName:"keydown",scope:B,esc:B.onEscapeKey})}B.callParent(arguments);if(B.showSeparator){B.iconSepEl=B.body.insertFirst({role:"presentation",cls:C+" "+C+"-"+B.ui,html:"&#160;"})}if(Ext.supports.MSPointerEvents||Ext.supports.PointerEvents){B.el.on({scope:B,click:B.preventClick,translate:false})}B.mouseMonitor=B.el.monitorMouseLeave(100,B.onMouseLeave,B)},onFocusLeave:function(B){var A=this;A.callParent([B]);A.mixins.focusablecontainer.onFocusLeave.call(A,B);if(A.floating){A.hide()}},canActivateItem:function(A){return A&&A.isFocusable()},deactivateActiveItem:function(){var A=this,B=A.lastFocusedChild;if(B){B.blur()}},getItemFromEvent:function(D){var A=this,C=A.layout.getRenderTarget().dom,B=D.getTarget();while(B.parentNode!==C){B=B.parentNode;if(!B){return }}return Ext.getCmp(B.id)},lookupComponent:function(B){var A=this;if(typeof B==="string"){B=A.lookupItemFromString(B)}else{if(Ext.isObject(B)){B=A.lookupItemFromObject(B)}}if(!B.dock){B.minWidth=B.minWidth||A.minWidth}return B},lookupItemFromObject:function(B){var A=this;if(!B.isComponent){if(!B.xtype){B=Ext.create("Ext.menu."+(Ext.isBoolean(B.checked)?"Check":"")+"Item",B)}else{B=Ext.ComponentManager.create(B,B.xtype)}}if(B.isMenuItem){B.parentMenu=A}return B},lookupItemFromString:function(A){return(A==="separator"||A==="-")?new Ext.menu.Separator():new Ext.menu.Item({canActivate:false,hideOnClick:false,plain:true,text:A})},configureItem:function(C){var B=this.owner,E=Ext.baseCSSPrefix,D=B.ui,A,F;if(C.isMenuItem){C.setUI(D)}else{if(B.items.getCount()>1&&!C.rendered&&!C.dock){F=B._itemCmpCls;A=[F+" "+F+"-"+D];if(!B.plain&&(C.indent!==false||C.iconCls==="no-icon")){A.push(E+"menu-item-indent-"+D)}if(C.rendered){C.el.addCls(A)}else{C.cls=(C.cls||"")+" "+A.join(" ")}C.$extraMenuCls=A}}this.callParent(arguments)},onRemove:function(A){this.callParent([A]);if(!A.destroyed&&A.$extraMenuCls){A.el.removeCls(A.$extraMenuCls)}},onClick:function(F){var E=this,C=F.type,D,B,A=C==="keydown";if(E.disabled){F.stopEvent();return }D=E.getItemFromEvent(F);if(D&&D.isMenuItem){if(!D.menu||!E.ignoreParentClicks){B=D.onClick(F)}else{F.stopEvent()}if(D.menu&&B!==false&&A){D.expandMenu(F,0)}}if(!D||D.disabled){D=undefined}E.fireEvent("click",E,D,F)},onDestroy:function(){var A=this;if(A.escapeKeyNav){A.escapeKeyNav.destroy()}A.parentMenu=A.ownerCmp=A.escapeKeyNav=null;if(A.rendered){A.el.un(A.mouseMonitor);Ext.destroy(A.iconSepEl)}Ext.menu.Manager.onHide(A);A.callParent(arguments)},onMouseLeave:function(A){if(this.disabled){return }this.fireEvent("mouseleave",this,A)},onMouseOver:function(F){var E=this,G=F.getRelatedTarget(),B=!E.el.contains(G),D=E.getItemFromEvent(F),C=E.parentMenu,A=E.ownerCmp;if(B&&C){C.setActiveItem(A);A.cancelDeferHide();C.mouseMonitor.mouseenter()}if(E.disabled){return }if(D){if(!D.containsFocus){D.focus()}if(D.expandMenu){D.expandMenu(F)}}if(B){E.fireEvent("mouseenter",E,F)}E.fireEvent("mouseover",E,D,F)},setActiveItem:function(B){var A=this;if(B&&(B!==A.lastFocusedChild)){A.focusChild(B,1)}},onEscapeKey:function(){if(this.floating){this.hide()}},onShortcutKey:function(G,F){var B=String.fromCharCode(F.getCharCode()),C=this.query(">[text]"),A=C.length,E=this.lastFocusedChild,H=Ext.Array.indexOf(C,E),D=H;for(;;){if(++D===A){D=0}E=C[D];if(D===H){return }if(E.text&&E.text[0].toUpperCase()===B){E.focus();return }}},onFocusableContainerTabKey:function(A){if(this.floating){this.hide()}},onFocusableContainerEnterKey:function(A){this.onClick(A)},onFocusableContainerSpaceKey:function(A){this.onClick(A)},onFocusableContainerLeftKey:function(A){A.preventDefault();if(this.parentMenu){this.ownerCmp.focus();this.hide()}},onFocusableContainerRightKey:function(B){var A=this,C=A.lastFocusedChild;B.preventDefault();if(C&&C.expandMenu){C.expandMenu(B,0)}},onBeforeShow:function(){if(Ext.Date.getElapsed(this.lastHide)<this.menuClickBuffer){return false}},beforeShow:function(){var C=this,B,D,A;if(C.floating){B=C.hasFloatMenuParent();if(!B&&!C.allowOtherMenus){Ext.menu.Manager.hideAll()}if(B){C.focusAnchor=B.focusAnchor}else{D=Ext.Element.getActiveElement();if(D===document.body||D===document.documentElement){C.focusAnchor=null}else{C.focusAnchor=D}}C.savedMaxHeight=C.maxHeight;A=C.container.getViewSize().height;C.maxHeight=Math.min(C.maxHeight||A,A)}C.callParent(arguments)},afterShow:function(){var B=this,A=B.ariaEl.dom;B.callParent(arguments);Ext.menu.Manager.onShow(B);if(B.floating&&A){A.setAttribute("aria-expanded",true)}if(B.floating&&B.autoFocus){B.maxHeight=B.savedMaxHeight;B.focus()}},onHide:function(F,C,D){var E=this,B=E.ariaEl.dom,A;if(E.el.contains(Ext.Element.getActiveElement())){A=E.focusAnchor||E.ownerCmp||E.up(":focusable");if(A){E.previousFocus=A}}E.callParent([F,C,D]);E.lastHide=Ext.Date.now();Ext.menu.Manager.onHide(E);if(E.floating&&B){B.setAttribute("aria-expanded",false)}},preventClick:function(B){var A=this.getItemFromEvent(B);if(A&&A.isMenuItem&&!A.href){B.preventDefault()}},privates:{hasFloatMenuParent:function(){return this.parentMenu||this.up("menu[floating=true]")},setOwnerCmp:function(B,A){var C=this;C.parentMenu=B.isMenuItem?B:null;C.ownerCmp=B;C.registerWithOwnerCt();delete C.hierarchicallyHidden;C.onInheritedAdd(B,A);C.containerOnAdded(B,A)}}})