Ext.define("Ext.panel.Table",{extend:"Ext.panel.Panel",alias:"widget.tablepanel",requires:["Ext.layout.container.Fit"],uses:["Ext.selection.RowModel","Ext.selection.CellModel","Ext.selection.CheckboxModel","Ext.grid.plugin.BufferedRenderer","Ext.grid.header.Container","Ext.grid.locking.Lockable","Ext.grid.NavigationModel"],extraBaseCls:Ext.baseCSSPrefix+"grid",extraBodyCls:Ext.baseCSSPrefix+"grid-body",actionableModeCls:Ext.baseCSSPrefix+"grid-actionable",noHeaderBordersCls:Ext.baseCSSPrefix+"no-header-borders",defaultBindProperty:"store",layout:"fit",ariaRole:"grid",config:{selection:null,headerBorders:true},publishes:["selection"],twoWayBindable:["selection"],autoLoad:false,variableRowHeight:false,numFromEdge:2,trailingBufferZone:10,leadingBufferZone:20,hasView:false,viewType:null,deferRowRender:false,sortableColumns:true,multiColumnSort:false,enableLocking:false,scrollerOwner:true,enableColumnMove:true,sealedColumns:false,enableColumnResize:true,rowLines:true,bufferedRenderer:true,ownerGrid:null,colLinesCls:Ext.baseCSSPrefix+"grid-with-col-lines",rowLinesCls:Ext.baseCSSPrefix+"grid-with-row-lines",noRowLinesCls:Ext.baseCSSPrefix+"grid-no-row-lines",hiddenHeaderCtCls:Ext.baseCSSPrefix+"grid-header-ct-hidden",hiddenHeaderCls:Ext.baseCSSPrefix+"grid-header-hidden",resizeMarkerCls:Ext.baseCSSPrefix+"grid-resize-marker",emptyCls:Ext.baseCSSPrefix+"grid-empty",focusable:true,constructor:function(C){var D=this,A=C&&C.ownerGrid,B;D.ownerGrid=A||D;D.actionables=A?A.actionables:[];D.callParent([C]);B=D.store;B.trackStateChanges=true;if(D.autoLoad){if(!B.isEmptyStore){B.load()}}},registerActionable:function(A){Ext.Array.include(this.actionables,A)},initComponent:function(){if(this.verticalScroller){Ext.raise("The verticalScroller config is not supported.")}if(!this.viewType){Ext.raise("You must specify a viewType config.")}if(this.headers){Ext.raise("The headers config is not supported. Please specify columns instead.")}var G=this,E=G.columns||G.colModel||[],I,H,D,F,J,C,B,A;I=G.store=Ext.data.StoreManager.lookup(G.store||"ext-empty-store");G.enableLocking=G.enableLocking||G.hasLockedColumns(E);if(G.plugins){G.plugins=G.constructPlugins()}if(G.columnLines){G.addBodyCls(G.colLinesCls)}G.addBodyCls(G.rowLines?G.rowLinesCls:G.noRowLinesCls);G.addBodyCls(G.extraBodyCls);if(G.enableLocking){G.self.mixin("lockable",Ext.grid.locking.Lockable);G.injectLockable();A=G.headerCt}else{if(E.isRootHeader){if(G.hideHeaders){E.setHeight(0);E.hiddenHeaders=true}else{E.setScrollable({x:false,y:false})}G.headerCt=A=E;A.grid=G;A.forceFit=!!G.forceFit;A.$initParent=G;G.columnManager=E.columnManager;G.visibleColumnManager=E.visibleColumnManager}else{if(Ext.isArray(E)){E={items:E}}Ext.apply(E,{grid:G,$initParent:G,forceFit:G.forceFit,sortable:G.sortableColumns,enableColumnMove:G.enableColumnMove,enableColumnResize:G.enableColumnResize,columnLines:G.columnLines,sealed:G.sealedColumns,scrollable:G.hideHeaders?undefined:{x:false,y:false}});if(G.hideHeaders){E.height=0;E.hiddenHeaders=true}if(Ext.isDefined(G.enableColumnHide)){E.enableColumnHide=G.enableColumnHide}G.headerCt=A=new Ext.grid.header.Container(E)}}G.columns=C=A.getGridColumns();G.scrollTask=new Ext.util.DelayedTask(G.syncHorizontalScroll,G);G.cls=(G.cls||"")+(" "+G.extraBaseCls);delete G.autoScroll;J=G.plugins&&Ext.Array.findBy(G.plugins,function(K){return K.isBufferedRenderer});if(J){G.bufferedRenderer=J}if(!G.hasView){if(I.isBufferedStore&&!I.getRemoteSort()){for(D=0,F=C.length;D<F;D++){C[D].sortable=false}}if(G.hideHeaders){G.headerCt.addCls(G.hiddenHeaderCtCls);G.addCls(G.hiddenHeaderCls)}G.relayHeaderCtEvents(A);G.features=G.features||[];if(!Ext.isArray(G.features)){G.features=[G.features]}G.dockedItems=[].concat(G.dockedItems||[]);G.dockedItems.unshift(A);G.viewConfig=G.viewConfig||{};H=G.getView();G.items=[H];G.hasView=true;if(!G.hideHeaders){B=H.getScrollable();if(B){A.getScrollable().addPartner(B,"x")}}G.bindStore(I,true);G.mon(H,{viewready:G.onViewReady,refresh:G.onRestoreHorzScroll,scope:G})}G.selModel=G.view.getSelectionModel();if(G.selModel.isRowModel){G.selModel.on({scope:G,lastselectedchanged:G.updateBindSelection,selectionchange:G.updateBindSelection})}G.relayEvents(G.view,["beforeitemmousedown","beforeitemmouseup","beforeitemmouseenter","beforeitemmouseleave","beforeitemclick","beforeitemdblclick","beforeitemcontextmenu","itemmousedown","itemmouseup","itemmouseenter","itemmouseleave","itemclick","itemdblclick","itemcontextmenu","beforecellclick","cellclick","beforecelldblclick","celldblclick","beforecellcontextmenu","cellcontextmenu","beforecellmousedown","cellmousedown","beforecellmouseup","cellmouseup","beforecellkeydown","cellkeydown","rowclick","rowdblclick","rowcontextmenu","rowmousedown","rowmouseup","rowkeydown","beforeitemkeydown","itemkeydown","beforeitemkeyup","itemkeyup","beforeitemkeypress","itemkeypress","beforecontainermousedown","beforecontainermouseup","beforecontainermouseover","beforecontainermouseout","beforecontainerclick","beforecontainerdblclick","beforecontainercontextmenu","beforecontainerkeydown","beforecontainerkeyup","beforecontainerkeypress","containermouseup","containermousedown","containermouseover","containermouseout","containerclick","containerdblclick","containercontextmenu","containerkeydown","containerkeyup","containerkeypress","selectionchange","beforeselect","select","beforedeselect","deselect"]);G.callParent();if(G.enableLocking){G.afterInjectLockable()}else{delete A.$initParent}G.addStateEvents(["columnresize","columnmove","columnhide","columnshow","sortchange","filterchange","groupchange"])},beforeRender:function(){var B=this,C=B.bufferedRenderer,A;if(B.lockable){B.getProtoBody().addCls(B.lockingBodyCls)}else{if(C&&B.getSizeModel().height.auto){if(C.isBufferedRenderer){Ext.raise("Cannot use buffered rendering with auto height")}B.bufferedRenderer=C=false}if(C&&!C.isBufferedRenderer){C={xclass:"Ext.grid.plugin.BufferedRenderer"};Ext.copy(C,B,"variableRowHeight,numFromEdge,trailingBufferZone,leadingBufferZone,scrollToLoadBuffer");B.bufferedRenderer=B.addPlugin(C)}A=B.ariaRenderAttributes||(B.ariaRenderAttributes={});A["aria-readonly"]=!B.isEditable;A["aria-multiselectable"]=B.selModel.selectionMode!=="SINGLE"}B.callParent(arguments)},onRender:function(){var B=this,A,C;if(B.isLocked&&B.getSizeModel().width.shrinkWrap){B.shrinkWrapColumns=true;C=B.headerCt.getTableWidth();if(isNaN(C)){Ext.raise("Locked columns in an unsized locked side do NOT support a flex width.")}A=B.gridPanelBorderWidth||(B.gridPanelBorderWidth=B.el.getBorderWidth("lr"));B.width=C+A}B.callParent()},getHeaderContainer:function(){return this.getView().getHeaderCt()},getColumns:function(){return this.getColumnManager().getColumns()},getVisibleColumns:function(){return this.getVisibleColumnManager().getColumns()},focus:function(){this.getView().focus()},disableColumnHeaders:function(){this.headerCt.disable()},enableColumnHeaders:function(){this.headerCt.enable()},hasLockedColumns:function(C){var B,A,D;if(C.isRootHeader){C=C.items.items}else{if(Ext.isObject(C)){C=C.items}}for(B=0,A=C.length;B<A;B++){D=C[B];if(!D.processed&&D.locked){return true}}},relayHeaderCtEvents:function(A){this.relayEvents(A,["columnresize","columnmove","columnhide","columnshow","columnschanged","sortchange","headerclick","headercontextmenu","headertriggerclick"])},getState:function(){var B=this,C=B.callParent(),A=B.store.getState();C=B.addPropertyToState(C,"columns",B.headerCt.getColumnsState());if(A){C.storeState=A}return C},applyState:function(E){var D=this,F=E.sort,A=E.storeState,B=D.store,C=E.columns;delete E.columns;D.callParent(arguments);if(C){D.headerCt.applyColumnsState(C,A)}if(F){if(B.getRemoteSort()){B.sort({property:F.property,direction:F.direction,root:F.root},null,false)}else{B.sort(F.property,F.direction)}}else{if(A){B.applyState(A)}}},getStore:function(){return this.store},getView:function(){var C=this,A,D,B;if(!C.view){B=C.viewConfig;A=B.scroll||C.scroll;D=C.scrollable;if(D==null&&B.scrollable==null&&A!==null){if(A===true||A==="both"){D=true}else{if(A===false||A==="none"){D=false}else{if(A==="vertical"){D={x:false,y:true}}else{if(A==="horizontal"){D={x:true,y:false}}}}}}B=Ext.apply({grid:C,ownerGrid:C.ownerGrid,deferInitialRefresh:C.deferRowRender,variableRowHeight:C.variableRowHeight,preserveScrollOnRefresh:true,trackOver:C.trackMouseOver!==false,throttledUpdate:C.throttledUpdate===true,xtype:C.viewType,store:C.store,headerCt:C.headerCt,columnLines:C.columnLines,rowLines:C.rowLines,navigationModel:"grid",features:C.features,panel:C,emptyText:C.emptyText||""},C.viewConfig);if(D!=null){B.scrollable=D;C.scrollable=null}Ext.create(B);if(C.view.emptyText){C.view.emptyText='<div class="'+C.emptyCls+'">'+C.view.emptyText+"</div>"}C.view.getComponentLayout().headerCt=C.headerCt;C.mon(C.view,{uievent:C.processEvent,scope:C});C.headerCt.view=C.view;if(C.hasListeners.viewcreated){C.fireEvent("viewcreated",C,C.view)}}return C.view},getColumnManager:function(){return this.columnManager},getVisibleColumnManager:function(){return this.visibleColumnManager},getTopLevelColumnManager:function(){return this.ownerGrid.getColumnManager()},getTopLevelVisibleColumnManager:function(){return this.ownerGrid.getVisibleColumnManager()},setAutoScroll:Ext.emptyFn,applyScrollable:function(A){if(this.view){this.view.setScrollable(A)}return A},getScrollable:function(){return null},processEvent:function(E,G,H,A,F,D,C,I){var B=D.position.column;if(B){return B.processEvent.apply(B,arguments)}},ensureVisible:function(A,B){this.doEnsureVisible(A,B)},scrollByDeltaY:function(B,A){this.getView().scrollBy(0,B,A)},scrollByDeltaX:function(B,A){this.getView().scrollBy(B,0,A)},afterCollapse:function(){this.saveScrollPos();this.callParent(arguments)},afterExpand:function(){this.callParent(arguments);this.restoreScrollPos()},saveScrollPos:Ext.emptyFn,restoreScrollPos:Ext.emptyFn,onHeaderResize:function(){var A=this.view.getScrollable(),B;if(A&&A.isTouchScroller){B=A.getSize();if(B){A.setSize({x:this.headerCt.getTableWidth(),y:B.y})}}},onHeaderMove:function(E,F,A,B,D){var C=this;if(C.optimizedColumnMove===false){C.view.refreshView()}else{C.view.moveColumn(B,D,A)}C.delayScroll()},onHeaderHide:function(B,C){var A=this.view;if(!B.childHideCount&&A.refreshCounter){A.refreshView()}},onHeaderShow:function(B,C){var A=this.view;if(A.refreshCounter){A.refreshView()}},onHeadersChanged:function(B,C){var A=this;if(A.rendered&&!A.reconfiguring){A.view.refreshView();A.delayScroll()}},delayScroll:function(){var A=this.view;if(A){this.scrollTask.delay(10,null,null,[A])}},onViewReady:function(){this.fireEvent("viewready",this)},onRestoreHorzScroll:function(){var B=this,A=B.scrollXPos;if(A){B.syncHorizontalScroll(B,true)}},getScrollerOwner:function(){var A=this;if(!this.scrollerOwner){A=this.up("[scrollerOwner]")}return A},getLhsMarker:function(){var A=this;return A.lhsMarker||(A.lhsMarker=Ext.DomHelper.append(A.el,{role:"presentation",cls:A.resizeMarkerCls},true))},getRhsMarker:function(){var A=this;return A.rhsMarker||(A.rhsMarker=Ext.DomHelper.append(A.el,{role:"presentation",cls:A.resizeMarkerCls},true))},getSelection:function(){return this.getSelectionModel().getSelection()},updateSelection:function(A){var B=this,C;if(!B.ignoreNextSelection){B.ignoreNextSelection=true;C=B.getSelectionModel();if(A){C.select(A)}else{C.deselectAll()}B.ignoreNextSelection=false}},updateBindSelection:function(A,C){var D=this,B=null;if(!D.ignoreNextSelection){D.ignoreNextSelection=true;if(C.length){B=A.getLastSelected();D.hasHadSelection=true}if(D.hasHadSelection){D.setSelection(B)}D.ignoreNextSelection=false}},updateHeaderBorders:function(A){this[A?"removeCls":"addCls"](this.noHeaderBordersCls)},getNavigationModel:function(){return this.getView().getNavigationModel()},getSelectionModel:function(){return this.getView().getSelectionModel()},getScrollTarget:function(){var A=this.getScrollerOwner().query("tableview");return A[A.length-1]},syncHorizontalScroll:function(E,C){var D=this,A=D.view.getScrollX(),B;C=C===true;if(D.rendered&&(C||A!==D.scrollXPos)){if(C){B=D.getScrollTarget();B.setScrollX(A)}D.headerCt.setScrollX(A);D.scrollXPos=A}},onStoreLoad:Ext.emptyFn,getEditorParent:function(){return this.body},bindStore:function(B,C){var D=this,A=D.getView();if(B){D.store=B;if(A.store!==B){A.bindStore(B,false)}D.mon(B,{load:D.onStoreLoad,scope:D});D.storeRelayers=D.relayEvents(B,["filterchange","groupchange"])}else{D.unbindStore()}},unbindStore:function(){var C=this,B=C.store,A;if(B){B.trackStateChanges=false;C.store=null;C.mun(B,{load:C.onStoreLoad,scope:C});Ext.destroy(C.storeRelayers);A=C.view;if(A.store){A.bindStore(null)}}},setColumns:function(A){if(A.length||this.getColumnManager().getColumns().length){this.reconfigure(undefined,A)}},setStore:function(A){this.reconfigure(A);if(this.autoLoad&&!A.isEmptyStore&&!(A.loading||A.isLoaded())){A.load()}},reconfigure:function(J,C){var G=this,A=G.store,B=G.headerCt,I=G.lockable,E=B?B.items.getRange():G.columns,H=G.getView(),D,F;if(arguments.length===1&&Ext.isArray(J)){C=J;J=null}if(C){C=Ext.Array.slice(C)}G.reconfiguring=true;if(J){J=Ext.StoreManager.lookup(J)}G.fireEvent("beforereconfigure",G,J,C,A,E);Ext.suspendLayouts();if(I){G.reconfigureLockable(J,C)}else{D=H.blockRefresh;H.blockRefresh=true;if(J&&J!==A){G.unbindStore();G.bindStore(J)}if(C){delete G.scrollXPos;B.removeAll();B.add(C)}H.blockRefresh=D;F=H.refreshCounter}Ext.resumeLayouts(true);if(I){G.afterReconfigureLockable()}else{if(H.refreshCounter===F){H.refreshView()}}G.fireEvent("reconfigure",G,J,C,A,E);delete G.reconfiguring},beforeDestroy:function(){var B=this,A=B.scrollTask;if(A){A.cancel();B.scrollTask=null}Ext.destroy(B.focusEnterLeaveListeners);B.callParent()},onDestroy:function(){var A=this;if(A.lockable){A.destroyLockable()}A.unbindStore();A.callParent();A.columns=A.storeRelayers=A.columnManager=A.visibleColumnManager=null},destroy:function(){var A=this;A.callParent();if(A.destroyed){A.view=A.selModel=A.headerCt=null}},privates:{initFocusableElement:function(){},doEnsureVisible:function(E,N){if(this.lockable){return this.ensureLockedVisible(E,N)}if(typeof E!=="number"&&!E.isEntity){E=this.store.getById(E)}var F=this,H=F.getView(),D=H.getNode(E),K,L,A,B,I,M,G,C,J;if(N){K=N.callback;L=N.scope;A=N.animate;B=N.highlight;I=N.select;M=N.focus;C=N.column}if(F.deferredEnsureVisible){F.deferredEnsureVisible.destroy()}if(!H.componentLayoutCounter){F.deferredEnsureVisible=H.on({resize:F.doEnsureVisible,args:Ext.Array.slice(arguments),scope:F,single:true,destroyable:true});return }if(typeof C==="number"){C=F.ownerGrid.getVisibleColumnManager().getColumns()[C]}if(D){G=H.getScrollable();if(C){J=Ext.fly(D).selectNode(C.getCellSelector())}if(G){G.scrollIntoView(J||D,!!C,A,B)}if(!E.isEntity){E=H.getRecord(D)}if(I){H.getSelectionModel().select(E)}if(M){H.getNavigationModel().setPosition(E,0)}Ext.callback(K,L||F,[true,E,D])}else{if(H.bufferedRenderer){H.bufferedRenderer.scrollTo(E,{animate:A,highlight:B,select:I,focus:M,column:C,callback:function(Q,O,P){Ext.callback(K,L||F,[true,O,P])}})}else{Ext.callback(K,L||F,[false,null])}}},getFocusEl:function(){return this.getView().getFocusEl()},setActionableMode:function(B,A){var C=this.ownerGrid;if(!C.destroying&&C.view.setActionableMode(B,A)!==false){C.fireEvent("actionablemodechange",B);C[B?"addCls":"removeCls"](C.actionableModeCls);return true}}}})