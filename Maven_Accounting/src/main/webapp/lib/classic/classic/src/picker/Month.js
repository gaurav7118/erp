Ext.define("Ext.picker.Month",{extend:"Ext.Component",requires:["Ext.XTemplate","Ext.util.ClickRepeater","Ext.Date","Ext.button.Button"],alias:"widget.monthpicker",alternateClassName:"Ext.MonthPicker",isMonthPicker:true,focusable:true,childEls:["bodyEl","prevEl","nextEl","monthEl","yearEl"],renderTpl:['<div id="{id}-bodyEl" data-ref="bodyEl" class="{baseCls}-body">','<div id="{id}-monthEl" data-ref="monthEl" class="{baseCls}-months">','<tpl for="months">','<div class="{parent.baseCls}-item {parent.baseCls}-month">','<a style="{parent.monthStyle}" role="button" hidefocus="on" class="{parent.baseCls}-item-inner">{.}</a>',"</div>","</tpl>","</div>",'<div id="{id}-yearEl" data-ref="yearEl" class="{baseCls}-years">','<div class="{baseCls}-yearnav">','<div class="{baseCls}-yearnav-button-ct">','<a id="{id}-prevEl" data-ref="prevEl" class="{baseCls}-yearnav-button {baseCls}-yearnav-prev" hidefocus="on" role="button"></a>',"</div>",'<div class="{baseCls}-yearnav-button-ct">','<a id="{id}-nextEl" data-ref="nextEl" class="{baseCls}-yearnav-button {baseCls}-yearnav-next" hidefocus="on" role="button"></a>',"</div>","</div>",'<tpl for="years">','<div class="{parent.baseCls}-item {parent.baseCls}-year">','<a hidefocus="on" class="{parent.baseCls}-item-inner" role="button">{.}</a>',"</div>","</tpl>","</div>",'<div class="'+Ext.baseCSSPrefix+'clear"></div>','<tpl if="showButtons">','<div class="{baseCls}-buttons">{%',"var me=values.$comp, okBtn=me.okBtn, cancelBtn=me.cancelBtn;","okBtn.ownerLayout = cancelBtn.ownerLayout = me.componentLayout;","okBtn.ownerCt = cancelBtn.ownerCt = me;","Ext.DomHelper.generateMarkup(okBtn.getRenderTree(), out);","Ext.DomHelper.generateMarkup(cancelBtn.getRenderTree(), out);","%}</div>","</tpl>","</div>"],okText:"OK",cancelText:"Cancel",baseCls:Ext.baseCSSPrefix+"monthpicker",showButtons:true,footerButtonUI:"default",measureWidth:35,measureMaxHeight:20,smallCls:Ext.baseCSSPrefix+"monthpicker-small",totalYears:10,yearOffset:5,monthOffset:6,initComponent:function(){var A=this;A.selectedCls=A.baseCls+"-selected";if(A.small){A.addCls(A.smallCls)}A.setValue(A.value);A.activeYear=A.getYear(new Date().getFullYear()-4,-4);if(A.showButtons){A.okBtn=new Ext.button.Button({ui:A.footerButtonUI,text:A.okText,handler:A.onOkClick,scope:A});A.cancelBtn=new Ext.button.Button({ui:A.footerButtonUI,text:A.cancelText,handler:A.onCancelClick,scope:A})}this.callParent()},beforeRender:function(){var F=this,C=0,B=[],A=Ext.Date.getShortMonthName,E=F.monthOffset,G=F.monthMargin,D="";if(F.padding&&!F.width){F.cacheWidth()}F.callParent();for(;C<E;++C){B.push(A(C),A(C+E))}if(Ext.isDefined(G)){D="margin: 0 "+G+"px;"}Ext.apply(F.renderData,{months:B,years:F.getYears(),showButtons:F.showButtons,monthStyle:D})},cacheWidth:function(){var A=this,B=A.parseBox(A.padding),C=Ext.getBody().createChild({cls:A.baseCls+" "+A.borderBoxCls,style:"position:absolute;top:-1000px;left:-1000px;",html:"&nbsp;"});A.self.prototype.width=C.getWidth()+B.left+B.right;C.destroy()},afterRender:function(){var B=this,A=B.bodyEl;B.callParent();if(B.up("[floating=true]")){B.el.on("mousedown",B.onElClick,B)}B.mon(A,"click",B.onBodyClick,B);B.mon(A,"dblclick",B.onBodyClick,B);B.years=A.select("."+B.baseCls+"-year a");B.months=A.select("."+B.baseCls+"-month a");B.backRepeater=new Ext.util.ClickRepeater(B.prevEl,{handler:Ext.Function.bind(B.adjustYear,B,[-B.totalYears])});B.prevEl.addClsOnOver(B.baseCls+"-yearnav-prev-over");B.nextRepeater=new Ext.util.ClickRepeater(B.nextEl,{handler:Ext.Function.bind(B.adjustYear,B,[B.totalYears])});B.nextEl.addClsOnOver(B.baseCls+"-yearnav-next-over");B.updateBody();if(!Ext.isDefined(B.monthMargin)){Ext.picker.Month.prototype.monthMargin=B.calculateMonthMargin()}},calculateMonthMargin:function(){var C=this,A=C.months,D=A.first(),B=D.getMargin("l");while(B&&C.getLargest()>C.measureMaxHeight){--B;A.setStyle("margin","0 "+B+"px")}return B},getLargest:function(A){var B=0;this.months.each(function(D){var C=D.getHeight();if(C>B){B=C}});return B},setValue:function(C){var B=this,D=B.activeYear,A;if(!C){B.value=[null,null]}else{if(Ext.isDate(C)){B.value=[C.getMonth(),C.getFullYear()]}else{B.value=[C[0],C[1]]}}if(B.rendered){A=B.value[1];if(A!==null){if((A<D||A>D+B.yearOffset)){B.activeYear=A-B.yearOffset+1}}B.updateBody()}return B},getValue:function(){return this.value},hasSelection:function(){var A=this.value;return A[0]!==null&&A[1]!==null},getYears:function(){var D=this,E=D.yearOffset,F=D.activeYear,A=F+E,C=F,B=[];for(;C<A;++C){B.push(C,C+E)}return B},updateBody:function(){var H=this,E=H.years,B=H.months,L=H.getYears(),M=H.selectedCls,J=H.getYear(null),F=H.value[0],K=H.monthOffset,G,D,I,A,C;if(H.rendered){E.removeCls(M);B.removeCls(M);D=E.elements;A=D.length;for(I=0;I<A;I++){C=Ext.fly(D[I]);G=L[I];C.dom.innerHTML=G;if(G===J){C.addCls(M)}}if(F!==null){if(F<K){F=F*2}else{F=(F-K)*2+1}B.item(F).addCls(M)}}},getYear:function(A,C){var B=this.value[1];C=C||0;return B===null?A:B+C},onElClick:function(A){A.stopEvent()},onBodyClick:function(D,B){var C=this,A=D.type==="dblclick";if(D.getTarget("."+C.baseCls+"-month")){D.stopEvent();C.onMonthClick(B,A)}else{if(D.getTarget("."+C.baseCls+"-year")){D.stopEvent();C.onYearClick(B,A)}}},adjustYear:function(A){if(typeof A!=="number"){A=this.totalYears}this.activeYear+=A;this.updateBody()},onOkClick:function(){this.fireEvent("okclick",this,this.value)},onCancelClick:function(){this.fireEvent("cancelclick",this)},onMonthClick:function(C,A){var B=this;B.value[0]=B.resolveOffset(B.months.indexOf(C),B.monthOffset);B.updateBody();B.fireEvent("month"+(A?"dbl":"")+"click",B,B.value);B.fireEvent("select",B,B.value)},onYearClick:function(C,A){var B=this;B.value[1]=B.activeYear+B.resolveOffset(B.years.indexOf(C),B.yearOffset);B.updateBody();B.fireEvent("year"+(A?"dbl":"")+"click",B,B.value);B.fireEvent("select",B,B.value)},resolveOffset:function(A,B){if(A%2===0){return(A/2)}else{return B+Math.floor(A/2)}},beforeDestroy:function(){var A=this;A.years=A.months=null;Ext.destroyMembers(A,"backRepeater","nextRepeater","okBtn","cancelBtn");A.callParent()},onDestroy:function(){Ext.destroyMembers(this,"okBtn","cancelBtn");this.callParent()},privates:{finishRenderChildren:function(){var A=this;this.callParent(arguments);if(this.showButtons){A.okBtn.finishRender();A.cancelBtn.finishRender()}}}})