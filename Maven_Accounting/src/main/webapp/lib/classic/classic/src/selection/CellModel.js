Ext.define("Ext.selection.CellModel",{extend:"Ext.selection.DataViewModel",alias:"selection.cellmodel",requires:["Ext.grid.CellContext"],isCellModel:true,deselectOnContainerClick:false,enableKeyNav:true,preventWrap:false,bindComponent:function(A){var C=this,B;if(C.view&&C.gridListeners){C.gridListeners.destroy()}C.callParent([A]);if(A){B=A.grid||A.ownerCt;if(B.optimizedColumnMove!==false){C.gridListeners=B.on({columnmove:C.onColumnMove,scope:C,destroyable:true})}}},getViewListeners:function(){var A=this.callParent();A.refresh=this.onViewRefresh;return A},getHeaderCt:function(){var B=this.navigationModel.getPosition(),A=B?B.view:this.primaryView;return A.headerCt},onNavigate:function(A){if(!A.record||A.keyEvent.stopSelection){return }this.setPosition(A.position)},selectWithEvent:function(A,B){this.select(A)},select:function(G,E,B){var D=this,F,C=D.getPosition(),A=D.view.store;if(G||G===0){if(G.isModel){F=A.indexOf(G);if(F!==-1){G={row:F,column:C?C.column:0}}else{G=null}}else{if(typeof G==="number"){G={row:G,column:0}}}}if(G){D.selectByPosition(G,B)}else{D.deselect()}},getCurrentPosition:function(){var A=this.selecting?this.nextSelection:this.selection;return A?{view:A.view,record:A.record,row:A.rowIdx,columnHeader:A.column,column:A.view.getColumnManager().indexOf(A.column)}:A},getPosition:function(){return(this.selecting?this.nextSelection:this.selection)||null},setCurrentPosition:function(C,A,B){if(C&&!C.isCellContext){C=new Ext.grid.CellContext(this.view).setPosition({row:C.row,column:typeof C.column==="number"?this.view.getColumnManager().getColumns()[C.column]:C.column})}return this.setPosition(C,A,B)},setPosition:function(E,A,D){var C=this,B=C.selection;if(E){E=E.isCellContext?E.clone():new Ext.grid.CellContext(C.view).setPosition(E)}if(!D&&B){if(E&&(E.record===B.record&&E.column===B.column&&E.view===B.view)){E=null}else{C.onCellDeselect(C.selection,A)}}if(E){C.nextSelection=E;C.selecting=true;C.onCellSelect(C.nextSelection,A);C.selecting=false;return(C.selection=E)}return null},isCellSelected:function(A,E,C){var D=this,B,F=D.getPosition();if(F&&F.view===A){B=new Ext.grid.CellContext(A).setPosition({row:E,column:typeof C==="number"?A.getColumnManager().getColumns()[C]:C});return(B.record===F.record)&&(B.column===F.column)}},onStoreRemove:function(B,A,D){var C=this,E=C.getPosition();C.callParent(arguments);if(E&&B.isMoving(E.record)){return }if(E&&B.getCount()&&B.indexOf(E.record)!==-1){E.setRow(E.record)}else{C.selection=null}},onStoreClear:function(){this.callParent(arguments);this.selection=null},onStoreAdd:function(){var A=this,B=A.getPosition();A.callParent(arguments);if(B){B.setRow(B.record)}else{A.selection=null}},onCellClick:function(C,A,E,B,G,D,F){if(D!==-1){this.setPosition(F.position)}},onCellSelect:function(A,B){if(A&&A.rowIdx!==undefined&&A.rowIdx>-1){this.doSelect(A.record,false,B)}},onCellDeselect:function(A,B){if(A&&A.rowIdx!==undefined){this.doDeselect(A.record,B)}},onSelectChange:function(B,E,D,G){var F=this,H,C,A;if(E){H=F.nextSelection;C="select"}else{H=F.selection;C="deselect"}A=H.view||F.primaryView;if((D||F.fireEvent("before"+C,F,B,H.rowIdx,H.colIdx))!==false&&G()!==false){if(E){A.onCellSelect(H)}else{A.onCellDeselect(H);delete F.selection}if(!D){F.fireEvent(C,F,B,H.rowIdx,H.colIdx)}}},refresh:function(){var B=this.getPosition(),A;if(B&&(A=this.store.indexOf(this.selected.last()))!==-1){B.rowIdx=A}},onColumnMove:function(D,E,B,C){var A=D.up("tablepanel");if(A){this.onViewRefresh(A.view)}},onUpdate:function(A){var B=this,C;if(B.isSelected(A)){C=B.selecting?B.nextSelection:B.selection;B.view.onCellSelect(C)}},onViewRefresh:function(B){var E=this,G=E.getPosition(),C,F=B.headerCt,A,D;if(G&&G.view===B){A=G.record;D=G.column;if(!D.isDescendantOf(F)){D=F.queryById(D.id)||F.down('[text="'+D.text+'"]')||F.down('[dataIndex="'+D.dataIndex+'"]')}if(G.record){if(D&&(B.store.indexOfId(A.getId())!==-1)){C=new Ext.grid.CellContext(B).setPosition({row:A,column:D});E.setPosition(C)}}else{E.selection=null}}},selectByPosition:function(A,B){this.setPosition(A,B)}})