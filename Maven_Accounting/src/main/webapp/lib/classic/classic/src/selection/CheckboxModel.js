Ext.define("Ext.selection.CheckboxModel",{alias:"selection.checkboxmodel",extend:"Ext.selection.RowModel",mode:"MULTI",injectCheckbox:0,checkOnly:false,showHeaderCheckbox:undefined,checkSelector:"."+Ext.baseCSSPrefix+"grid-row-checker",allowDeselect:true,headerWidth:24,checkerOnCls:Ext.baseCSSPrefix+"grid-hd-checker-on",tdCls:Ext.baseCSSPrefix+"grid-cell-special "+Ext.baseCSSPrefix+"grid-cell-row-checker",constructor:function(){var A=this;A.callParent(arguments);if(A.mode==="SINGLE"){if(A.showHeaderCheckbox){Ext.Error.raise("The header checkbox is not supported for SINGLE mode selection models.")}A.showHeaderCheckbox=false}},beforeViewRender:function(B){var C=this,A;C.callParent(arguments);if(!C.hasLockedHeader()||B.headerCt.lockedCt){C.addCheckbox(B,true);A=B.ownerCt;if(B.headerCt.lockedCt){A=A.ownerCt}C.mon(A,"reconfigure",C.onReconfigure,C)}},bindComponent:function(A){this.sortable=false;this.callParent(arguments)},hasLockedHeader:function(){var A=this.views,C=A.length,B;for(B=0;B<C;B++){if(A[B].headerCt.lockedCt){return true}}return false},addCheckbox:function(A,B){var C=this,D=C.injectCheckbox,E=A.headerCt;if(D!==false){if(D==="first"){D=0}else{if(D==="last"){D=E.getColumnCount()}}Ext.suspendLayouts();if(A.getStore().isBufferedStore){C.showHeaderCheckbox=false}C.column=E.add(D,C.getHeaderConfig());Ext.resumeLayouts()}if(B!==true){A.refresh()}},onReconfigure:function(C,A,B){if(B){this.addCheckbox(this.views[0])}},toggleUiHeader:function(E){var B=this.views[0],D=B.headerCt,C=D.child("gridcolumn[isCheckerHd]"),A=this.checkerOnCls;if(C){if(E){C.addCls(A)}else{C.removeCls(A)}}},onHeaderClick:function(C,E,B){var A=this,D;if(E===A.column&&A.mode!=="SINGLE"){B.stopEvent();D=E.el.hasCls(Ext.baseCSSPrefix+"grid-hd-checker-on");if(D){A.deselectAll()}else{A.selectAll()}}},getHeaderConfig:function(){var A=this,B=A.showHeaderCheckbox!==false;return{xtype:"gridcolumn",ignoreExport:true,isCheckerHd:B,text:"&#160;",clickTargetName:"el",width:A.headerWidth,sortable:false,draggable:false,resizable:false,hideable:false,menuDisabled:true,dataIndex:"",tdCls:A.tdCls,cls:B?Ext.baseCSSPrefix+"column-header-checkbox ":"",defaultRenderer:A.renderer.bind(A),editRenderer:A.editRenderer||A.renderEmpty,locked:A.hasLockedHeader(),processEvent:A.processColumnEvent}},processColumnEvent:function(E,G,H,B,F,D,C,I){var A=G.getNavigationModel();if(D.type==="keydown"&&G.actionableMode&&D.getKey()===D.SPACE){A.fireEvent("navigate",{view:G,navigationModel:A,keyEvent:D,position:D.position,recordIndex:B,record:C,item:D.item,cell:D.position.cellElement,columnIndex:D.position.colIdx,column:D.position.column})}},renderEmpty:function(){return"&#160;"},refresh:function(){this.callParent(arguments);this.updateHeaderState()},renderer:function(F,C,B,G,E,D,A){return'<div class="'+Ext.baseCSSPrefix+'grid-row-checker" role="button" tabIndex="0">&#160;</div>'},selectByPosition:function(A,B){if(!A.isCellContext){A=new Ext.grid.CellContext(this.view).setPosition(A.row,A.column)}if(!this.checkOnly||A.column===this.column){this.callParent([A,B])}},onSelectChange:function(){this.callParent(arguments);if(!this.suspendChange){this.updateHeaderState()}},onStoreLoad:function(){this.callParent(arguments);this.updateHeaderState()},onStoreAdd:function(){this.callParent(arguments);this.updateHeaderState()},onStoreRemove:function(){this.callParent(arguments);this.updateHeaderState()},onStoreRefresh:function(){this.callParent(arguments);this.updateHeaderState()},maybeFireSelectionChange:function(A){if(A&&!this.suspendChange){this.updateHeaderState()}this.callParent(arguments)},resumeChanges:function(){this.callParent();if(!this.suspendChange){this.updateHeaderState()}},updateHeaderState:function(){var F=this,G=F.store,E=G.getCount(),H=F.views,I=false,A=0,B,D,C;if(!G.isBufferedStore&&E>0){B=F.selected;I=true;for(C=0,D=B.getCount();C<D;++C){if(G.indexOfId(B.getAt(C).id)===-1){break}++A}I=E===A}if(H&&H.length){F.toggleUiHeader(I)}},vetoSelection:function(E){var C=this,B=C.column,A,D,F;if(C.checkOnly){D=E.type==="click"&&E.getTarget(C.checkSelector);F=E.getKey()===E.SPACE&&E.position.column===B;A=!(D||F)}return A||C.callParent([E])},destroy:function(){this.column=null;this.callParent()},privates:{onBeforeNavigate:function(A){var B=A.keyEvent;if(this.selectionMode!=="SINGLE"){A.ctrlKey=A.ctrlKey||B.ctrlKey||(B.type==="click"&&!B.shiftKey)||B.getKey()===B.SPACE}},selectWithEventMulti:function(A,D,B){var C=this;if(!D.shiftKey&&!D.ctrlKey&&D.getTarget(C.checkSelector)){if(B){C.doDeselect(A)}else{C.doSelect(A,true)}}else{C.callParent([A,D,B])}}}})