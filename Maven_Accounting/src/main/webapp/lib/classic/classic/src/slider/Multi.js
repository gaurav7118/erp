Ext.define("Ext.slider.Multi",{extend:"Ext.form.field.Base",alias:"widget.multislider",alternateClassName:"Ext.slider.MultiSlider",requires:["Ext.slider.Thumb","Ext.slider.Tip","Ext.Number","Ext.util.Format","Ext.Template"],vertical:false,minValue:0,maxValue:100,decimalPrecision:0,keyIncrement:1,pageSize:10,increment:0,clickRange:[5,15],clickToChange:true,animate:true,dragging:false,constrainThumbs:true,useTips:true,tipText:null,defaultBindProperty:"values",ariaRole:"slider",focusable:true,needArrowKeys:true,tabIndex:0,focusCls:"slider-focus",childEls:["endEl","innerEl"],fieldSubTpl:['<div id="{id}" data-ref="inputEl" {inputAttrTpl}',' class="',Ext.baseCSSPrefix,"slider {fieldCls} {vertical}",'{childElCls}"','<tpl if="tabIdx != null"> tabindex="{tabIdx}"</tpl>','<tpl foreach="inputElAriaAttributes"> {$}="{.}"</tpl>',">",'<div id="{cmpId}-endEl" data-ref="endEl" class="'+Ext.baseCSSPrefix+'slider-end" role="presentation">','<div id="{cmpId}-innerEl" data-ref="innerEl" class="'+Ext.baseCSSPrefix+'slider-inner" role="presentation">',"{%this.renderThumbs(out, values)%}","</div>","</div>","</div>",{renderThumbs:function(F,E){var H=E.$comp,G=0,C=H.thumbs,B=C.length,D,A;for(;G<B;G++){D=C[G];A=D.getElConfig();A.id=H.id+"-thumb-"+G;Ext.DomHelper.generateMarkup(A,F)}},disableFormats:true}],horizontalProp:"left",initValue:function(){var E=this,B=Ext.valueFrom,C=B(E.values,[B(E.value,B(E.minValue,0))]),D=0,A=C.length;E.originalValue=C;for(;D<A;D++){E.addThumb(E.normalizeValue(C[D]))}},initComponent:function(){var E=this,C,D,F,B,A;E.thumbs=[];E.keyIncrement=Math.max(E.increment,E.keyIncrement);E.extraFieldBodyCls=Ext.baseCSSPrefix+"slider-ct-"+(E.vertical?"vert":"horz");E.callParent();if(E.useTips){if(Ext.isObject(E.useTips)){C=Ext.apply({},E.useTips)}else{C=E.tipText?{getText:E.tipText}:{}}A=E.plugins=E.plugins||[];B=A.length;for(F=0;F<B;F++){if(A[F].isSliderTip){D=true;break}}if(!D){E.plugins.push(new Ext.slider.Tip(C))}}},addThumb:function(C){var B=this,A=new Ext.slider.Thumb({ownerCt:B,value:C,slider:B,index:B.thumbs.length,constrain:B.constrainThumbs,disabled:!!B.readOnly});B.thumbs.push(A);if(B.rendered){A.render()}return A},promoteThumb:function(B){var A=this.thumbStack||(this.thumbStack=Ext.Array.slice(this.thumbs)),D=A.length,E=10000,C;if(A[0]!==B){Ext.Array.remove(A,B);A.unshift(B)}for(C=0;C<D;C++){A[C].el.setStyle("zIndex",E);E-=1000}},getSubTplData:function(B){var C=this,D,A;D=Ext.apply(C.callParent([B]),{$comp:C,vertical:C.vertical?Ext.baseCSSPrefix+"slider-vert":Ext.baseCSSPrefix+"slider-horz",minValue:C.minValue,maxValue:C.maxValue,value:C.value,tabIdx:C.tabIndex,childElCls:""});A=D.inputElAriaAttributes;if(A){A["aria-orientation"]=C.vertical?"vertical":"horizontal";A["aria-valuemin"]=C.minValue;A["aria-valuemax"]=C.maxValue;A["aria-valuenow"]=C.value}return D},onRender:function(){var E=this,B=E.thumbs,A=B.length,D=0,C;E.callParent(arguments);for(D=0;D<A;D++){C=B[D];C.el=E.el.getById(E.id+"-thumb-"+D);C.onRender()}},initEvents:function(){var A=this;A.callParent();A.mon(A.el,{scope:A,mousedown:A.onMouseDown,keydown:A.onKeyDown})},onDragStart:Ext.emptyFn,onDragEnd:Ext.emptyFn,getTrackpoint:function(G){var F=this,D=F.vertical,C=F.innerEl,B,A,E;if(D){E="top";B=C.getHeight()}else{E=F.horizontalProp;B=C.getWidth()}G=F.transformTrackPoints(C.translatePoints(G));A=Ext.Number.constrain(G[E],0,B);return D?B-A:A},transformTrackPoints:Ext.identityFn,checkChange:Ext.emptyFn,onMouseDown:function(G){var D=this,F=false,C=0,B=D.thumbs,A=B.length,E;if(D.disabled){return }for(;!F&&C<A;C++){F=F||G.target===B[C].el.dom}D.focus();if(D.clickToChange&&!F){E=D.getTrackpoint(G.getXY());if(E!==undefined){D.onClickChange(E)}}},onClickChange:function(D){var C=this,A,B;A=C.getNearest(D);if(!A.disabled){B=A.index;C.setValue(B,Ext.util.Format.round(C.reversePixelValue(D),C.decimalPrecision),undefined,true)}},getNearest:function(H){var I=this,F=I.reversePixelValue(H),J=I.getRange()+5,B=null,E=I.thumbs,C=0,D=E.length,A,K,G;for(;C<D;C++){A=I.thumbs[C];K=A.value;G=Math.abs(K-F);if(Math.abs(G)<=J){if(B&&B.value==K&&K>F&&A.index>B.index){continue}B=A;J=G}}return B},onKeyDown:function(D){var C=this,A=C.ariaEl.dom,B,E;B=D.getKey();if(C.disabled||C.thumbs.length!==1){if(B!==D.TAB){D.preventDefault()}return }switch(B){case D.UP:case D.RIGHT:E=D.ctrlKey?C.maxValue:C.getValue(0)+C.keyIncrement;break;case D.DOWN:case D.LEFT:E=D.ctrlKey?C.minValue:C.getValue(0)-C.keyIncrement;break;case D.HOME:E=C.minValue;break;case D.END:E=C.maxValue;break;case D.PAGE_UP:E=C.getValue(0)+C.pageSize;break;case D.PAGE_DOWN:E=C.getValue(0)-C.pageSize;break}if(E!==undefined){D.stopEvent();E=C.normalizeValue(E);C.setValue(0,E,undefined,true);if(A){A.setAttribute("aria-valuenow",E)}}},normalizeValue:function(B){var C=this,A=C.zeroBasedSnapping?"snap":"snapInRange";B=Ext.Number[A](B,C.increment,C.minValue,C.maxValue);B=Ext.util.Format.round(B,C.decimalPrecision);B=Ext.Number.constrain(B,C.minValue,C.maxValue);return B},setMinValue:function(G){var F=this,C=F.thumbs,B=C.length,A=F.ariaEl.dom,D,E;F.minValue=G;for(E=0;E<B;++E){D=C[E];if(D.value<G){F.setValue(E,G,false)}}if(A){A.setAttribute("aria-valuemin",G)}F.syncThumbs()},setMaxValue:function(G){var F=this,C=F.thumbs,B=C.length,A=F.ariaEl.dom,D,E;F.maxValue=G;for(E=0;E<B;++E){D=C[E];if(D.value>G){F.setValue(E,G,false)}}if(A){A.setAttribute("aria-valuemax",G)}F.syncThumbs()},setValue:function(F,J,B,D){var I=this,H=I.thumbs,G=I.ariaEl.dom,A,E,C,K;if(Ext.isArray(F)){K=F;B=J;for(C=0,E=K.length;C<E;++C){A=H[C];if(A){I.setValue(C,K[C],B)}}return I}A=I.thumbs[F];J=I.normalizeValue(J);if(J!==A.value&&I.fireEvent("beforechange",I,J,A.value,A)!==false){A.value=J;if(I.rendered){if(Ext.isDefined(B)){B=B===false?false:B}else{B=I.animate}A.move(I.calculateThumbPosition(J),B);if(F===0&&G){G.setAttribute("aria-valuenow",J)}I.fireEvent("change",I,J,A);I.checkDirty();if(D){I.fireEvent("changecomplete",I,J,A)}}}return I},calculateThumbPosition:function(A){var B=this,C=B.minValue,D=(A-C)/B.getRange()*100;if(isNaN(D)){D=0}return D},getRatio:function(){var B=this,D=B.innerEl,A=B.vertical?D.getHeight():D.getWidth(),C=B.getRange();return C===0?A:(A/C)},getRange:function(){return this.maxValue-this.minValue},reversePixelValue:function(A){return this.minValue+(A/this.getRatio())},reversePercentageValue:function(A){return this.minValue+this.getRange()*(A/100)},onDisable:function(){var F=this,D=0,B=F.thumbs,A=B.length,C,E,G;F.callParent();for(;D<A;D++){C=B[D];E=C.el;C.disable();if(Ext.isIE){G=E.getXY();E.hide();F.innerEl.addCls(F.disabledCls).dom.disabled=true;if(!F.thumbHolder){F.thumbHolder=F.endEl.createChild({role:"presentation",cls:Ext.baseCSSPrefix+"slider-thumb "+F.disabledCls})}F.thumbHolder.show().setXY(G)}}},onEnable:function(){var F=this,D=0,B=F.thumbs,A=B.length,C,E;this.callParent();for(;D<A;D++){C=B[D];E=C.el;C.enable();if(Ext.isIE){F.innerEl.removeCls(F.disabledCls).dom.disabled=false;if(F.thumbHolder){F.thumbHolder.hide()}E.show();F.syncThumbs()}}},syncThumbs:function(){if(this.rendered){var A=this.thumbs,C=A.length,B=0;for(;B<C;B++){A[B].move(this.calculateThumbPosition(A[B].value))}}},getValue:function(A){return Ext.isNumber(A)?this.thumbs[A].value:this.getValues()},getValues:function(){var C=[],D=0,B=this.thumbs,A=B.length;for(;D<A;D++){C.push(B[D].value)}return C},getSubmitValue:function(){var A=this;return(A.disabled||!A.submitValue)?null:A.getValue()},reset:function(){var D=this,A=[].concat(D.originalValue),B=0,C=A.length,E;for(;B<C;B++){E=A[B];D.setValue(B,E)}D.clearInvalid();delete D.wasValid},setReadOnly:function(E){var D=this,B=D.thumbs,A=B.length,C=0;D.callParent(arguments);E=D.readOnly;for(;C<A;++C){if(E){B[C].disable()}else{B[C].enable()}}},beforeDestroy:function(){var E=this,B=E.thumbs,D=0,A=B.length,C;if(E.rendered){for(;D<A;D++){C=B[D];Ext.destroy(C)}}E.callParent()}})