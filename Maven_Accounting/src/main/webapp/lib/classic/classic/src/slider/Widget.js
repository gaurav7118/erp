Ext.define("Ext.slider.Widget",{extend:"Ext.Widget",alias:"widget.sliderwidget",requires:["Ext.slider.Multi"],cachedConfig:{vertical:false},config:{clickToChange:true,ui:"widget",value:0,minValue:0,maxValue:100,publishOnComplete:true,twoWayBindable:{value:1}},decimalPrecision:0,defaultBindProperty:"value",element:{reference:"element",cls:Ext.baseCSSPrefix+"slider",listeners:{mousedown:"onMouseDown",dragstart:"cancelDrag",drag:"cancelDrag",dragend:"cancelDrag"},children:[{reference:"endEl",cls:Ext.baseCSSPrefix+"slider-end",children:[{reference:"innerEl",cls:Ext.baseCSSPrefix+"slider-inner"}]}]},thumbCls:Ext.baseCSSPrefix+"slider-thumb",horizontalProp:"left",animateOnSetValue:undefined,applyValue:function(E){var D=this,B=D.animateOnSetValue,C,A;if(Ext.isArray(E)){E=Ext.Array.from(E);for(C=0,A=E.length;C<A;++C){D.setThumbValue(C,E[C]=D.normalizeValue(E[C]),B,true)}}else{E=D.normalizeValue(E);D.setThumbValue(0,E,B,true)}return E},updateVertical:function(A,B){this.element.removeCls(Ext.baseCSSPrefix+"slider-"+(B?"vert":"horz"));this.element.addCls(Ext.baseCSSPrefix+"slider-"+(A?"vert":"horz"))},updateHeight:function(A,B){this.callParent([A,B]);this.endEl.dom.style.height=this.innerEl.dom.style.height="100%"},cancelDrag:function(A){A.stopPropagation()},getThumb:function(C){var D=this,B,A=(D.thumbs||(D.thumbs=[]))[C];if(!A){B={cls:D.thumbCls,style:{}};B["data-thumbIndex"]=C;A=D.thumbs[C]=D.innerEl.createChild(B)}return A},getThumbPositionStyle:function(){return this.getVertical()?"bottom":(this.rtl&&Ext.rtl?"right":"left")},update:function(){var D=this,B=D.getValue(),A=B.length,C;for(C=0;C<A;C++){this.thumbs[C].dom.style[D.getThumbPositionStyle()]=D.calculateThumbPosition(B[C])+"%"}},onMouseDown:function(D){var B=this,A,C=D.getXY(),E;if(!B.disabled&&D.button===0){Ext.getDoc().on({scope:B,capture:true,selectstart:B.stopSelect});A=D.getTarget("."+B.thumbCls,null,true);if(A){B.animateOnSetValue=false;B.promoteThumb(A);B.captureMouse(B.onMouseMove,B.onMouseUp,[A],1);E=B.pointerOffset=A.getXY();E[0]+=Math.floor(A.getWidth()/2)-C[0];E[1]+=Math.floor(A.getHeight()/2)-C[1]}else{if(B.getClickToChange()){C=B.getTrackpoint(C);if(C!=null){B.onClickChange(C)}}}}},onClickChange:function(E){var C=this,A,B,D;A=C.getNearest(E);B=parseInt(A.getAttribute("data-thumbIndex"),10);D=Ext.util.Format.round(C.reversePixelValue(E),C.decimalPrecision);if(B){C.setThumbValue(B,D,undefined,true)}else{C.setValue(D)}},getNearest:function(H){var I=this,F=I.reversePixelValue(H),J=I.getRange()+5,B=null,E=I.thumbs,C=0,D=E.length,A,K,G;for(;C<D;C++){A=E[C];K=I.reversePercentageValue(parseInt(A.dom.style[I.getThumbPositionStyle()],10));G=Math.abs(K-F);if(Math.abs(G)<=J){B=A;J=G}}return B},promoteThumb:function(B){var A=this.thumbStack||(this.thumbStack=Ext.Array.slice(this.thumbs)),D=A.length,E=10000,C;if(A[0]!==B){Ext.Array.remove(A,B);A.unshift(B)}for(C=0;C<D;C++){A[C].el.setStyle("zIndex",E);E-=1000}},doMouseMove:function(H,B,E){var D=this,A=H.getXY(),G,C,F;A[0]+=D.pointerOffset[0];A[1]+=D.pointerOffset[1];F=D.getTrackpoint(A);if(F){G=D.reversePixelValue(F);C=parseInt(B.getAttribute("data-thumbIndex"),10);if(C||(!E&&D.getPublishOnComplete())){D.setThumbValue(C,G,false,E)}else{D.setValue(G)}}},onMouseMove:function(B,A){this.doMouseMove(B,A,false)},onMouseUp:function(C,A){var B=this;B.doMouseMove(C,A,true);Ext.getDoc().un({scope:B,capture:true,selectstart:B.stopSelect});delete B.animateOnSetValue},stopSelect:function(A){A.stopEvent();return false},setThumbValue:function(F,I,B,D){var H=this,A,E,G,C,J;if(Ext.isArray(F)){J=F;B=I;for(C=0,G=J.length;C<G;++C){H.setThumbValue(C,J[C],B,D)}return H}A=H.getThumb(F);E=H.reversePercentageValue(parseInt(A.dom.style[H.getThumbPositionStyle()],10));I=H.normalizeValue(I);if(I!==E&&H.fireEvent("beforechange",H,I,E,A)!==false){if(H.element.dom){H.element.set({"aria-valuenow":I,"aria-valuetext":I});H.moveThumb(A,H.calculateThumbPosition(I),Ext.isDefined(B)?B!==false:H.animate);H.fireEvent("change",H,I,A)}}return H},getValue:function(A){var B=this,C;if(Ext.isNumber(A)){C=B.thumbs[A].dom.style[B.getThumbPositionStyle()];C=B.reversePercentageValue(parseInt(C,10))}else{C=B.getValues();if(C.length===1){C=C[0]}}return C},getValues:function(){var E=this,C=[],D=0,B=E.thumbs,A=B.length;for(;D<A;D++){C.push(E.reversePercentageValue(parseInt(E.thumbs[D].dom.style[E.getThumbPositionStyle()],10)))}return C},moveThumb:function(D,C,B){var E=this,A=E.getThumbPositionStyle(),G,F;C+="%";if(!B){D.dom.style[A]=C}else{G={};G[A]=C;if(!Ext.supports.GetPositionPercentage){F={};F[A]=D.dom.style[A]}new Ext.fx.Anim({target:D,duration:350,from:F,to:G})}},normalizeValue:function(B){var C=this,A=C.zeroBasedSnapping?"snap":"snapInRange";B=Ext.Number[A](B,C.increment,C.minValue,C.maxValue);B=Ext.util.Format.round(B,C.decimalPrecision);B=Ext.Number.constrain(B,C.minValue,C.maxValue);return B},getTrackpoint:function(G){var F=this,D=F.getVertical(),C=F.innerEl,B,A,E;if(D){E="top";B=C.getHeight()}else{E="left";B=C.getWidth()}G=F.transformTrackPoints(C.translatePoints(G));A=Ext.Number.constrain(G[E],0,B);return D?B-A:A},transformTrackPoints:Ext.identityFn,calculateThumbPosition:function(A){var B=this,C=(A-B.getMinValue())/B.getRange()*100;if(isNaN(C)){C=0}return C},getRatio:function(){var B=this,D=B.innerEl,A=B.getVertical()?D.getHeight():D.getWidth(),C=B.getRange();return C===0?A:(A/C)},getRange:function(){return this.getMaxValue()-this.getMinValue()},reversePixelValue:function(A){return this.getMinValue()+(A/this.getRatio())},reversePercentageValue:function(A){return this.getMinValue()+this.getRange()*(A/100)},captureMouse:function(G,B,D,A){var F=this,C,E;G=G&&Ext.Function.bind(G,F,D,A);B=B&&Ext.Function.bind(B,F,D,A);C=function(){Ext.getDoc().un(E);if(B){B.apply(F,arguments)}};E={mousemove:G,mouseup:C};Ext.getDoc().on(E)}})