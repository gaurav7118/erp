Ext.define("Ext.sparkline.Bar",{extend:"Ext.sparkline.BarBase",requires:["Ext.sparkline.RangeMap"],alias:"widget.sparklinebar",config:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:null,nullColor:null,zeroAxis:true,barWidth:4,barSpacing:1,chartRangeMin:null,chartRangeMax:null,chartRangeClip:false,colorMap:null,tipTpl:new Ext.XTemplate("&#9679; {prefix}{value}{suffix}")},remove:function(E,C){var B,D,A=[];for(B=0,D=E.length;B<D;B++){if(E[B]!==C){A.push(E[B])}}return A},all:function(B,D,A){var C;for(C=B.length;C--;){if(A&&B[C]===null){continue}if(B[C]!==D){return false}}return true},applyColorMap:function(A){var B=this;if(Ext.isArray(A)){B.colorMapByIndex=A;B.colorMapByValue=null}else{B.colorMapByIndex=null;B.colorMapByValue=A;if(B.colorMapByValue&&B.colorMapByValue.get==null){B.colorMapByValue=new Ext.sparkline.RangeMap(A)}}return A},onUpdate:function(){var f=this,C=f.values,Q=f.getBarWidth(),N=f.getBarSpacing(),H=f.getChartRangeMin(),I=f.getChartRangeMax(),J=f.getChartRangeClip(),a=Infinity,d=-Infinity,S,O,R,E,F,Y,G,P,W=f.getZeroAxis(),L,U,X,Z,c,b,T,V,e,M,g,K,D,B=[],A=[];for(Y=0,G=C.length;Y<G;Y++){g=C[Y];S=typeof (g)==="string"&&g.indexOf(":")>-1;if(S||Ext.isArray(g)){b=true;if(S){g=C[Y]=f.normalizeValues(g.split(":"))}g=f.remove(g,null);O=Math.min.apply(Math,g);R=Math.max.apply(Math,g);if(O<a){a=O}if(R>d){d=R}}}f.stacked=b;f.regionShapes={};f.totalBarWidth=Q+N;f.width=(C.length*Q)+((C.length-1)*N);if(J){Z=H==null?-Infinity:H;c=I==null?Infinity:I}F=[];E=b?[]:F;for(Y=0,G=C.length;Y<G;Y++){if(b){T=C[Y];C[Y]=M=[];B[Y]=0;E[Y]=A[Y]=0;for(V=0,e=T.length;V<e;V++){g=M[V]=J?Ext.Number.constrain(T[V],Z,c):T[V];if(g!==null){if(g>0){B[Y]+=g}if(a<0&&d>0){if(g<0){A[Y]+=Math.abs(g)}else{E[Y]+=g}}else{E[Y]+=Math.abs(g-(g<0?d:a))}F.push(g)}}}else{g=J?Ext.Number.constrain(C[Y],Z,c):C[Y];g=C[Y]=f.normalizeValue(g);if(g!==null){F.push(g)}}}f.max=X=Math.max.apply(Math,F);f.min=U=Math.min.apply(Math,F);f.stackMax=d=b?Math.max.apply(Math,B):X;f.stackMin=a=b?Math.min.apply(Math,F):U;if(H!=null&&(J||H<U)){U=H}if(I!=null&&(J||I>X)){X=I}if(U<=0&&X>=0&&W){L=0}else{if(!W){L=U}else{if(U>0){L=U}else{L=X}}}f.xAxisOffset=L;P=b?(Math.max.apply(Math,E)+Math.max.apply(Math,A)):X-U;f.canvasHeightEf=(W&&U<0)?f.getHeight()-2:f.getHeight()-1;if(U<L){D=(b&&X>=0)?d:X;K=(D-L)/P*f.getHeight();if(K!==Math.ceil(K)){f.canvasHeightEf-=2;K=Math.ceil(K)}}else{K=f.getHeight()}f.yoffset=K;f.range=P},getRegion:function(B,C){var A=Math.floor(B/this.totalBarWidth);return(A<0||A>=this.values.length)?undefined:A},getRegionFields:function(E){var B=Ext.Array.from(this.values[E]),A=[],D,C;for(C=B.length;C--;){D=B[C];A.push({isNull:D===null,value:D,color:this.calcColor(C,D,E),offset:E})}return A},calcColor:function(I,H,D){var F=this,B=F.colorMapByIndex,G=F.colorMapByValue,A,E,C=F.getZeroColor();if(this.stacked){A=F.getStackedBarColor()}else{A=(H<0)?F.getNegBarColor():F.getBarColor()}if(H===0&&C!==undefined){A=C}if(G&&(E=G.get(H))){A=E}else{if(B&&B.length>D){A=B[D]}}return Ext.isArray(A)?A[I%A.length]:A},renderRegion:function(J,E){var V=this,L=V.values[J],A=V.xAxisOffset,M=V.range,U=V.stacked,C=V.canvas,O=V.getBarWidth(),H=J*V.totalBarWidth,B=V.canvasHeightEf,I=V.yoffset,G,P,R,Q,F,S,D,W,T,K,N=V.getNullColor();L=Ext.isArray(L)?L:[L];D=L.length;W=L[0];Q=V.all(L,null);K=V.all(L,A,true);if(Q){if(N){R=E?N:V.calcHighlightColor(N,V);G=(I>0)?I-1:I;C.drawRect(H,G,O-1,0,R,R).append()}return }F=I;for(S=0;S<D;S++){W=L[S];if(U&&W===A){if(!K||T){continue}T=true}if(M>0){P=Math.floor(B*((Math.abs(W-A)/M)))+1}else{P=1}if(W<A||(W===A&&I===0)){G=F;F+=P}else{G=I-P;I-=P}R=V.calcColor(S,W,J);if(E){R=V.calcHighlightColor(R,V)}C.drawRect(H,G,O-1,P-1,R,R).append()}}},function(A){A.onClassCreated(A)})