Ext.define("Ext.sparkline.Line",{extend:"Ext.sparkline.Base",requires:["Ext.sparkline.RangeMap"],alias:"widget.sparklineline",config:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:null,normalRangeMax:null,normalRangeColor:"#ccc",drawNormalOnTop:false,chartRangeMin:null,chartRangeMax:null,chartRangeMinX:null,chartRangeMaxX:null,tipTpl:new Ext.XTemplate("&#9679; {prefix}{y}{suffix}"),valueSpots:null},applyValueSpots:function(A){if(A&&!A.get){A=new Ext.sparkline.RangeMap(A)}return A},onUpdate:function(){this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues=[];this.yminmax=[]},getRegion:function(A,D){var B,C=this.regionMap;for(B=C.length;B--;){if(C[B]!==null&&A>=C[B][0]&&A<=C[B][1]){return C[B][2]}}return undefined},getRegionFields:function(A){return{isNull:this.yvalues[A]===null,x:this.xvalues[A],y:this.yvalues[A],color:this.getLineColor(),fillColor:this.getFillColor(),offset:A}},renderHighlight:function(F){var C=this,A=C.canvas,E=C.vertices[F],B=C.getSpotRadius(),G=C.getHighlightSpotColor(),D=C.getHighlightLineColor();if(!E){return }if(B&&G){A.drawCircle(E[0],E[1],B,null,G).append()}if(D){A.drawLine(E[0],C.canvasTop,E[0],C.canvasTop+C.getHeight(),D).append()}},scanValues:function(){var I=this,J=I.values,C=J.length,A=I.xvalues,G=I.yvalues,K=I.yminmax,E,D,H,F,B;for(E=0;E<C;E++){D=J[E];H=typeof (J[E])==="string";F=typeof (J[E])==="object"&&J[E] instanceof Array;B=H&&J[E].split(":");if(H&&B.length===2){A.push(Number(B[0]));G.push(Number(B[1]));K.push(Number(B[1]))}else{if(F){A.push(D[0]);G.push(D[1]);K.push(D[1])}else{A.push(E);if(J[E]===null||J[E]==="null"){G.push(null)}else{G.push(Number(D));K.push(Number(D))}}}}if(I.xvalues){A=I.xvalues}I.maxy=I.maxyorg=Math.max.apply(Math,K);I.miny=I.minyorg=Math.min.apply(Math,K);I.maxx=Math.max.apply(Math,A);I.minx=Math.min.apply(Math,A);I.xvalues=A;I.yvalues=G;I.yminmax=K},processRangeOptions:function(){var D=this,C=D.getNormalRangeMin(),F=D.getNormalRangeMax(),A=D.getChartRangeMin(),B=D.getChartRangeMinX(),E=D.getChartRangeMax(),G=D.getChartRangeMaxX();if(C!=null){if(C<D.miny){D.miny=C}if(F>D.maxy){D.maxy=F}}if(A!=null&&(D.chartRangeClip||A<D.miny)){D.miny=A}if(E!=null&&(D.chartRangeClip||E>D.maxy)){this.maxy=E}if(B!=null&&(D.chartRangeClipX||B<D.minx)){D.minx=B}if(G!=null&&(D.chartRangeClipX||G>D.maxx)){D.maxx=G}},drawNormalRange:function(C,G,F,D,H){var A=this.getNormalRangeMin(),E=this.getNormalRangeMax(),B=G+Math.round(F-(F*((E-this.miny)/H))),I=Math.round((F*(E-A))/H);this.canvas.drawRect(C,B,D,I,undefined,this.normalRangeColor).append()},renderGraph:function(){var O=this,I=O.canvas,k=O.getWidth(),K=O.getHeight(),D=O.vertices,j=O.getSpotRadius(),m=O.regionMap,X,F,Z,R,P,Q,g,W,c,b,H,U,L,N,G,h,E,a,M,C=O.getValueSpots(),e,S,d,f,l,J=O.getSpotColor(),B=O.getMinSpotColor(),V=O.getMaxSpotColor(),T=O.getNormalRangeMin(),A=O.getDrawNormalOnTop();if(!O.callParent()){return }O.scanValues();O.processRangeOptions();d=O.xvalues;f=O.yvalues;if(!O.yminmax.length||O.yvalues.length<2){return }R=P=0;X=O.maxx-O.minx===0?1:O.maxx-O.minx;F=O.maxy-O.miny===0?1:O.maxy-O.miny;Z=O.yvalues.length-1;if(j&&(k<(j*4)||K<(j*4))){j=0}if(j){e=O.getHighlightSpotColor()&&!O.disableInteraction;if(e||B||(J&&f[Z]===O.miny)){K-=Math.ceil(j)}if(e||V||(J&&f[Z]===O.maxy)){K-=Math.ceil(j);R+=Math.ceil(j)}if(e||((B||V)&&(f[0]===O.miny||f[0]===O.maxy))){P+=Math.ceil(j);k-=Math.ceil(j)}if(e||J||(B||V&&(f[Z]===O.miny||f[Z]===O.maxy))){k-=Math.ceil(j)}}K--;if(T!=null&&!A){O.drawNormalRange(P,R,K,k,F)}g=[];W=[g];N=G=null;h=f.length;for(l=0;l<h;l++){c=d[l];H=d[l+1];b=f[l];U=P+Math.round((c-O.minx)*(k/X));L=l<h-1?P+Math.round((H-O.minx)*(k/X)):k;G=U+((L-U)/2);m[l]=[N||0,G,l];N=G;if(b===null){if(l){if(f[l-1]!==null){g=[];W.push(g)}D.push(null)}}else{if(b<O.miny){b=O.miny}if(b>O.maxy){b=O.maxy}if(!g.length){g.push([U,R+K])}Q=[U,R+Math.round(K-(K*((b-this.miny)/F)))];g.push(Q);D.push(Q)}}E=[];a=[];M=W.length;for(l=0;l<M;l++){g=W[l];if(g.length){if(O.fillColor){g.push([g[g.length-1][0],(R+K)]);a.push(g.slice(0));g.pop()}if(g.length>2){g[0]=[g[0][0],g[1][1]]}E.push(g)}}M=a.length;for(l=0;l<M;l++){I.drawShape(a[l],O.fillColor,O.fillColor).append()}if(T!=null&&A){O.drawNormalRange(P,R,K,k,F)}M=E.length;for(l=0;l<M;l++){I.drawShape(E[l],O.getLineColor(),null,O.getLineWidth()).append()}if(j&&C){if(C.get==null){C=new Ext.sparkline.RangeMap(C)}for(l=0;l<h;l++){S=C.get(f[l]);if(S){I.drawCircle(P+Math.round((d[l]-O.minx)*(k/X)),R+Math.round(K-(K*((f[l]-O.miny)/F))),j,null,S).append()}}}if(j&&J&&f[Z]!=null){I.drawCircle(P+Math.round((d[d.length-1]-O.minx)*(k/X)),R+Math.round(K-(K*((f[Z]-O.miny)/F))),j,null,J).append()}if(O.maxy!==O.minyorg){if(j&&B){c=d[Ext.Array.indexOf(f,O.minyorg)];I.drawCircle(P+Math.round((c-O.minx)*(k/X)),R+Math.round(K-(K*((O.minyorg-O.miny)/F))),j,null,B).append()}if(j&&V){c=d[Ext.Array.indexOf(f,O.maxyorg)];I.drawCircle(P+Math.round((c-O.minx)*(k/X)),R+Math.round(K-(K*((O.maxyorg-O.miny)/F))),j,null,V).append()}}O.canvasTop=R;if(O.currentPageXY&&O.el.getRegion().contains(O.currentPageXY)){O.updateDisplay()}I.render()}})