Ext.define("Ext.state.Stateful",{mixinId:"state",requires:["Ext.state.Manager","Ext.util.TaskRunner"],stateful:false,saveDelay:100,constructor:function(){var A=this;if(!A.stateEvents){A.stateEvents=[]}if(A.stateful!==false){A.addStateEvents(A.stateEvents);A.initState()}},addStateEvents:function(D){var F=this,C,E,B,A;if(F.stateful&&F.getStateId()){A=(typeof D==="string")?arguments:D;B=F.stateEventsByName||(F.stateEventsByName={});for(C=A.length;C--;){E=A[C];if(E&&!B[E]){B[E]=1;F.on(E,F.onStateChange,F)}}}},onStateChange:function(){var C=this,A=C.saveDelay,D,B;if(!C.stateful){return }if(A){if(!C.stateTask){D=Ext.state.Stateful;B=D.runner||(D.runner=new Ext.util.TaskRunner());C.stateTask=B.newTask({run:C.saveState,scope:C,interval:A,repeat:1,fireIdleEvent:false})}C.stateTask.start()}else{C.saveState()}},saveState:function(){var H=this,B=H.stateful&&H.getStateId(),G=H.hasListeners,C,E,D,F,A,I;if(B){A=H.getState()||{};C=H.getPlugins()||[];for(D=0,F=C.length;D<F;D++){E=C[D];if(E&&E.getState){I=E.getState(A);if(I&&!A[E.ptype]){A[E.ptype]=I}}}if(!G.beforestatesave||H.fireEvent("beforestatesave",H,A)!==false){Ext.state.Manager.set(B,A);if(G.statesave){H.fireEvent("statesave",H,A)}}}},getState:function(){return null},applyState:function(A){if(A){Ext.apply(this,A)}},getStateId:function(){var A=this;return A.stateId||(A.autoGenId?null:A.id)},initState:function(){var I=this,B=I.stateful&&I.getStateId(),H=I.hasListeners,A,J,E,G,D,F,C;if(B){J=Ext.state.Manager.get(B);if(J){A=Ext.apply({},J);if(!H.beforestaterestore||I.fireEvent("beforestaterestore",I,J)!==false){D=I.getPlugins()||[];for(E=0,G=D.length;E<G;E++){F=D[E];if(F){C=F.ptype;if(F.applyState){F.applyState(A[C],J)}delete A[C]}}I.applyState(A);if(H.staterestore){I.fireEvent("staterestore",I,J)}}}}},savePropToState:function(F,E,D){var B=this,C=B[F],A=B.initialConfig;if(B.hasOwnProperty(F)){if(!A||A[F]!==C){if(E){E[D||F]=C}return true}}return false},savePropsToState:function(E,C){var B=this,A,D;if(typeof E==="string"){B.savePropToState(E,C)}else{for(A=0,D=E.length;A<D;++A){B.savePropToState(E[A],C)}}return C},destroy:function(){var B=this,A=B.stateTask;if(A){A.destroy();B.stateTask=null}B.clearListeners()}})