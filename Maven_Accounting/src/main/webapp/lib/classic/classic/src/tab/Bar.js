Ext.define("Ext.tab.Bar",{extend:"Ext.panel.Bar",xtype:"tabbar",baseCls:Ext.baseCSSPrefix+"tab-bar",requires:["Ext.tab.Tab","Ext.util.Point","Ext.layout.component.Body"],mixins:["Ext.util.FocusableContainer"],componentLayout:"body",isTabBar:true,config:{tabRotation:"default",tabStretchMax:true,activateOnFocus:true},defaultType:"tab",plain:false,ensureActiveVisibleOnChange:true,ariaRole:"tablist",childEls:["body","strip"],_stripCls:Ext.baseCSSPrefix+"tab-bar-strip",_baseBodyCls:Ext.baseCSSPrefix+"tab-bar-body",renderTpl:'<div id="{id}-body" data-ref="body" role="presentation" class="{baseBodyCls} {baseBodyCls}-{ui} {bodyCls} {bodyTargetCls}{childElCls}"<tpl if="bodyStyle"> style="{bodyStyle}"</tpl>>{%this.renderContainer(out,values)%}</div><div id="{id}-strip" data-ref="strip" role="presentation" class="{stripCls} {stripCls}-{ui}{childElCls}"></div>',_reverseDockNames:{left:"right",right:"left"},_layoutAlign:{top:"end",right:"begin",bottom:"begin",left:"end"},initComponent:function(){var D=this,A=D.initialConfig.layout,C=A&&A.align,B=A&&A.overflowHandler;if(D.plain){D.addCls(D.baseCls+"-plain")}D.callParent();D.setLayout({align:C||(D.getTabStretchMax()?"stretchmax":D._layoutAlign[D.dock]),overflowHandler:B||"scroller"});D.on({click:D.onClick,element:"el",scope:D})},ensureTabVisible:function(B){var C=this,D=C.tabPanel,A=C.layout.overflowHandler;if(C.rendered&&A&&C.tooNarrow&&A.scrollToItem){if(B||B===0){if(!B.isTab){if(Ext.isNumber(B)){B=this.items.getAt(B)}else{if(B.isComponent&&D&&D.items.contains(B)){B=B.tab}}}}if(!B){B=C.activeTab}if(B){A.scrollToItem(B)}}},initRenderData:function(){var A=this;return Ext.apply(A.callParent(),{bodyCls:A.bodyCls,baseBodyCls:A._baseBodyCls,bodyTargetCls:A.bodyTargetCls,stripCls:A._stripCls,dock:A.dock})},setDock:function(G){var F=this,A=F.items,C=F.ownerCt,E,B,D;A=A&&A.items;if(A){for(B=0,D=A.length;B<D;B++){E=A[B];if(E.isTab){E.setTabPosition(G)}}}if(F.rendered){F.resetItemMargins();if(C&&C.isHeader){C.resetItemMargins()}F.needsScroll=true}F.callParent([G])},updateTabRotation:function(F){var E=this,A=E.items,B,D,C;A=A&&A.items;if(A){for(B=0,D=A.length;B<D;B++){C=A[B];if(C.isTab){C.setRotation(F)}}}if(E.rendered){E.resetItemMargins();E.needsScroll=true;E.updateLayout()}},onRender:function(){var A=this;A.callParent();if(Ext.isIE8&&A.vertical){A.el.on({mousemove:A.onMouseMove,scope:A})}},afterLayout:function(){this.adjustTabPositions();this.callParent(arguments)},onAdd:function(B,C){var A=this.onTabContentChange;if(this.ensureActiveVisibleOnChange){B.barListeners=B.on({scope:this,destroyable:true,glyphchange:A,iconchange:A,textchange:A})}this.callParent([B,C])},onAdded:function(B,C,A){if(B.isHeader){this.addCls(B.baseCls+"-"+B.ui+"-tab-bar")}this.callParent([B,C,A])},onRemove:function(A,C){var B=this;if(B.ensureActiveVisibleOnChange){if(!C){A.barListeners.destroy()}A.barListeners=null}if(A===B.previousTab){B.previousTab=null}B.callParent([A,C])},onRemoved:function(B){var A=this.ownerCt;if(A.isHeader){this.removeCls(A.baseCls+"-"+A.ui+"-tab-bar")}this.callParent([B])},onTabContentChange:function(A){if(A===this.activeTab){this.ensureTabVisible(A)}},afterComponentLayout:function(C){var D=this,B=D.needsScroll,A=D.layout.overflowHandler;D.callParent(arguments);if(A&&B&&D.tooNarrow&&A.scrollToItem){A.scrollToItem(D.activeTab)}delete D.needsScroll},onMouseMove:function(E){var D=this,B=D._overTab,A,C;if(E.getTarget("."+Ext.baseCSSPrefix+"box-scroller")){return }A=D.getTabInfoFromPoint(E.getXY());C=A.tab;if(C!==B){if(B&&B.rendered){B.onMouseLeave(E);D._overTab=null}if(C){C.onMouseEnter(E);D._overTab=C;if(!C.disabled){D.el.setStyle("cursor","pointer")}}else{D.el.setStyle("cursor","default")}}},onMouseLeave:function(B){var A=this._overTab;if(A&&A.rendered){A.onMouseLeave(B)}},getTabInfoFromPoint:function(F){var Y=this,U=Y.items.items,E=U.length,M=Y.layout.innerCt,S=M.getXY(),R=new Ext.util.Point(F[0],F[1]),T=0,V,B,A,N,W,H,G,D,P,J,I,L,K,Q,O,X,C;for(;T<E;T++){C=U[T];V=C.lastBox;if(!V||!C.isTab){continue}J=S[0]+V.x;I=S[1]-M.dom.scrollTop+V.y;L=V.width;K=V.height;B=new Ext.util.Region(I,J+L,I+K,J);if(B.contains(R)){A=C.closeEl;if(A){if(Y._isTabReversed===undefined){Y._isTabReversed=O=(C.btnWrap.dom.currentStyle.filter.indexOf("rotation=2")!==-1)}X=O?this._reverseDockNames[Y.dock]:Y.dock;D=A.getWidth();P=A.getHeight();W=Y.getCloseXY(A,J,I,L,K,D,P,X);H=W[0];G=W[1];Q=new Ext.util.Region(G,H+D,G+P,H);N=Q.contains(R)}break}}return{tab:C,close:N}},getCloseXY:function(C,J,H,F,K,I,D,G){var E=C.getXY(),B,A;if(G==="right"){B=J+F-((E[1]-H)+D);A=H+(E[0]-J)}else{B=J+(E[1]-H);A=H+J+K-E[0]-I}return[B,A]},closeTab:function(C){var D=this,B=C.card,E=D.tabPanel,A;if(B&&B.fireEvent("beforeclose",B)===false){return false}A=D.findNextActivatable(C);Ext.suspendLayouts();if(E&&B){delete C.ownerCt;B.fireEvent("close",B);E.remove(B);if(!E.getComponent(B)){C.fireClose();D.remove(C)}else{C.ownerCt=D;Ext.resumeLayouts(true);return false}}if(A){if(E){E.setActiveTab(A.card)}else{D.setActiveTab(A)}A.focus()}Ext.resumeLayouts(true)},findNextActivatable:function(B){var C=this,D=C.previousTab,A;if(B.active&&C.items.getCount()>1){if(D&&D!==B&&!D.disabled){A=D}else{A=B.next("tab[disabled=false]")||B.prev("tab[disabled=false]")}}return A||C.activeTab},setActiveTab:function(B,A){var C=this;if(!B.disabled&&B!==C.activeTab){if(C.activeTab){if(C.activeTab.destroyed){C.previousTab=null}else{C.previousTab=C.activeTab;C.activeTab.deactivate();C.deactivateFocusable(C.activeTab)}}B.activate();C.activateFocusable(B);C.activeTab=B;C.needsScroll=true;if(!A){C.fireEvent("change",C,B,B.card);C.updateLayout()}}},privates:{adjustTabPositions:function(){var G=this,A=G.items.items,D=A.length,F,B,E,C,H;if(!Ext.isIE8){H=G._getTabAdjustProp();while(D--){F=A[D];E=F.el;B=F.lastBox;C=F.isTab?F.getActualRotation():0;if(C===1&&F.isVisible()){E.setStyle(H,(B.x+B.width)+"px")}else{if(C===2&&F.isVisible()){E.setStyle(H,(B.x-B.height)+"px")}}}}},applyTargetCls:function(A){this.bodyTargetCls=A},_getTabAdjustProp:function(){return"left"},getTargetEl:function(){return this.body||this.frameBody||this.el},onClick:function(F,E){var D=this,G,C,B,A;if(F.getTarget("."+Ext.baseCSSPrefix+"box-scroller")){return }if(Ext.isIE8&&D.vertical){A=D.getTabInfoFromPoint(F.getXY());C=A.tab;B=A.close}else{G=F.getTarget("."+Ext.tab.Tab.prototype.baseCls);C=G&&Ext.getCmp(G.id);B=C&&C.closeEl&&(E===C.closeEl.dom)}if(B){F.preventDefault()}if(C&&C.isDisabled&&!C.isDisabled()){C.beforeClick(B);if(C.closable&&B){C.onCloseClick()}else{D.doActivateTab(C)}}},doActivateTab:function(A){var B=this.tabPanel;if(B){if(!A.disabled){B.setActiveTab(A.card)}}else{this.setActiveTab(A)}},onFocusableContainerFocus:function(C){var B=this,A=B.mixins.focusablecontainer,D;D=A.onFocusableContainerFocus.call(B,C);if(D&&D.isTab){B.doActivateTab(D)}},onFocusableContainerFocusEnter:function(C){var B=this,A=B.mixins.focusablecontainer,D;D=A.onFocusableContainerFocusEnter.call(B,C);if(D&&D.isTab){B.doActivateTab(D)}},focusChild:function(E,B){var C=this,A=C.mixins.focusablecontainer,D;D=A.focusChild.call(C,E,B);if(C.activateOnFocus&&D&&D.isTab){C.doActivateTab(D)}}}})