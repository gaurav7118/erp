Ext.define("Ext.toolbar.Breadcrumb",{extend:"Ext.Container",xtype:"breadcrumb",requires:["Ext.data.TreeStore","Ext.button.Split"],mixins:["Ext.util.FocusableContainer"],isBreadcrumb:true,baseCls:Ext.baseCSSPrefix+"breadcrumb",layout:"hbox",config:{buttonUI:"plain-toolbar",displayField:"text",overflowHandler:null,showIcons:null,showMenuIcons:null,store:null,useSplitButtons:true},renderConfig:{selection:"root"},publishes:["selection"],twoWayBindable:["selection"],_breadcrumbCls:Ext.baseCSSPrefix+"breadcrumb",_btnCls:Ext.baseCSSPrefix+"breadcrumb-btn",_folderIconCls:Ext.baseCSSPrefix+"breadcrumb-icon-folder",_leafIconCls:Ext.baseCSSPrefix+"breadcrumb-icon-leaf",initComponent:function(){var C=this,B=C.layout,A=C.getOverflowHandler();if(typeof B==="string"){B={type:B}}if(A){B.overflowHandler=A}C.layout=B;C.defaultButtonUI=C.getButtonUI();C._buttons=[];C.addCls([C._breadcrumbCls,C._breadcrumbCls+"-"+C.ui]);C.callParent()},onDestroy:function(){var A=this;A._buttons=Ext.destroy(A._buttons);A.setStore(null);A.callParent()},onRemove:function(A,B){this.callParent([A,B]);delete A._breadcrumbNodeId},afterComponentLayout:function(){var B=this,A=B.layout.overflowHandler;B.callParent(arguments);if(A&&B.tooNarrow&&A.scrollToItem){A.scrollToItem(B.getSelection().get("depth"))}},applySelection:function(B){var A=this.getStore();if(A){B=(B==="root")?this.getStore().getRoot():B}else{B=null}return B},updateSelection:function(K,J){var Q=this,N=Q._buttons,G=[],P=Q.items.getCount(),I=Q._needsSync,L=Q.getDisplayField(),D,E,B,O,R,C,F,A,H,S,M;Ext.suspendLayouts();if(K){C=K;S=K.get("depth");R=S+1;M=S;while(C){H=C.getId();A=N[M];if(!I&&A&&A._breadcrumbNodeId===H){break}F=C.get(L);if(A){A.setText(F)}else{A=N[M]=Ext.create({xtype:Q.getUseSplitButtons()?"splitbutton":"button",ui:Q.getButtonUI(),cls:Q._btnCls+" "+Q._btnCls+"-"+Q.ui,text:F,showEmptyMenu:true,menu:{listeners:{click:"_onMenuClick",beforeshow:"_onMenuBeforeShow",scope:this}},handler:"_onButtonClick",scope:Q})}D=this.getShowIcons();if(D!==false){E=C.get("glyph");O=C.get("icon");B=C.get("iconCls");if(E){A.setGlyph(E);A.setIcon(null);A.setIconCls(B)}else{if(O){A.setGlyph(null);A.setIconCls(null);A.setIcon(O)}else{if(B){A.setGlyph(null);A.setIcon(null);A.setIconCls(B)}else{if(D){A.setGlyph(null);A.setIcon(null);A.setIconCls((C.isLeaf()?Q._leafIconCls:Q._folderIconCls)+"-"+Q.ui)}else{A.setGlyph(null);A.setIcon(null);A.setIconCls(null)}}}}}A.setArrowVisible(C.hasChildNodes());A._breadcrumbNodeId=C.getId();C=C.parentNode;M--}if(R>P){G=N.slice(P,S+1);Q.add(G)}else{for(M=P-1;M>=R;M--){Q.remove(Q.items.items[M],false)}}}else{Q.removeAll(false)}Ext.resumeLayouts(true);Q.fireEvent("selectionchange",Q,K,J);if(Q._shouldFireChangeEvent){Q.fireEvent("change",Q,K,J)}Q._shouldFireChangeEvent=true;Q._needsSync=false},applyUseSplitButtons:function(B,A){if(this.rendered&&B!==A){Ext.raise("Cannot reconfigure 'useSplitButtons' config of Ext.toolbar.Breadcrumb after initial render")}return B},applyStore:function(A){if(A){A=Ext.data.StoreManager.lookup(A)}return A},updateStore:function(A,B){this._needsSync=true;if(A&&!this.isConfiguring){this.setSelection(A.getRoot())}},updateOverflowHandler:function(A){if(A==="menu"){Ext.raise("Using Menu overflow with breadcrumb is not currently supported.")}},privates:{_onButtonClick:function(A,B){if(this.getUseSplitButtons()){this.setSelection(this.getStore().getNodeById(A._breadcrumbNodeId))}},_onMenuClick:function(C,A,B){if(A){this.setSelection(this.getStore().getNodeById(A._breadcrumbNodeId))}},_onMenuBeforeShow:function(C){var I=this,D=I.getStore().getNodeById(C.ownerCmp._breadcrumbNodeId),F=I.getDisplayField(),A=I.getShowMenuIcons(),M,B,J,H,E,K,L,G,N;if(D.hasChildNodes()){M=D.childNodes;H=[];for(E=0,G=M.length;E<G;E++){B=M[E];N={text:B.get(F),_breadcrumbNodeId:B.getId()};if(A!==false){J=B.get("glyph");K=B.get("icon");L=B.get("iconCls");if(J){N.glyph=J;N.iconCls=L}else{if(K){N.icon=K}else{if(L){N.iconCls=L}else{if(A){N.iconCls=(B.isLeaf()?I._leafIconCls:I._folderIconCls)+"-"+I.ui}}}}}H.push(N)}C.removeAll();C.add(H)}else{return false}}}})