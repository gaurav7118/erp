Ext.define("Ext.tree.Panel",{extend:"Ext.panel.Table",alias:"widget.treepanel",alternateClassName:["Ext.tree.TreePanel","Ext.TreePanel"],requires:["Ext.tree.View","Ext.selection.TreeModel","Ext.tree.Column","Ext.data.TreeStore","Ext.tree.NavigationModel"],viewType:"treeview",treeCls:Ext.baseCSSPrefix+"tree-panel",rowLines:false,lines:true,useArrows:false,singleExpand:false,ddConfig:{enableDrag:true,enableDrop:true},rootVisible:true,displayField:"text",root:null,normalCfgCopy:["displayField","root","singleExpand","useArrows","lines","rootVisible","scroll"],lockedCfgCopy:["displayField","root","singleExpand","useArrows","lines","rootVisible"],isTree:true,arrowCls:Ext.baseCSSPrefix+"tree-arrows",linesCls:Ext.baseCSSPrefix+"tree-lines",noLinesCls:Ext.baseCSSPrefix+"tree-no-lines",autoWidthCls:Ext.baseCSSPrefix+"autowidth-table",constructor:function(A){A=A||{};if(A.animate===undefined){A.animate=Ext.isBoolean(this.animate)?this.animate:Ext.enableFx}this.enableAnimations=A.animate;delete A.animate;this.callParent([A])},initComponent:function(){var D=this,B=[D.treeCls],C,A;if(D.useArrows){B.push(D.arrowCls);D.lines=false}if(D.lines){B.push(D.linesCls)}else{if(!D.useArrows){B.push(D.noLinesCls)}}C=D.applyStore(D.store);if(!C.getRoot()){C.setRoot({})}C.setRootVisible(D.rootVisible);D.viewConfig=Ext.apply({rootVisible:D.rootVisible,animate:D.enableAnimations,singleExpand:D.singleExpand,node:C.getRoot(),hideHeaders:D.hideHeaders,navigationModel:"tree"},D.viewConfig);if(!D.columns){if(D.initialConfig.hideHeaders===undefined){D.hideHeaders=true}D.addCls(D.autoWidthCls);D.columns=[{xtype:"treecolumn",text:"Name",flex:1,dataIndex:D.displayField}]}if(D.cls){B.push(D.cls)}D.cls=B.join(" ");D.callParent();A=D.getView();D.relayEvents(A,["beforecheckchange","checkchange","afteritemexpand","afteritemcollapse"])},applyStore:function(A){var B=this;if(Ext.isString(A)){A=B.store=Ext.StoreMgr.lookup(A)}else{if(!A||!A.isStore){A=Ext.apply({type:"tree",proxy:"memory"},A);if(B.root){A.root=B.root}if(B.fields){A.fields=B.fields}else{if(B.model){A.model=B.model}}if(B.folderSort){A.folderSort=B.folderSort}A=B.store=Ext.StoreMgr.lookup(A)}else{if(B.root){A=B.store=Ext.data.StoreManager.lookup(A);A.setRoot(B.root);if(B.folderSort!==undefined){A.folderSort=B.folderSort;A.sort()}}}}return A},setStore:function(A){var B=this;A=B.applyStore(A);if(!A.getRoot()){A.setRoot({})}A.setRootVisible(B.rootVisible);if(B.view){B.view.setRootNode(A.getRootNode())}B.bindStore(A)},bindStore:function(B,C){var D=this,A=B.getRoot(),E=D.bufferedRenderer;D.callParent(arguments);if(E){if(E.store){E.bindStore(B)}}B.singleExpand=D.singleExpand;D.storeListeners=D.mon(B,{destroyable:true,rootchange:D.onRootChange,scope:D});D.storeRelayers=D.relayEvents(B,["beforeload","load"]);if(!D.rootVisible&&!B.autoLoad&&!(A.isExpanded()||A.isLoading())){if(A.isLoaded()){A.data.expanded=true;B.onNodeExpand(A,A.childNodes)}else{if(B.autoLoad!==false){A.data.expanded=false;A.expand()}}}B.ownerTree=D;if(!C){D.view.setRootNode(A)}},addRelayers:function(B){var A=this;if(A.rootRelayers){A.rootRelayers.destroy();A.rootRelayers=null}A.rootRelayers=A.mon(B,{destroyable:true,append:A.createRelayer("itemappend"),remove:A.createRelayer("itemremove"),move:A.createRelayer("itemmove",[0,4]),insert:A.createRelayer("iteminsert"),beforeappend:A.createRelayer("beforeitemappend"),beforeremove:A.createRelayer("beforeitemremove"),beforemove:A.createRelayer("beforeitemmove"),beforeinsert:A.createRelayer("beforeiteminsert"),expand:A.createRelayer("itemexpand",[0,1]),collapse:A.createRelayer("itemcollapse",[0,1]),beforeexpand:A.createRelayer("beforeitemexpand",[0,1]),beforecollapse:A.createRelayer("beforeitemcollapse",[0,1]),scope:A})},unbindStore:function(){var B=this,A=B.store;if(A){B.callParent();Ext.destroy(B.storeListeners,B.storeRelayers,B.rootRelayers);delete A.ownerTree;A.singleExpand=null}},setRootNode:function(){return this.store.setRoot.apply(this.store,arguments)},getRootNode:function(){return this.store.getRoot()},onRootChange:function(A){this.view.setRootNode(A)},getChecked:function(){return this.getView().getChecked()},isItemChecked:function(A){return A.get("checked")},expandNode:function(B,A,D,C){return this.getView().expand(B,A,D,C||this)},collapseNode:function(B,A,D,C){return this.getView().collapse(B,A,D,C||this)},expandAll:function(D,B){var C=this,A=C.getRootNode();if(A){Ext.suspendLayouts();A.expand(true,D,B||C);Ext.resumeLayouts(true)}},collapseAll:function(E,C){var D=this,B=D.getRootNode(),A=D.getView();if(B){Ext.suspendLayouts();C=C||D;if(A.rootVisible){B.collapse(true,E,C)}else{B.collapseChildren(true,E,C)}Ext.resumeLayouts(true)}},expandPath:function(N,P){var E=arguments,F=this,G=F.view,H=(P&&P.field)||F.store.model.idProperty,I,O,B=(P&&P.separator)||"/",J,M,D,C,L,A,K;if(P&&typeof P==="object"){H=P.field||F.store.model.idProperty;B=P.separator||"/";J=P.callback;M=P.scope;I=P.select;O=P.focus}else{H=E[1]||F.store.model.idProperty;B=E[2]||"/";J=E[3];M=E[4]}if(Ext.isEmpty(N)){return Ext.callback(J,M||F,[false,null])}L=N.split(B);A=!L[0];if(A){D=F.getRootNode();C=1}else{D=F.store.findNode(H,L[0]);C=0}if(!D||(A&&D.get(H)!==L[1])){return Ext.callback(J,M||F,[false,D])}K=function(U){var S=this,Q,R,T;if(++C===L.length){if(I){G.getSelectionModel().select(S)}if(O){G.getNavigationModel().setPosition(S,0)}return Ext.callback(J,M||F,[true,S,G.getNode(S)])}for(R=0,Q=U?U.length:0;R<Q;R++){S=U[R];T=S.get(H);if(T||T===0){T=T.toString()}if(T===L[C]){return S.expand(false,K)}}S=this;Ext.callback(J,M||F,[false,S,G.getNode(S)])};D.expand(false,K)},ensureVisible:function(L,M){if(L.isEntity||typeof L==="number"){return this.callParent([L,M])}var F=this,G=(M&&M.field)||F.store.model.idProperty,E=(M&&M.separator)||"/",I,K,J,A,H,B,D,C=function(Q,O,N,P){if(!P&&Q&&O){P=O.findChild(G,H)}if(P){F.doEnsureVisible(P,M)}else{Ext.callback(I,K||F,[false,O])}};if(M){I=M.callback;K=M.scope}J=L.split(E);A=!J[0];H=J.pop();if(J.length&&!(A&&J.length===1)){F.expandPath(J.join(E),G,E,C)}else{B=F.store.findNode(G,H);if(B){D=B.parentNode;if(D&&!D.isExpanded()){D.expand()}C(true,null,null,B)}else{Ext.callback(I,K||F,[false,null])}}},selectPath:function(D,C,B,E,A){this.ensureVisible(D,{field:C,separator:B,select:true,callback:E,scope:A})}})