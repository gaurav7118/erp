Ext.define("Ext.tree.View",{extend:"Ext.view.Table",alias:"widget.treeview",config:{selectionModel:{type:"treemodel"}},isTreeView:true,loadingCls:Ext.baseCSSPrefix+"grid-tree-loading",expandedCls:Ext.baseCSSPrefix+"grid-tree-node-expanded",leafCls:Ext.baseCSSPrefix+"grid-tree-node-leaf",expanderSelector:"."+Ext.baseCSSPrefix+"tree-expander",checkboxSelector:"."+Ext.baseCSSPrefix+"tree-checkbox",expanderIconOverCls:Ext.baseCSSPrefix+"tree-expander-over",nodeAnimWrapCls:Ext.baseCSSPrefix+"tree-animator-wrap",ariaRole:"tree",loadMask:false,rootVisible:true,expandDuration:250,collapseDuration:250,toggleOnDblClick:true,stripeRows:false,treeRowTpl:["{%","this.processRowValues(values);","this.nextTpl.applyOut(values, out, parent);","%}",{priority:10,processRowValues:function(C){var B=C.record,A=C.view;C.rowAttr["data-qtip"]=B.get("qtip")||"";C.rowAttr["data-qtitle"]=B.get("qtitle")||"";if(B.isExpanded()){C.rowClasses.push(A.expandedCls)}if(B.isLeaf()){C.rowClasses.push(A.leafCls)}if(B.isLoading()){C.rowClasses.push(A.loadingCls)}}}],initComponent:function(){var A=this;if(A.bufferedRenderer){A.animate=false}else{if(A.initialConfig.animate===undefined){A.animate=Ext.enableFx}}A.store=A.panel.getStore();A.onRootChange(A.store.getRoot());A.animQueue={};A.animWraps={};A.callParent();A.store.setRootVisible(A.rootVisible);A.addRowTpl(Ext.XTemplate.getTpl(A,"treeRowTpl"))},onFillComplete:function(E,D,B){var C=this,A=C.store,F=A.indexOf(B[0]);D.triggerUIUpdate();if(!B.length||F===-1){return }C.onAdd(C.store,B,F);C.refreshPartner()},refreshPartner:function(){var A=this.lockingPartner;if(A){A.refresh()}},afterComponentLayout:function(C,B,D,E){var A=this.getScrollable();this.callParent([C,B,D,E]);if(A&&!this.bufferedRenderer){A.refresh()}},processUIEvent:function(A){if(A.getTarget("."+this.nodeAnimWrapCls,this.el)){return false}return this.callParent([A])},setRootNode:function(A){this.node=A},getChecked:function(){var A=[];this.node.cascadeBy(function(B){if(B.get("checked")){A.push(B)}});return A},isItemChecked:function(A){return A.get("checked")},createAnimWrap:function(A,B){var E=this,D=E.getNode(A),C;C=Ext.fly(D).insertSibling({role:"presentation",tag:"div",cls:E.nodeAnimWrapCls},"after");return{record:A,node:D,el:C,expanding:false,collapsing:false,animateEl:C,targetEl:C}},getAnimWrap:function(D,A){if(!this.animate){return null}var B=this.animWraps,C=B[D.internalId];if(A!==false){while(!C&&D){D=D.parentNode;if(D){C=B[D.internalId]}}}return C},doAdd:function(B,F){var G=this,D=B[0],H=D.parentNode,I=G.all,M,C=G.getAnimWrap(H),K,J,E,L,A;if(!C||!C.expanding){return G.callParent([B,F])}L=G.bufferRender(B,F,true);A=L.children;H=C.record;K=C.targetEl;J=K.dom.childNodes;E=J.length;M=F-G.indexInStore(H)-1;if(!E||M>=E){K.appendChild(L.fragment,true)}else{Ext.fly(J[M]).insertSibling(A,"before",true)}I.insert(F,A);return A},onRemove:function(F,A,B){var D=this,E,C,H=D.hasListeners.remove,G;if(D.viewReady){E=D.store.getCount()===0;if(D.bufferedRenderer){return D.callParent([F,A,B])}if(H){G=this.all.slice(B,B+A.length)}if(E){D.refresh()}else{for(C=A.length-1,B+=C;C>=0;--C,--B){D.doRemove(A[C],B)}D.refreshSizePending=true}if(H){D.fireEvent("itemremove",A,B,G,D)}}},doRemove:function(A,C){var G=this,D=G.all,B=G.getAnimWrap(A),F=D.item(C),E=F?F.dom:null;if(!E||!B||!B.collapsing){return G.callParent([A,C])}B.targetEl.dom.insertBefore(E,B.targetEl.dom.firstChild);D.removeElement(C)},onBeforeExpand:function(D,B,C){var E=this,A;if(E.rendered&&E.all.getCount()&&E.animate){if(E.getNode(D)){A=E.getAnimWrap(D,false);if(!A){A=E.animWraps[D.internalId]=E.createAnimWrap(D);A.animateEl.setHeight(0)}else{if(A.collapsing){A.targetEl.select(E.itemSelector).destroy()}}A.expanding=true;A.collapsing=false}}},onExpand:function(H){var G=this,E=G.animQueue,A=H.getId(),C=G.getNode(H),F=C?G.indexOf(C):-1,D,B,I;if(G.singleExpand){G.ensureSingleExpand(H)}if(F===-1){return }D=G.getAnimWrap(H,false);if(!D){H.isExpandingOrCollapsing=false;G.fireEvent("afteritemexpand",H,F,C);return }B=D.animateEl;I=D.targetEl;B.stopAnimation();E[A]=true;Ext.on("idle",function(){B.dom.style.height="0px"},null,{single:true});B.animate({from:{height:0},to:{height:I.dom.scrollHeight},duration:G.expandDuration,listeners:{afteranimate:function(){var J=I.dom.childNodes,K=Ext.Element.getActiveElement();if(J.length){if(!I.contains(K)){K=null}D.el.insertSibling(J,"before",true);if(K){Ext.fly(K).focus()}}D.el.destroy();G.animWraps[D.record.internalId]=E[A]=null}},callback:function(){H.isExpandingOrCollapsing=false;if(!G.destroyed){G.refreshSize(true)}G.fireEvent("afteritemexpand",H,F,C)}})},onBeforeCollapse:function(E,B,C,G,D){var F=this,A;if(F.rendered&&F.all.getCount()){if(F.animate){if(E.isVisible()){A=F.getAnimWrap(E);if(!A){A=F.animWraps[E.internalId]=F.createAnimWrap(E,C)}else{if(A.expanding){A.targetEl.select(this.itemSelector).destroy()}}A.expanding=false;A.collapsing=true;A.callback=G;A.scope=D}}else{F.onCollapseCallback=G;F.onCollapseScope=D}}},onCollapse:function(D){var F=this,A=F.animQueue,H=D.getId(),E=F.getNode(D),C=E?F.indexOf(E):-1,B=F.getAnimWrap(D),G;if(!F.all.getCount()||!D.isVisible()){return }if(!B){D.isExpandingOrCollapsing=false;F.fireEvent("afteritemcollapse",D,C,E);Ext.callback(F.onCollapseCallback,F.onCollapseScope);F.onCollapseCallback=F.onCollapseScope=null;return }G=B.animateEl;A[H]=true;G.stopAnimation();G.animate({to:{height:0},duration:F.collapseDuration,listeners:{afteranimate:function(){B.el.destroy();F.animWraps[B.record.internalId]=A[H]=null}},callback:function(){D.isExpandingOrCollapsing=false;if(!F.destroyed){F.refreshSize(true)}F.fireEvent("afteritemcollapse",D,C,E);Ext.callback(B.callback,B.scope);B.callback=B.scope=null}})},isAnimating:function(A){return !!this.animQueue[A.getId()]},expand:function(D,C,G,E){var F=this,B=!!F.animate,A;if(!B||!D.isExpandingOrCollapsing){if(!D.isLeaf()){D.isExpandingOrCollapsing=B}Ext.suspendLayouts();A=D.expand(C,G,E);Ext.resumeLayouts(true);return A}},collapse:function(C,B,F,D){var E=this,A=!!E.animate;if(!A||!C.isExpandingOrCollapsing){if(!C.isLeaf()){C.isExpandingOrCollapsing=A}return C.collapse(B,F,D)}},toggle:function(B,A,D,C){if(B.isExpanded()){this.collapse(B,A,D,C)}else{this.expand(B,A,D,C)}},onItemDblClick:function(A,E,C,F){var D=this,B=D.editingPlugin;D.callParent([A,E,C,F]);if(D.toggleOnDblClick&&A.isExpandable()&&!(B&&B.clicksToEdit===2)){D.toggle(A)}},onCellClick:function(G,E,B,I,F,C){var D=this,A=C.position.column,H;if(A.isTreeColumn){if(C.getTarget(D.checkboxSelector,G)&&Ext.isBoolean(H=B.get("checked"))&&D.fireEvent("beforecheckchange",B,H,C)!==false){D.onCheckChange(C);if(A.stopSelection){C.stopSelection=true}}else{if(C.getTarget(D.expanderSelector,G)&&B.isExpandable()){D.getNavigationModel().setPosition(C.position);D.toggle(B,C.ctrlKey);C.nodeToggled=true}}return D.callParent([G,E,B,I,F,C])}},onCheckChange:function(C){var A=C.record,B=!A.get("checked");A.set("checked",B);this.fireEvent("checkchange",A,B,C)},onItemMouseOver:function(A,C,B,D){if(D.getTarget(this.expanderSelector,C)){D.getTarget(this.cellSelector,null,true).addCls(this.expanderIconOverCls)}},onItemMouseOut:function(A,C,B,D){if(D.getTarget(this.expanderSelector,C)){D.getTarget(this.cellSelector,null,true).removeCls(this.expanderIconOverCls)}},getStoreListeners:function(){return Ext.apply(this.callParent(),{rootchange:this.onRootChange,fillcomplete:this.onFillComplete})},onBindStore:function(A,C,D,E){var B=E&&E.getRootNode(),F=A&&A.getRootNode();this.callParent([A,C,D,E]);if(F!==B){this.onRootChange(F,B)}},onRootChange:function(D,A){var C=this,B=C.grid;if(A){C.rootListeners.destroy();C.rootListeners=null}if(D){C.rootListeners=D.on({beforeexpand:C.onBeforeExpand,expand:C.onExpand,beforecollapse:C.onBeforeCollapse,collapse:C.onCollapse,destroyable:true,scope:C});B.addRelayers(D)}},ensureSingleExpand:function(B){var A=B.parentNode;if(A){A.eachChild(function(C){if(C!==B&&C.isExpanded()){C.collapse()}})}}})