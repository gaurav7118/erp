Ext.define("Ext.util.Floating",{mixinId:"floating",uses:["Ext.ZIndexManager"],focusOnToFront:true,shadow:"sides",animateShadow:false,constrain:false,config:{activeCounter:0,alwaysOnTop:false},preventDefaultAlign:false,_visModeMap:{visibility:1,display:2,offsets:3},constructor:function(){var D=this,C=D.el,E=D.shadow,A,B;if(E){B={mode:(E===true)?"sides":E};A=D.shadowOffset;if(A){B.offset=A}B.animate=D.animateShadow;B.fixed=D.fixed;C.enableShadow(B,false)}if(D.shim||Ext.useShims){C.enableShim({fixed:D.fixed},false)}C.setVisibilityMode(D._visModeMap[D.hideMode]);D.el.on({mousedown:D.onMouseDown,scope:D,capture:true});D.registerWithOwnerCt();D.initHierarchyEvents()},alignTo:function(C,A,F,D){var E=this,B;Ext.un("scroll",E.onAlignToScroll,E);if(C.isComponent){B=C.el}else{if(C.nodeType){B=Ext.fly(C)}else{B=C}}if(!B.contains(E.el)){Ext.on("scroll",E.onAlignToScroll,E)}E._lastAlignTarget=C;E._lastAlignToPos=A;E.mixins.positionable.alignTo.call(E,B,A,F,D)},initFloatConstrain:function(){var A=this,B=A.floatParent;if((A.constrain||A.constrainHeader)&&!A.constrainTo){A.constrainTo=B?B.getTargetEl():A.container}},initHierarchyEvents:function(){var B=this,A=this.syncHidden;if(!B.hasHierarchyEventListeners){B.mon(Ext.GlobalEvents,{hide:A,collapse:A,show:A,expand:A,added:A,scope:B});B.hasHierarchyEventListeners=true}},registerWithOwnerCt:function(){var C=this,B=C.ownerCt,A=C.zIndexParent;if(A){A.unregisterFloatingItem(C)}A=C.zIndexParent=C.up("[floating]");C.floatParent=B||A;C.initFloatConstrain();delete C.ownerCt;if(A){A.registerFloatingItem(C)}else{Ext.WindowManager.register(C)}},onMouseDown:function(E){var B=this,A=B.focusTask,C=E.pointerType==="touch",D,F,G;if(B.floating&&(!A||!A.id)){D=E.target;F=B.el.dom;while(!C&&D&&D!==F){if(Ext.fly(D).isFocusable()){C=true}D=D.parentNode}G=Ext.WindowManager.getActive()===B&&(D===F||C);if(!G){B.toFront(C)}}},onBeforeFloatLayout:function(){this.el.preventSync=true},onAfterFloatLayout:function(){var A=this.el;if(A.shadow||A.shim){A.setUnderlaysVisible(true);A.syncUnderlays()}},syncHidden:function(){var C=this,D=C.hidden||!C.rendered,A=C.hierarchicallyHidden=C.isHierarchicallyHidden(),B=C.pendingShow;if(D!==A){if(A){C.hide();C.pendingShow=true}else{if(B){delete C.pendingShow;if(B.length){C.show.apply(C,B)}else{C.show()}}}}},setZIndex:function(A){var B=this;B.el.setZIndex(A);A+=10;if(B.floatingDescendants){A=Math.floor(B.floatingDescendants.setBase(A)/100)*100+10000}return A},doConstrain:function(A){var B=this,C=B.calculateConstrainedPosition(A,null,true);if(C){B.setPosition(C)}},updateActiveCounter:function(A){var B=this.zIndexParent;if(B&&this.bringParentToFront!==false){B.setActiveCounter(++Ext.ZIndexManager.activeCounter)}B=this.zIndexManager;if(B){B.onComponentUpdate(this)}},updateAlwaysOnTop:function(A){var B=this.zIndexManager;if(B){B.onComponentUpdate(this)}},toFront:function(B){var A=this;if(A.zIndexManager.bringToFront(A,B||!A.focusOnToFront)){if(A.hasListeners.tofront){A.fireEvent("tofront",A,A.el.getZIndex())}}return A},setActive:function(D,B){var C=this,A;if(D){if(C.el.shadow&&!C.maximized){C.el.enableShadow(null,true)}if(B){A=Ext.ComponentManager.getActiveComponent();if(!A||!A.up(C)){C.focus()}}C.fireEvent("activate",C)}else{C.fireEvent("deactivate",C)}},toBack:function(){this.zIndexManager.sendToBack(this);return this},center:function(){var A=this,B;if(A.isVisible()){B=A.getAlignToXY(A.container,"c-c");A.setPagePosition(B)}else{A.needsCenter=true}return A},onFloatShow:function(){if(this.needsCenter){this.center()}delete this.needsCenter;if(this.toFrontOnShow){this.toFront()}},fitContainer:function(C){var F=this,E=F.floatParent,B=E?E.getTargetEl():F.container,A=B.getViewSize(),D=E||(B.dom!==document.body)?[0,0]:B.getXY();A.x=D[0];A.y=D[1];F.setBox(A,C)},privates:{onFloatDestroy:function(){this.clearAlignEl()},clearAlignEl:function(){var A=this;if(A._lastAlignTarget){Ext.un("scroll",A.onAlignToScroll,A);A._lastAlignPos=A._lastAlignTarget=null}},onAlignToScroll:function(A){var E=this,B=E._lastAlignTarget,C=B.isFloating,D,F;if(B){if(B.isComponent){D=B.destroyed;B=B.el}else{if(B.nodeType){B=Ext.fly(B)}F=B.dom;D=!F||Ext.isGarbage(F)}if(D){E.clearAlignEl()}else{if((A.getElement().contains(B)||C)&&!A.getElement().contains(E.el)){E.alignTo(B,E._lastAlignToPos)}}}}}})