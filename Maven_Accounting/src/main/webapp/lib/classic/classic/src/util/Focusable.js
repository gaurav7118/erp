Ext.define("Ext.util.Focusable",{mixinId:"focusable",hasFocus:false,focusable:false,focusCls:"focus",initFocusable:Ext.emptyFn,initFocusableEvents:function(){this.initFocusableElement()},getFocusClsEl:function(){return this.getFocusEl()},getFocusEl:function(){return this.element||this.el},destroyFocusable:function(){var A=this;Ext.destroy(A.focusListeners);A.focusListeners=A.focusEnterEvent=A.focusTask=null;A.focusEl=A.ariaEl=null},enableFocusable:Ext.emptyFn,disableFocusable:function(){var D=this,B,C=D.focusCls,A;if(D.hasFocus){B=D.findFocusTarget();if(B){B.focus()}}A=D.getFocusClsEl();if(C&&A){A.removeCls(D.removeClsWithUI(C,true))}},isFocusable:function(A){var C=this,B;if(!C.focusable&&(!C.isContainer||!A)){return false}B=C.getFocusEl();if(B&&C.canFocus()){return B.isFocusable(A)}return false},canFocus:function(B,D){var C=this,A;A=(C.isContainer||C.focusable)&&C.rendered&&!C.destroying&&!C.destroyed&&!C.disabled&&(B||C.isVisible(true));return A||(D&&!!C.findFocusTarget())},focus:function(F,C,H,D){var E=this,A,G,B;if((!E.focusable&&!E.isContainer)||E.destroyed||E.destroying){return }if(C){E.getFocusTask().delay(Ext.isNumber(C)?C:10,E.focus,E,[F,false,H,D]);return E}E.cancelFocus();if(E.canFocus()){if(A=E.getFocusEl()){if(A.isComponent){return A.focus(F,C,H,D)}G=A.dom;if(G){if(E.floating){B=E.container.dom.scrollTop}A.focus();if(F){if(Ext.isArray(F)){if(E.selectText){E.selectText.apply(E,F)}}else{if(G.select){G.select()}else{if(E.selectText){E.selectText()}}}}Ext.callback(H,D)}if(E.floating){if(B!==undefined){E.container.dom.scrollTop=B}}}}else{A=E.findFocusTarget();if(A){return A.focus(F,C,H,D)}}return E},cancelFocus:function(){var A=this.getFocusTask();if(A){A.cancel()}},beforeBlur:Ext.emptyFn,onBlur:function(E){var D=this,B=D.focusableContainer,C=D.focusCls,A;if(!D.focusable||D.destroying){return }D.beforeBlur(E);if(B){B.beforeFocusableChildBlur(D,E)}A=D.getFocusClsEl();if(C&&A){A.removeCls(D.removeClsWithUI(C,true))}if(D.validateOnBlur){D.validate()}D.hasFocus=false;D.fireEvent("blur",D,E);D.postBlur(E);if(B){B.afterFocusableChildBlur(D,E)}},postBlur:Ext.emptyFn,beforeFocus:Ext.emptyFn,onFocus:function(E){var D=this,B=D.focusableContainer,C=D.focusCls,A;if(!D.focusable){return }if(D.canFocus()){D.beforeFocus(E);if(B){B.beforeFocusableChildFocus(D,E)}A=D.getFocusClsEl();if(C&&A){A.addCls(D.addClsWithUI(C,true))}if(!D.hasFocus){D.hasFocus=true;D.fireEvent("focus",D,E)}D.postFocus(E);if(B){B.afterFocusableChildFocus(D,E)}}},postFocus:Ext.emptyFn,getTabIndex:function(){var C=this,B,A;if(!C.focusable){return }B=C.rendered&&C.getFocusEl();if(B){if(B.isComponent){A=B.getTabIndex()}else{if(B.isElement){A=B.getAttribute("tabIndex")}else{return }}C.tabIndex=A}else{A=C.tabIndex}return A-0},setTabIndex:function(D,A){var C=this,B;if(!C.focusable){return }C.tabIndex=D;if(!C.rendered){return }B=A||C.getFocusEl();if(B){if(B.isComponent){B.setTabIndex(D)}else{if(B.isElement){B.set({tabIndex:D})}}}},onFocusEnter:function(B){var A=this;if(A.floating&&A!==A.zIndexManager.getActive()){A.toFront(true)}A.focusEnterEvent=B;A.containsFocus=true;A.fireEvent("focusenter",A,B)},onFocusLeave:function(B){var A=this;A.focusEnterEvent=null;A.containsFocus=false;A.fireEvent("focusleave",A,B)},privates:{revertFocus:function(){var D=this,C=D.previousFocus,B=D.focusEnterEvent,A;D.previousFocus=null;if(D.preventRefocus||!D.el.contains(Ext.Element.getActiveElement())){return }A=C||(B&&B.fromComponent);if(A){if(A.canFocus&&A.canFocus(false,true)){A.focus();return }else{if(A.nodeType){A=Ext.fly(A)}if(A.isFocusable&&A.isFocusable()){A.focus();return }}}if(B){A=Ext.fly(B.relatedTarget);if(Ext.isIE8||(A.isFocusable&&A.isFocusable())){A.focus()}}},findFocusTarget:function(){var B=this,A,C;for(A=B.up(":not([disabled])");A;A=A.up(":not([disabled])")){C=Ext.ComponentQuery.query(":focusable:not([hasFocus])",A);if(C.length){return C[0]}if(A.isFocusable&&A.isFocusable()){return A}}},initFocusableElement:function(){var C=this,A=C.tabIndex,B=C.getFocusEl();if(B&&!B.isComponent){C.focusEl=B;if(A!=null&&C.canFocus(true)){C.setTabIndex(A,B)}B.dom.setAttribute("data-componentid",C.id);if(C.config.keyHandlers){C.initKeyHandlers(B)}}},getFocusTask:function(){if(!this.focusTask){this.focusTask=Ext.focusTask}return this.focusTask},handleFocusEvent:function(B){var A;if(this.isFocusing(B)){A=new Ext.event.Event(B.event);A.type="focus";A.relatedTarget=B.fromElement;A.target=B.toElement;this.onFocus(A)}},handleBlurEvent:function(B){var A;if(this.isBlurring(B)){A=new Ext.event.Event(B.event);A.type="blur";A.target=B.fromElement;A.relatedTarget=B.toElement;this.onBlur(A)}},isFocusing:function(B){var D=B.fromElement,C=B.toElement,A;if(this.focusable){A=this.getFocusEl();if(A){if(A.isComponent){return A.isFocusing(D,C)}else{return C===A.dom&&D!==C}}}return false},isBlurring:function(B){var D=B.fromElement,C=B.toElement,A;if(this.focusable){A=this.getFocusEl();if(A){if(A.isComponent){return A.isBlurring(D,C)}else{return D===A.dom&&D!==C}}}return false},blur:function(){var B=this,A;if(!B.focusable||!B.canFocus()){return }A=B.getFocusEl();if(A){B.blurring=true;A.blur();delete B.blurring}return B},disableTabbing:function(){var C=this,B=C.el,A;if(B){B.saveTabbableState()}A=C.getFocusEl();if(A){if(A.isComponent){A.disableTabbing()}else{if(A.isElement&&B&&!B.contains(A)){A.saveTabbableState()}}}},enableTabbing:function(){var C=this,B=C.el,A;A=C.getFocusEl();if(A){if(A.isComponent){A.enableTabbing()}else{if(A.isElement&&B&&!B.contains(A)){A.restoreTabbableState()}}}if(B){B.restoreTabbableState()}}}},function(){if(!Ext.focusTask){Ext.focusTask=new Ext.util.DelayedTask()}})