Ext.define("Ext.util.KeyMap",{alternateClassName:"Ext.KeyMap",eventName:"keydown",constructor:function(A){var B=this;if((arguments.length!==1)||(typeof A==="string")||A.dom||A.tagName||A===document||A.isComponent){B.legacyConstructor.apply(B,arguments);return }Ext.apply(B,A);B.bindings=[];if(!B.target.isComponent){B.target=Ext.get(B.target)}if(B.binding){B.addBinding(B.binding)}else{if(A.key){B.addBinding(A)}}B.enable()},legacyConstructor:function(B,D,A){var C=this;Ext.apply(C,{target:Ext.get(B),eventName:A||C.eventName,bindings:[]});if(D){C.addBinding(D)}C.enable()},addBinding:function(E){var C=this,D=E.key,B,A;if(C.processing){C.bindings=C.bindings.slice(0)}if(Ext.isArray(E)){for(B=0,A=E.length;B<A;B++){C.addBinding(E[B])}return }C.bindings.push(Ext.apply({keyCode:C.processKeys(D)},E))},removeBinding:function(F){var E=this,G=E.bindings,A=G.length,B,D,C;if(E.processing){E.bindings=G.slice(0)}C=E.processKeys(F.key);for(B=0;B<A;++B){D=G[B];if((D.fn||D.handler)===(F.fn||F.handler)&&D.scope===F.scope){if(F.alt===D.alt&&F.crtl===D.crtl&&F.shift===D.shift){if(Ext.Array.equals(D.keyCode,C)){Ext.Array.erase(E.bindings,B,1);return }}}}},processKeys:function(F){var G=false,D,E,B,A,C;if(F.test){return F}if(Ext.isString(F)){E=[];B=F.toUpperCase();for(C=0,A=B.length;C<A;++C){E.push(B.charCodeAt(C))}F=E;G=true}if(!Ext.isArray(F)){F=[F]}if(!G){for(C=0,A=F.length;C<A;++C){D=F[C];if(Ext.isString(D)){F[C]=D.toUpperCase().charCodeAt(0)}}}return F},handleTargetEvent:function(E){var D=this,F,C,B,A;if(D.enabled){F=D.bindings;C=0;B=F.length;E=D.processEvent.apply(D.processEventScope||D,arguments);if(E){D.lastKeyEvent=E;if(D.ignoreInputFields&&Ext.fly(E.target).isInputField()){return }if(!E.getKey){return E}D.processing=true;for(;C<B;++C){A=D.processBinding(F[C],E);if(A===false){D.processing=false;return A}}D.processing=false}}},processEvent:Ext.identityFn,processBinding:function(E,A){if(this.checkModifiers(E,A)){var F=A.getKey(),H=E.fn||E.handler,I=E.scope||this,G=E.keyCode,B=E.defaultEventAction,C,D,J;if(G.test){if(G.test(String.fromCharCode(A.getCharCode()))){J=H.call(I,F,A);if(J!==true&&B){A[B]()}if(J===false){return J}}}else{if(G.length){for(C=0,D=G.length;C<D;++C){if(F===G[C]){J=H.call(I,F,A);if(J!==true&&B){A[B]()}if(J===false){return J}break}}}}}},checkModifiers:function(G,E){var D=["shift","ctrl","alt"],C=0,A=D.length,F,B;for(;C<A;++C){B=D[C];F=G[B];if(!(F===undefined||(F===E[B+"Key"]))){return false}}return true},on:function(B,D,C){var G,A,E,F;if(Ext.isObject(B)&&!Ext.isArray(B)){G=B.key;A=B.shift;E=B.ctrl;F=B.alt}else{G=B}this.addBinding({key:G,shift:A,ctrl:E,alt:F,fn:D,scope:C})},un:function(B,D,C){var G,A,E,F;if(Ext.isObject(B)&&!Ext.isArray(B)){G=B.key;A=B.shift;E=B.ctrl;F=B.alt}else{G=B}this.removeBinding({key:G,shift:A,ctrl:E,alt:F,fn:D,scope:C})},isEnabled:function(){return this.enabled},enable:function(){var A=this;if(!A.enabled){A.target.on(A.eventName,A.handleTargetEvent,A,{capture:A.capture,priority:A.priority});A.enabled=true}},disable:function(){var A=this;if(A.enabled){A.target.removeListener(A.eventName,A.handleTargetEvent,A);A.enabled=false}},setDisabled:function(A){if(A){this.disable()}else{this.enable()}},destroy:function(C){var A=this,B=A.target;A.bindings=[];A.disable();if(C){B.destroy()}delete A.target;A.callParent()}})