Ext.define("Ext.view.MultiSelectorSearch",{extend:"Ext.panel.Panel",xtype:"multiselector-search",layout:"fit",floating:true,resizable:true,minWidth:200,minHeight:200,border:true,defaultListenerScope:true,referenceHolder:true,searchText:"Search...",initComponent:function(){var G=this,A=G.owner,D=G.makeItems(),E,F,C,B;G.dockedItems=G.makeDockedItems();G.items=D;B=Ext.data.StoreManager.lookup(G.store);for(E=D.length;E--;){if((F=D[E]).xtype==="grid"){F.store=B;F.isSearchGrid=true;F.selModel=F.selModel||{type:"checkboxmodel",pruneRemoved:false,listeners:{selectionchange:"onSelectionChange"}};Ext.merge(F,G.grid);if(!F.columns){F.hideHeaders=true;F.columns=[{flex:1,dataIndex:G.field}]}break}}G.callParent();C=G.getOwnerStore().getRange();if(!A.convertSelectionRecord.$nullFn){for(E=C.length;E--;){C[E]=A.convertSelectionRecord(C[E])}}if(B.isLoading()||(B.loadCount===0&&!B.getCount())){B.on("load",function(){var H=C.length,J,I,K=[];if(!G.destroyed){for(J=0;J<H;J++){I=B.getById(C[J].getId());if(I){K.push(I)}}G.selectRecords(K)}},null,{single:true})}else{G.selectRecords(C)}},getOwnerStore:function(){return this.owner.getStore()},afterShow:function(){var A=this.lookupReference("searchField");this.callParent(arguments);if(A){A.focus()}},getSearchStore:function(){var A=this.lookupReference("searchGrid");return A.getStore()},makeDockedItems:function(){return[{xtype:"textfield",reference:"searchField",dock:"top",hideFieldLabel:true,emptyText:this.searchText,triggers:{clear:{cls:Ext.baseCSSPrefix+"form-clear-trigger",handler:"onClearSearch",hidden:true}},listeners:{change:"onSearchChange",buffer:300}}]},makeItems:function(){return[{xtype:"grid",reference:"searchGrid",trailingBufferZone:2,leadingBufferZone:2,viewConfig:{deferEmptyText:false,emptyText:"No results."}}]},selectRecords:function(B){var A=this.lookupReference("searchGrid");return A.getSelectionModel().select(B)},deselectRecords:function(B){var A=this.lookupReference("searchGrid");return A.getSelectionModel().deselect(B)},search:function(D){var C=this,A=C.searchFilter,B=C.getSearchStore().getFilters();if(D){B.beginUpdate();if(A){A.setValue(D)}else{C.searchFilter=A=new Ext.util.Filter({id:"search",property:C.field,value:D})}B.add(A);B.endUpdate()}else{if(A){B.remove(A)}}},privates:{onClearSearch:function(){var A=this.lookupReference("searchField");A.setValue(null);A.focus()},onSearchChange:function(C){var B=C.getValue(),A=C.getTrigger("clear");A.setHidden(!B);this.search(B)},onSelectionChange:function(H,I){var C=this.owner,J=C.getStore(),E=J.data,F=0,A={},K,D,B,G;for(D=I.length;D--;){G=I[D];B=G.id;A[B]=G;if(!E.containsKey(B)){(K||(K=[])).push(C.convertSearchRecord(G))}}for(D=E.length;D--;){G=E.getAt(D);if(!A[G.id]){(F||(F=[])).push(G)}}if(K||F){E.splice(E.length,F,K)}}}})