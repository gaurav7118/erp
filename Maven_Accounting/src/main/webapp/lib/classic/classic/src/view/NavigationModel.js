Ext.define("Ext.view.NavigationModel",{mixins:["Ext.util.Observable","Ext.mixin.Factoryable","Ext.util.StoreHolder"],alias:"view.navigation.default",config:{store:null},focusCls:Ext.baseCSSPrefix+"view-item-focused",constructor:function(){this.mixins.observable.constructor.call(this)},bindComponent:function(A){if(this.view!==A){this.view=A;this.bindView(A)}},bindView:function(A){var C=this,D=A.dataSource,B;C.initKeyNav(A);if(!D.isEmptyStore){C.setStore(D)}B=C.getViewListeners();B.destroyable=true;C.viewListeners=C.viewListeners||[];C.viewListeners.push(A.on(B))},updateStore:function(A){this.mixins.storeholder.bindStore.apply(this,[A])},getViewListeners:function(){var A=this;return{containermousedown:A.onContainerMouseDown,itemmousedown:A.onItemMouseDown,itemclick:A.onItemClick,itemcontextmenu:A.onItemMouseDown,scope:A}},initKeyNav:function(A){var B=this;B.keyNav=new Ext.util.KeyNav({target:A,ignoreInputFields:true,eventName:"itemkeydown",defaultEventAction:"stopEvent",processEvent:B.processViewEvent,up:B.onKeyUp,down:B.onKeyDown,right:B.onKeyRight,left:B.onKeyLeft,pageDown:B.onKeyPageDown,pageUp:B.onKeyPageUp,home:B.onKeyHome,end:B.onKeyEnd,space:B.onKeySpace,enter:B.onKeyEnter,A:{ctrl:true,handler:B.onSelectAllKeyPress},scope:B})},processViewEvent:function(B,A,E,C,D){return D},addKeyBindings:function(A){this.keyNav.addBindings(A)},enable:function(){this.keyNav.enable();this.disabled=false},disable:function(){this.keyNav.disable();this.disabled=true},onContainerMouseDown:function(A,B){if(B.pointerType==="mouse"&&Ext.getScrollbarSize().width){if(!A.el.getClientRegion().contains(B.getPoint())){B.preventDefault()}}},onItemMouseDown:function(B,A,E,D,C){if(C.pointerType!=="touch"){this.setPosition(D)}},onItemClick:function(C,B,E,D,A){if(this.record===B){this.fireNavigateEvent(A)}else{this.setPosition(D,A)}},setPosition:function(C,G,J,D){var H=this,I=H.view,E=I.getSelectionModel(),A=I.dataSource,F,B;if(C==null||!I.all.getCount()){H.record=H.recordIndex=null}else{if(typeof C==="number"){B=Math.max(Math.min(C,A.getCount()-1),0);F=A.getAt(C)}else{if(C.isEntity){F=A.getById(C.id);B=A.indexOf(F);if(B===-1){F=A.getAt(0);B=0}}else{if(C.tagName){F=I.getRecord(C);B=A.indexOf(F)}else{F=B=null}}}}if(F===H.record){H.recordIndex=B;return H.focusPosition(B)}if(H.item){H.item.removeCls(H.focusCls)}H.previousRecordIndex=H.recordIndex;H.previousRecord=H.record;H.previousItem=H.item;H.recordIndex=B;H.record=F;D=D||H.record===H.lastFocused;if(F){H.focusPosition(H.recordIndex)}else{H.item=null}if(!J){E.fireEvent("focuschange",E,H.previousRecord,H.record)}if(!D&&G){H.fireNavigateEvent(G)}},focusPosition:function(A){var B=this;if(A!=null&&A!==-1){if(A.isEntity){A=B.view.dataSource.indexOf(A)}B.item=B.view.all.item(A);if(B.item){B.lastFocused=B.record;B.lastFocusedIndex=B.recordIndex;B.focusItem(B.item)}else{B.record=null}}else{B.item=null}},focusItem:function(A){A.addCls(this.focusCls);A.focus()},getPosition:function(){return this.record?this.recordIndex:null},getRecordIndex:function(){return this.recordIndex},getItem:function(){return this.item},getRecord:function(){return this.record},getLastFocused:function(){if(this.view.dataSource.indexOf(this.lastFocused)===-1){return null}return this.lastFocused},onKeyUp:function(B){var A=this.recordIndex-1;if(A<0){A=this.view.all.getCount()-1}this.setPosition(A,B)},onKeyDown:function(B){var A=this.recordIndex+1;if(A>this.view.all.getCount()-1){A=0}this.setPosition(A,B)},onKeyRight:function(B){var A=this.recordIndex+1;if(A>this.view.all.getCount()-1){A=0}this.setPosition(A,B)},onKeyLeft:function(B){var A=this.recordIndex-1;if(A<0){A=this.view.all.getCount()-1}this.setPosition(A,B)},onKeyPageDown:Ext.emptyFn,onKeyPageUp:Ext.emptyFn,onKeyHome:function(A){this.setPosition(0,A)},onKeyEnd:function(A){this.setPosition(this.view.all.getCount()-1,A)},onKeySpace:function(A){this.fireNavigateEvent(A)},onKeyEnter:function(A){A.stopEvent();A.view.fireEvent("itemclick",A.view,A.record,A.item,A.recordIndex,A)},onSelectAllKeyPress:function(A){this.fireNavigateEvent(A)},fireNavigateEvent:function(B){var A=this;A.fireEvent("navigate",{navigationModel:A,keyEvent:B,previousRecordIndex:A.previousRecordIndex,previousRecord:A.previousRecord,previousItem:A.previousItem,recordIndex:A.recordIndex,record:A.record,item:A.item})},destroy:function(){var A=this;A.setStore(null);Ext.destroy(A.viewListeners,A.keyNav);A.keyNav=A.viewListeners=A.dataSource=A.lastFocused=null;A.callParent()}})