Ext.define("Ext.view.NodeCache",{requires:["Ext.dom.CompositeElementLite"],statics:{range:document.createRange&&document.createRange()},constructor:function(A){this.view=A;this.clear();this.el=new Ext.dom.Fly()},destroy:function(){var A=this;if(!A.destroyed){A.el.destroy();A.el=A.view=null;A.destroyed=true}A.callParent()},clear:function(E){var C=this,D=C.elements,A=C.statics().range,B;if(C.count&&E){if(A){A.setStartBefore(D[C.startIndex]);A.setEndAfter(D[C.endIndex]);A.deleteContents()}else{for(B in D){Ext.removeNode(D[B])}}}C.elements={};C.count=C.startIndex=0;C.endIndex=-1},fill:function(B,G,F){F=F||0;var D=this,E=D.elements={},C,A=B.length-F;if(!G){G=0}for(C=0;C<A;C++){E[G+C]=B[C+F]}D.startIndex=G;D.endIndex=G+A-1;D.count=A;return this},insert:function(F,B){var D=this,E=D.elements,C,A=B.length;if(D.count){if(F>D.endIndex+1||F+B.length-1<D.startIndex){Ext.raise("Discontiguous range would result from inserting "+B.length+" nodes at "+F)}if(F<D.count){for(C=D.endIndex+A;C>=F+A;C--){E[C]=E[C-A];E[C].setAttribute("data-recordIndex",C)}}D.endIndex=D.endIndex+A}else{D.startIndex=F;D.endIndex=F+A-1}for(C=0;C<A;C++,F++){E[F]=B[C];E[F].setAttribute("data-recordIndex",F)}D.count+=A},invoke:function(D,A){var E=this,C,B;D=Ext.dom.Element.prototype[D];for(B=E.startIndex;B<=E.endIndex;B++){C=E.item(B);if(C){D.apply(C,A)}}return E},item:function(C,B){var D=this.elements[C],A=null;if(D){A=B?this.elements[C]:this.el.attach(this.elements[C])}return A},first:function(A){return this.item(this.startIndex,A)},last:function(A){return this.item(this.endIndex,A)},moveBlock:function(A){var F=this,G=F.elements,E,B,D,C;if(!A){return }if(A<0){C=F.startIndex-1;B=F.endIndex;D=1}else{C=F.endIndex+1;B=F.startIndex;D=-1}F.startIndex+=A;F.endIndex+=A;do{C+=D;E=G[C+A]=G[C];E.setAttribute("data-recordIndex",C+A);if(C<F.startIndex||C>F.endIndex){delete G[C]}}while(C!==B);delete G[C]},getCount:function(){return this.count},slice:function(E,B){var D=this.elements,A=[],C;if(!B){B=this.endIndex}else{B=Math.min(this.endIndex,B-1)}for(C=E||this.startIndex;C<=B;C++){A.push(D[C])}return A},replaceElement:function(D,C,A){var E=this.elements,B=(typeof D==="number")?D:this.indexOf(D);if(B>-1){C=Ext.getDom(C);if(A){D=E[B];D.parentNode.insertBefore(C,D);Ext.removeNode(D);C.setAttribute("data-recordIndex",B)}this.elements[B]=C}return this},indexOf:function(B){var C=this.elements,A;B=Ext.getDom(B);for(A=this.startIndex;A<=this.endIndex;A++){if(C[A]===B){return A}}return -1},removeRange:function(C,F,D){var I=this,A=I.elements,H=[],E,G,B,J;if(F==null){F=I.endIndex+1}else{F=Math.min(I.endIndex+1,F+1)}if(C==null){C=I.startIndex}B=F-C;for(G=C,J=F;G<=I.endIndex;G++,J++){E=A[G];if(G<F){H.push(E);if(D){Ext.removeNode(E)}}if(J<=I.endIndex){E=A[G]=A[J];E.setAttribute("data-recordIndex",G)}else{delete A[G]}}I.count-=B;I.endIndex-=B;return H},removeElement:function(K,C){var G=this,J,I,A=G.elements,D,E,B=0,F,H;if(Ext.isArray(K)){J=K;K=[];E=J.length;for(B=0;B<E;B++){I=J[B];if(typeof I!=="number"){I=G.indexOf(I)}if(I>=G.startIndex&&I<=G.endIndex){K[K.length]=I}}Ext.Array.sort(K);E=K.length}else{if(K<G.startIndex||K>G.endIndex){return }E=1;K=[K]}for(F=H=K[0],B=0;F<=G.endIndex;F++,H++){if(B<E&&F===K[B]){H++;B++;if(C){Ext.removeNode(A[F])}}if(H<=G.endIndex&&H>=G.startIndex){D=A[F]=A[H];D.setAttribute("data-recordIndex",F)}else{delete A[F]}}G.endIndex-=E;G.count-=E},scroll:function(Q,R,H){var S=this,J=S.view,F=J.store,K=S.elements,A=Q.length,N=J.getNodeContainer(),G=J.hasListeners.itemremove,P=J.hasListeners.itemadd,L=S.statics().range,O,B,C,D,I,E,M,T;if(!Q.length){return }if(R===-1){if(H){if(G){M=[];T=[]}E=(S.endIndex-H)+1;if(L){L.setStartBefore(K[E]);L.setEndAfter(K[S.endIndex]);L.deleteContents();for(O=E;O<=S.endIndex;O++){B=K[O];delete K[O];if(G){M.push(F.getByInternalId(B.getAttribute("data-recordId")));T.push(B)}}}else{for(O=E;O<=S.endIndex;O++){B=K[O];delete K[O];Ext.removeNode(B);if(G){M.push(F.getByInternalId(B.getAttribute("data-recordId")));T.push(B)}}}J.fireEvent("itemremove",M,E,T,J);S.endIndex-=H}if(Q.length){I=J.bufferRender(Q,S.startIndex-=A);D=I.children;for(O=0;O<A;O++){K[S.startIndex+O]=D[O]}N.insertBefore(I.fragment,N.firstChild);if(P){J.fireEvent("itemadd",Q,S.startIndex,D)}}}else{if(H){if(G){M=[];T=[]}C=S.startIndex+H;if(L){L.setStartBefore(K[S.startIndex]);L.setEndAfter(K[C-1]);L.deleteContents();for(O=S.startIndex;O<C;O++){B=K[O];delete K[O];if(G){M.push(F.getByInternalId(B.getAttribute("data-recordId")));T.push(B)}}}else{for(O=S.startIndex;O<C;O++){B=K[O];delete K[O];Ext.removeNode(B);if(G){M.push(F.getByInternalId(B.getAttribute("data-recordId")));T.push(B)}}}J.fireEvent("itemremove",M,S.startIndex,T,J);S.startIndex=C}I=J.bufferRender(Q,S.endIndex+1);D=I.children;for(O=0;O<A;O++){K[S.endIndex+=1]=D[O]}N.appendChild(I.fragment);if(P){J.fireEvent("itemadd",Q,S.endIndex+1,D)}}S.count=S.endIndex-S.startIndex+1;return D},sumHeights:function(){var A=0,C=this.elements,B;for(B=this.startIndex;B<=this.endIndex;B++){A+=C[B].offsetHeight}return A}},function(){Ext.dom.CompositeElementLite.importElementMethods.call(this)})