Ext.define("Ext.view.Table",{extend:"Ext.view.View",xtype:["tableview","gridview"],alternateClassName:"Ext.grid.View",requires:["Ext.grid.CellContext","Ext.view.TableLayout","Ext.grid.locking.RowSynchronizer","Ext.view.NodeCache","Ext.util.DelayedTask","Ext.util.MixedCollection"],isTableView:true,config:{selectionModel:{type:"rowmodel"}},inheritableStatics:{normalSideEvents:["deselect","select","beforedeselect","beforeselect","selectionchange"],events:["blur","focus","move","resize","destroy","beforedestroy","boxready","afterrender","render","beforerender","removed","hide","beforehide","show","beforeshow","enable","disable","added","deactivate","beforedeactivate","activate","beforeactivate","cellkeydown","beforecellkeydown","cellmouseup","beforecellmouseup","cellmousedown","beforecellmousedown","cellcontextmenu","beforecellcontextmenu","celldblclick","beforecelldblclick","cellclick","beforecellclick","refresh","itemremove","itemadd","beforeitemupdate","itemupdate","viewready","beforerefresh","unhighlightitem","highlightitem","focuschange","containerkeydown","containercontextmenu","containerdblclick","containerclick","containermouseout","containermouseover","containermouseup","containermousedown","beforecontainerkeydown","beforecontainercontextmenu","beforecontainerdblclick","beforecontainerclick","beforecontainermouseout","beforecontainermouseover","beforecontainermouseup","beforecontainermousedown","itemkeydown","itemcontextmenu","itemdblclick","itemclick","itemmouseleave","itemmouseenter","itemmouseup","itemmousedown","rowclick","rowcontextmenu","rowdblclick","rowkeydown","rowmouseup","rowmousedown","rowkeydown","beforeitemkeydown","beforeitemcontextmenu","beforeitemdblclick","beforeitemclick","beforeitemmouseleave","beforeitemmouseenter","beforeitemmouseup","beforeitemmousedown","statesave","beforestatesave","staterestore","beforestaterestore","uievent","groupcollapse","groupexpand","scroll"]},scrollable:true,componentLayout:"tableview",baseCls:Ext.baseCSSPrefix+"grid-view",unselectableCls:Ext.baseCSSPrefix+"unselectable",firstCls:Ext.baseCSSPrefix+"grid-cell-first",lastCls:Ext.baseCSSPrefix+"grid-cell-last",itemCls:Ext.baseCSSPrefix+"grid-item",selectedItemCls:Ext.baseCSSPrefix+"grid-item-selected",selectedCellCls:Ext.baseCSSPrefix+"grid-cell-selected",focusedItemCls:Ext.baseCSSPrefix+"grid-item-focused",overItemCls:Ext.baseCSSPrefix+"grid-item-over",altRowCls:Ext.baseCSSPrefix+"grid-item-alt",dirtyCls:Ext.baseCSSPrefix+"grid-dirty-cell",rowClsRe:new RegExp("(?:^|\\s*)"+Ext.baseCSSPrefix+"grid-item-alt(?:\\s+|$)","g"),cellRe:new RegExp(Ext.baseCSSPrefix+"grid-cell-([^\\s]+)(?:\\s|$)",""),positionBody:true,positionCells:false,stripeOnUpdate:null,actionableMode:false,trackOver:true,getRowClass:null,stripeRows:true,markDirty:true,ariaRole:"rowgroup",rowAriaRole:"row",cellAriaRole:"gridcell",tpl:["{%","view = values.view;","if (!(columns = values.columns)) {","columns = values.columns = view.ownerCt.getVisibleColumnManager().getColumns();","}","values.fullWidth = 0;","for (i = 0, len = columns.length; i < len; i++) {","column = columns[i];","values.fullWidth += (column.cellWidth = column.lastBox ? column.lastBox.width : column.width || column.minWidth);","}","tableCls=values.tableCls=[];","%}",'<div class="'+Ext.baseCSSPrefix+'grid-item-container" role="presentation" style="width:{fullWidth}px">',"{[view.renderTHead(values, out, parent)]}","{%","view.renderRows(values.rows, values.columns, values.viewStartIndex, out);","%}","{[view.renderTFoot(values, out, parent)]}","</div>","{% ","view = columns = column = null;","%}",{definitions:"var view, tableCls, columns, i, len, column;",priority:0}],outerRowTpl:['<table id="{rowId}" role="presentation" ','data-boundView="{view.id}" ','data-recordId="{record.internalId}" ','data-recordIndex="{recordIndex}" ','class="{[values.itemClasses.join(" ")]}" cellpadding="0" cellspacing="0" style="{itemStyle};width:0">',"{%","this.nextTpl.applyOut(values, out, parent)","%}","</table>",{priority:9999}],rowTpl:["{%",'var dataRowCls = values.recordIndex === -1 ? "" : " '+Ext.baseCSSPrefix+'grid-row";',"%}",'<tr class="{[values.rowClasses.join(" ")]} {[dataRowCls]}"',' role="{rowRole}" {rowAttr:attributes}>','<tpl for="columns">{%',"parent.view.renderCell(values, parent.record, parent.recordIndex, parent.rowIndex, xindex - 1, out, parent)","%}","</tpl>","</tr>",{priority:0}],cellTpl:['<td class="{tdCls}" role="{cellRole}" {tdAttr} {cellAttr:attributes}',' style="width:{column.cellWidth}px;<tpl if="tdStyle">{tdStyle}</tpl>"',' tabindex="-1" data-columnid="{[values.column.getItemId()]}">','<div {unselectableAttr} class="'+Ext.baseCSSPrefix+'grid-cell-inner {innerCls}" ','style="text-align:{align};<tpl if="style">{style}</tpl>" ',"{cellInnerAttr:attributes}>{value}</div>","</td>",{priority:0}],refreshSelmodelOnRefresh:false,tableValues:{},rowValues:{itemClasses:[],rowClasses:[]},cellValues:{classes:[Ext.baseCSSPrefix+"grid-cell "+Ext.baseCSSPrefix+"grid-td"]},constructor:function(A){if(A.grid.isTree){A.baseCls=Ext.baseCSSPrefix+"tree-view"}this.callParent([A])},hasVariableRowHeight:function(A){var B=this;return B.variableRowHeight||B.store.isGrouped()||B.getVisibleColumnManager().hasVariableRowHeight()||(!A&&B.lockingPartner&&B.lockingPartner.hasVariableRowHeight(true))},initComponent:function(){var A=this;if(A.columnLines){A.addCls(A.grid.colLinesCls)}if(A.rowLines){A.addCls(A.grid.rowLinesCls)}A.body=new Ext.dom.Fly();A.body.id=A.id+"gridBody";if(!A.trackOver){A.overItemCls=null}A.headerCt.view=A;A.grid.view=A;A.initFeatures(A.grid);A.itemSelector=A.getItemSelector();A.all=new Ext.view.NodeCache(A);A.callParent()},applySelectionModel:function(B,E){var D=this,C=D.ownerGrid,F=B.type,A=D.disableSelection||C.disableSelection;if(!E){if(!(B&&B.isSelectionModel)){B=C.selModel||B}}if(B){if(B.isSelectionModel){B.allowDeselect=C.allowDeselect||B.selectionMode!=="SINGLE";B.locked=A}else{if(typeof B==="string"){B={type:B}}else{B.type=C.selType||B.selType||B.type||F}if(!B.mode){if(C.simpleSelect){B.mode="SIMPLE"}else{if(C.multiSelect){B.mode="MULTI"}}}B=Ext.Factory.selection(Ext.apply({allowDeselect:C.allowDeselect,locked:A},B))}}return B},updateSelectionModel:function(A,C){var B=this;if(C){C.un({scope:B,lastselectedchanged:B.updateBindSelection,selectionchange:B.updateBindSelection});Ext.destroy(B.selModelRelayer)}B.selModelRelayer=B.relayEvents(A,["selectionchange","beforeselect","beforedeselect","select","deselect","focuschange"]);A.on({scope:B,lastselectedchanged:B.updateBindSelection,selectionchange:B.updateBindSelection});B.selModel=A},getVisibleColumnManager:function(){return this.ownerCt.getVisibleColumnManager()},getColumnManager:function(){return this.ownerCt.getColumnManager()},getTopLevelVisibleColumnManager:function(){return this.ownerGrid.getVisibleColumnManager()},moveColumn:function(A,R,H){var Q=this,O=H>1,J=O&&document.createRange?document.createRange():null,B=O&&!J?document.createDocumentFragment():null,I=R,K=Q.getGridColumns().length,P=K-1,E=(Q.firstCls||Q.lastCls)&&(R===0||R===K||A===0||A===P),M,L,G,N,C,D,F;if(Q.rendered&&R!==A){G=Q.el.query(Q.rowSelector);for(M=0,N=G.length;M<N;M++){C=G[M];D=C.childNodes;if(E){if(D.length===1){Ext.fly(D[0]).addCls(Q.firstCls);Ext.fly(D[0]).addCls(Q.lastCls);continue}if(A===0){Ext.fly(D[0]).removeCls(Q.firstCls);Ext.fly(D[1]).addCls(Q.firstCls)}else{if(A===P){Ext.fly(D[P]).removeCls(Q.lastCls);Ext.fly(D[P-1]).addCls(Q.lastCls)}}if(R===0){Ext.fly(D[0]).removeCls(Q.firstCls);Ext.fly(D[A]).addCls(Q.firstCls)}else{if(R===K){Ext.fly(D[P]).removeCls(Q.lastCls);Ext.fly(D[A]).addCls(Q.lastCls)}}}if(O){if(J){J.setStartBefore(D[A]);J.setEndAfter(D[A+H-1]);B=J.extractContents()}else{for(L=0;L<H;L++){B.appendChild(D[A])}}C.insertBefore(B,D[I]||null)}else{C.insertBefore(D[A],D[I]||null)}}F=Q.el.query("colgroup");for(M=0,N=F.length;M<N;M++){C=F[M];if(O){if(J){J.setStartBefore(C.childNodes[A]);J.setEndAfter(C.childNodes[A+H-1]);B=J.extractContents()}else{for(L=0;L<H;L++){B.appendChild(C.childNodes[A])}}C.insertBefore(B,C.childNodes[I]||null)}else{C.insertBefore(C.childNodes[A],C.childNodes[I]||null)}}}},scrollToTop:Ext.emptyFn,addElListener:function(A,C,B){this.mon(this,A,C,B,{element:"el"})},getGridColumns:function(){return this.ownerCt.getVisibleColumnManager().getColumns()},getHeaderAtIndex:function(A){return this.ownerCt.getVisibleColumnManager().getHeaderAtIndex(A)},getCell:function(A,B){var C=this.getRow(A);if(typeof B==="number"){B=this.getHeaderAtIndex(B)}return Ext.fly(C).down(B.getCellSelector())},getFeature:function(B){var A=this.featuresMC;if(A){return A.get(B)}},findFeature:function(A){if(this.features){return Ext.Array.findBy(this.features,function(B){if(B.ftype===A){return true}})}},initFeatures:function(D){var F=this,C,E,B,A;F.tpl=Ext.XTemplate.getTpl(this,"tpl");F.rowTpl=Ext.XTemplate.getTpl(this,"rowTpl");F.addRowTpl(Ext.XTemplate.getTpl(this,"outerRowTpl"));F.cellTpl=Ext.XTemplate.getTpl(this,"cellTpl");F.featuresMC=new Ext.util.MixedCollection();E=F.features=F.constructFeatures();A=E?E.length:0;for(C=0;C<A;C++){B=E[C];B.view=F;B.grid=D;F.featuresMC.add(B);B.init(D)}},renderTHead:function(B,C,E){var F=B.view.headerFns,A,D;if(F){for(D=0,A=F.length;D<A;++D){F[D].call(this,B,C,E)}}},addHeaderFn:function(A){var B=this.headerFns;if(!B){B=this.headerFns=[]}B.push(A)},renderTFoot:function(B,C,E){var F=B.view.footerFns,A,D;if(F){for(D=0,A=F.length;D<A;++D){F[D].call(this,B,C,E)}}},addFooterFn:function(A){var B=this.footerFns;if(!B){B=this.footerFns=[]}B.push(A)},addTpl:function(A){return this.insertTpl("tpl",A)},addRowTpl:function(A){return this.insertTpl("rowTpl",A)},addCellTpl:function(A){return this.insertTpl("cellTpl",A)},insertTpl:function(E,D){var C=this,A,B;if(D.isTemplate){D=Ext.Object.chain(D)}else{D=new Ext.XTemplate("{%this.nextTpl.applyOut(values, out, parent);%}",D)}for(A=C[E];D.priority<A.priority;A=A.nextTpl){B=A}if(B){B.nextTpl=D}else{C[E]=D}D.nextTpl=A;return D},tplApplyOut:function(A,B,C){if(this.before){if(this.before(A,B,C)===false){return }}this.nextTpl.applyOut(A,B,C);if(this.after){this.after(A,B,C)}},constructFeatures:function(){var F=this,E=F.features,D,B,C=0,A;if(E){B=[];A=E.length;for(;C<A;C++){D=E[C];if(!D.isFeature){D=Ext.create("feature."+D.ftype,D)}B[C]=D}}return B},beforeRender:function(){this.callParent();if(!this.enableTextSelection){this.protoEl.unselectable()}},getElConfig:function(){var A=this.callParent();delete A["aria-hidden"];delete A["aria-disabled"];return A},onBindStore:function(A){var B=this,C=B.bufferedRenderer;if(C&&C.store!==A){C.bindStore(A)}if(B.all&&B.all.getCount()){if(C){C.setBodyTop(0)}B.clearViewEl()}B.callParent(arguments)},getStoreListeners:function(){var A=this.callParent();if(this.bufferedRenderer){delete A.clear}A.beforepageremove=this.beforePageRemove;return A},beforePageRemove:function(C,B){var D=this.all,A=C.getPageSize();if(D.startIndex>=(B-1)*A&&D.endIndex<=(B*A-1)){C.get(B);return false}},onViewScroll:function(B,A,C){if(!this.ignoreScroll){this.callParent([B,A,C])}},createRowElement:function(B,C,D){var E=this,F=E.renderBuffer,A=E.collectData([B],C);A.columns=D;E.tpl.overwrite(F,A);E.cleanupData();return Ext.fly(F).down(E.getNodeContainerSelector(),true).firstChild},bufferRender:function(C,D){var E=this,F=E.renderBuffer,A,B=document.createRange?document.createRange():null;E.tpl.overwrite(F,E.collectData(C,D));E.cleanupData();Ext.fly(F).saveTabbableState({skipSelf:true,includeHidden:true});F=Ext.fly(F).down(E.getNodeContainerSelector(),true);if(B){B.selectNodeContents(F);A=B.extractContents()}else{A=document.createDocumentFragment();while(F.firstChild){A.appendChild(F.firstChild)}}return{fragment:A,children:Ext.Array.toArray(A.childNodes)}},collectData:function(A,C){var B=this;B.rowValues.view=B;B.tableValues.view=B;B.tableValues.rows=A;B.tableValues.columns=null;B.tableValues.viewStartIndex=C;B.tableValues.touchScroll=B.touchScroll;B.tableValues.tableStyle="width:"+B.headerCt.getTableWidth()+"px";return B.tableValues},cleanupData:function(){var A=this.tableValues;A.view=A.columns=A.rows=this.rowValues.view=null},refreshSize:function(C){var B=this,A=B.getBodySelector();if(A){B.body.attach(B.el.down(A,true))}if(!B.hasLoadingHeight){Ext.suspendLayouts();B.callParent(arguments);if(C||(B.hasVariableRowHeight()&&B.dataSource.getCount())){B.grid.updateLayout()}Ext.resumeLayouts(true)}},clearViewEl:function(A){var E=this,F=E.all,G=E.getStore(),C,D,H,I=F.slice(),B=[];if(E.hasListeners.itemremove){for(C=F.startIndex;C<=F.endIndex;C++){B.push(G.getByInternalId(F.item(C,true).getAttribute("data-recordId")))}}E.fireEvent("itemremove",B,F.startIndex,I,E);E.callParent();D=Ext.fly(E.getNodeContainer());if(D&&!A){H=E.getTargetEl();if(H.dom!==D.dom){D.destroy()}}},getMaskTarget:function(){return this.ownerCt.body},statics:{getBoundView:function(A){return Ext.getCmp(A.getAttribute("data-boundView"))}},getRecord:function(A){if(this.store.destroyed){return }if(A.isModel){return A}A=this.getNode(A);if(A){return this.dataSource.getByInternalId(A.getAttribute("data-recordId"))}},indexOf:function(A){A=this.getNode(A);if(!A&&A!==0){return -1}return this.all.indexOf(A)},indexInStore:function(A){return A?this.dataSource.indexOf(this.getRecord(A)):-1},indexOfRow:function(B){var C=this.dataSource,A;if(B.isCollapsedPlaceholder){A=C.indexOfPlaceholder(B)}else{A=C.indexOf(B)}return A},renderRows:function(G,E,D,B){var F=this,H=F.rowValues,A=G.length,C;H.view=F;H.columns=E;H.rowRole=F.rowAriaRole;F.cellValues.cellRole=F.cellAriaRole;for(C=0;C<A;C++,D++){H.itemClasses.length=H.rowClasses.length=0;F.renderRow(G[C],D,B)}H.view=H.columns=H.record=null},renderColumnSizer:function(B,C){var E=B.columns||this.getGridColumns(),A=E.length,D,G,F;C.push('<colgroup role="presentation">');for(D=0;D<A;D++){G=E[D];F=G.cellWidth?G.cellWidth:Ext.grid.header.Container.prototype.defaultWidth;C.push('<col role="presentation" class="',Ext.baseCSSPrefix,"grid-cell-",E[D].getItemId(),'" style="width:'+F+'px">')}C.push("</colgroup>")},renderRow:function(G,A,F){var I=this,E=A===-1,H=I.selectionModel,L=I.rowValues,D=L.itemClasses,C=L.rowClasses,B=I.itemCls,K,J=I.rowTpl;L.rowAttr={};L.record=G;L.recordId=G.internalId;L.recordIndex=I.store.indexOf(G);L.rowIndex=A;L.rowId=I.getRowId(G);L.itemCls=L.rowCls="";if(!L.columns){L.columns=I.ownerCt.getVisibleColumnManager().getColumns()}D.length=C.length=0;if(!E){D[0]=B;if(!I.ownerCt.disableSelection&&H.isRowSelected){if(H.isRowSelected(G)){D.push(I.selectedItemCls)}}if(I.stripeRows&&A%2!==0){D.push(I.altRowCls)}if(I.getRowClass){K=I.getRowClass(G,A,null,I.dataSource);if(K){C.push(K)}}}if(F){J.applyOut(L,F,I.tableValues)}else{return J.apply(L,I.tableValues)}},renderCell:function(D,G,F,M,I,E){var K=this,B,H=K.selectionModel,J=K.cellValues,C=J.classes,A=G.data[D.dataIndex],N=K.cellTpl,O,L,P=K.navigationModel.getPosition();J.record=G;J.column=D;J.recordIndex=F;J.rowIndex=M;J.columnIndex=J.cellIndex=I;J.align=D.align;J.innerCls=D.innerCls;J.tdCls=J.tdStyle=J.tdAttr=J.style="";J.unselectableAttr=K.enableTextSelection?"":'unselectable="on"';C[1]=D.getCellId();L=2;if(D.renderer&&D.renderer.call){B=K.ownerCt.columnManager.getHeaderIndex(D);O=D.renderer.call(D.usingDefaultRenderer?D:D.scope||K.ownerCt,A,J,G,F,B,K.dataSource,K);if(J.css){G.cssWarning=true;J.tdCls+=" "+J.css;J.css=null}if(J.tdCls){C[L++]=J.tdCls}}else{O=A}J.value=(O==null||O==="")?D.emptyCellText:O;if(D.tdCls){C[L++]=D.tdCls}if(K.markDirty&&G.dirty&&G.isModified(D.dataIndex)){C[L++]=K.dirtyCls}if(D.isFirstVisible){C[L++]=K.firstCls}if(D.isLastVisible){C[L++]=K.lastCls}if(!K.enableTextSelection){C[L++]=K.unselectableCls}if(H&&(H.isCellModel||H.isSpreadsheetModel)&&H.isCellSelected(K,F,D)){C[L++]=K.selectedCellCls}if(P&&P.record.id===G.id&&P.column===D){C[L++]=K.focusedItemCls}C.length=L;J.tdCls=C.join(" ");N.applyOut(J,E);J.column=J.record=null},getRow:function(A){var B;if((!A&&A!==0)||!this.rendered){return null}if(A.target){A=A.target}if(Ext.isString(A)){return Ext.fly(A).down(this.rowSelector,true)}if(Ext.isNumber(A)){B=this.all.item(A);return B&&B.down(this.rowSelector,true)}if(A.isModel){return this.getRowByRecord(A)}B=Ext.fly(A);if(B.is(this.itemSelector)){return this.getRowFromItem(B)}return B.findParent(this.rowSelector,this.getTargetEl())},getRowId:function(A){return this.id+"-record-"+A.internalId},constructRowId:function(A){return this.id+"-record-"+A},getNodeById:function(A){A=this.constructRowId(A);return this.retrieveNode(A,false)},getRowById:function(A){A=this.constructRowId(A);return this.retrieveNode(A,true)},getNodeByRecord:function(A){return this.retrieveNode(this.getRowId(A),false)},getRowByRecord:function(A){return this.retrieveNode(this.getRowId(A),true)},getRowFromItem:function(C){var D=Ext.getDom(C).tBodies[0].childNodes,A=D.length,B;for(B=0;B<A;B++){if(Ext.fly(D[B]).is(this.rowSelector)){return D[B]}}},retrieveNode:function(C,B){var A=this.el.getById(C,true);if(B&&A){return Ext.fly(A).down(this.rowSelector,true)}return A},updateIndexes:Ext.emptyFn,bodySelector:"div."+Ext.baseCSSPrefix+"grid-item-container",nodeContainerSelector:"div."+Ext.baseCSSPrefix+"grid-item-container",itemSelector:"table."+Ext.baseCSSPrefix+"grid-item",rowSelector:"tr."+Ext.baseCSSPrefix+"grid-row",cellSelector:"td."+Ext.baseCSSPrefix+"grid-cell",sizerSelector:"."+Ext.baseCSSPrefix+"grid-cell",innerSelector:"div."+Ext.baseCSSPrefix+"grid-cell-inner",getBodySelector:function(){return this.bodySelector},getColumnSizerSelector:function(B){var A=this.sizerSelector+"-"+B.getItemId();return"td"+A+",col"+A},getItemSelector:function(){return this.itemSelector},getCellSelector:function(A){return A?A.getCellSelector():this.cellSelector},getCellInnerSelector:function(A){return this.getCellSelector(A)+" "+this.innerSelector},addRowCls:function(B,A){var C=this.getRow(B);if(C){Ext.fly(C).addCls(A)}},removeRowCls:function(B,A){var C=this.getRow(B);if(C){Ext.fly(C).removeCls(A)}},onRowSelect:function(C){var B=this,A;B.addItemCls(C,B.selectedItemCls);A=B.getRow(C);if(A){A.setAttribute("aria-selected",true)}if(Ext.isIE8){B.repaintBorder(C+1)}},onRowDeselect:function(C){var B=this,A;B.removeItemCls(C,B.selectedItemCls);A=B.getRow(C);if(A){A.removeAttribute("aria-selected")}if(Ext.isIE8){B.repaintBorder(C+1)}},onCellSelect:function(B){var A=this.getCellByPosition(B);if(A){A.addCls(this.selectedCellCls);A.dom.setAttribute("aria-selected",true)}},onCellDeselect:function(B){var A=this.getCellByPosition(B,true);if(A){Ext.fly(A).removeCls(this.selectedCellCls);A.removeAttribute("aria-selected")}},getCellInclusive:function(A,B){if(A){var C=this.getRow(A.row),D=this.ownerCt.getColumnManager().getHeaderAtIndex(A.column);if(D&&C){return Ext.fly(C).down(this.getCellSelector(D),B)}}return false},getCellByPosition:function(A,C){if(A){var B=A.view||this,D=B.getRow(A.record||A.row),E=A.column.isColumn?A.column:B.getVisibleColumnManager().getHeaderAtIndex(A.column);if(E&&D){return Ext.fly(D).down(B.getCellSelector(E),C)}}return false},onFocusEnter:function(D){var E=this,G=D.fromComponent,I=E.getNavigationModel(),B,J=E.bufferedRenderer,F,A,H,C;if(E.actionableMode){return }D=D.event;if(!E.cellFocused&&E.all.getCount()&&E.dataSource.getCount()){H=D.getTarget();if(Ext.fly(H).is(E.getCellSelector())){B=new Ext.grid.CellContext(E).setPosition(E.getRecord(H),E.getHeaderByCell(H))}else{if(H&&Ext.fly(H).isFocusable()&&E.el.contains(H)&&H!==E.el.dom){E.ownerGrid.setActionableMode(true,new Ext.grid.CellContext(E).setPosition(E.getRecord(H),E.getHeaderByCell(Ext.fly(H).up(E.getCellSelector()))));Ext.fly(H).focus()}else{B=E.lastFocused;if(B){C=E.getScrollable();if(!C||C.isInView(B.getRow()).y){F=B.record}}else{B=new Ext.grid.CellContext((E.isNormalView&&E.lockingPartner.grid.isVisible())?E.lockingPartner:E).setColumn(0)}if(G&&G.isColumn&&G.getView()===E){B.view=E;B.setColumn(G)}if(!F){A=J?J.getFirstVisibleRowIndex():0;F=E.dataSource.getAt(A);while(F&&F.isNonData){A++;F=E.dataSource.getAt(A)}if(F){B.setRow(F)}else{B=null}}if(!B){D.stopEvent();E.el.focus();return }}}}if(B){I.setPosition(B,null,D,null,true);E.cellFocused=!!I.getPosition();if(E.cellFocused){E.el.dom.setAttribute("tabIndex","-1");E.toggleChildrenTabbability(false)}}Ext.Component.prototype.onFocusEnter.call(E,D)},onFocusLeave:function(C){var B=this,A=!B.lockingPartner||!C.toComponent||(C.toComponent!==B.lockingPartner&&!B.lockingPartner.isAncestor(C.toComponent));if(!B.refreshing){if(B.cellFocused){if(A){B.getNavigationModel().setPosition(null,null,C.event,null,true)}B.cellFocused=false;B.focusEl=B.el;B.focusEl.dom.setAttribute("tabIndex",0)}if(A){if(B.ownerGrid.actionableMode){B.ownerGrid.setActionableMode(false)}}Ext.Component.prototype.onFocusLeave.call(B,C)}},onRowFocus:function(D,B,A){var C=this;if(B){C.addItemCls(D,C.focusedItemCls);if(!A){C.focusRow(D)}}else{C.removeItemCls(D,C.focusedItemCls)}if(Ext.isIE8){C.repaintBorder(D+1)}},focusRow:function(D,A){var C=this,B=C.getFocusTask();if(A){B.delay(Ext.isNumber(A)?A:10,C.focusRow,C,[D,false]);return }B.cancel();if(C.isVisible(true)){C.getNavigationModel().setPosition(C.getRecord(D))}},focusNode:function(B,A){this.focusRow(B,A)},scrollRowIntoView:function(B,A){B=this.getRow(B);if(B){this.scrollElIntoView(B,false,A)}},focusCell:function(B,C){var E=this,A,D=E.getFocusTask();if(C){D.delay(Ext.isNumber(C)?C:10,E.focusCell,E,[B,false]);return }D.cancel();if(E.isVisible(true)&&(A=E.getCellByPosition(B))){E.getNavigationModel().setPosition(B)}},getLastFocused:function(){var B=this,A=B.lastFocused;if(A&&A.record&&A.column){if(B.dataSource.indexOf(A.record)!==-1&&B.getVisibleColumnManager().indexOf(A.column)!==-1&&B.getNode(A.record)){return A}}},scrollCellIntoView:function(A,B){if(A.isCellContext){A=this.getCellByPosition(A)}if(A){this.scrollElIntoView(A,null,B)}},scrollElIntoView:function(C,D,B){var A=this.getScrollable();if(A){A.scrollIntoView(C,D,B)}},syncRowHeightBegin:function(){var F=this,H=F.all,E=H.count,C=[],G=Ext.grid.locking.RowSynchronizer,B,A,D;for(B=0,A=H.startIndex;B<E;B++,A++){C[B]=D=new G(F,H.elements[A]);D.reset()}return C},syncRowHeightClear:function(B){var D=this,E=D.all,C=E.count,A;for(A=0;A<C;A++){B[A].reset()}},syncRowHeightMeasure:function(B){var C=B.length,A;for(A=0;A<C;A++){B[A].measure()}},syncRowHeightFinish:function(B,D){var C=B.length,E=this.bufferedRenderer,A;for(A=0;A<C;A++){B[A].finish(D[A])}if(E){E.syncRowHeightsFinish()}},handleUpdate:function(N,G,Q,a){Q=Q||Ext.data.Model.EDIT;var j=this,H=j.store.indexOf(G),T=j.rowTpl,L=j.markDirty,X=j.dirtyCls,b=Q!==Ext.data.Model.EDIT,W=[],Y=j.variableRowHeight,U=0,f=j.ownerCt,D=j.cellFly||(j.self.prototype.cellFly=new Ext.dom.Fly()),R,O,I,P,d,g,K,V,C,F,e,c,M,B,E,Z,h,A,J,S;if(j.viewReady){R=j.getNodeByRecord(G);if(R){if(G.isCollapsedPlaceholder){Ext.fly(R).syncContent(j.createRowElement(G,j.indexOfRow(G)));return }V=j.overItemCls;C=j.ownerCt.getVisibleColumnManager().getColumns();for(c=0,e=C.length;c<e;c++){F=C[c];if(F.preventUpdate){B=Ext.fly(R).down(F.getCellSelector(),true);if(B&&!b&&L){D.attach(B);if(G.isModified(F.dataIndex)){D.addCls(X)}else{D.removeCls(X)}}}else{M=j.shouldUpdateCell(G,F,a);if(M){U=U|M;W[W.length]=F;Y=Y||F.variableRowHeight}}}j.fireEvent("beforeitemupdate",G,H,R,W);if(j.getRowClass||!j.getRowFromItem(R)||(U&1)||(R.tBodies[0].childNodes.length>1)){J=R._extData;I=j.createRowElement(G,j.indexOfRow(G),W);if(Ext.fly(R,"_internal").hasCls(V)){Ext.fly(I).addCls(V)}if(Ext.isIE9m&&R.mergeAttributes){R.mergeAttributes(I,true)}else{P=I.attributes;d=P.length;for(K=0;K<d;K++){g=P[K].name;if(g!=="id"){R.setAttribute(g,P[K].value)}}}if(J){J.isSynchronized=false}if(C.length&&(O=j.getRow(R))){j.updateColumns(O,Ext.fly(I).down(j.rowSelector,true),W)}while(T){if(T.syncContent){if(T.syncContent(R,I,a?W:null)===false){break}}T=T.nextTpl}}else{for(c=0,e=W.length;c<e;c++){F=W[c];E=F.dataIndex;Z=G.get(E);B=Ext.fly(R).down(F.getCellSelector(),true);D.attach(B);if(!b&&L){if(G.isModified(F.dataIndex)){D.addCls(X)}else{D.removeCls(X)}}h=F.usingDefaultRenderer;A=h?F:F.scope;if(F.updater){Ext.callback(F.updater,A,[B,Z,G,j,j.dataSource],0,F,f)}else{if(F.renderer){Z=Ext.callback(F.renderer,A,[Z,null,G,0,0,j.dataSource,j],0,F,f)}S=Z==null||Z==="";Z=S?F.emptyCellText:Z;if(F.producesHTML||S){D.down(j.innerSelector,true).innerHTML=Z}else{D.down(j.innerSelector,true).childNodes[0].data=Z}}if(j.highlightClass){Ext.fly(B).addCls(j.highlightClass);if(!j.changedCells){j.self.prototype.changedCells=[];j.prototype.clearChangedTask=new Ext.util.DelayedTask(j.clearChangedCells,j.prototype);j.clearChangedTask.delay(j.unhighlightDelay)}j.changedCells.push({cell:B,cls:j.highlightClass,expires:Ext.Date.now()+1000})}}}if(b&&L&&!G.dirty){Ext.fly(R,"_internal").select("."+X).removeCls(X)}if(Y){Ext.suspendLayouts()}j.fireEvent("itemupdate",G,H,R);if(Y){j.ownerGrid.updateLayout();Ext.resumeLayouts(true)}}}},afterComponentLayout:function(){var A;this.callParent(arguments);if(this.touchScroll&&!this.bufferedRenderer&&(A=this.getScrollable())){A.refresh()}},clearChangedCells:function(){var D=this,B=Ext.Date.now(),E;for(var C=0,A=D.changedCells.length;C<A;){E=D.changedCells[C];if(E.expires<=B){Ext.fly(E.cell).removeCls(E.highlightClass);Ext.Array.erase(D.changedCells,C,1);A--}else{break}}if(A){D.clearChangedTask.delay(D.unhighlightDelay)}},updateColumns:function(I,J,K){var H=this,B,A,G,C,M=K.length,L,D,N,F,E=H.getCellSelector();if(I.mergeAttributes){I.mergeAttributes(J,true)}else{B=J.attributes;A=B.length;for(C=0;C<A;C++){G=B[C].name;if(G!=="id"){I.setAttribute(G,B[C].value)}}}for(L=0;L<M;L++){D=K[L];E=H.getCellSelector(D);N=Ext.fly(I).selectNode(E);F=Ext.fly(J).selectNode(E);Ext.fly(N).syncContent(F)}},shouldUpdateCell:function(A,C,B){return C.shouldUpdateCell(A,B)},refresh:function(){var B=this,A,C=B.saveFocusState();if(B.destroying){return }B.callParent(arguments);C();B.headerCt.setSortState();if(B.touchScroll&&B.el&&!B.all.getCount()&&B.headerCt&&B.headerCt.tooNarrow){A=B.getScrollable();if(A&&A.isTouchScroller){A.setSize({x:B.headerCt.getTableWidth(),y:A.getSize().y})}}},processContainerEvent:function(B){var A=Ext.Component.fromElement(B.target.parentNode);if(A&&A.up(this.ownerCt)){return false}},processItemEvent:function(B,O,I,N){var R=this,K=R.self,Q=K.EventMap,D=N.type,F=R.features,M=F.length,L,H,J,E,C,P=N.position=R.eventPosition||(R.eventPosition=new Ext.grid.CellContext()),G,A;if(Ext.isIE&&D==="mouseup"&&!N.within(R.el)){return false}if(R.indexInStore(O)!==-1){G=P.rowElement=Ext.fly(O).down(R.rowSelector,true);A=N.getTarget(R.getCellSelector(),G);D=K.TouchEventMap[D]||D;if(A){if(!A.parentNode){return false}C=R.getHeaderByCell(A);H=R.ownerCt.getColumnManager().getHeaderIndex(C)}else{H=-1}P.setAll(R,I,C?R.getVisibleColumnManager().getHeaderIndex(C):-1,B,C);P.cellElement=A;J=R.fireEvent("uievent",D,R,A,I,H,N,B,G);if((J===false||R.callParent(arguments)===false)){return false}for(L=0;L<M;++L){E=F[L];if(E.wrapsItem){if(E.vetoEvent(B,G,I,N)===false){R.processSpecialEvent(N);return false}}}if(A&&D!=="mouseover"&&D!=="mouseout"){J=!((R["onBeforeCell"+Q[D]](A,H,B,G,I,N)===false)||(R.fireEvent("beforecell"+D,R,A,H,B,G,I,N)===false)||(R["onCell"+Q[D]](A,H,B,G,I,N)===false)||(R.fireEvent("cell"+D,R,A,H,B,G,I,N)===false))}if(J!==false){J=R.fireEvent("row"+D,R,B,G,I,N)}return J}else{this.processSpecialEvent(N);N.preventDefault();return false}},processSpecialEvent:function(G){var J=this,C=J.features,I=C.length,K=G.type,D,L,E,F,B,H,A=J.ownerCt;J.callParent(arguments);if(K==="mouseover"||K==="mouseout"){return }K=J.self.TouchEventMap[K]||K;for(D=0;D<I;D++){L=C[D];if(L.hasFeatureEvent){F=G.getTarget(L.eventSelector,J.getTargetEl());if(F){E=L.eventPrefix;B=L.getFireEventArgs("before"+E+K,J,F,G);H=L.getFireEventArgs(E+K,J,F,G);if((J.fireEvent.apply(J,B)===false)||(A.fireEvent.apply(A,B)===false)||(J.fireEvent.apply(J,H)===false)||(A.fireEvent.apply(A,H)===false)){return false}}}}return true},onCellMouseDown:Ext.emptyFn,onCellLongPress:Ext.emptyFn,onCellMouseUp:Ext.emptyFn,onCellClick:Ext.emptyFn,onCellDblClick:Ext.emptyFn,onCellContextMenu:Ext.emptyFn,onCellKeyDown:Ext.emptyFn,onCellKeyUp:Ext.emptyFn,onCellKeyPress:Ext.emptyFn,onBeforeCellMouseDown:Ext.emptyFn,onBeforeCellLongPress:Ext.emptyFn,onBeforeCellMouseUp:Ext.emptyFn,onBeforeCellClick:Ext.emptyFn,onBeforeCellDblClick:Ext.emptyFn,onBeforeCellContextMenu:Ext.emptyFn,onBeforeCellKeyDown:Ext.emptyFn,onBeforeCellKeyUp:Ext.emptyFn,onBeforeCellKeyPress:Ext.emptyFn,expandToFit:function(A){this.autoSizeColumn(A)},autoSizeColumn:function(A){if(Ext.isNumber(A)){A=this.getGridColumns()[A]}if(A){if(A.isGroupHeader){A.autoSize();return }delete A.flex;A.setWidth(this.getMaxContentWidth(A))}},getMaxContentWidth:function(D){var F=this,J=F.el.query(D.getCellInnerSelector()),B=D.getWidth(),C=0,E=J.length,A=F.body.select(F.getColumnSizerSelector(D)),H=Math.max,G=0,I;if(E>0){if(Ext.supports.ScrollWidthInlinePaddingBug){G+=F.getCellPaddingAfter(J[0])}if(F.columnLines){G+=Ext.fly(J[0].parentNode).getBorderWidth("lr")}}A.setWidth(1);D.textEl.setStyle({"text-overflow":"clip",display:"table-cell"});I=D.textEl.dom.offsetWidth+D.titleEl.getPadding("lr");D.textEl.setStyle({"text-overflow":"",display:""});for(;C<E;C++){I=H(I,J[C].scrollWidth)}I+=G;I=H(I+1,40);A.setWidth(B);return I},getPositionByEvent:function(E){var D=this,B=E.getTarget(D.cellSelector),C=E.getTarget(D.itemSelector),A=D.getRecord(C),F=D.getHeaderByCell(B);return D.getPosition(A,F)},getHeaderByCell:function(A){if(A){return this.ownerCt.getVisibleColumnManager().getHeaderById(Ext.getDom(A).getAttribute("data-columnId"))}return false},walkCells:function(G,H,C,I){var F=this,J=G.clone(),E=F.lockingPartner&&F.lockingPartner.grid.isVisible()?F.lockingPartner:null,B=G.rowIdx,A=F.dataSource.getCount()-1,D=F.ownerCt.getVisibleColumnManager().getColumns();switch(H.toLowerCase()){case"right":if(G.isLastColumn()){B=E&&F.isLockedView?B:B+1;if(B>A){return false}if(E){J.view=E}J.setPosition(B,0)}else{J.navigate(+1)}break;case"left":if(G.isFirstColumn()){B=E&&F.isNormalView?B:B-1;if(B<0){return false}if(E){J.view=E;D=E.getVisibleColumnManager().getColumns()}J.setPosition(B,D[D.length-1])}else{J.navigate(-1)}break;case"up":if(B===0){return false}else{J.setRow(B-1)}break;case"down":if(B===A){return false}else{J.setRow(B+1)}break}if(C&&C.call(I||F,J)!==true){return false}return J},walkRows:function(H,A){var D=this,G=D.dataSource,E=0,J=H,B,C=(A<0)?0:G.getCount()-1,F=C?1:-1,I=H;do{if(C?I>=C:I<=C){return J||C}I+=F;if((B=Ext.fly(D.getRow(I)))&&B.isVisible(true)){E+=F;J=I}}while(E!==A);return I},walkRecs:function(B,A){var G=this,J=G.dataSource,H=0,K=B,C,E=(A<0)?0:(J.isBufferedStore?J.getTotalCount():J.getCount())-1,I=E?1:-1,F=J.indexOf(B),D;do{if(E?F>=E:F<=E){return K}F+=I;D=J.getAt(F);if(!D.isCollapsedPlaceholder&&(C=Ext.fly(G.getNodeByRecord(D)))&&C.isVisible(true)){H+=I;K=D}}while(H!==A);return K},getFirstVisibleRowIndex:function(){var C=this,B=(C.dataSource.isBufferedStore?C.dataSource.getTotalCount():C.dataSource.getCount()),A=C.indexOf(C.all.first())-1;do{A+=1;if(A===B){return }}while(!Ext.fly(C.getRow(A)).isVisible(true));return A},getLastVisibleRowIndex:function(){var B=this,A=B.indexOf(B.all.last());do{A-=1;if(A===-1){return }}while(!Ext.fly(B.getRow(A)).isVisible(true));return A},getHeaderCt:function(){return this.headerCt},getPosition:function(A,B){return new Ext.grid.CellContext(this).setPosition(A,B)},onDestroy:function(){var D=this,C=D.featuresMC,A,B;if(C){for(B=0,A=C.getCount();B<A;++B){C.getAt(B).destroy()}}D.cellFly=D.featuresMC=null;D.callParent(arguments);D.all.destroy();D.body.destroy();D.all=D.body=D.body.el=null;D.grid=D.ownerGrid=D.headerCt=D.panel=null;D.selection=D.actionPosition=D.eventPosition=D.lastFocused=null;D.actionRow=D.cellTpl=D.rowTpl=D.bufferedRenderer=null},onReplace:function(B,F,A,E){var C=this,G=C.bufferedRenderer,D;if(C.rendered&&G){D=C.saveFocusState();G.onReplace(B,F,A,E);D()}else{C.callParent(arguments)}C.setPendingStripe(F)},onResize:function(C,A,B,F){var D=this,E=D.bufferedRenderer;if(E){E.onViewResize(D,C,A,B,F)}D.callParent([C,A])},onAdd:function(B,A,C){var D=this,E=D.bufferedRenderer;if(D.rendered&&E&&(E.bodyTop||D.dataSource.getCount()+A.length>=E.viewSize)){E.onReplace(B,C,[],A)}else{D.callParent(arguments)}D.setPendingStripe(C)},onRemove:function(B,A,C){var D=this,F=D.bufferedRenderer,E;if(D.rendered&&F&&D.dataSource.getCount()+A.length>=F.viewSize){E=D.saveFocusState();F.onReplace(B,C,A,[]);E()}else{D.callParent(arguments)}D.setPendingStripe(C)},saveFocusState:function(){var E=this,A=E.dataSource,G=E.actionableMode,C=E.getNavigationModel(),D=G?E.actionPosition:C.getPosition(true),B,F;if(D){D=D.clone();if(G){E.ownerGrid.setActionableMode(false)}E.el.dom.focus();C.setPosition();return function(){if(A.getCount()){B=Math.min(D.rowIdx,E.all.getCount()-1);F=Math.min(D.colIdx,E.getVisibleColumnManager().getColumns().length-1);D=new Ext.grid.CellContext(E).setPosition(A.contains(D.record)?D.record:B,F);if(G){E.ownerGrid.setActionableMode(true,D)}else{E.cellFocused=true;C.setPosition(D,null,null,null,true)}}else{D.column.focus()}}}return Ext.emptyFn},onDataRefresh:function(B){var C=this,A=C.ownerCt;if(A&&A.isCollapsingOrExpanding===2){A.on("expand",C.onDataRefresh,C,{single:true});return }C.callParent([B])},getViewRange:function(){var A=this;if(A.bufferedRenderer){return A.bufferedRenderer.getViewRange()}return A.callParent()},setPendingStripe:function(A){var B=this.stripeOnUpdate;if(B===null){B=A}else{B=Math.min(B,A)}this.stripeOnUpdate=B},onEndUpdate:function(){var A=this,C=A.stripeOnUpdate,B=A.all.startIndex;if(A.rendered&&(C||C===0)){if(C<B){C=B}A.doStripeRows(C);A.stripeOnUpdate=null}A.callParent(arguments)},doStripeRows:function(B,A){var D=this,E,G,C,F;if(D.rendered&&D.stripeRows){E=D.getNodes(B,A);for(C=0,G=E.length;C<G;C++){F=E[C];F.className=F.className.replace(D.rowClsRe," ");B++;if(B%2===0){F.className+=(" "+D.altRowCls)}}}},hasActiveFeature:function(){return(this.isGrouping&&this.store.isGrouped())||this.isRowWrapped},getCellPaddingAfter:function(A){return Ext.fly(A).getPadding("r")},privates:{refreshScroll:function(){var A=this,B=A.bufferedRenderer;if(B){B.refreshSize()}else{A.callParent()}},collectNodes:function(A){this.all.fill(this.getNodeContainer().childNodes,this.all.startIndex)},setActionableMode:function(I,F){var K=this,A=K.getNavigationModel(),B,O,L,C,M=K.grid.actionables,G=M.length,D,E,N,J,H;if(K.actionableMode===I){if(!I||F.isEqual(K.actionPosition)){return false}}if(I){if(F&&(F.view===K||(F.view===(J=K.lockingPartner)&&J.actionableMode))){F=F.clone();E=F.record;K.grid.ensureVisible(E,{column:F.column});B=K.all.item(F.rowIdx);if(!J){O=Ext.fly(B).down(F.column.getCellSelector());for(D=0;D<G;D++){N=N||M[D].activateCell(F)}}if(J||O.restoreTabbableState(true).length||N){for(D=0;D<G;D++){if(M[D].activateRow){M[D].activateRow(B)}}if(J||(L=O.findTabbableElements()).length){B.restoreTabbableState(true);if(J){K.actionableMode=true;K.actionPosition=null;return true}if(L){K.actionRow=B;K.actionableMode=K.ownerGrid.actionableMode=true;A.setPosition();A.actionPosition=K.actionPosition=F;Ext.fly(L[0]).focus();return true}}}}return false}else{C=Ext.fly(Ext.Element.getActiveElement());H=K.el.contains(C);if(H){E=K.actionPosition&&K.actionPosition.record}for(D=0;D<G;D++){if(M[D].deactivate){M[D].deactivate()}}if(K.actionRow){K.actionRow.saveTabbableState({skipSelf:true,includeSaved:false})}K.actionableMode=K.ownerGrid.actionableMode=false;K.actionPosition=A.actionPosition=K.actionRow=null;if(H){A.setPosition(new Ext.grid.CellContext(K).setPosition(E||0,K.getHeaderByCell(C.findParent(K.getCellSelector()))||0))}}},onRowExit:function(C,K,E){var H=this,I=E?"nextSibling":"previousSibling",G=H.lockingPartner,J=H.grid.actionables,F=J.length,D,B,A;H.refreshing=H.actionableModeTabbing=true;for(D=0;D<F;D++){if(J[D].deactivate){J[D].deactivate()}}if(G&&G.grid.isVisible()){B=H.all.indexOf(C);if(E){A=0;if(H.isNormalView){B++}}else{A=G.getVisibleColumnManager().getColumns().length-1;if(H.isLockedView){B--}}H.actionPosition=null;H=G;K=H.all.item(B,true)}H.findFirstActionableElement(K,I,E);H.refreshing=H.actionableModeTabbing=false;Ext.fly(C).saveTabbableState({skipSelf:true,includeSaved:false})},findFirstActionableElement:function(A,J,G){var I=this,C=I.getVisibleColumnManager().getColumns(),H=C.length,P,M,N=I.grid.actionables,L=N.length,E,D,B,F=new Ext.grid.CellContext(I),O,K;if(A){F.setRow(A);for(E=0;E<L;E++){if(N[E].activateRow){N[E].activateRow(A)}}for(E=(G?0:H-1);(G?E<H:E>-1)&&!M;E=E+(G?1:-1)){B=C[E];F.setColumn(B);P=Ext.fly(A).down(F.column.getCellSelector());for(D=0;D<L;D++){O=O||N[D].activateCell(F)}if(P.restoreTabbableState(true).length||O){K=P.findTabbableElements();I.actionRow=Ext.get(A);I.actionRow.restoreTabbableState(true);M=K[G?0:K.length-1]}}if(M){I.actionPosition=I.getNavigationModel().actionPosition=F;Ext.fly(M).focus()}else{I.onRowExit(A,I.all.item(F.rowIdx+(G?1:-1)),G)}}else{I.grid.ensureVisible(G?0:I.dataSource.getCount()-1,{callback:function(S,Q,R){if(S){I.findFirstActionableElement(R,J,G)}else{I.ownerGrid.setActionableMode(false)}}})}}}})