Ext.define("Ext.window.Window",{extend:"Ext.panel.Panel",alternateClassName:"Ext.Window",requires:["Ext.util.ComponentDragger","Ext.util.Region"],mixins:["Ext.util.FocusTrap"],alias:"widget.window",baseCls:Ext.baseCSSPrefix+"window",resizable:true,draggable:true,constrain:false,constrainHeader:false,plain:false,minimizable:false,maximizable:false,minHeight:50,minWidth:50,expandOnShow:true,collapsible:false,closable:true,hidden:true,autoRender:true,hideMode:"offsets",floating:true,itemCls:Ext.baseCSSPrefix+"window-item",overlapHeader:true,ignoreHeaderBorderManagement:true,alwaysFramed:true,isRootCfg:{isRoot:true},isWindow:true,ariaRole:"dialog",initComponent:function(){var A=this;A.frame=false;A.callParent();if(A.plain){A.addClsWithUI("plain")}A.addStateEvents(["maximize","restore","resize","dragend"])},getElConfig:function(){var B=this,A;A=B.callParent();A.tabIndex=-1;return A},getFocusEl:function(){return this.getDefaultFocus()||this.el},getState:function(){var B=this,D=B.callParent()||{},A=!!B.maximized,C=B.ghostBox,E;D.maximized=A;if(A){E=B.restorePos}else{if(C){E=[C.x,C.y]}else{E=B.getPosition()}}Ext.apply(D,{size:A?B.restoreSize:B.getSize(),pos:E});return D},applyState:function(B){var A=this;if(B){A.maximized=B.maximized;if(A.maximized){A.hasSavedRestore=true;A.restoreSize=B.size;A.restorePos=B.pos}else{Ext.apply(A,{width:B.size.width,height:B.size.height,x:B.pos[0],y:B.pos[1]})}}},onRender:function(B,A){var C=this;C.callParent(arguments);if(C.header){C.header.on({scope:C,click:C.onHeaderClick})}if(C.maximizable){C.header.on({scope:C,dblclick:C.toggleMaximize})}},afterRender:function(){var A=this,C=A.header,B;if(A.maximized){A.maximized=false;A.maximize();if(C){C.removeCls(C.indicateDragCls)}}A.callParent();if(A.closable){B=A.getKeyMap();B.on(27,A.onEsc,A)}else{B=A.keyMap}if(B&&A.hidden){B.disable()}},onEsc:function(A,B){B.stopEvent();this.close()},beforeDestroy:function(){var A=this;if(A.rendered){Ext.un("resize",A.onWindowResize,A);delete A.animateTarget;A.hide();Ext.destroy(A.keyMap)}A.callParent()},addTools:function(){var A=this,B=[];A.callParent();if(A.minimizable){B.push({type:"minimize",handler:"minimize",scope:A})}if(A.maximizable){B.push({type:A.maximized?"restore":"maximize",handler:"toggleMaximize",scope:A})}if(B.length){A.addTool(B)}},onShow:function(){var A=this;A.callParent(arguments);if(A.expandOnShow){A.expand(false)}A.syncMonitorWindowResize();if(A.keyMap){A.keyMap.enable()}},doClose:function(){var A=this;if(A.hidden){A.fireEvent("close",A);if(A.closeAction==="destroy"){A.destroy()}}else{A.hide(A.animateTarget,A.doClose,A)}},afterHide:function(){var A=this;A.syncMonitorWindowResize();if(A.keyMap){A.keyMap.disable()}A.callParent(arguments)},onWindowResize:function(){var B=this,A;if(!B.destroyed){if(B.maximized){B.fitContainer()}else{A=B.getSizeModel();if(A.width.natural||A.height.natural){B.updateLayout()}B.doConstrain()}}},minimize:function(){this.fireEvent("minimize",this);return this},resumeHeaderLayout:function(A){this.header.resumeLayouts(A?this.isRootCfg:null)},afterCollapse:function(){var A=this,C=A.header,B=A.tools;if(C&&A.maximizable){C.suspendLayouts();B.maximize.hide();this.resumeHeaderLayout(true)}if(A.resizer){A.resizer.disable()}A.callParent(arguments)},afterExpand:function(){var A=this,D=A.header,B=A.tools,C;if(D){D.suspendLayouts();if(A.maximizable){B.maximize.show();C=true}this.resumeHeaderLayout(C)}if(A.resizer){A.resizer.enable()}A.callParent(arguments)},maximize:function(B){var E=this,H=E.header,F=E.tools,D=E.width,A=E.height,C,G;if(!E.maximized){E.expand(false);if(!E.hasSavedRestore){C=E.restoreSize={width:D?D:null,height:A?A:null};E.restorePos=E.getPosition()}if(H){H.suspendLayouts();if(F.maximize){F.maximize.setType("restore")}if(E.collapseTool){E.collapseTool.hide();G=true}E.resumeHeaderLayout(G)}E.el.disableShadow();if(E.dd){E.dd.disable();if(H){H.removeCls(H.indicateDragCls)}}if(E.resizer){E.resizer.disable()}E.el.addCls(Ext.baseCSSPrefix+"window-maximized");E.container.addCls(Ext.baseCSSPrefix+"window-maximized-ct");E.syncMonitorWindowResize();E.fitContainer(B=(B||!!E.animateTarget)?{callback:function(){E.maximized=true;E.fireEvent("maximize",E)}}:null);if(!B){E.maximized=true;E.fireEvent("maximize",E)}}return E},restore:function(B){var C=this,D=C.tools,F=C.header,A=C.restoreSize,E;if(C.maximized){C.hasSavedRestore=null;C.removeCls(Ext.baseCSSPrefix+"window-maximized");if(F){F.suspendLayouts();if(D.maximize){D.maximize.setType("maximize")}if(C.collapseTool){C.collapseTool.show();E=true}C.resumeHeaderLayout(E)}A.x=C.restorePos[0];A.y=C.restorePos[1];C.setBox(A,B=(B||!!C.animateTarget)?{callback:function(){C.el.enableShadow(null,true);C.maximized=false;C.fireEvent("restore",C)}}:null);C.restorePos=C.restoreSize=null;if(C.dd){C.dd.enable();if(F){F.addCls(F.indicateDragCls)}}if(C.resizer){C.resizer.enable()}C.container.removeCls(Ext.baseCSSPrefix+"window-maximized-ct");C.syncMonitorWindowResize();if(!B){C.el.enableShadow(null,true);C.maximized=false;C.fireEvent("restore",C)}}return C},syncMonitorWindowResize:function(){var B=this,C=B._monitoringResize,D=B.monitorResize||B.constrain||B.constrainHeader||B.maximized,A=B.hidden||B.destroying||B.destroyed;if(D&&!A){if(!C){Ext.on("resize",B.onWindowResize,B,{buffer:1});B._monitoringResize=true}}else{if(C){Ext.un("resize",B.onWindowResize,B);B._monitoringResize=false}}},toggleMaximize:function(){return this[this.maximized?"restore":"maximize"]()},createGhost:function(){var A=this.callParent(arguments);A.xtype="window";A.focusOnToFront=false;return A},getDefaultFocus:function(){var C=this,B,D=C.defaultFocus,A;if(D!==undefined){if(Ext.isNumber(D)){B=C.query("button")[D]}else{if(Ext.isString(D)){A=D;if(Ext.validIdRe.test(A)){B=C.down(Ext.makeIdSelector(A))}if(!B){B=C.down(A)}}else{if(D.focus){B=D}}}}return B},privates:{initDraggable:function(){this.initSimpleDraggable()},onHeaderClick:function(C,B){var A;if(C.el.contains(B.getTarget())){A=this.getDefaultFocus();if(A){A.focus()}}},initResizable:function(){this.callParent(arguments);if(this.maximized){this.resizer.disable()}}}})