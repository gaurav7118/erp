describe("Ext.grid.NavigationModel",function(){function I(P,Q){var O=A.getVisibleColumnManager().getColumns()[Q];expect(A.getNavigationModel().getPosition().isEqual(new Ext.grid.CellContext(O.getView()).setPosition(P,O))).toBe(true)}function M(P,O){return A.getView().getCellInclusive({row:P,column:O},true)}function F(Q,S,R,P,O,U){var T=M(S,R);jasmine.fireMouseEvent(T,Q,O,U,P)}function N(R,Q,P,O){var S=M(R,Q);jasmine.fireKeyEvent(S,P,O)}var B=Ext.define(null,{extend:"Ext.data.Model",fields:["field1","field2","field3","field4","field5","field6","field7","field8","field9","field10"]}),J,L;function D(O){K=new Ext.data.Store({model:B,data:O||[{field1:1,field2:2,field3:3,field4:4,field5:5,field6:6,field7:7,field8:8,field9:9,field10:10}]});return K}function H(O,Q,T,X,S){X=X||{};T=T||{};var R,V,U;if(!X.preventColumnCreate&&(!O||typeof O==="number")){var W=typeof O==="number"?O:10;O=[];for(R=1;R<=W;R++){O.push({dataIndex:"field"+R,text:"Field "+R,width:90,locked:S&&R===1})}}if(typeof Q==="number"){V=Q;Q=[];for(R=0;R<V;R++){U={id:"rec"+R};for(var P=0;P<O.length;P++){U[O[P].dataIndex]=(R+1)+", "+(P+1)}Q.push(U)}}if(!X.preventStoreCreate){D(Q)}A=new Ext.grid.Panel(Ext.apply({columns:O,store:K,width:600,height:400,border:false,viewConfig:Ext.apply({mouseOverOutBuffer:false,deferHighlight:false},T.viewConfig)},T));if(T.renderTo===undefined){A.render(Ext.getBody())}J=A.getView();L=A.getColumnManager().getColumns();C=J.getNavigationModel();G=J.getSelectionModel()}var E=Ext.view.Table.prototype,A,L,K,J,G,C;afterEach(function(){Ext.destroy(A);A=null;J=null;G=null});describe("Re-entering grid after sorting",function(){it("should scroll last focused row into view on sort",function(){H(null,500);var O=new Ext.grid.CellContext(J).setPosition(9,4);C.setPosition(9,4);waitsFor(function(){return C.lastFocused&&C.lastFocused.isEqual(O)});runs(function(){L[4].el.dom.focus();jasmine.fireKeyEvent(L[4].el,"keydown",Ext.event.Event.SPACE);expect(J.getEl().getRegion().contains(J.getCellByPosition(C.lastFocused).getRegion())).toBe(true);jasmine.fireKeyEvent(L[4].el,"keydown",Ext.event.Event.SPACE);expect(J.getEl().getRegion().contains(J.getCellByPosition(C.lastFocused).getRegion())).toBe(true)})})});describe("reacting to programmatic focus",function(){it("should set the position correctly",function(){H(null,500);var O=new Ext.grid.CellContext(J).setPosition(0,0),P;J.focus();waitsFor(function(){return J.getNavigationModel().getPosition().isEqual(O)&&Ext.Element.getActiveElement()===O.getCell(true)},"for position(0,0) to be focuised");runs(function(){O=new Ext.grid.CellContext(J).setPosition(2,2);P=O.getCell(true);P.focus()});waitsFor(function(){return J.getNavigationModel().getPosition().isEqual(O)&&Ext.Element.getActiveElement()===P},"for cell (2,2) to be focused")})});describe("navigation in a locking grid",function(){it("should wrap and navigate from side to side seamlessly",function(){H(4,100,null,null,true);C.setPosition(new Ext.grid.CellContext(A.lockedGrid.view).setPosition(0,0));I(0,0);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(0,1);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(0,2);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(0,3);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(1,0);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(1,1);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(1,2);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(1,3);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(2,0);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(2,1);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(2,2);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(2,3);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(2,2);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(2,1);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(2,0);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(1,3);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(1,2);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(1,1);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(1,0);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(0,3);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(0,2);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(0,1);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(0,0)})});describe("navigation in a non-locking grid",function(){it("should wrap and navigate correctly",function(){H(4,100);C.setPosition(new Ext.grid.CellContext(A.view).setPosition(0,0));I(0,0);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(0,1);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(0,2);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(0,3);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(1,0);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(1,1);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(1,2);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(1,3);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(2,0);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(2,1);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(2,2);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.RIGHT);I(2,3);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(2,2);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(2,1);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(2,0);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(1,3);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(1,2);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(1,1);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(1,0);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(0,3);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(0,2);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(0,1);jasmine.fireKeyEvent(C.cell,"keydown",Ext.event.Event.LEFT);I(0,0)})});describe("With widget column",function(){var S=Ext.define(null,{extend:"Ext.data.Model",idProperty:"peopleId",fields:[{name:"name",type:"string"},{name:"age",type:"int"},{name:"location",type:"string"}]}),P,R,Q,O,U;function T(W,V){P=Ext.create("Ext.data.Store",Ext.apply({model:S,data:[{name:"Jimmy",age:22,location:"United States"},{name:"Sally",age:25,location:"England"},{name:"Billy",age:26,location:"Mexico"}]},W));R=Ext.create("Ext.grid.Panel",Ext.apply({itemId:"peopleGrid",width:400,height:200,margin:20,frame:true,title:"People",renderTo:Ext.getBody(),store:P,selModel:"cellmodel",columns:[{header:"Name",flex:1,dataIndex:"name"},{id:"locId",text:"Location",width:160,dataIndex:"location",xtype:"widgetcolumn",stopSelection:false,widget:{xtype:"button",itemId:"projButton",listeners:{click:function(X){U=R.getSelectionModel().getPosition()}}}},{xtype:"widgetcolumn",header:"Age",width:80,dataIndex:"age",stopSelection:true,widget:{xtype:"numberfield"}}]},V));Q=R.getNavigationModel();O=R.down("widgetcolumn")}beforeEach(function(){T()});afterEach(function(){R.destroy()});it("should select when clicking a widget is stopSelection is false",function(){var V=O.getWidget(P.getAt(0));jasmine.fireMouseEvent(V.el,"click");waitsFor(function(){return !!U})})})})