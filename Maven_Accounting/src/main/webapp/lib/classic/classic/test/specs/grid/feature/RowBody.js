describe("Ext.grid.feature.RowBody",function(){var B=[["3m Co",71.72,0.02,0.03,"9/1 12:00am","Manufacturing"],["Alcoa Inc",29.01,0.42,1.47,"9/1 12:00am","Manufacturing"],["Altria Group Inc",83.81,0.28,0.34,"9/1 12:00am","Manufacturing"],["American Express Company",52.55,0.01,0.02,"9/1 12:00am","Finance"],["American International Group, Inc.",64.13,0.31,0.49,"9/1 12:00am","Services"],["AT&T Inc.",31.61,-0.48,-1.54,"9/1 12:00am","Services"],["Boeing Co.",75.43,0.53,0.71,"9/1 12:00am","Manufacturing"],["Caterpillar Inc.",67.27,0.92,1.39,"9/1 12:00am","Services"],["Citigroup, Inc.",49.37,0.02,0.04,"9/1 12:00am","Finance"],["E.I. du Pont de Nemours and Company",40.48,0.51,1.28,"9/1 12:00am","Manufacturing"],["Exxon Mobil Corp",68.1,-0.43,-0.64,"9/1 12:00am","Manufacturing"],["General Electric Company",34.14,-0.08,-0.23,"9/1 12:00am","Manufacturing"],["General Motors Corporation",30.27,1.09,3.74,"9/1 12:00am","Automotive"],["Hewlett-Packard Co.",36.53,-0.03,-0.08,"9/1 12:00am","Computer"],["Honeywell Intl Inc",38.77,0.05,0.13,"9/1 12:00am","Manufacturing"],["Intel Corporation",19.88,0.31,1.58,"9/1 12:00am","Computer"],["International Business Machines",81.41,0.44,0.54,"9/1 12:00am","Computer"],["Johnson & Johnson",64.72,0.06,0.09,"9/1 12:00am","Medical"],["JP Morgan & Chase & Co",45.73,0.07,0.15,"9/1 12:00am","Finance"],["McDonald's Corporation",36.76,0.86,2.4,"9/1 12:00am","Food"],["Merck & Co., Inc.",40.96,0.41,1.01,"9/1 12:00am","Medical"],["Microsoft Corporation",25.84,0.14,0.54,"9/1 12:00am","Computer"],["Pfizer Inc",27.96,0.4,1.45,"9/1 12:00am","Services","Medical"],["The Coca-Cola Company",45.07,0.26,0.58,"9/1 12:00am","Food"],["The Home Depot, Inc.",34.64,0.35,1.02,"9/1 12:00am","Retail"],["The Procter & Gamble Company",61.91,0.01,0.02,"9/1 12:00am","Manufacturing"],["United Technologies Corporation",63.26,0.55,0.88,"9/1 12:00am","Computer"],["Verizon Communications",35.57,0.39,1.11,"9/1 12:00am","Services"],["Wal-Mart Stores, Inc.",45.45,0.73,1.63,"9/1 12:00am","Retail"],["Walt Disney Company (The) (Holding Company)",29.89,0.24,0.81,"9/1 12:00am","Services"]],A,G,H,D,C,I;function F(J,M,L,K){Ext.define("spec.RowBodyCompany",{extend:"Ext.data.Model",fields:[{name:"company"},{name:"price",type:"float"},{name:"change",type:"float"},{name:"pctChange",type:"float"},{name:"lastChange",type:"date",dateFormat:"n/j h:ia"},{name:"industry"}]});H=new Ext.data.Store({model:"spec.RowBodyCompany",data:B,groupField:"company",autoDestroy:true});D=new Ext.grid.feature.RowBody(Ext.apply({ftype:"rowbody",getAdditionalData:function(O,R,N,P){var Q=this.view.headerCt.getColumnCount();return{rowBody:'<div style="padding: 1em">'+N.get("company")+"</div>",rowBodyCls:"my-body-class",rowBodyColspan:Q}}},M));L=L||[{text:"Company",locked:K,flex:K?undefined:1,width:K?200:undefined,dataIndex:"company"},{text:"Price",renderer:Ext.util.Format.usMoney,dataIndex:"price"},{text:"Change",dataIndex:"change"},{text:"% Change",dataIndex:"pctChange"},{text:"Last Updated",renderer:Ext.util.Format.dateRenderer("m/d/Y"),dataIndex:"lastChange"}];A=new Ext.grid.Panel(Ext.apply({store:H,columns:L,width:600,height:300,features:D,renderTo:Ext.getBody()},J));G=A.view}function E(K,J){H=new Ext.data.TreeStore({root:{expanded:true,children:[{text:"detention",leaf:true},{text:"homework",expanded:true,children:[{text:"book report",leaf:true},{text:"algebra",leaf:true}]},{text:"buy lottery tickets",leaf:true}]}});D=new Ext.grid.feature.RowBody(Ext.apply({getAdditionalData:function(N,L,M,Q){var O=this.view.headerCt,P=O.getColumnCount();return{rowBody:">>>>>>>>>>>>>>>>>>>>> with a rowbody",rowBodyCls:"ok",rowBodyColspan:P}}},J));I=new Ext.tree.Panel(Ext.apply({width:200,height:150,store:H,features:D,rootVisible:false,renderTo:Ext.getBody()},K))}afterEach(function(){A=G=H=D=C=I=Ext.destroy(A,I);Ext.undefine("spec.RowBodyCompany");Ext.data.Model.schema.clear()});describe("grids",function(){describe("init",function(){describe("rendering",function(){var K,L,J;afterEach(function(){K=L=J=null});it("should render a rowbody row for each wrapped row item",function(){F();K=G.body;J=K.query(G.itemSelector).length;L=K.query(".my-body-class").length;expect(L).toBe(J)});describe("when combined with the grouping feature",function(){var M;beforeEach(function(){F({features:[{ftype:"grouping"},{ftype:"rowbody",getAdditionalData:function(O,R,N,P){var Q=this.view.headerCt.getColumnCount();return{rowBody:'<div style="padding: 1em">'+N.get("company")+"</div>",rowBodyCls:"my-body-class",rowBodyColspan:Q}}}]});K=G.body;M=G.summaryFeature.ctCls});afterEach(function(){M=null});it("should render a colgroup for each grouping container to properly size the columns",function(){var O=K.query("colgroup").length,N=K.query("."+M).length;expect(O).toBe(N)});it("should render a rowbody row for each wrapped row item",function(){var O=G.body,N=O.query(G.itemSelector).length,P=O.query(".my-body-class").length;expect(P).toBe(N)})});xdescribe("when combined with the rowexpander plugin",function(){beforeEach(function(){F({plugins:[{ptype:"rowexpander",rowBodyTpl:new Ext.XTemplate("<p><b>Company:</b> {company}</p>","<p><b>Price:</b> {price}</p>")}]});K=G.body});it("should render a rowbody row for each wrapped row item",function(){var M=K.query(G.itemSelector).length,N=K.query(".my-body-class").length;expect(N).toBe(M)})})})});it("should be a RowBody feature",function(){F();expect(D instanceof Ext.grid.feature.RowBody).toBe(true)});describe("row over, focus and selection",function(){var M,J,L,K;beforeEach(function(){F();L=A.getVisibleColumnManager().getColumns();K=L[0].getX()+L[0].getWidth()/2;M=A.view.all.item(1);J=M.down("div.x-grid-rowbody",true)});afterEach(function(){J=null});it("should add the row over class to the entire wrapped row when hovering over the row body",function(){jasmine.fireMouseEvent(J,"mouseover");expect(M.hasCls("x-grid-item-over")).toBe(true)});it("should focus the closest cell when clicking the row body",function(){jasmine.fireMouseEvent(J,"click",K);expect(A.view.getCell(1,L[0]).hasCls("x-grid-item-focused")).toBe(true)});it("should select the entire wrapped row when clicking the row body",function(){jasmine.fireMouseEvent(J,"click",K);expect(M.hasCls("x-grid-item-selected")).toBe(true)});it("should capture the selection in the selection model",function(){var N;jasmine.fireMouseEvent(J,"click",K);N=A.selModel;expect(N.selected.length).toBe(1);expect(N.getSelection()[0]===H.getAt(1)).toBe(true)})});describe("rowbody events",function(){var J=false,K;beforeEach(function(){F({viewConfig:{listeners:{rowbodyclick:function(){J=true},rowbodydblclick:function(){J=true},rowbodycontextmenu:function(){J=true}}}});K=A.view.all.item(1).down("tr.x-grid-rowbody-tr",true)});afterEach(function(){J=false;K=null});it("should fire the rowbodyclick event",function(){jasmine.fireMouseEvent(K,"click");expect(J).toBe(true)});it("should fire the rowbodydblclick event",function(){jasmine.fireMouseEvent(K,"dblclick");expect(J).toBe(true)});it("should fire the rowbodycontextmenu event",function(){jasmine.fireMouseEvent(K,"contextmenu");expect(J).toBe(true)})});describe("rowBefore",function(){it("should put the expander row before the data row",function(){F(null,{bodyBefore:true});var L=A.view.all.item(0,true),K=L.tBodies[0].childNodes[0],J=L.tBodies[0].childNodes[1];expect(Ext.fly(K).hasCls("x-grid-rowbody-tr")).toBeTruthy();expect(Ext.fly(K).hasCls("my-body-class")).toBeTruthy();expect(K.childNodes.length).toBe(1);expect(J.childNodes.length).toBe(5);expect(Ext.fly(J).hasCls("x-grid-row")).toBeTruthy()});it("should put the expander row before the data row when there's a locked column",function(){F(null,{bodyBefore:true},null,true);var M=A.lockedGrid.view.all.item(0,true),O=M.tBodies[0].childNodes[0],N=M.tBodies[0].childNodes[1],K=A.normalGrid.view.all.item(0,true),L=K.tBodies[0].childNodes[0],J=K.tBodies[0].childNodes[1];expect(Ext.fly(O).hasCls("x-grid-rowbody-tr")).toBeTruthy();expect(Ext.fly(O).hasCls("my-body-class")).toBeTruthy();expect(O.childNodes.length).toBe(1);expect(N.childNodes.length).toBe(1);expect(Ext.fly(N).hasCls("x-grid-row")).toBeTruthy();expect(Ext.fly(L).hasCls("x-grid-rowbody-tr")).toBeTruthy();expect(Ext.fly(L).hasCls("my-body-class")).toBeTruthy();expect(L.childNodes.length).toBe(1);expect(J.childNodes.length).toBe(4);expect(Ext.fly(J).hasCls("x-grid-row")).toBeTruthy()})})});describe("trees",function(){describe("collapsing a node",function(){var K,J;afterEach(function(){K=J=null});it("should not remove the node from the treeview",function(){E();K=I.view;J=K.store.getAt(1);J.collapse();expect(K.getNode(J)).not.toBe(null)});it("should not remove the node from the treeview (animation off)",function(){E({animate:false});K=I.view;J=K.store.getAt(1);J.collapse();expect(K.getNode(J)).not.toBe(null)})})})})