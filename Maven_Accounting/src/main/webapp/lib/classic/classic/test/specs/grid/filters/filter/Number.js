describe("Ext.grid.filters.filter.Number",function(){var A,I,F,K,C,B,E,L=true,D=Ext.data.ProxyStore.prototype.load,H;function G(O,N,M){L=false;I=new Ext.data.Store(Ext.apply({fields:["name","email","phone"],data:[{name:"Lisa",email:"lisa@simpsons.com",phone:"555-111-1224",age:14},{name:"Bart",email:"bart@simpsons.com",phone:"555-222-1234",age:12},{name:"Homer",email:"homer@simpsons.com",phone:"555-222-1244",age:44},{name:"Marge",email:"marge@simpsons.com",phone:"555-222-1254",age:42}]},N));A=new Ext.grid.Panel(Ext.apply({title:"Simpsons",store:I,autoLoad:true,columns:[{dataIndex:"name",width:100},{dataIndex:"email",width:100},{dataIndex:"phone",width:100,hidden:true},{dataIndex:"age",filter:Ext.apply({type:"number",updateBuffer:0},O),width:100}],viewConfig:{mouseOverOutBuffer:false,deferHighlight:false},plugins:[{ptype:"gridfilters"}],height:200,width:400,renderTo:Ext.getBody()},M));K=A.columnManager.getHeaderByDataIndex("age").filter;F=A.filters;L=true;I.flushLoad()}function J(){var M=A.getColumnManager().getLast();C=A.headerCt;C.showMenuBy(null,M.triggerEl.dom,M);E=C.menu.items.last();E.activated=true;E.expandMenu(null,0);B=E.menu}beforeEach(function(){H=Ext.data.ProxyStore.prototype.load=function(){D.apply(this,arguments);if(L){this.flushLoad.apply(this,arguments)}return this}});afterEach(function(){Ext.data.ProxyStore.prototype.load=D;I.destroy();A=I=F=K=B=C=E=Ext.destroy(A)});describe("init",function(){it("should add a menu separator to the menu",function(){G();J();expect(B.down("menuseparator")).not.toBeNull()})});describe("setValue",function(){it("should filter the store regardless of whether the menu has been created",function(){G();expect(I.data.length).toBe(4);K.setValue({eq:44});expect(I.data.length).toBe(1)});describe("0",function(){beforeEach(function(){G();K.createMenu()});it("should accept 0 for lt",function(){K.setValue({lt:0});var M=I.getFilters().first();expect(M.getOperator()).toBe("lt");expect(M.getValue()).toBe(0)});it("should accept 0 for eq",function(){K.setValue({eq:0});var M=I.getFilters().first();expect(M.getOperator()).toBe("eq");expect(M.getValue()).toBe(0)});it("should accept 0 for gt",function(){K.setValue({gt:0});var M=I.getFilters().first();expect(M.getOperator()).toBe("gt");expect(M.getValue()).toBe(0)})})});describe("events",function(){describe("keyup",function(){it("should hide the menu",function(){var M;G();J();M=K.fields.eq;M.setValue(5);jasmine.fireKeyEvent(M.inputEl,"keyup",13);waitsFor(function(){return B.hidden});runs(function(){expect(B.hidden).toBe(true)})})})});describe("updateBuffer",function(){var P,N,O,M;beforeEach(function(){spyOn(Ext.grid.filters.filter.Number.prototype,"setValue").andCallFake(function(){M=new Date().getTime()})});afterEach(function(){P=N=O=M=null});it("should default to 500ms",function(){N=500;expect(N).toBe(Ext.grid.filters.filter.Base.prototype.config.updateBuffer);G({updateBuffer:N});J();P=K.fields.eq;O=new Date().getTime();jasmine.fireKeyEvent(P.inputEl,"keyup",83);waitsFor(function(){return M});runs(function(){expect(M-O).toBeAtLeast(N-100)})});it("should honor a configured updateBuffer",function(){N=250;G({updateBuffer:N});expect(K.getUpdateBuffer()).toBe(N);J();P=K.fields.eq;O=new Date().getTime();jasmine.fireKeyEvent(P.inputEl,"keyup",83);waitsFor(function(){return M});runs(function(){var Q=(M-O);expect(M-O).toBeAtLeast(N-100);expect(Q).toBeLE(Ext.grid.filters.filter.Base.prototype.config.updateBuffer)})})});describe("showing the menu",function(){function M(N){it("should not add a filter to the store when shown",function(){G({active:N,value:[{on:new Date()}]});spyOn(K,"addStoreFilter");J();expect(K.addStoreFilter).not.toHaveBeenCalled()})}M(true);M(false)});describe("clearing filters",function(){it('should not recheck the root menu item ("Filters") when showing menu after clearing filters',function(){G();J();K.setValue({eq:44});expect(E.checked).toBe(true);C.getMenu().hide();F.clearFilters();J();expect(E.checked).toBe(false)})});describe("entering invalid text",function(){it("should not add a store filter and activate the filter",function(){var M,N;G();J();N=A.getStore().getFilters();M=K.fields.lt;expect(N.length).toBe(0);expect(K.active).toBe(false);M.setRawValue("invalid text");jasmine.fireKeyEvent(M.inputEl.dom,"keyup",86,null,true);expect(N.length).toBe(0);expect(K.active).toBe(false)})});describe("the UI and the active state",function(){function M(N){describe("when "+N,function(){var O=!N?"not":"";it("should "+O+" check the Filters menu item",function(){G({active:N});J();expect(E.checked).toBe(N)});it("should set any field values that map to a configured value",function(){var P;G({active:N,value:{gt:10,lt:20}});J();P=K.fields;expect(P.gt.inputEl.getValue()).toBe("10");expect(P.lt.inputEl.getValue()).toBe("20");expect(P.eq.inputEl.getValue()).toBe(Ext.supports.Placeholder?"":"Enter Number...")});describe("when a store filter is created",function(){it("should not update the filter collection twice",function(){var P=0;G({active:N},{listeners:{filterchange:function(){++P}}});J();K.setValue({eq:5});expect(P).toBe(1)})})})}M(true);M(false)});describe("activate and deactivate",function(){describe("activating",function(){describe("when activating after instantiation",function(){function M(N){it("should work for both truthy and falsey values",function(){var O;G({active:false,value:{eq:N}});O=I.data.length;J();expect(I.data.length).toBe(O);K.setActive(true);expect(I.data.length).toBe(0)})}M(0);M(5)});describe("when toggling",function(){function M(N){it("should work for both truthy and falsey values",function(){G();J();K.setValue({eq:N});K.setActive(false);K.setActive(true);expect(I.data.length).toBe(0)})}M(0);M(5)})});describe("deactivating",function(){describe("when deactivating after instantiation",function(){function M(N){it("should work for both truthy and falsey values",function(){var O;G({value:{eq:N}});J();expect(I.data.length).toBe(0);K.setActive(false);expect(I.data.length>0).toBe(true)})}M(0);M(5)});describe("when toggling",function(){function M(N){it("should work for both truthy and falsey values",function(){var O;G();O=I.data.length;J();K.setValue({eq:N});expect(I.data.length).toBe(0);K.setActive(false);expect(I.data.length).toBe(O)})}M(0);M(5)})})})})