describe("Ext.grid.filters.filter.String",function(){var A,I,F,J,C,K=true,D=Ext.data.ProxyStore.prototype.load,H;function G(N,M,L){K=false;I=new Ext.data.Store(Ext.apply({fields:["name","email","phone"],data:[{name:"Lisa",email:"lisa@simpsons.com",phone:"555-111-1224"},{name:"Bart",email:"bart@simpsons.com",phone:"555-222-1234"},{name:"Homer",email:"homer@simpsons.com",phone:"555-222-1244"},{name:"Marge",email:"marge@simpsons.com",phone:"555-222-1254"}]},M));A=new Ext.grid.Panel(Ext.apply({title:"Simpsons",store:I,autoLoad:true,columns:[{dataIndex:"name",filter:Ext.apply({type:"string"},N),width:100},{dataIndex:"email",width:100},{dataIndex:"phone",width:100,hidden:true}],viewConfig:{mouseOverOutBuffer:false,deferHighlight:false},plugins:[{ptype:"gridfilters"}],height:200,width:400,renderTo:Ext.getBody()},L));F=A.filters;J=A.headerCt.columnManager.getHeaderByDataIndex("name").filter;K=true;I.flushLoad()}function E(){var M=A.headerCt,L,N=A.columnManager.getFirst();M.showMenuBy(null,N.triggerEl.dom,N);L=M.menu.items.last();L.activated=true;L.expandMenu(null,0);C=L.menu}beforeEach(function(){H=Ext.data.ProxyStore.prototype.load=function(){D.apply(this,arguments);if(K){this.flushLoad.apply(this,arguments)}return this}});function B(){Ext.data.ProxyStore.prototype.load=D;I.destroy();A=I=F=J=C=Ext.destroy(A)}afterEach(B);describe("events",function(){describe("keyup",function(){it("should hide the menu",function(){var L;G();E();L=J.inputItem;L.setValue("Molly");jasmine.fireKeyEvent(L.inputEl,"keyup",13);waitsFor(function(){return C.hidden});runs(function(){expect(C.hidden).toBe(true)})})})});describe("updateBuffer",function(){var N,O,L,P;function M(Q){expect(J.updateBuffer).toBe(Q);E()}beforeEach(function(){spyOn(Ext.grid.filters.filter.String.prototype,"setValue").andCallFake(function(){L=new Date().getTime()})});afterEach(function(){N=O=L=P=null});it("should default to 500ms",function(){N=500;G();M(N);P=J.inputItem;O=new Date().getTime();jasmine.fireKeyEvent(P.inputEl,"keyup",83);waitsFor(function(){return L});runs(function(){expect(L-O).toBeAtLeast(N-100)})});it("should honor a configured updateBuffer",function(){N=250;G({updateBuffer:N});M(N);P=J.inputItem;O=new Date().getTime();jasmine.fireKeyEvent(P.inputEl,"keyup",83);waitsFor(function(){return L});runs(function(){var Q=(L-O);expect(Q).toBeAtLeast(N-100);expect(Q).toBeLE(Ext.grid.filters.filter.Base.prototype.config.updateBuffer)})})});describe("removing store filters, single filter",function(){beforeEach(function(){G();spyOn(J,"onFilterRemove");I.getFilters().add({property:"name",value:"Camp Hill"})});it("should not throw if removing filters directly on the bound store",function(){expect(function(){I.clearFilter()}).not.toThrow()});it("should not call through to the delegated handler if the store filter was not generated by the class",function(){I.clearFilter();expect(J.onFilterRemove).not.toHaveBeenCalled()});it("should not call through to the delegated handler when the store filter is replaced",function(){F.addFilter({dataIndex:"name",value:"Princeton"});I.clearFilter();expect(J.onFilterRemove).not.toHaveBeenCalled()});it("should call through to the delegated handler when the store filter was generated by the class (when menu has been created)",function(){B();G({value:"Homer"});E();spyOn(J,"onFilterRemove");J.addStoreFilter({id:"x-gridfilter-name",property:"name",operator:"like",value:"Lily"});expect(J.onFilterRemove).toHaveBeenCalled()})});describe("adding a column filter, single filter",function(){describe("replacing an existing column filter",function(){it("should not throw",function(){G();expect(function(){F.addFilter({type:"string",value:"ben germane"})}).not.toThrow()});it("should replace the existing store filter",function(){var M,L,N;G({value:"Marge"});N=J.getBaseIdPrefix();M=I.getFilters();L=M.getAt(0);expect(M.length).toBe(1);expect(L.getId()).toBe(N);expect(L.getValue()).toBe("Marge");F.addFilter({type:"string",dataIndex:"name",value:"attaboy"});L=M.getAt(0);expect(M.length).toBe(1);expect(L.getId()).toBe(N);expect(L.getValue()).toBe("attaboy")})})});describe("showing the menu",function(){function L(M){it("should not add a filter to the store when shown",function(){G({active:M,updateBuffer:0,value:"Asbury Park"});spyOn(J,"addStoreFilter");E();expect(J.addStoreFilter).not.toHaveBeenCalled()})}L(true);L(false)})})