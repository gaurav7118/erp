describe("grid-events",function(){function A(B){describe(B?"with buffered rendering":"without buffered rendering",function(){var D,N,P,J,M,O,F=Ext.define(null,{extend:"Ext.data.Model",fields:["field1","field2","field3","field4","field5","field6","field7","field8","field9","field10","group"]});function G(V,X,W,U,T,Z){var Y=Q(X,W);jasmine.fireMouseEvent(Y,V,T,Z,U)}function S(U,W,V,T){var X=Q(W,V);jasmine.fireKeyEvent(X,U,T)}function R(T){return P.getAt(T)}function Q(U,T){return D.getView().getCellInclusive({row:U,column:T},true)}function I(U){var T=Ext.fly(U).up("table");return Ext.Array.indexOf(T.dom.rows,U)}function C(U){var T=Ext.fly(U).up("tr");return Ext.Array.indexOf(T.dom.cells,U)}function H(){return false}function K(){O=true}function E(){M=Array.prototype.slice.call(arguments,0,arguments.length)}function L(W,X,T){var Y=[],U=[],V;for(V=1;V<=10;++V){U.push({name:"F"+V,dataIndex:"field"+V})}for(V=1;V<=10;++V){Y.push({field1:V+"."+1,field2:V+"."+2,field3:V+"."+3,field4:V+"."+4,field5:V+"."+5,field6:V+"."+6,field7:V+"."+7,field8:V+"."+8,field9:V+"."+9,field10:V+"."+10,group:Math.floor((V+4)/5)})}P={model:F,data:Y};if(X){P.groupField="group"}P=new Ext.data.Store(P);D=Ext.apply({columns:W||U,store:P,width:1000,height:500,bufferedRenderer:B,viewConfig:{mouseOverOutBuffer:0},renderTo:Ext.getBody()},T||{});if(X){D.features={ftype:"groupingsummary"}}D=new Ext.grid.Panel(D);N=D.getView();J=N.getSelectionModel()}afterEach(function(){Ext.destroy(D,P);D=P=N=M=null;O=false;Ext.data.Model.schema.clear()});describe("all grid events",function(){describe("buffered",function(){beforeEach(function(){L(null,null,{viewConfig:{mouseOverOutBuffer:1}})});describe("item events",function(){function T(U,V){expect(M[0]).toBe(N);expect(M[1]).toBe(R(U));expect(M[2]).toBe(N.getNode(U));expect(M[3]).toBe(U);expect(M[4].type).toBe(V)}describe("itemmouseenter",function(){it("should fire the beforeitemmouseenter event",function(){D.on("beforeitemmouseenter",E);G("mouseover",1,3);waits(1);runs(function(){T(1,"mouseover")})});it("should fire the itemmouseenter event",function(){D.on("itemmouseenter",E);G("mouseover",1,3);waits(1);runs(function(){T(1,"mouseover")})});it("should not trigger itemmouseenter if beforeitemmouseenter is vetoed",function(){D.on({beforeitemmouseenter:H,itemmouseenter:K});G("mouseover",1,3);expect(O).toBe(false)})});describe("itemmouseleave",function(){it("should fire the beforeitemmouseleave event",function(){D.on("beforeitemmouseleave",E);G("mouseover",1,3);G("mouseout",1,3);waits(1);runs(function(){T(1,"mouseout")})});it("should fire the itemmouseleave event",function(){D.on("itemmouseleave",E);G("mouseover",1,3);G("mouseout",1,3);waits(1);runs(function(){T(1,"mouseout")})});it("should not trigger itemmouseleave if beforeitemmouseleave is vetoed",function(){D.on({beforeitemmouseleave:H,itemmouseleave:K});G("mouseover",1,3);G("mouseout",1,3);expect(O).toBe(false)})})});describe("container events",function(){function T(X,W){jasmine.fireMouseEvent(N.el.dom,X,5,495,W)}function V(X,W){jasmine.fireKeyEvent(N.el.dom,X,W)}function U(W){expect(M[0]).toBe(N);expect(M[1].type).toBe(W)}describe("containermouseout",function(){it("should fire the beforecontainermouseout event",function(){D.on("beforecontainermouseout",E);T("mouseout");waits(1);runs(function(){U("mouseout")})});it("should fire the containermouseout event",function(){D.on("containermouseout",E);T("mouseout");waits(1);runs(function(){U("mouseout")})});it("should not trigger containermouseout if beforecontainermouseout is vetoed",function(){D.on({beforecontainermouseout:H,containermouseout:K});T("mouseout");waits(1);runs(function(){expect(O).toBe(false)})})});describe("containermouseover",function(){it("should fire the beforecontainermouseover event",function(){D.on("beforecontainermouseover",E);T("mouseover");waits(1);runs(function(){U("mouseover")})});it("should fire the containermouseover event",function(){D.on("containermouseover",E);T("mouseover");waits(1);runs(function(){U("mouseover")})});it("should not trigger containermouseover if beforecontainermouseover is vetoed",function(){D.on({beforecontainermouseover:H,containermouseover:K});T("mouseover");waits(1);runs(function(){expect(O).toBe(false)})})})})});describe("not buffered",function(){beforeEach(function(){L()});describe("item events",function(){function T(U,V){expect(M[0]).toBe(N);expect(M[1]).toBe(R(U));expect(M[2]).toBe(N.getNode(U));expect(M[3]).toBe(U);expect(M[4].type).toBe(V)}describe("itemclick",function(){it("should fire the beforeitemclick event",function(){D.on("beforeitemclick",E);G("click",2,4);T(2,"click")});it("should fire the itemclick event",function(){D.on("itemclick",E);G("click",2,4);T(2,"click")});it("should not trigger itemclick if beforeitemclick is vetoed",function(){D.on({beforeitemclick:H,itemclick:K});G("click",2,4);expect(O).toBe(false)})});describe("itemcontextmenu",function(){it("should fire the beforeitemcontextmenu event",function(){D.on("beforeitemcontextmenu",E);G("contextmenu",2,4,2);T(2,"contextmenu")});it("should fire the itemcontextmenu event",function(){D.on("itemcontextmenu",E);G("contextmenu",2,4,2);T(2,"contextmenu")});it("should not trigger itemcontextmenu if beforeitemcontextmenu is vetoed",function(){D.on({beforeitemcontextmenu:H,itemcontextmenu:K});G("contextmenu",2,4,2);expect(O).toBe(false)})});describe("itemdblclick",function(){it("should fire the beforeitemdblclick event",function(){D.on("beforeitemdblclick",E);G("dblclick",2,4);T(2,"dblclick")});it("should fire the itemdblclick event",function(){D.on("itemdblclick",E);G("dblclick",2,4);T(2,"dblclick")});it("should not trigger itemdblclick if beforeitemdblclick is vetoed",function(){D.on({beforeitemdblclick:H,itemdblclick:K});G("dblclick",2,4);expect(O).toBe(false)})});describe("itemkeydown",function(){it("should fire the beforeitemkeydown event",function(){D.on("beforeitemkeydown",E);S("keydown",1,3);T(1,"keydown")});it("should fire the itemkeydown event",function(){D.on("itemkeydown",E);S("keydown",1,3);T(1,"keydown")});it("should not trigger itemkeydown if beforeitemkeydown is vetoed",function(){D.on({beforeitemkeydown:H,itemkeydown:K});S("keydown",1,3);expect(O).toBe(false)})});describe("itemmousedown",function(){it("should fire the beforeitemmousedown event",function(){D.on("beforeitemmousedown",E);G("mousedown",1,3);T(1,"mousedown")});it("should fire the itemmousedown event",function(){D.on("itemmousedown",E);G("mousedown",1,3);T(1,"mousedown")});it("should not trigger itemmousedown if beforeitemmousedown is vetoed",function(){D.on({beforeitemmousedown:H,itemmousedown:K});G("mousedown",1,3);expect(O).toBe(false)})});describe("itemmouseenter",function(){it("should fire the beforeitemmouseenter event",function(){D.on("beforeitemmouseenter",E);G("mouseover",1,3);T(1,"mouseover")});it("should fire the itemmouseenter event",function(){D.on("itemmouseenter",E);G("mouseover",1,3);T(1,"mouseover")});it("should not trigger itemmouseenter if beforeitemmouseenter is vetoed",function(){D.on({beforeitemmouseenter:H,itemmouseenter:K});G("mouseover",1,3);expect(O).toBe(false)})});describe("itemmouseleave",function(){it("should fire the beforeitemmouseleave event",function(){D.on("beforeitemmouseleave",E);G("mouseover",1,3);G("mouseout",1,3);T(1,"mouseout")});it("should fire the itemmouseleave event",function(){D.on("itemmouseleave",E);G("mouseover",1,3);G("mouseout",1,3);T(1,"mouseout")});it("should not trigger itemmouseleave if beforeitemmouseleave is vetoed",function(){D.on({beforeitemmouseleave:H,itemmouseleave:K});G("mouseover",1,3);G("mouseout",1,3);expect(O).toBe(false)})});describe("itemmouseup",function(){it("should fire the beforeitemmouseup event",function(){D.on("beforeitemmouseup",E);G("mouseup",1,3);T(1,"mouseup")});it("should fire the itemmouseup event",function(){D.on("itemmouseup",E);G("mouseup",1,3);T(1,"mouseup")});it("should not trigger itemmouseup if beforeitemmouseup is vetoed",function(){D.on({beforeitemmouseup:H,itemmouseup:K});G("mouseup",1,3);expect(O).toBe(false)})})});describe("cell events",function(){function T(X,V,W){var U=R(X);expect(M[0]).toBe(N);expect(M[1]).toBe(N.getCell(U,N.getHeaderAtIndex(V)).dom);expect(M[2]).toBe(V);expect(M[3]).toBe(U);expect(M[4]===N.getRow(X)).toBe(true);expect(M[5]).toBe(X);expect(M[6].type).toBe(W)}describe("cellclick",function(){it("should fire the beforecellclick event",function(){D.on("beforecellclick",E);G("click",3,6);T(3,6,"click")});it("should fire the cellclick event",function(){D.on("cellclick",E);G("click",3,6);T(3,6,"click")});it("should not trigger cellclick if beforecellclick is vetoed",function(){D.on({beforecellclick:H,cellclick:K});G("click",3,6);expect(O).toBe(false)})});describe("cellcontextmenu",function(){it("should fire the beforecellcontextmenu event",function(){D.on("beforecellcontextmenu",E);G("contextmenu",3,6);T(3,6,"contextmenu")});it("should fire the cellcontextmenu event",function(){D.on("cellcontextmenu",E);G("contextmenu",3,6);T(3,6,"contextmenu")});it("should not trigger cellcontextmenu if beforecellcontextmenu is vetoed",function(){D.on({beforecellcontextmenu:H,cellcontextmenu:K});G("contextmenu",3,6);expect(O).toBe(false)})});describe("celldblclick",function(){it("should fire the beforecelldblclick event",function(){D.on("beforecelldblclick",E);G("dblclick",3,6);T(3,6,"dblclick")});it("should fire the celldblclick event",function(){D.on("celldblclick",E);G("dblclick",3,6);T(3,6,"dblclick")});it("should not trigger celldblclick if beforecelldblclick is vetoed",function(){D.on({beforecelldblclick:H,celldblclick:K});G("dblclick",3,6);expect(O).toBe(false)})});describe("cellkeydown",function(){it("should fire the beforecellkeydown event",function(){D.on("beforecellkeydown",E);S("keydown",3,6);T(3,6,"keydown")});it("should fire the cellkeydown event",function(){D.on("cellkeydown",E);S("keydown",3,6);T(3,6,"keydown")});it("should not trigger cellkeydown if beforecellkeydown is vetoed",function(){D.on({beforecellkeydown:H,cellkeydown:K});S("keydown",3,6);expect(O).toBe(false)})});describe("cellmousedown",function(){it("should fire the beforecellmousedown event",function(){D.on("beforecellmousedown",E);G("mousedown",3,6);T(3,6,"mousedown")});it("should fire the cellmousedown event",function(){D.on("cellmousedown",E);G("mousedown",3,6);T(3,6,"mousedown")});it("should not trigger cellmousedown if beforecellmousedown is vetoed",function(){D.on({beforecellmousedown:H,cellmousedown:K});G("mousedown",3,6);expect(O).toBe(false)})});describe("cellmouseup",function(){it("should fire the beforecellmouseup event",function(){D.on("beforecellmouseup",E);G("mouseup",3,6);T(3,6,"mouseup")});it("should fire the cellmouseup event",function(){D.on("cellmouseup",E);G("mouseup",3,6);T(3,6,"mouseup")});it("should not trigger cellmouseup if beforecellmouseup is vetoed",function(){D.on({beforecellmouseup:H,cellmouseup:K});G("mouseup",3,6);expect(O).toBe(false)})})});describe("container events",function(){function T(X,W){jasmine.fireMouseEvent(N.el.dom,X,5,495,W)}function V(X,W){jasmine.fireKeyEvent(N.el.dom,X,W)}function U(W){expect(M[0]).toBe(N);expect(M[1].type).toBe(W)}describe("containerclick",function(){it("should fire the beforecontainerclick event",function(){D.on("beforecontainerclick",E);T("click");U("click")});it("should fire the containerclick event",function(){D.on("containerclick",E);T("click");U("click")});it("should not trigger containerclick if beforecontainerclick is vetoed",function(){D.on({beforecontainerclick:H,containerclick:K});T("click");expect(O).toBe(false)})});describe("containercontextmenu",function(){it("should fire the beforecontainercontextmenu event",function(){D.on("beforecontainercontextmenu",E);T("contextmenu",2);U("contextmenu")});it("should fire the containercontextmenu event",function(){D.on("containercontextmenu",E);T("contextmenu",2);U("contextmenu")});it("should not trigger containercontextmenu if beforecontainercontextmenu is vetoed",function(){D.on({beforecontainercontextmenu:H,containercontextmenu:K});T("contextmenu",2);expect(O).toBe(false)})});describe("containerdblclick",function(){it("should fire the beforecontainerdblclick event",function(){D.on("beforecontainerdblclick",E);T("dblclick");U("dblclick")});it("should fire the containerdblclick event",function(){D.on("containerdblclick",E);T("dblclick");U("dblclick")});it("should not trigger containerdblclick if beforecontainerdblclick is vetoed",function(){D.on({beforecontainerdblclick:H,containerdblclick:K});T("dblclick");expect(O).toBe(false)})});describe("containerkeydown",function(){it("should fire the beforecontainerkeydown event",function(){D.on("beforecontainerkeydown",E);V("keydown");U("keydown")});it("should fire the containerkeydown event",function(){D.on("containerkeydown",E);V("keydown");U("keydown")});it("should not trigger containerkeydown if beforecontainerkeydown is vetoed",function(){D.on({beforecontainerkeydown:H,containerkeydown:K});V("keydown");expect(O).toBe(false)})});describe("containermousedown",function(){it("should fire the beforecontainermousedown event",function(){D.on("beforecontainermousedown",E);T("mousedown");U("mousedown")});it("should fire the containermousedown event",function(){D.on("containermousedown",E);T("mousedown");U("mousedown")});it("should not trigger containermousedown if beforecontainermousedown is vetoed",function(){D.on({beforecontainermousedown:H,containermousedown:K});T("mousedown");expect(O).toBe(false)})});describe("containermouseout",function(){it("should fire the beforecontainermouseout event",function(){D.on("beforecontainermouseout",E);T("mouseout");U("mouseout")});it("should fire the containermouseout event",function(){D.on("containermouseout",E);T("mouseout");U("mouseout")});it("should not trigger containermouseout if beforecontainermouseout is vetoed",function(){D.on({beforecontainermouseout:H,containermouseout:K});T("mouseout");expect(O).toBe(false)})});describe("containermouseover",function(){it("should fire the beforecontainermouseover event",function(){D.on("beforecontainermouseover",E);T("mouseover");U("mouseover")});it("should fire the containermouseover event",function(){D.on("containermouseover",E);T("mouseover");U("mouseover")});it("should not trigger containermouseover if beforecontainermouseover is vetoed",function(){D.on({beforecontainermouseover:H,containermouseover:K});T("mouseover");expect(O).toBe(false)})});describe("containermouseup",function(){it("should fire the beforecontainermouseup event",function(){D.on("beforecontainermouseup",E);T("mouseup");U("mouseup")});it("should fire the containermouseup event",function(){D.on("containermouseup",E);T("mouseup");U("mouseup")});it("should not trigger containermouseup if beforecontainermouseup is vetoed",function(){D.on({beforecontainermouseup:H,containermouseup:K});T("mouseup");expect(O).toBe(false)})})});describe("column events",function(){function T(X,V,W){var U=R(X);expect(M[0]).toBe(N);expect(M[1]).toBe(N.getCell(U,N.getHeaderAtIndex(V)).dom);expect(M[2]).toBe(X);expect(M[3]).toBe(V);expect(M[4].type).toBe(W);expect(M[5]).toBe(U);expect(M[6]===N.getRow(X)).toBe(true)}it("should relay click events",function(){D.headerCt.getComponent(6).on("click",E);G("click",3,6);T(3,6,"click")});it("should relay contextmenu events",function(){D.headerCt.getComponent(6).on("contextmenu",E);G("contextmenu",3,6);T(3,6,"contextmenu")});it("should relay dblclick events",function(){D.headerCt.getComponent(6).on("dblclick",E);G("dblclick",3,6);T(3,6,"dblclick")});it("should relay keydown events",function(){D.headerCt.getComponent(6).on("keydown",E);S("keydown",3,6);T(3,6,"keydown")});it("should relay mousedown events",function(){D.headerCt.getComponent(6).on("mousedown",E);G("mousedown",3,6);T(3,6,"mousedown")});it("should relay mouseup events",function(){D.headerCt.getComponent(6).on("mouseup",E);G("mouseup",3,6);T(3,6,"mouseup")})})})});describe("relaying selection events",function(){var U,T;beforeEach(function(){T=jasmine.createSpy()});afterEach(function(){T=U=null});describe("row model",function(){function V(X){var Y=[];if(!Ext.isArray(X)){X=[X]}Ext.Array.forEach(X,function(Z){Y.push(P.getAt(Z))});return Y}beforeEach(function(){L(null,null,{multiSelect:true});U=D.getSelectionModel()});function W(Z,X,Y){expect(Z[0]).toBe(U);expect(Z[1]).toBe(X);expect(Z[2]).toBe(Y)}describe("beforeselect/select",function(){it("should fire beforeselect before selecting an item",function(){D.on("beforeselect",T);U.select(0);expect(T.callCount).toBe(1);W(T.mostRecentCall.args,P.getAt(0),0)});it("should fire beforeselect before selecting each item",function(){D.on("beforeselect",T);U.select(V([3,4,7]));expect(T.callCount).toBe(3);W(T.calls[0].args,P.getAt(3),3);W(T.calls[1].args,P.getAt(4),4);W(T.calls[2].args,P.getAt(7),7)});it("should prevent selection when beforeselect returns false",function(){D.on("beforeselect",T.andReturn(false));U.select(0);expect(T.callCount).toBe(1);W(T.mostRecentCall.args,P.getAt(0),0);expect(U.getCount()).toBe(0)});it("should fire select when an item is selected",function(){D.on("select",T);U.select(0);expect(T.callCount).toBe(1);W(T.mostRecentCall.args,P.getAt(0),0)});it("should fire select for each selected item",function(){D.on("select",T);U.select(V([3,4,7]));expect(T.callCount).toBe(3);W(T.calls[0].args,P.getAt(3),3);W(T.calls[1].args,P.getAt(4),4);W(T.calls[2].args,P.getAt(7),7)})});describe("beforedeselect/deselect",function(){it("should fire beforedeselect before deselecting an item",function(){U.select(0);D.on("beforedeselect",T);U.deselect(0);expect(T.callCount).toBe(1);W(T.mostRecentCall.args,P.getAt(0),0)});it("should fire beforedeselect before deselecting each item",function(){U.select(V([3,4,7]));D.on("beforedeselect",T);U.deselect(V([3,4,7]));expect(T.callCount).toBe(3);W(T.calls[0].args,P.getAt(3),3);W(T.calls[1].args,P.getAt(4),4);W(T.calls[2].args,P.getAt(7),7)});it("should prevent deselection when beforedeselect returns false",function(){U.select(0);D.on("beforedeselect",T.andReturn(false));U.deselect(0);expect(T.callCount).toBe(1);W(T.mostRecentCall.args,P.getAt(0),0);expect(U.getCount()).toBe(1)});it("should fire deselect when an item is deselected",function(){U.select(0);D.on("deselect",T);U.deselect(0);expect(T.callCount).toBe(1);W(T.mostRecentCall.args,P.getAt(0),0)});it("should fire select for each selected item",function(){U.select(V([3,4,7]));D.on("deselect",T);U.deselect(V([3,4,7]));expect(T.callCount).toBe(3);W(T.calls[0].args,P.getAt(3),3);W(T.calls[1].args,P.getAt(4),4);W(T.calls[2].args,P.getAt(7),7)})});describe("selectionchange",function(){it("should fire a single selectionchange",function(){D.on("selectionchange",T);U.select(V([1,4,8]));expect(T.callCount).toBe(1);var X=T.mostRecentCall.args;expect(X[0]).toBe(U);expect(X[1]).toEqual(V([1,4,8]));T.reset();U.select(9,true);expect(T.callCount).toBe(1);var X=T.mostRecentCall.args;expect(X[0]).toBe(U);expect(X[1]).toEqual(V([1,4,8,9]));T.reset();U.select(2);expect(T.callCount).toBe(1);var X=T.mostRecentCall.args;expect(X[0]).toBe(U);expect(X[1]).toEqual(V([2]))})})})});describe("locking",function(){describe("events",function(){beforeEach(function(){L([{locked:true,text:"F1",dataIndex:"field1"},{locked:true,text:"F2",dataIndex:"field2"},{locked:true,text:"F3",dataIndex:"field3"},{locked:true,text:"F4",dataIndex:"field4"},{locked:true,text:"F5",dataIndex:"field5"},{text:"F6",dataIndex:"field6"},{text:"F7",dataIndex:"field7"},{text:"F8",dataIndex:"field8"},{text:"F9",dataIndex:"field9"},{text:"F10",dataIndex:"field10"}])});describe("selection events",function(){var V;function U(W){D.on(W,function(){V++})}function T(W){it("should fire the "+W+" event once",function(){J.select(0);U(W);J.select(1);expect(V).toBe(1)})}beforeEach(function(){V=0});T("deselect");T("select");T("beforeselect");T("beforedeselect");T("selectionchange")});describe("row events",function(){function T(U,V,W){expect(M[0]===U).toBe(true);expect(M[1]===R(V)).toBe(true);expect(M[2]===U.getNode(V).getElementsByTagName("tr")[0]).toBe(true);expect(M[3]).toBe(V);expect(M[4].type).toBe(W)}it("should fire the itemclick event when clicking on the locked side",function(){D.on("rowclick",E);G("click",2,4);T(D.lockedGrid.getView(),2,"click")});it("should fire the itemclick event when clicking on the unlocked side",function(){D.on("rowcontextmenu",E);G("contextmenu",3,7,2);T(D.normalGrid.getView(),3,"contextmenu")})});describe("item events",function(){function T(U,V,W){expect(M[0]===U).toBe(true);expect(M[1]===R(V)).toBe(true);expect(M[2]===U.getNode(V)).toBe(true);expect(M[3]).toBe(V);expect(M[4].type).toBe(W)}it("should fire the itemclick event when clicking on the locked side",function(){D.on("itemclick",E);G("click",2,4);T(D.lockedGrid.getView(),2,"click")});it("should fire the itemclick event when clicking on the unlocked side",function(){D.on("itemclick",E);G("click",3,7);T(D.normalGrid.getView(),3,"click")})});describe("cell events",function(){function T(V,Y,W,X){var U=R(Y);expect(M[0]===V).toBe(true);expect(M[1]===V.getCell(U,V.getHeaderAtIndex(W)).dom).toBe(true);expect(M[2]).toBe(W);expect(M[3]===U).toBe(true);expect(M[4]===V.getRow(Y)).toBe(true);expect(M[5]).toBe(Y);expect(M[6].type).toBe(X)}it("should fire the cellclick event when clicking on the locked side",function(){D.on("cellclick",E);G("click",1,0);T(D.lockedGrid.getView(),1,0,"click")});it("should fire the cellclick event when clicking on the unlocked side",function(){D.on("cellclick",E);G("click",1,6);T(D.normalGrid.getView(),1,1,"click")})})});describe("viewready event",function(){var T;beforeEach(function(){T=jasmine.createSpy();L([{locked:true,text:"F1",dataIndex:"field1"},{text:"F2",dataIndex:"field2"},{locked:true,text:"F3",dataIndex:"field3"},{text:"F4",dataIndex:"field4"}],false,{listeners:{viewready:T}})});it("should relay the event from the child grid",function(){waitsFor(function(){return T.callCount>0});runs(function(){expect(T).toHaveBeenCalled()})});it("should add a gridRelayers property to the owner lockable grid",function(){waitsFor(function(){return T.callCount>0});runs(function(){expect(D.gridRelayers).toBeDefined()})})})});describe("hidden columns",function(){function T(V,Z,W,X,Y){var U=R(Z);expect(M[0]===V).toBe(true);expect(M[1]===V.getCell(U,V.getHeaderAtIndex(W)).dom).toBe(true);expect(M[2]).toBe(X);expect(M[3]===U).toBe(true);expect(M[4]===V.getRow(Z)).toBe(true);expect(M[5]).toBe(Z);expect(M[6].type).toBe(Y)}describe("unlocked",function(){beforeEach(function(){L([{text:"F1",dataIndex:"field1"},{hidden:true,text:"F2",dataIndex:"field2"},{hidden:true,text:"F3",dataIndex:"field3"},{text:"F4",dataIndex:"field4"},{hidden:true,text:"F5",dataIndex:"field5"},{text:"F6",dataIndex:"field6"}])});it("should fire the events taking into account hidden columns before hidden columns",function(){D.on("cellclick",E);G("click",1,0);T(N,1,0,0,"click")});it("should fire the events taking into account hidden columns in between hidden columns",function(){D.on("cellclick",E);G("click",1,3);T(N,1,1,3,"click")});it("should fire the events taking into account hidden columns at the last column",function(){D.on("cellclick",E);G("click",1,5);T(N,1,2,5,"click")})});describe("with locking",function(){beforeEach(function(){L([{locked:true,text:"F1",dataIndex:"field1"},{locked:true,hidden:true,text:"F2",dataIndex:"field2"},{locked:true,hidden:true,text:"F3",dataIndex:"field3"},{locked:true,text:"F4",dataIndex:"field4"},{locked:true,text:"F5",dataIndex:"field5"},{text:"F6",dataIndex:"field6"},{hidden:true,text:"F7",dataIndex:"field7"},{text:"F8",dataIndex:"field8"},{hidden:true,text:"F9",dataIndex:"field9"},{text:"F10",dataIndex:"field10"}])});it("should fire the events taking into account hidden columns from the locked part",function(){D.on("cellclick",E);G("click",1,3);T(D.lockedGrid.getView(),1,1,3,"click")});it("should fire the events taking into account hidden columns from the unlocked part",function(){D.on("cellclick",E);G("click",1,5);T(D.normalGrid.getView(),1,0,0,"click")})})});describe("With grouping",function(){var T,U;beforeEach(function(){L(null,true)});describe("mouseover",function(){it("should highlight rows on select",function(){G("click",0,0);T=N.all.item(0);expect(T).toHaveCls(N.selectedItemCls)})})});describe("with editing",function(){var V,T,U;beforeEach(function(){U=jasmine.createSpy();V=new Ext.grid.plugin.CellEditing();L([{name:"F1",dataIndex:"field1",field:"textfield"}],null,{plugins:[V]});T=D.getColumnManager().getColumns()[0]});afterEach(function(){T=U=V=null});it("should not fire containermousedown when the target is an editor",function(){D.getView().on("containermousedown",U);V.startEditByPosition({row:0,column:0});jasmine.fireMouseEvent(T.getEditor().inputEl,"mousedown");expect(U).not.toHaveBeenCalled()});it("should not fire containermouseup when the target is an editor",function(){D.getView().on("containermouseup",U);V.startEditByPosition({row:0,column:0});jasmine.fireMouseEvent(T.getEditor().inputEl,"mouseup");expect(U).not.toHaveBeenCalled()});it("should not fire containerclick when the target is an editor",function(){D.getView().on("containerclick",U);V.startEditByPosition({row:0,column:0});jasmine.fireMouseEvent(T.getEditor().inputEl,"click");expect(U).not.toHaveBeenCalled()})})})}A(false);A(true)})