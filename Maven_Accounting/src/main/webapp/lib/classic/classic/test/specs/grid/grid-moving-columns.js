describe("grid-moving-columns",function(){var P="webkitTransform" in document.documentElement.style?"webkitTransform":"transform",K=Ext.define(null,{extend:"Ext.data.Model",fields:["field1","field2","field3","field4","field5","field6","field7","field8","field9","field10","field11","field12","field13","field14","field15","field16","field17","field18"]}),B=[],V=[],A,I,U,L,G,T,N,F,W,O,H;function C(g,h,d){var e=g.el.getBox(),Z=e.x+e.width/2,Y=e.y+e.height/2,c=h.el.getBox(),i=c.x,f=c.y+c.height/2,b=d?c.width-6:5,X=i+b,a=d?Ext.dd.DragDropManager.clickPixelThresh+1:-Ext.dd.DragDropManager.clickPixelThresh-1;jasmine.fireMouseEvent(g.el.dom,"mouseover",Z,Y);jasmine.fireMouseEvent(g.titleEl.dom,"mousedown",Z,Y);jasmine.fireMouseEvent(g.el.dom,"mousemove",Z+a,Y);if(U){jasmine.fireMouseEvent(h.el.dom,"mousemove",(d?X+1:X-1),f)}jasmine.fireMouseEvent(h.el.dom,"mousemove",X,f);jasmine.fireMouseEvent(h.el.dom,"mouseup",X,f);S()}function Q(Z,a,X){var Y;if(!Z){Z=[];for(Y=1;Y<19;Y++){Z.push({dataIndex:"field"+Y,text:"Field "+Y,width:90})}}G=new Ext.data.Store({model:K,data:a||[{field1:1,field2:2,field3:3,field4:4,field5:5,field6:6,field7:7,field8:8,field9:9,field10:10,field11:11,field12:12,field13:13,field14:14,field15:15,field16:16,field17:17,field18:18}]});A=new Ext.grid.Panel(Ext.apply({columns:Z,store:G,width:2000,height:500,border:false,viewConfig:{mouseOverOutBuffer:0}},X));if(!X||X.renderTo===undefined){A.render(Ext.getBody())}I=A.headerCt;S();L=A.getView()}function S(){var X=A.down("[isGroupHeader]"),Y=A.headerCt;T=Y.gridVisibleColumns||Y.visibleColumnManager.getColumns();if((typeof N!=="number")&&(!N||(N.items&&N.items.length))){N=X}}function D(Y,X,a){var b={fn:a||Ext.emptyFn},Z=spyOn(b,"fn");Y.addListener(X,b.fn);return Z}function M(X){var Y;B.length=0;Ext.Array.each(A.getVisibleColumnManager().getColumns(),function(Z){B.push(Z.text)});Y=X.replace(/(\d+,?)/g,function(b,Z){return"Field"+Z});expect(B.join(",")).toEqual(Y)}function J(X){expect(W.callCount).toBe(X[0]);expect(O.callCount).toBe(X[1]);expect(H.callCount).toBe(X[1])}function R(X){V.length=0;if(!U){Ext.Array.each(L.getRow(L.all.item(0)).childNodes,function(Y){V.push(Y.textContent||Y.innerText)})}else{Ext.Array.each(L.getRow(L.lockedView.all.item(0)).childNodes,function(Y){V.push(Y.textContent||Y.innerText)});Ext.Array.each(L.getRow(L.normalView.all.item(0)).childNodes,function(Y){V.push(Y.textContent||Y.innerText)})}expect(V.join(",")).toEqual(X)}function E(X,Y){M(X);if(Y!==false){R(X)}}afterEach(function(){Ext.destroy(A,G);A=G=U=T=N=F=W=O=H=I=null;Ext.data.Model.schema.clear();B.length=V.length=0});describe("destroy during column header drag",function(){it("should move columns",function(){Q([{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"},{dataIndex:"field7",header:"Field7"}],null,{enableColumnResize:false,header:false});var Y=A.getColumnManager().getColumns()[0],Z=A.headerCt.findPlugin("gridheaderreorderer"),X;runs(function(){jasmine.fireMouseEvent(Y.el.dom,"mouseover",5,5);jasmine.fireMouseEvent(Y.titleEl.dom,"mousedown",20,5);jasmine.fireMouseEvent(document.body,"mousemove",100,0)});waits(1);runs(function(){X=Z.dragZone.proxy.el;expect(X.isVisible()).toBe(true);A.destroy();expect(X.dom).toBeFalsy();jasmine.fireMouseEvent(document.body,"mousemove",100,0);jasmine.fireMouseEvent(document.body,"mouseup")})})});describe("destroying a component in the midst of a drag operation",function(){beforeEach(function(){Q();C(T[3],T[1],true);A.destroy();Ext.data.Model.schema.clear()});it("should not try to complete the drag operation",function(){var X;Q();X=A.headerCt.reorderer.dragZone;spyOn(X,"onDragOut").andCallThrough();C(T[3],T[1]);expect(X.onDragOut).not.toHaveBeenCalled()});it("should not cache any references to the destroyed drop zone object in the DragDropManager",function(){Q();C(T[3],T[1]);expect(Ext.dd.DragDropManager.dragOvers[A.headerCt.reorderer.dropZone.id]).toBeUndefined()})});describe("Header movement using the UI",function(){it("should move columns",function(){Q([{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{dataIndex:"field3",header:"Field3",hidden:true},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"}],null,{enableColumnResize:false,header:false});W=D(A,"columnschanged");O=D(A,"columnmove");H=D(A.headerCt,"columnmove");C(T[3],T[1]);J([1,1]);E("1,5,2,4");C(T[3],T[1]);J([2,2]);E("1,4,5,2");A.destroy()});it("should move columns to the end of the header container",function(){Q([{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{dataIndex:"field3",header:"Field3",hidden:true},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"}],null,{enableColumnResize:false,header:false});W=D(A,"columnschanged");O=D(A,"columnmove");H=D(A.headerCt,"columnmove");C(T[0],T[3],true);J([1,1]);E("2,4,5,1");C(T[0],T[3],true);J([2,2]);E("4,5,1,2");A.destroy()});it("should move columns to the start of the header container",function(){Q([{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{dataIndex:"field3",header:"Field3",hidden:true},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"}],null,{enableColumnResize:false,header:false});W=D(A,"columnschanged");O=D(A,"columnmove");H=D(A.headerCt,"columnmove");C(T[3],T[0]);J([1,1]);E("5,1,2,4");C(T[3],T[0]);J([2,2]);E("4,5,1,2");A.destroy()});it("should only fire columnmove once when moving columns between column groups",function(){Q([{header:"Group 1",columns:[{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{dataIndex:"field3",header:"Field3"}]},{header:"Group2",columns:[{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"},{dataIndex:"field7",header:"Field7"}]}],null,{enableColumnResize:false,header:false});W=D(A,"columnschanged");O=D(A,"columnmove");H=D(A.headerCt,"columnmove");C(T[0],T[5]);J([1,1]);E("2,3,4,5,1,6,7");A.destroy()});it("should work when columns are hidden",function(){var X;Q([{header:"Group 1",columns:[{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{dataIndex:"field3",header:"Field3"}]},{header:"Group2",columns:[{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"},{dataIndex:"field7",header:"Field7"}]}],null,{enableColumnResize:false,header:false});X=A.getColumnManager().getColumns();W=D(A,"columnschanged");O=D(A,"columnmove");H=D(A.headerCt,"columnmove");X[0].hide();X[3].hide();S();J([2,0]);S();C(T[2],T[0]);J([3,1]);E("5,2,3,6,7");A.destroy()});it("should work moving columns across group columns",function(){Q([{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group 1",columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"}]},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"}],null,{enableColumnResize:false,header:false});W=D(A,"columnschanged");O=D(A,"columnmove");H=D(A.headerCt,"columnmove");C(T[0],T[6]);J([1,1]);E("2,3,4,5,6,1,7,8");C(T[7],T[0]);J([2,2]);E("8,2,3,4,5,6,1,7");A.destroy()});it("should work moving group columns",function(){Q([{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group 1",columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"}]},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"}],null,{enableColumnResize:false,header:false});W=D(A,"columnschanged");O=D(A,"columnmove");H=D(A.headerCt,"columnmove");A.headerCt.move(2,3);J([1,1]);E("1,2,7,3,4,5,6,8",false);A.destroy()});describe("moving column(s) out of a group to the root container",function(){it("should work moving a column out of a group",function(){Q([{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group 1",columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"}]},{header:"Group2",columns:[{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"}]},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"}],null,{enableColumnResize:false,header:false});var X=A.getColumnManager().getColumns();W=D(A,"columnschanged");O=D(A,"columnmove");H=D(A.headerCt,"columnmove");X[0].hide();S();C(T[1],T[0],true);J([2,1]);E("2,3,4,5,6,7,8");C(T[1],T[2]);J([3,2]);E("2,3,4,5,6,7,8");A.destroy()});it("should work moving columns out of a group when columns are hidden before a group",function(){var X;Q([{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group 1",columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"}]},{header:"Group2",columns:[{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"}]},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"}],null,{enableColumnResize:false,header:false});X=A.getColumnManager().getColumns();W=D(A,"columnschanged");O=D(A,"columnmove");H=D(A.headerCt,"columnmove");X[0].hide();X[1].hide();S();C(T[4],T[3],true);J([3,1]);E("3,4,5,6,7,8");C(T[4],T[5]);J([4,2]);E("3,4,5,6,7,8");A.destroy()});describe("moving the last header out of a group",function(){function X(Y){Q([{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group1",columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"}]},{dataIndex:"field5",header:"Field5"}],null,{enableColumnResize:false,header:false});C(T[2],T[1]);E("1,3,2,4,5");C(T[3],N);E("1,3,2,4,5");if(Y){Y()}A.destroy()}it("should work",function(){X()});it("should remove the group header when the last subheader is removed",function(){X(function(){expect(N.rendered).toBe(null);expect(N.ownerCt).toBe(null)})})})});describe("locking grids",function(){it("should work when configured without any locked columns",function(){var X,Y;Q(null,null,{enableLocking:true});X=A.lockedGrid.getVisibleColumnManager();Y=A.columns[0];expect(X.getColumns().length).toBe(0);A.lock(Y);expect(X.getColumns().length).toBe(1);expect(X.getFirst()===Y).toBe(true)})})});describe("nested groups",function(){var e,l,d,i,g,X,k,h,f;function Y(m,n){b(m);Q(e,null,{enableColumnResize:false,header:false,stateful:h,stateId:"quux"});if(!f){j()}E(d);if(n){n()}if(h){A.saveState()}A.destroy();N=X=null}function b(m){m=m||{};e=m.columns;l=m.dropPosition||"after";U=m.locked;d=m.order;i=m.range;g=m.sequence;f=m.skipMove;h=m.stateful;X=m.subGroupHeader;k=l==="before"?false:true;if(m.groupHeader){N=m.groupHeader}}function j(){if(i){a()}else{Z()}}function a(){var n=i[0],m=i[1];if(n===m){return }c();if(n>m){for(;n>=m;n--){C(T[n],X,k)}}else{for(;n<=m;n++){C(T[n],X,k)}}}function Z(){var q,o,m,t,p,n,s,r;c();q={"groupHeader":N,"subGroupHeader":X};for(o=0,m=g.length;o<m;o++){t=g[o];p=t[0];n=t[1];s=(typeof p==="string")?q[p]:T[p];r=(typeof n==="string")?q[n]:T[n];C(s,r,t[2])}}function c(){N=(typeof N==="number")?A.query("[isGroupHeader]")[N]:N;X=(typeof X==="number")?A.query("[isGroupHeader]")[X]:N}afterEach(function(){e=l=X=d=i=g=X=k=h=f=null});describe("stateful",function(){var m;beforeEach(function(){m=[{dataIndex:"field1",stateId:"foo1",header:"Field1"},{dataIndex:"field2",stateId:"foo2",header:"Field2"},{header:"Group1",stateId:"foo3",columns:[{dataIndex:"field3",stateId:"foo4",header:"Field3"},{dataIndex:"field4",stateId:"foo5",header:"Field4"},{dataIndex:"field5",stateId:"foo6",header:"Field5"},{dataIndex:"field6",stateId:"foo7",header:"Field6"}]},{dataIndex:"field7",stateId:"foo8",header:"Field7"},{dataIndex:"field8",stateId:"foo9",header:"Field8"}];new Ext.state.Provider()});afterEach(function(){Ext.state.Manager.getProvider().clear();m=null});it("should work when moving headers within a grouped header",function(){Y({columns:m,order:"1,2,4,5,6,3,7,8",sequence:[[2,5,true]],stateful:true});Y({columns:m,order:"1,2,4,5,6,3,7,8",skipMove:true,stateful:true})})});describe("one nested group",function(){var m=[{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group1",columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"}]},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"}];describe("dragging all subheaders out of the group",function(){describe("when the targetHeader is the groupHeader",function(){function n(){expect(N.rendered).toBe(null);expect(N.ownerCt).toBe(null)}it("should work when the move position is before the target header",function(){Y({columns:m,dropPosition:"before",order:"1,2,3,4,5,6,7,8",range:[2,5]},n)});it("should work when the move position is before the target header, in reverse",function(){Y({columns:m,order:"1,2,6,5,4,3,7,8",sequence:[[5,"groupHeader",false],[5,"groupHeader",false],[5,"groupHeader",false],[5,"groupHeader",false]]},n)});it("should work when the move position is after the target header",function(){Y({columns:m,order:"1,2,6,5,4,3,7,8",sequence:[[2,"groupHeader",true],[2,"groupHeader",true],[2,"groupHeader",true],[2,"groupHeader",true]]},n)});it("should work when the move position is after the target header, in reverse",function(){Y({columns:m,dropPosition:"right",order:"1,2,3,4,5,6,7,8",range:[5,2]},n)});it("should work when the move position alternates between 'before' and 'after'",function(){Y({columns:m,order:"1,2,4,3,6,5,7,8",sequence:[[4,"groupHeader",true],[3,"groupHeader",false],[3,"groupHeader",false],[4,"groupHeader",true]]},n)})})});describe("when the headers are moved randomly",function(){it("should work when the move position is 'before'",function(){Y({columns:m,order:"6,1,3,4,2,5,7,8",sequence:[[3,1,false],[4,6,false],[4,0,false],[4,2,false]]})});it("should work when the move position is 'after'",function(){Y({columns:m,order:"1,6,2,3,4,7,5,8",sequence:[[3,1,true],[4,6,true],[4,0,true],[4,2,true]]})});it("should work when the move position alternates between 'before' and 'after'",function(){Y({columns:m,order:"6,1,4,3,2,7,5,8",sequence:[[3,1,false],[4,6,true],[4,0,false],[4,2,true]]})})});describe("moving the group header",function(){it("should move the group to the beginning of the root header container, before position",function(){Y({columns:m,order:"3,4,5,6,1,2,7,8",sequence:[["groupHeader",0,false]]})});it("should move the group to the beginning of the root header container, after position",function(){Y({columns:m,order:"1,3,4,5,6,2,7,8",sequence:[["groupHeader",0,true]]})});it("should move the group to the end of the root header container, before position",function(){Y({columns:m,order:"1,2,7,3,4,5,6,8",sequence:[["groupHeader",7,false]]})});it("should move the group to the end of the root header container, after position",function(){Y({columns:m,order:"1,2,7,8,3,4,5,6",sequence:[["groupHeader",7,true]]})})})});describe("two nested groups",function(){var m=[{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group1",columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{header:"Group2",columns:[{dataIndex:"field6",header:"Field6"},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"},{dataIndex:"field9",header:"Field9"}]},{dataIndex:"field10",header:"Field10"}]},{dataIndex:"field11",header:"Field11"},{dataIndex:"field12",header:"Field12"},{dataIndex:"field13",header:"Field13"}];describe("dragging all subheaders out of Group2",function(){describe("when the targetHeader is the Group2 groupHeader (so the drag is contiguous to Group2)",function(){function n(){expect(X.ownerCt).toBe(null);expect(X.rendered).toBe(null)}it("should work when the move position is before the target header",function(){Y({columns:m,dropPosition:"before",order:"1,2,3,4,5,6,7,8,9,10,11,12,13",range:[5,8],subGroupHeader:1})});it("should work when the move position is before the target header, in reverse",function(){Y({columns:m,order:"1,2,3,4,5,9,8,7,6,10,11,12,13",sequence:[[8,"subGroupHeader",false],[8,"subGroupHeader",false],[8,"subGroupHeader",false],[8,"subGroupHeader",false]],subGroupHeader:1})});it("should work when the move position is after the target header",function(){Y({columns:m,order:"1,2,3,4,5,9,8,7,6,10,11,12,13",sequence:[[5,"subGroupHeader",true],[5,"subGroupHeader",true],[5,"subGroupHeader",true],[5,"subGroupHeader",true]],subGroupHeader:1})});it("should work when the move position is after the target header, in reverse",function(){Y({columns:m,dropPosition:"right",order:"1,2,3,4,5,6,7,8,9,10,11,12,13",range:[8,5],subGroupHeader:1})});it("should work when the move position alternates between 'before' and 'after'",function(){Y({columns:m,order:"1,2,3,4,5,7,9,6,8,10,11,12,13",sequence:[[6,"subGroupHeader",false],[7,"subGroupHeader",true],[6,"subGroupHeader",true],[6,"subGroupHeader",false]],subGroupHeader:1})});it("should remove the group header when the last subheader is removed, 'before' move position",function(){Y({columns:m,dropPosition:"before",order:"1,2,3,4,5,6,7,8,9,10,11,12,13",range:[5,8],subGroupHeader:1},n)});it("should remove the group header when the last subheader is removed, 'after' move position",function(){Y({columns:m,dropPosition:"after",order:"1,2,3,4,5,6,7,8,9,10,11,12,13",range:[8,5],subGroupHeader:1},n)})});describe("when the Group2 subheaders are dragged into Group1 (targetHeader is not Group2)",function(){it("should work when the move position is before the first subheader in Group1",function(){Y({columns:m,order:"1,2,9,8,7,6,3,4,5,10,11,12,13",sequence:[[5,2,false],[6,2,false],[7,2,false],[8,2,false]]})});it("should work when the move position is before the first subheader in Group1, in reverse",function(){Y({columns:m,order:"1,2,6,7,8,9,3,4,5,10,11,12,13",sequence:[[8,2,false],[8,2,false],[8,2,false],[8,2,false]]})});it("should work when the move position is after the last subheader in Group1",function(){Y({columns:m,order:"1,2,3,4,5,10,6,7,8,9,11,12,13",sequence:[[5,9,true],[5,9,true],[5,9,true],[5,9,true]]})});it("should work when the move position is after the last subheader in Group1, in reverse",function(){Y({columns:m,order:"1,2,3,4,5,10,9,8,7,6,11,12,13",sequence:[[8,9,true],[7,9,true],[6,9,true],[5,9,true]]})});it("should work when the move position is before the subheader directly after Group2",function(){Y({columns:m,order:"1,2,3,4,5,9,8,7,6,10,11,12,13",sequence:[[5,9,false],[5,8,false],[5,7,false],[5,6,false]]})});it("should work when the move position is before the subheader directly after Group2, in reverse",function(){Y({columns:m,order:"1,2,3,4,5,6,7,8,9,10,11,12,13",sequence:[[8,9,false],[7,8,false],[6,7,false],[5,6,false]]})})});describe("when the Group2 subheaders are dragged into the root header container",function(){function n(){expect(A.down("[isGroupHeader][text=Group2]")).toBe(null)}it("should work when the move position is before the first group header (Group1)",function(){Y({columns:m,dropPosition:"before",order:"1,2,6,7,8,9,3,4,5,10,11,12,13",range:[5,8]},n)});it("should work when the move position is before the first group header (Group1), in reverse",function(){Y({columns:m,order:"1,2,9,8,7,6,3,4,5,10,11,12,13",sequence:[[8,"groupHeader",false],[8,"groupHeader",false],[8,"groupHeader",false],[8,"groupHeader",false]]},n)});it("should work when the move position is after the first group header (Group1)",function(){Y({columns:m,order:"1,2,3,4,5,10,9,8,7,6,11,12,13",sequence:[[5,"groupHeader",true],[5,"groupHeader",true],[5,"groupHeader",true],[5,"groupHeader",true]]},n)});it("should work when the move position is after the first group header (Group1), in reverse",function(){Y({columns:m,dropPosition:"right",order:"1,2,3,4,5,10,6,7,8,9,11,12,13",range:[8,5]},n)});it("should work when the move position alternates between 'before' and 'after'",function(){Y({columns:m,order:"1,2,3,4,5,7,9,6,8,10,11,12,13",sequence:[[6,"subGroupHeader",false],[7,"subGroupHeader",true],[6,"subGroupHeader",true],[6,"subGroupHeader",false]],subGroupHeader:1},n)})})});describe("moving the group header",function(){describe("Group1",function(){it("should move the group to the beginning of the root header container, before position",function(){Y({columns:m,order:"3,4,5,6,7,8,9,10,1,2,11,12,13",sequence:[["groupHeader",0,false]]})});it("should move the group to the beginning of the root header container, after position",function(){Y({columns:m,order:"1,3,4,5,6,7,8,9,10,2,11,12,13",sequence:[["groupHeader",0,true]]})});it("should move the group to the end of the root header container, before position",function(){Y({columns:m,order:"1,2,11,12,3,4,5,6,7,8,9,10,13",sequence:[["groupHeader",12,false]]})});it("should move the group to the end of the root header container, after position",function(){Y({columns:m,order:"1,2,11,12,13,3,4,5,6,7,8,9,10",sequence:[["groupHeader",12,true]]})})});describe("Group2",function(){it("should move the group to the beginning of the root header container, before position",function(){Y({columns:m,order:"6,7,8,9,1,2,3,4,5,10,11,12,13",sequence:[["subGroupHeader",0,false]],subGroupHeader:1})});it("should move the group to the beginning of the root header container, after position",function(){Y({columns:m,order:"1,6,7,8,9,2,3,4,5,10,11,12,13",sequence:[["subGroupHeader",0,true]],subGroupHeader:1})});it("should move the group to the end of the root header container, before position",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,6,7,8,9,13",sequence:[["subGroupHeader",12,false]],subGroupHeader:1})});it("should move the group to the end of the root header container, after position",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,13,6,7,8,9",sequence:[["subGroupHeader",12,true]],subGroupHeader:1})});it("should move the group to the beginning of Group1",function(){Y({columns:m,order:"1,2,6,7,8,9,3,4,5,10,11,12,13",sequence:[["subGroupHeader",2,false]],subGroupHeader:1})});it("should move the group to the end of Group1",function(){Y({columns:m,order:"1,2,3,4,5,10,6,7,8,9,11,12,13",sequence:[["subGroupHeader",9,true]],subGroupHeader:1})})});describe("when the nested groups are stacked directly on top of each other",function(){var n=[{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group1",columns:[{header:"Group2",columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"}]}]},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"},{dataIndex:"field9",header:"Field9"}];function o(){expect(N.ownerCt).toBe(null);expect(N.rendered).toBe(null);expect(X.ownerCt).not.toBe(null);expect(X.rendered).toBe(true)}it("should remove the Group1 group header when Group2 is moved out of its grouping",function(){Y({columns:n,order:"1,3,4,5,6,2,7,8,9",sequence:[["subGroupHeader",1,false]],subGroupHeader:1},o);Y({columns:n,order:"1,2,7,8,3,4,5,6,9",sequence:[["subGroupHeader",7,true]],subGroupHeader:1},o)});it("should remove the Group1 group header when Group2 is dragged onto it, before position",function(){Y({columns:n,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],groupHeader:0,subGroupHeader:1},o)});it("should remove the Group1 group header when Group2 is dragged onto it, after position",function(){Y({columns:n,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],subGroupHeader:1},o)})});describe("when the nested groups are aligned on either side",function(){describe("aligned on left",function(){var n=[{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group1",columns:[{header:"Group2",columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"}]},{dataIndex:"field6",header:"Field6"}]},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"},{dataIndex:"field9",header:"Field9"}];it("should work when the subgroupheader is dragged onto its ownerCt, before position",function(){Y({columns:n,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],subGroupHeader:1})});it("should work when the subgroupheader is dragged onto its ownerCt, after position",function(){Y({columns:n,order:"1,2,6,3,4,5,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],subGroupHeader:1})})});describe("aligned on right",function(){var n=[{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group1",columns:[{dataIndex:"field3",header:"Field3"},{header:"Group2",columns:[{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"}]}]},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"},{dataIndex:"field9",header:"Field9"}];it("should work when the subgroupheader is dragged onto its ownerCt, before position",function(){Y({columns:n,order:"1,2,4,5,6,3,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],subGroupHeader:1})});it("should work when the subgroupheader is dragged onto its ownerCt, after position",function(){Y({columns:n,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],subGroupHeader:1})})})})});describe("when the headers are moved randomly",function(){it("should work when the move position is 'before'",function(){Y({columns:m,order:"6,1,9,2,3,7,4,5,8,10,11,12,13",sequence:[[5,0,false],[7,9,false],[6,4,false],[7,2,false]]})});it("should work when the move position is 'after'",function(){Y({columns:m,order:"1,6,2,3,4,8,5,10,11,12,9,13,7",sequence:[[6,12,true],[6,3,true],[7,10,true],[6,0,true]]})});it("should work when the move position alternates between 'before' and 'after'",function(){Y({columns:m,order:"1,2,9,3,6,4,7,5,8,10,11,12,13",sequence:[[6,4,false],[7,9,false],[7,1,true],[7,3,true]]})})})});describe("three nested groups",function(){var m=[{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group1",columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{header:"Group2",columns:[{header:"Group3",columns:[{dataIndex:"field6",header:"Field6"},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"},{dataIndex:"field9",header:"Field9"}]},{dataIndex:"field10",header:"Field10"},{dataIndex:"field11",header:"Field11"},{dataIndex:"field12",header:"Field12"}]},{dataIndex:"field13",header:"Field13"}]},{dataIndex:"field14",header:"Field14"},{dataIndex:"field15",header:"Field15"},{dataIndex:"field16",header:"Field16"}];describe("dragging all subheaders out of Group3",function(){describe("when the targetHeader is the Group3 groupHeader (so the drag is contiguous to Group3)",function(){function n(){expect(X.ownerCt).toBe(null);expect(X.rendered).toBe(null)}it("should work when the move position is before the target header",function(){Y({columns:m,dropPosition:"before",order:"1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16",range:[5,8],subGroupHeader:2},n)});it("should work when the move position is before the target header, in reverse",function(){Y({columns:m,order:"1,2,3,4,5,9,8,7,6,10,11,12,13,14,15,16",sequence:[[8,"subGroupHeader",false],[8,"subGroupHeader",false],[8,"subGroupHeader",false],[8,"subGroupHeader",false]],subGroupHeader:2},n)});it("should work when the move position is after the target header",function(){Y({columns:m,dropPosition:"right",order:"1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16",range:[8,5],subGroupHeader:2},n)});it("should work when the move position is after the target header, in reverse",function(){Y({columns:m,dropPosition:"right",order:"1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16",range:[8,5],subGroupHeader:2},n)});it("should work when the move position alternates between 'before' and 'after'",function(){Y({columns:m,order:"1,2,3,4,5,7,9,6,8,10,11,12,13,14,15,16",sequence:[[6,"subGroupHeader",false],[7,"subGroupHeader",true],[6,"subGroupHeader",true],[6,"subGroupHeader",false]],subGroupHeader:2},n)})});describe("when the Group3 subheaders are dragged into Group2 (targetHeader is not Group3)",function(){function n(){expect(X.ownerCt).toBe(null);expect(X.rendered).toBe(null)}it("should work when the move position is after the last subheader in Group2",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,6,7,8,9,13,14,15,16",sequence:[[5,11,true],[5,11,true],[5,11,true],[5,11,true]],subGroupHeader:2},n)});it("should work when the move position is before the subheader directly after Group2",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,9,8,7,6,13,14,15,16",sequence:[[5,12,false],[5,11,false],[5,10,false],[5,9,false]],subGroupHeader:2})})});describe("when the Group3 subheaders are dragged into Group1",function(){function n(){expect(X.ownerCt).toBe(null);expect(X.rendered).toBe(null)}it("should work when the move position is after the last subheader in Group1",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,13,6,7,8,9,14,15,16",sequence:[[5,12,true],[5,12,true],[5,12,true],[5,12,true]],subGroupHeader:2},n)});it("should work when the move position is after the last subheader in Group1, in reverse",function(){Y({columns:m,dropPosition:"after",order:"1,2,3,4,5,10,11,12,13,6,7,8,9,14,15,16",range:[8,5]})});it("should work when the move position is before the subheader directly after Group1",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,9,8,7,6,13,14,15,16",sequence:[[5,12,false],[5,11,false],[5,10,false],[5,9,false]],subGroupHeader:2},n)});it("should work when the move position is before the subheader directly after Group1, in reverse",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,6,7,8,9,13,14,15,16",sequence:[[8,12,false],[7,11,false],[6,10,false],[5,9,false]],subGroupHeader:2},n)});it("should work when the targetHeader is Group1 and the move position is before",function(){Y({columns:m,order:"1,2,9,8,7,6,3,4,5,10,11,12,13,14,15,16",sequence:[[8,"groupHeader",false],[8,"groupHeader",false],[8,"groupHeader",false],[8,"groupHeader",false]],subGroupHeader:2},n)});it("should work when the targetHeader is Group1 and the move position is after",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,13,9,8,7,6,14,15,16",sequence:[[5,"groupHeader",true],[5,"groupHeader",true],[5,"groupHeader",true],[5,"groupHeader",true]],subGroupHeader:2},n)})});describe("when the Group3 subheaders are dragged into the root header container",function(){function n(){expect(X.rendered).toBe(null);expect(X.ownerCt).toBe(null)}it("should work when the move position is before the first group header (Group1)",function(){Y({columns:m,order:"1,2,6,7,8,9,3,4,5,10,11,12,13,14,15,16",sequence:[[5,"groupHeader",false],[6,"groupHeader",false],[7,"groupHeader",false],[8,"groupHeader",false]],subGroupHeader:2},n)});it("should work when the move position is before the first group header (Group1), in reverse",function(){Y({columns:m,order:"1,2,9,8,7,6,3,4,5,10,11,12,13,14,15,16",sequence:[[8,"groupHeader",false],[8,"groupHeader",false],[8,"groupHeader",false],[8,"groupHeader",false]],subGroupHeader:2},n)});it("should work when the move position is after the first group header (Group1)",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,13,9,8,7,6,14,15,16",sequence:[[5,"groupHeader",true],[5,"groupHeader",true],[5,"groupHeader",true],[5,"groupHeader",true]],subGroupHeader:2},n)});it("should work when the move position is after the first group header (Group1), in reverse",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,13,6,7,8,9,14,15,16",sequence:[[8,"groupHeader",true],[7,"groupHeader",true],[6,"groupHeader",true],[5,"groupHeader",true]],subGroupHeader:2},n)});it("should work when the move position alternates between 'before' and 'after'",function(){Y({columns:m,order:"1,2,7,9,3,4,5,10,11,12,13,6,8,14,15,16",sequence:[[6,"groupHeader",false],[7,"groupHeader",true],[6,"groupHeader",true],[6,"groupHeader",false]],subGroupHeader:2},n)})})});describe("moving the group header",function(){describe("Group1",function(){it("should move the group to the beginning of the root header container, before position",function(){Y({columns:m,order:"3,4,5,6,7,8,9,10,11,12,13,1,2,14,15,16",sequence:[["groupHeader",0,false]]})});it("should move the group to the beginning of the root header container, after position",function(){Y({columns:m,order:"1,3,4,5,6,7,8,9,10,11,12,13,2,14,15,16",sequence:[["groupHeader",0,true]]})});it("should move the group to the end of the root header container, before position",function(){Y({columns:m,order:"1,2,14,15,3,4,5,6,7,8,9,10,11,12,13,16",sequence:[["groupHeader",15,false]]})});it("should move the group to the end of the root header container, after position",function(){Y({columns:m,order:"1,2,14,15,16,3,4,5,6,7,8,9,10,11,12,13",sequence:[["groupHeader",15,true]]})})});describe("Group2",function(){it("should move the group to the beginning of the root header container, before position",function(){Y({columns:m,order:"6,7,8,9,10,11,12,1,2,3,4,5,13,14,15,16",sequence:[["subGroupHeader",0,false]],subGroupHeader:1})});it("should move the group to the beginning of the root header container, after position",function(){Y({columns:m,order:"1,6,7,8,9,10,11,12,2,3,4,5,13,14,15,16",sequence:[["subGroupHeader",0,true]],subGroupHeader:1})});it("should move the group to the end of the root header container, before position",function(){Y({columns:m,order:"1,2,3,4,5,13,14,15,6,7,8,9,10,11,12,16",sequence:[["subGroupHeader",15,false]],subGroupHeader:1})});it("should move the group to the end of the root header container, after position",function(){Y({columns:m,order:"1,2,3,4,5,13,14,15,16,6,7,8,9,10,11,12",sequence:[["subGroupHeader",15,true]],subGroupHeader:1})});it("should move the group to the beginning of Group1",function(){Y({columns:m,order:"1,2,6,7,8,9,10,11,12,3,4,5,13,14,15,16",sequence:[["subGroupHeader",2,false]],subGroupHeader:1})});it("should move the group to the end of Group1",function(){Y({columns:m,order:"1,2,3,4,5,13,6,7,8,9,10,11,12,14,15,16",sequence:[["subGroupHeader",12,true]],subGroupHeader:1})})});describe("Group3",function(){it("should move the group to the beginning of the root header container, before position",function(){Y({columns:m,order:"6,7,8,9,1,2,3,4,5,10,11,12,13,14,15,16",sequence:[["subGroupHeader",0,false]],subGroupHeader:2})});it("should move the group to the beginning of the root header container, after position",function(){Y({columns:m,order:"1,6,7,8,9,2,3,4,5,10,11,12,13,14,15,16",sequence:[["subGroupHeader",0,true]],subGroupHeader:2})});it("should move the group to the end of the root header container, before position",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,13,14,15,6,7,8,9,16",sequence:[["subGroupHeader",15,false]],subGroupHeader:2})});it("should move the group to the end of the root header container, after position",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,13,14,15,16,6,7,8,9",sequence:[["subGroupHeader",15,true]],subGroupHeader:2})});it("should move the group to the beginning of Group1",function(){Y({columns:m,order:"1,2,6,7,8,9,3,4,5,10,11,12,13,14,15,16",sequence:[["subGroupHeader",2,false]],subGroupHeader:2})});it("should move the group to the end of Group1",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,13,6,7,8,9,14,15,16",sequence:[["subGroupHeader",12,true]],subGroupHeader:2})});it("should move the group to the beginning of Group2",function(){Y({columns:m,order:"1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16",sequence:[["subGroupHeader","groupHeader",false]],groupHeader:1,subGroupHeader:2})});it("should move the group to the end of Group2",function(){Y({columns:m,order:"1,2,3,4,5,10,11,12,6,7,8,9,13,14,15,16",sequence:[["subGroupHeader","groupHeader",true]],groupHeader:1,subGroupHeader:2})})});describe("when the nested groups are stacked directly on top of each other",function(){var o=[{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group1",columns:[{header:"Group2",columns:[{header:"Group3",columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"}]}]}]},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"},{dataIndex:"field9",header:"Field9"}];function p(){expect(N.ownerCt).toBe(null);expect(N.rendered).toBe(null);expect(X.ownerCt).not.toBe(null);expect(X.rendered).toBe(true)}function n(){expect(N.ownerCt).toBe(null);expect(N.rendered).toBe(null);expect(I.down("[text=Group1]")).toBe(null)}it("should remove the Group1 group header when Group2 is moved out of its grouping",function(){Y({columns:o,order:"1,3,4,5,6,2,7,8,9",sequence:[["subGroupHeader",1,false]],subGroupHeader:1},p);Y({columns:o,order:"1,2,7,8,3,4,5,6,9",sequence:[["subGroupHeader",7,true]],subGroupHeader:1},p)});it("should remove both the Group1 and Group2 group headers when Group3 is moved out of its grouping",function(){Y({columns:o,order:"1,3,4,5,6,2,7,8,9",sequence:[["subGroupHeader",1,false]],subGroupHeader:2},n);Y({columns:o,order:"1,2,7,8,3,4,5,6,9",sequence:[["subGroupHeader",7,true]],subGroupHeader:2},n)});it("should remove the Group1 group header when Group2 is dragged onto it, before position",function(){Y({columns:o,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],subGroupHeader:1},p)});it("should remove the Group1 group header when Group2 is dragged onto it, after position",function(){Y({columns:o,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],subGroupHeader:1},p)});it("should remove both the Group1 and Group2 group headers when Group3 is dragged onto Group1, before position",function(){Y({columns:o,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],subGroupHeader:2},n)});it("should remove both the Group1 and Group2 group headers when Group3 is dragged onto Group1 , after position",function(){Y({columns:o,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],subGroupHeader:2},n)})});describe("when the nested groups are aligned on either side",function(){describe("aligned on left",function(){var n=[{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group1",columns:[{header:"Group2",columns:[{header:"Group3",columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"}]}]},{dataIndex:"field6",header:"Field6"}]},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"},{dataIndex:"field9",header:"Field9"}];describe("Group2 and Group3 are aligned left with a header to the right",function(){function q(){expect(N.ownerCt).toBe(null);expect(N.rendered).toBe(null);expect(X.ownerCt).toBe(I.down("[text=Group1]"))}function p(){expect(I.down("[text=Group2]")).toBe(null);expect(X.ownerCt).toBe(N.ownerCt)}function o(){expect(I.down("[text=Group3]").ownerCt).toBe(X);expect(X.ownerCt).toBe(N.ownerCt)}it("should work when Group3 is dragged onto Group2, before position",function(){Y({columns:n,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],groupHeader:1,subGroupHeader:2},q)});it("should work when Group3 is dragged onto Group2, after position",function(){Y({columns:n,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],groupHeader:1,subGroupHeader:2},q)});it("should work when Group3 is dragged onto Group1, before position",function(){Y({columns:n,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],subGroupHeader:2},p)});it("should work when Group3 is dragged onto Group1, after position",function(){Y({columns:n,order:"1,2,6,3,4,5,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],subGroupHeader:2},p)});it("should work when Group2 is dragged onto Group1, before position",function(){Y({columns:n,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],subGroupHeader:1},o)});it("should work when Group2 is dragged onto Group1, after position",function(){Y({columns:n,order:"1,2,6,3,4,5,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],subGroupHeader:1},o)})})});describe("aligned on right",function(){var n=[{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group1",columns:[{dataIndex:"field3",header:"Field3"},{header:"Group2",columns:[{header:"Group3",columns:[{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"}]}]}]},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"},{dataIndex:"field9",header:"Field9"}];describe("Group2 and Group3 are aligned right with a header to the left",function(){function q(){expect(N.ownerCt).toBe(null);expect(N.rendered).toBe(null);expect(X.ownerCt).toBe(I.down("[text=Group1]"))}function p(){expect(I.down("[text=Group2]")).toBe(null);expect(X.ownerCt).toBe(N.ownerCt)}function o(){expect(I.down("[text=Group3]").ownerCt).toBe(X);expect(X.ownerCt).toBe(N.ownerCt)}it("should work when Group3 is dragged onto Group2, before position",function(){Y({columns:n,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],groupHeader:1,subGroupHeader:2},q)});it("should work when Group3 is dragged onto Group2, after position",function(){Y({columns:n,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],groupHeader:1,subGroupHeader:2},q)});it("should work when Group3 is dragged onto Group1, before position",function(){Y({columns:n,order:"1,2,4,5,6,3,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],subGroupHeader:2},p)});it("should work when Group3 is dragged onto Group1, after position",function(){Y({columns:n,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],subGroupHeader:2},p)});it("should work when Group2 is dragged onto Group1, before position",function(){Y({columns:n,order:"1,2,4,5,6,3,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],subGroupHeader:1},o)});it("should work when Group2 is dragged onto Group1, after position",function(){Y({columns:n,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],subGroupHeader:1},o)})})})})})});describe("four nested groups",function(){describe("when the nested groups are stacked directly on top of each other",function(){var p=[{dataIndex:"field1",header:"Field1"},{dataIndex:"field2",header:"Field2"},{header:"Group1",columns:[{header:"Group2",columns:[{header:"Group3",columns:[{header:"Group4",columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"}]}]}]}]},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"},{dataIndex:"field9",header:"Field9"}];function q(){expect(N.ownerCt).toBe(null);expect(N.rendered).toBe(null);expect(X.rendered).toBe(true);expect(I.down("[text=Group3]").rendered).toBe(true);expect(I.down("[text=Group4]").rendered).toBe(true)}function o(){expect(N.ownerCt).toBe(null);expect(N.rendered).toBe(null);expect(I.down("[text=Group2]")).toBe(null);expect(I.down("[text=Group3]").rendered).toBe(true);expect(I.down("[text=Group4]").rendered).toBe(true)}function n(){expect(N.ownerCt).toBe(null);expect(N.rendered).toBe(null);expect(I.down("[text=Group2]")).toBe(null);expect(I.down("[text=Group3]")).toBe(null);expect(I.down("[text=Group4]").rendered).toBe(true)}function m(){expect(N.ownerCt).toBe(null);expect(N.rendered).toBe(null);expect(I.down("[text=Group2]")).toBe(null);expect(I.down("[text=Group3]").rendered).toBe(true);expect(I.down("[text=Group4]").rendered).toBe(true)}describe("when its moved out of its stacked grouping",function(){it("should remove the Group1 group header when Group2 is moved out of its grouping",function(){Y({columns:p,order:"3,4,5,6,1,2,7,8,9",sequence:[["subGroupHeader",0,false]],subGroupHeader:1},q);Y({columns:p,order:"1,2,7,8,3,4,5,6,9",sequence:[["subGroupHeader",7,true]],subGroupHeader:1},q)});it("should remove both the Group1 and Group2 group headers when Group3 is moved out of its grouping",function(){Y({columns:p,order:"1,3,4,5,6,2,7,8,9",sequence:[["subGroupHeader",0,true]],subGroupHeader:2},o);Y({columns:p,order:"1,2,7,3,4,5,6,8,9",sequence:[["subGroupHeader",7,false]],subGroupHeader:2},o)});it("should remove the Group1, Group2 and Group3 group headers when Group4 is moved out of its grouping",function(){Y({columns:p,order:"1,3,4,5,6,2,7,8,9",sequence:[["subGroupHeader",1,false]],subGroupHeader:3},n);Y({columns:p,order:"1,2,7,3,4,5,6,8,9",sequence:[["subGroupHeader",6,true]],subGroupHeader:3},n)})});describe("when the targetHeader is an ancestor group within the stacked grouping",function(){describe("when Group1 is the targetHeader",function(){it("should remove the Group1 group header when Group2 is dragged onto it, before position",function(){Y({columns:p,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],subGroupHeader:1},q)});it("should remove the Group1 group header when Group2 is dragged onto it, after position",function(){Y({columns:p,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],subGroupHeader:1},q)});it("should remove both the Group1 and Group2 group headers when Group3 is dragged onto it, before position",function(){Y({columns:p,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],subGroupHeader:2},o)});it("should remove both the Group1 and Group2 group headers when Group3 is dragged onto it, after position",function(){Y({columns:p,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],subGroupHeader:2},o)});it("should remove the Group1, Group2 and Group3 group headers when Group4 is dragged onto it, before position",function(){Y({columns:p,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],subGroupHeader:3},n)});it("should remove the Group1, Group2 and Group3 group headers when Group4 is dragged onto it, after position",function(){Y({columns:p,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],subGroupHeader:3},n)})});describe("when Group2 is the targetHeader",function(){it("should remove the Group2 group header when Group 3 is dragged onto it, before position",function(){Y({columns:p,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],groupHeader:1,subGroupHeader:2},q)});it("should remove the Group2 group header when Group 3 is dragged onto it, after position",function(){Y({columns:p,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],groupHeader:1,subGroupHeader:2},q)});it("should remove the Group2 and Group3 group headers when Group4 is dragged onto it, before position",function(){Y({columns:p,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],groupHeader:1,subGroupHeader:3},n)});it("should remove the Group1, Group2 and Group3 group headers when Group4 is dragged onto it, after position",function(){Y({columns:p,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],groupHeader:1,subGroupHeader:3},n)})});describe("when Group3 is the targetHeader",function(){function r(){expect(N.rendered).toBe(null);expect(X.rendered).toBe(true);expect(I.down("[text=Group1]").rendered).toBe(true);expect(I.down("[text=Group2]").rendered).toBe(true)}it("should remove the Group3 group header when Group4 is dragged onto it, before position",function(){Y({columns:p,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",false]],groupHeader:2,subGroupHeader:3},r)});it("should remove the Group3 group header when Group4 is dragged onto it, after position",function(){Y({columns:p,order:"1,2,3,4,5,6,7,8,9",sequence:[["subGroupHeader","groupHeader",true]],groupHeader:2,subGroupHeader:3},r)})})})})});describe("locked grids",function(){describe("one nested group",function(){var m=[{dataIndex:"field1",header:"Field1",locked:true},{dataIndex:"field2",header:"Field2",locked:true},{header:"Group1",locked:true,columns:[{dataIndex:"field3",header:"Field3"},{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"}]},{dataIndex:"field7",header:"Field7",locked:true},{dataIndex:"field8",header:"Field8",locked:true},{dataIndex:"field9",header:"Field9"},{header:"Group2",columns:[{dataIndex:"field10",header:"Field10"},{dataIndex:"field11",header:"Field11"},{dataIndex:"field12",header:"Field12"},{dataIndex:"field13",header:"Field13"}]},{dataIndex:"field14",header:"Field14"},{dataIndex:"field15",header:"Field15"}];describe("moving the group from one locked side to another",function(){it("should work moving from locked to normal",function(){Y({columns:m,locked:true,order:"1,2,7,8,9,10,11,12,13,3,4,5,6,14,15",sequence:[["groupHeader",13,false]]})});it("should work moving from normal to locked",function(){Y({columns:m,locked:true,order:"1,10,11,12,13,2,3,4,5,6,7,8,9,14,15",groupHeader:1,sequence:[["groupHeader",0,true]]})})});describe("moving the group from one locked side to another into another group",function(){describe("moving from locked to normal",function(){function n(){expect(!!I.down("[text=Group2]").down("[text=Group1]")).toBe(true)}it("should work moving before the first nested header in the target group",function(){Y({columns:m,locked:true,order:"1,2,7,8,9,3,4,5,6,10,11,12,13,14,15",sequence:[["groupHeader",9,false]]})});it("should work moving after the last nested header in the target group",function(){Y({columns:m,locked:true,order:"1,2,7,8,9,10,11,12,13,3,4,5,6,14,15",sequence:[["groupHeader",12,true]]})});it("should work moving into the middle of the target group",function(){Y({columns:m,locked:true,order:"1,2,7,8,9,10,11,3,4,5,6,12,13,14,15",sequence:[["groupHeader",10,true]]},n);Y({columns:m,locked:true,order:"1,2,7,8,9,10,11,12,3,4,5,6,13,14,15",sequence:[["groupHeader",12,false]]},n)})});describe("moving from normal to locked",function(){function n(){expect(!!I.down("[text=Group1]").down("[text=Group2]")).toBe(true)}it("should work moving before the first nested header in the target group",function(){Y({columns:m,locked:true,order:"1,2,10,11,12,13,3,4,5,6,7,8,9,14,15",sequence:[["subGroupHeader",2,false]],subGroupHeader:1})});it("should work moving after the last nested header in the target group",function(){Y({columns:m,locked:true,order:"1,2,3,4,5,6,10,11,12,13,7,8,9,14,15",sequence:[["subGroupHeader",5,true]],subGroupHeader:1})});it("should work moving into the middle of the target group",function(){Y({columns:m,locked:true,order:"1,2,3,4,10,11,12,13,5,6,7,8,9,14,15",sequence:[["subGroupHeader",3,true]],subGroupHeader:1},n);Y({columns:m,locked:true,order:"1,2,3,4,10,11,12,13,5,6,7,8,9,14,15",sequence:[["subGroupHeader",4,false]],subGroupHeader:1},n)})})})});describe("two nested groups",function(){var m=[{dataIndex:"field1",header:"Field1",locked:true},{dataIndex:"field2",header:"Field2",locked:true},{header:"Group1",locked:true,columns:[{dataIndex:"field3",header:"Field3"},{header:"Group3",columns:[{dataIndex:"field4",header:"Field4"},{dataIndex:"field5",header:"Field5"},{dataIndex:"field6",header:"Field6"}]},{dataIndex:"field7",header:"Field7"},{dataIndex:"field8",header:"Field8"}]},{dataIndex:"field9",header:"Field9",locked:true},{dataIndex:"field10",header:"Field10",locked:true},{dataIndex:"field11",header:"Field11"},{header:"Group2",columns:[{header:"Group4",columns:[{dataIndex:"field12",header:"Field12"},{dataIndex:"field13",header:"Field13"}]},{dataIndex:"field14",header:"Field14"},{dataIndex:"field15",header:"Field15"},{dataIndex:"field16",header:"Field16"}]},{dataIndex:"field17",header:"Field17"},{dataIndex:"field18",header:"Field18"}];describe("moving the group from one locked side to another",function(){it("should work moving from locked to normal, Group1 (1st nested)",function(){Y({columns:m,locked:true,order:"1,2,9,10,11,12,13,14,15,16,3,4,5,6,7,8,17,18",sequence:[["groupHeader",16,false]]})});it("should work moving from locked to normal, Group3 (2nd nested)",function(){Y({columns:m,groupHeader:1,locked:true,order:"1,2,3,7,8,9,10,11,12,13,14,15,16,17,18,4,5,6",sequence:[["groupHeader",17,true]]},function(){expect(I.down("[text=Group3]").ownerCt).not.toBe(I.down("[text=Group1]"))})});it("should work moving from normal to locked, Group1 (1st nested)",function(){Y({columns:m,groupHeader:2,locked:true,order:"1,12,13,14,15,16,2,3,4,5,6,7,8,9,10,11,17,18",sequence:[["groupHeader",1,false]]})});it("should work moving from normal to locked, Group4 (2nd nested)",function(){Y({columns:m,groupHeader:3,locked:true,order:"1,2,3,4,5,6,7,8,9,10,12,13,11,14,15,16,17,18",sequence:[["groupHeader",9,true]]},function(){expect(I.down("[text=Group4]").ownerCt).not.toBe(I.down("[text=Group2]"))})})});describe("moving the group from one locked side to another into another group",function(){describe("moving from locked to normal",function(){describe("Group1",function(){describe("moving into Group2",function(){function n(){expect(!!I.down("[text=Group2]").down("[text=Group1]")).toBe(true)}it("should work moving before the first nested header",function(){Y({columns:m,locked:true,order:"1,2,9,10,11,3,4,5,6,7,8,12,13,14,15,16,17,18",sequence:[["groupHeader","subGroupHeader",false]],subGroupHeader:3},n)});it("should work moving after the last nested header",function(){Y({columns:m,locked:true,order:"1,2,9,10,11,12,13,14,15,16,3,4,5,6,7,8,17,18",sequence:[["groupHeader",15,true]]})},n);it("should work moving into the middle",function(){Y({columns:m,locked:true,order:"1,2,9,10,11,12,13,14,15,3,4,5,6,7,8,16,17,18",sequence:[["groupHeader",14,true]]},n);Y({columns:m,locked:true,order:"1,2,9,10,11,12,13,3,4,5,6,7,8,14,15,16,17,18",sequence:[["groupHeader",13,false]]},n)})});describe("moving into Group4",function(){function n(){expect(!!I.down("[text=Group2]").down("[text=Group4]").down("[text=Group1]").down("[text=Group3]")).toBe(true)}it("should work moving before the first nested header",function(){Y({columns:m,locked:true,order:"1,2,9,10,11,3,4,5,6,7,8,12,13,14,15,16,17,18",sequence:[["groupHeader",11,false]]},n)});it("should work moving after the last nested header",function(){Y({columns:m,locked:true,order:"1,2,9,10,11,12,13,3,4,5,6,7,8,14,15,16,17,18",sequence:[["groupHeader",12,true]]},n)});it("should work moving into the middle",function(){Y({columns:m,locked:true,order:"1,2,9,10,11,12,3,4,5,6,7,8,13,14,15,16,17,18",sequence:[["groupHeader",11,true]]},n);Y({columns:m,locked:true,order:"1,2,9,10,11,12,3,4,5,6,7,8,13,14,15,16,17,18",sequence:[["groupHeader",12,false]]},n)})})});describe("Group3",function(){describe("moving into Group2",function(){function n(){expect(!!I.down("[text=Group2]").down("[text=Group3]")).toBe(true)}it("should work moving before the first nested header",function(){Y({columns:m,locked:true,order:"1,2,3,7,8,9,10,11,4,5,6,12,13,14,15,16,17,18",sequence:[["groupHeader","subGroupHeader",false]],groupHeader:1,subGroupHeader:3},n)});it("should work moving after the last nested header",function(){Y({columns:m,locked:true,order:"1,2,3,7,8,9,10,11,12,13,14,15,16,4,5,6,17,18",sequence:[["groupHeader",15,true]],groupHeader:1},n)});it("should work moving into the middle",function(){Y({columns:m,locked:true,order:"1,2,3,7,8,9,10,11,12,13,14,15,4,5,6,16,17,18",sequence:[["groupHeader",14,true]],groupHeader:1},n);Y({columns:m,locked:true,order:"1,2,3,7,8,9,10,11,12,13,14,4,5,6,15,16,17,18",sequence:[["groupHeader",14,false]],groupHeader:1},n)})});describe("moving into Group4",function(){function n(){expect(!!I.down("[text=Group2]").down("[text=Group4]").down("[text=Group3]")).toBe(true)}it("should work moving before the first nested header",function(){Y({columns:m,locked:true,order:"1,2,3,7,8,9,10,11,4,5,6,12,13,14,15,16,17,18",sequence:[["groupHeader",11,false]],groupHeader:1},n)});it("should work moving after the last nested header",function(){Y({columns:m,locked:true,order:"1,2,3,7,8,9,10,11,12,13,4,5,6,14,15,16,17,18",sequence:[["groupHeader",12,true]],groupHeader:1},n)});it("should work moving into the middle",function(){Y({columns:m,locked:true,order:"1,2,3,7,8,9,10,11,12,4,5,6,13,14,15,16,17,18",sequence:[["groupHeader",11,true]],groupHeader:1},n);Y({columns:m,locked:true,order:"1,2,3,7,8,9,10,11,12,4,5,6,13,14,15,16,17,18",sequence:[["groupHeader",12,false]],groupHeader:1},n)})})})});describe("moving from normal to locked",function(){describe("Group2",function(){describe("moving into Group1",function(){function n(){expect(!!I.down("[text=Group1]").down("[text=Group2]")).toBe(true)}it("should work moving before the first nested header",function(){Y({columns:m,locked:true,order:"1,2,12,13,14,15,16,3,4,5,6,7,8,9,10,11,17,18",sequence:[["groupHeader",2,false]],groupHeader:2},n)});it("should work moving after the last nested header",function(){Y({columns:m,locked:true,order:"1,2,3,4,5,6,7,8,12,13,14,15,16,9,10,11,17,18",sequence:[["groupHeader",7,true]],groupHeader:2})},n);it("should work moving into the middle",function(){Y({columns:m,locked:true,order:"1,2,3,4,5,6,12,13,14,15,16,7,8,9,10,11,17,18",sequence:[["groupHeader","subGroupHeader",true]],groupHeader:2,subGroupHeader:1},n);Y({columns:m,locked:true,order:"1,2,3,12,13,14,15,16,4,5,6,7,8,9,10,11,17,18",sequence:[["groupHeader","subGroupHeader",false]],groupHeader:2,subGroupHeader:1},n)})});describe("moving into Group3",function(){function n(){expect(!!I.down("[text=Group1]").down("[text=Group3]").down("[text=Group2]").down("[text=Group4]")).toBe(true)}it("should work moving before the first nested header",function(){Y({columns:m,locked:true,order:"1,2,3,12,13,14,15,16,4,5,6,7,8,9,10,11,17,18",sequence:[["groupHeader",3,false]],groupHeader:2},n)});it("should work moving after the last nested header",function(){Y({columns:m,locked:true,order:"1,2,3,4,5,6,12,13,14,15,16,7,8,9,10,11,17,18",sequence:[["groupHeader",5,true]],groupHeader:2},n)});it("should work moving into the middle",function(){Y({columns:m,locked:true,order:"1,2,3,4,12,13,14,15,16,5,6,7,8,9,10,11,17,18",sequence:[["groupHeader",4,false]],groupHeader:2},n);Y({columns:m,locked:true,order:"1,2,3,4,5,12,13,14,15,16,6,7,8,9,10,11,17,18",sequence:[["groupHeader",4,true]],groupHeader:2},n)})})});describe("Group4",function(){describe("moving into Group1",function(){function n(){expect(!!I.down("[text=Group1]").down("[text=Group4]")).toBe(true)}it("should work moving before the first nested header",function(){Y({columns:m,locked:true,order:"1,2,12,13,3,4,5,6,7,8,9,10,11,14,15,16,17,18",sequence:[["groupHeader",2,false]],groupHeader:3},n)});it("should work moving after the last nested header",function(){Y({columns:m,locked:true,order:"1,2,3,4,5,6,7,8,12,13,9,10,11,14,15,16,17,18",sequence:[["groupHeader",7,true]],groupHeader:3},n)});it("should work moving into the middle",function(){Y({columns:m,locked:true,order:"1,2,3,12,13,4,5,6,7,8,9,10,11,14,15,16,17,18",sequence:[["groupHeader","subGroupHeader",false]],groupHeader:3,subGroupHeader:1},n);Y({columns:m,locked:true,order:"1,2,3,4,5,6,12,13,7,8,9,10,11,14,15,16,17,18",sequence:[["groupHeader","subGroupHeader",true]],groupHeader:3,subGroupHeader:1},n)})});describe("moving into Group3",function(){function n(){expect(!!I.down("[text=Group1]").down("[text=Group3]").down("[text=Group4]")).toBe(true)}it("should work moving before the first nested header",function(){Y({columns:m,locked:true,order:"1,2,3,12,13,4,5,6,7,8,9,10,11,14,15,16,17,18",sequence:[["groupHeader",3,false]],groupHeader:3},n)});it("should work moving after the last nested header",function(){Y({columns:m,locked:true,order:"1,2,3,4,5,6,12,13,7,8,9,10,11,14,15,16,17,18",sequence:[["groupHeader",5,true]],groupHeader:3},n)});it("should work moving into the middle",function(){Y({columns:m,locked:true,order:"1,2,3,4,12,13,5,6,7,8,9,10,11,14,15,16,17,18",sequence:[["groupHeader",4,false]],groupHeader:3},n);Y({columns:m,locked:true,order:"1,2,3,4,5,12,13,6,7,8,9,10,11,14,15,16,17,18",sequence:[["groupHeader",5,false]],groupHeader:3},n)})})})})})})})})})