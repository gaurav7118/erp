describe("Ext.grid.plugin.BufferedRenderer",function(){var F,A,M,J,D,E=true,C=Ext.data.ProxyStore.prototype.load,R,L=Ext.data.TreeStore.prototype.load,B,I=Ext.isIE9m?xit:it;function G(X,U,W){var Y=[],V,T,Z;for(V=0,T=X||100;V<T;V++){Z=V+1;Y.push({field1:U?('<div style="height:'+Ext.Number.randomInt(20,40)+'px">'+Z+"</div>"):W?40:Z,field2:Z,field3:Z,field4:Z,field5:Z})}return Y}function P(X,W){W=W||1;var V=[],T=W+X,U;for(U=W;U<T;++U){V.push({id:U,name:"name"+U})}return V}function K(X,U){var T=X+U,W=[],V;for(V=X;V<T;++V){W.push({id:V,namee:"name"+V})}return W}function O(U){var Y=Ext.Ajax.mockGetAllRequests(),W=U===0,T,X,V;while(Y.length){T=Y[0];X=T.options.params;V=K(W?0:X.start,W?0:X.limit);Ext.Ajax.mockComplete({status:200,responseText:Ext.encode({total:(U||W)?U:5000,data:V})});Y=Ext.Ajax.mockGetAllRequests()}}function Q(T,U){if(!U||!U.store){F=new Ext.data.Store(Ext.apply({fields:["name","email","phone"],groupField:"name",data:[{"name":"Lisa","email":"lisa@simpsons.com","phone":"555-111-1224","age":14},{"name":"Lisa","email":"aunt_lisa@simpsons.com","phone":"555-111-1274","age":34},{"name":"Bart","email":"bart@simpsons.com","phone":"555-222-1234","age":12},{"name":"Homer","email":"homer@simpsons.com","phone":"555-222-1244","age":44},{"name":"Marge","email":"marge@simpsons.com","phone":"555-222-1254","age":41}],autoDestroy:true},U))}else{F=U.store}A=new Ext.grid.Panel(Ext.apply({columns:[{header:"Name",dataIndex:"name",editor:"textfield"},{header:"Email",dataIndex:"email",flex:1,editor:{xtype:"textfield",allowBlank:false}},{header:"Phone",dataIndex:"phone",editor:"textfield"},{header:"Age",dataIndex:"age",editor:"textfield"}],store:F,width:200,height:400,renderTo:Ext.getBody()},T));J=A.view;D=A.down("tableview").bufferedRenderer}function S(X){var W=0,T=0,V=[],U;for(;W<X;W++){U=[];for(T=1;T<7;T++){U.push({treeData:"Child of "+W+", number "+T,leaf:true})}V.push({treeData:W,children:U})}return{children:V}}function H(U,T){F=new Ext.data.TreeStore({fields:["treeData"],root:S(T||20)});M=new Ext.tree.Panel(Ext.apply({columns:[{xtype:"treecolumn",text:"Tree Column",width:300,dataIndex:"treeData"}],height:800,width:500,store:F,rootVisible:false,animate:false,renderTo:Ext.getBody()},U||{}));J=M.view}function N(T){Ext.Ajax.mockComplete({status:200,responseText:Ext.JSON.encode(T)})}beforeEach(function(){R=Ext.data.ProxyStore.prototype.load=function(){C.apply(this,arguments);if(E){this.flushLoad.apply(this,arguments)}return this};B=Ext.data.TreeStore.prototype.load=function(){L.apply(this,arguments);if(E){this.flushLoad.apply(this,arguments)}return this};MockAjaxManager.addMethods()});afterEach(function(){Ext.data.ProxyStore.prototype.load=C;Ext.data.TreeStore.prototype.load=L;MockAjaxManager.removeMethods();if(A){Ext.destroy(A)}if(M){Ext.destroy(M)}F=A=M=J=D=null});describe("updateing scroller when changing width",function(){it("should update the horizontal scroll range",function(){Q();var T=J.getScrollable(),U=T.getMaxPosition().x;A.setWidth(A.getWidth()-100);expect(T.getMaxPosition().x).toBe(U+100)})});describe("autogenerating the plugin",function(){var T=Ext.grid.plugin.BufferedRenderer;it("should create an instance by default",function(){Q();expect(D instanceof T).toBe(true)});it("should not create an instance when turned off",function(){Q({bufferedRenderer:false});expect(D instanceof T).toBe(false);expect(D).toBeUndefined()});describe("locking grids",function(){var V,U;afterEach(function(){V=U=null});describe("init",function(){function W(X){var Y=X?"not":"";describe("buffered rendering = "+X,function(){beforeEach(function(){Q({bufferedRenderer:X,columns:[{header:"Name",dataIndex:"name",editor:"textfield"},{header:"Phone",dataIndex:"phone",editor:"textfield",locked:true},{header:"Age",dataIndex:"age",editor:"textfield"}]});V=A.normalGrid.bufferedRenderer;U=A.lockedGrid.bufferedRenderer});it("should "+Y+" create an instance on the ownerGrid for locking grids",function(){D=A.bufferedRenderer;expect(D instanceof T).toBe(false)});it("should "+Y+" create an instance by default on each child grid for locking grids",function(){expect(V instanceof T).toBe(X);expect(U instanceof T).toBe(X)})})}W(true);W(false)});describe("syncing locking partners when scrolling",function(){beforeEach(function(){Q({columns:[{header:"Name",dataIndex:"name",editor:"textfield",locked:true},{header:"Email",dataIndex:"email",flex:1,editor:{xtype:"textfield",allowBlank:false}},{header:"Phone",dataIndex:"phone",editor:"textfield"},{header:"Age",dataIndex:"age",editor:"textfield"}]},{data:P(1000)});V=A.normalGrid.bufferedRenderer;U=A.lockedGrid.bufferedRenderer});it("should fetch the range",function(){spyOn(V,"onRangeFetched").andCallThrough();spyOn(U,"onRangeFetched").andCallThrough();V.scrollTo(500);expect(V.onRangeFetched).toHaveBeenCalled();expect(U.onRangeFetched).toHaveBeenCalled()});it("should sync the view els",function(){V.scrollTo(500);expect(V.bodyTop).toBe(U.bodyTop)})});describe("Load requests during scrolling",function(){var Z,Y,X=Ext.define(null,{extend:"Ext.data.Model",fields:["name"],proxy:{type:"ajax",url:"/foo",reader:{rootProperty:"data"}}});function W(){if(J&&!J.destroyed){J.scrollBy(null,100)}Y=0}beforeEach(function(){Z=Ext.grid.plugin.BufferedRenderer.prototype.scrollToLoadBuffer;Ext.grid.plugin.BufferedRenderer.prototype.scrollToLoadBuffer=10000;Q({columns:[{header:"Name",dataIndex:"name",editor:"textfield"},{header:"Phone",dataIndex:"phone",editor:"textfield",locked:true},{header:"Age",dataIndex:"age",editor:"textfield"}]},{store:new Ext.data.BufferedStore({model:X,leadingBufferZone:300,pageSize:100})});F.load();N({total:1000,data:P(100)});N({total:1000,data:P(100,101)});N({total:1000,data:P(100,201)});N({total:1000,data:P(100,301)})});afterEach(function(){Ext.grid.plugin.BufferedRenderer.prototype.scrollToLoadBuffer=Z});it("should not have time between scroll events to fire off any requests",function(){spyOn(D,"doAttemptLoad");waitsFor(function(){if(D.getLastVisibleRowIndex()<=995){if(!Y){Y=setTimeout(W,50)}}else{return true}},"grid to scroll to end",Ext.isIE?40000:20000);runs(function(){expect(D.doAttemptLoad.callCount).toBe(0)})})})})});describe("Less data than the computed view size",function(){it("should add new rows at top while scrolled to bottom",function(){var T=Ext.define(null,{extend:"Ext.data.Model",fields:["name"],proxy:{type:"ajax",url:"/foo",reader:{rootProperty:"data"}}});F=new Ext.data.Store({model:T,data:P(12)});A=new Ext.grid.Panel({width:600,height:305,store:F,deferRowRender:false,columns:[{dataIndex:"id",renderer:function(U){return'<span style="line-height:25px">'+U+"</span>"},producesHTML:true},{dataIndex:"name"}],renderTo:Ext.getBody()});J=A.getView();waitsFor(function(){if(J.all.endIndex===F.getCount()-1){return true}else{J.scrollBy(null,10)}},"view is scrolled to the last record");runs(function(){F.insert(0,{id:666,name:"Old Nick"});J.scrollTo(0,0);var U=J.all.item(0,true);expect(U).not.toBeNull();expect((U.innerText||U.textContent).replace(/\n/g,"").replace(/\r/g,"")).toBe("666Old Nick")})})});describe("basic functionality with a buffered store",function(){it("should render rows in order",function(){var U=Ext.define(null,{extend:"Ext.data.Model",fields:["name"],proxy:{type:"ajax",url:"/foo",reader:{rootProperty:"data"}}});F=new Ext.data.BufferedStore({model:U,leadingBufferZone:300,pageSize:100});A=new Ext.grid.Panel({width:800,height:500,store:F,deferRowRender:false,columns:[{dataIndex:"id"},{dataIndex:"name"}],renderTo:Ext.getBody()});F.load();N({total:5000,data:P(100)});N({total:5000,data:P(100,101)});N({total:5000,data:P(100,201)});N({total:5000,data:P(100,301)});var T=A.getView(),V=T.all;waitsFor(function(){if(V.startIndex<=100&&V.endIndex>=100){return true}else{T.scrollBy(null,10)}},"View to scroll record id 100 into the rendered block",20000);runs(function(){var X=T.getNodes(),W=X.length,a=V.startIndex+1,Y,Z;expect(W).toBe(T.bufferedRenderer.viewSize);for(Y=0;Y<W;++Y){Z=T.getRecord(X[Y]);expect(Z.getId()).toBe(Y+a)}})});it("should scroll to the bottom of a locking grid with no error",function(){var T=Ext.define(null,{extend:"Ext.data.Model",fields:["name"],proxy:{type:"ajax",url:"/foo",reader:{rootProperty:"data"}}}),W,U,V;F=new Ext.data.BufferedStore({model:T,leadingBufferZone:300,pageSize:100});A=new Ext.grid.Panel({width:800,height:500,store:F,deferRowRender:false,columns:[{dataIndex:"id",locked:true},{dataIndex:"name"}],renderTo:Ext.getBody()});W=A.lockedGrid.view;U=A.normalGrid.view;W.bufferedRenderer.scrollToLoadBuffer=U.bufferedRenderer.scrollToLoadBuffer=0;F.load();N({total:5000,data:P(100)});V=U.getScrollable().getMaxPosition().y;U.setScrollY(V);waits(100);runs(function(){O()});waitsFor(function(){return W.all.endIndex===4999&&U.all.endIndex===4999})});it("should maintain synchronization when scrolling locked, variable row height grid with keyboard",function(){F=Ext.create("Ext.data.Store",{idProperty:"index",fields:["index","name","email","phone","isActive","eyeColor","company","gender"],autoLoad:true,data:[{"_id":"54ff69d95aa43325cc4eee9f","index":0,"guid":"48c42a75-09a7-4671-86a1-e9a486bee6ab","isActive":true,"balance":"$3,457.90","age":20,"eyeColor":"brown","name":"Louella Morrison","gender":"female","company":"ZBOO","email":"louellamorrison@zboo.com","phone":"+1 (803) 483-2686"},{"_id":"54ff69d918616dbc093ca6cd","index":1,"guid":"17b3f923-96b5-40c9-b3c1-721485e5bf80","isActive":true,"balance":"$1,377.85","age":20,"eyeColor":"brown","name":"Madden Coffey","gender":"male","company":"COMDOM","email":"maddencoffey@comdom.com","phone":"+1 (850) 534-2345"},{"_id":"54ff69d91a4917f9643178b0","index":2,"guid":"f62da049-ab17-49fd-9f4c-3439d33cbb93","isActive":false,"balance":"$3,798.71","age":22,"eyeColor":"blue","name":"Chase Crawford","gender":"male","company":"PYRAMAX","email":"chasecrawford@pyramax.com","phone":"+1 (944) 494-2920"},{"_id":"54ff69d9a63b6103f9e1530f","index":3,"guid":"3640c402-f878-4f97-bbda-564de91d2dde","isActive":true,"balance":"$2,480.02","age":39,"eyeColor":"blue","name":"Johanna Pollard","gender":"female","company":"ZEROLOGY","email":"johannapollard@zerology.com","phone":"+1 (813) 512-3311"},{"_id":"54ff69d9048722389ffde4bb","index":4,"guid":"361089ba-e6dc-4701-b316-c7e977b21cb2","isActive":true,"balance":"$3,973.38","age":20,"eyeColor":"brown","name":"Malone Bentley","gender":"male","company":"DIGIPRINT","email":"malonebentley@digiprint.com","phone":"+1 (905) 435-2056"},{"_id":"54ff69d9f75a66fb8e08b335","index":5,"guid":"4cec529a-232a-4d5f-bedc-6141adc9f2fa","isActive":true,"balance":"$3,956.60","age":21,"eyeColor":"green","name":"Jennings Rodgers","gender":"male","company":"LUDAK","email":"jenningsrodgers@ludak.com","phone":"+1 (833) 543-2230"},{"_id":"54ff69d974c1757e026721cb","index":6,"guid":"6ce0c1e1-adc6-4cd0-b9c9-e2214e63aa8f","isActive":true,"balance":"$2,874.71","age":40,"eyeColor":"green","name":"Mosley Mcgowan","gender":"male","company":"AMTAP","email":"mosleymcgowan@amtap.com","phone":"+1 (990) 486-3229"},{"_id":"54ff69d949a3873336e2e446","index":7,"guid":"0f88d544-4aa0-4a05-a236-363c64b40988","isActive":false,"balance":"$3,277.11","age":28,"eyeColor":"green","name":"Patton Whitaker","gender":"male","company":"IMMUNICS","email":"pattonwhitaker@immunics.com","phone":"+1 (944) 557-2615"},{"_id":"54ff69d917f9642ab989e999","index":8,"guid":"6577bb0c-f7ed-495f-a3db-7f7d35f6fe49","isActive":false,"balance":"$1,091.47","age":35,"eyeColor":"green","name":"Neal Rivera","gender":"male","company":"NETILITY","email":"nealrivera@netility.com","phone":"+1 (816) 590-2358"},{"_id":"54ff69d94573c1c04f0a9940","index":9,"guid":"29be9274-d3cb-461f-a565-2374768689df","isActive":false,"balance":"$1,885.75","age":25,"eyeColor":"brown","name":"May Barron","gender":"male","company":"TELEPARK","email":"maybarron@telepark.com","phone":"+1 (958) 486-2915"},{"_id":"54ff69d9c0e2f4aee9180984","index":10,"guid":"479320d7-70ef-4f55-99b9-f3ef3a76b72e","isActive":false,"balance":"$2,031.57","age":36,"eyeColor":"brown","name":"Janna Howell","gender":"female","company":"PYRAMIS","email":"jannahowell@pyramis.com","phone":"+1 (823) 423-2342"},{"_id":"54ff69d96e7f08b674de7cb9","index":11,"guid":"9f6df0e4-b92c-4272-ad75-981305e9bb09","isActive":true,"balance":"$2,279.79","age":33,"eyeColor":"green","name":"Nieves Short","gender":"male","company":"PETICULAR","email":"nievesshort@peticular.com","phone":"+1 (904) 556-3401"},{"_id":"54ff69d9fb987df7ecf3d8ab","index":12,"guid":"32c80cfd-d880-48a6-a3b0-e687c1e52b30","isActive":false,"balance":"$3,830.03","age":26,"eyeColor":"green","name":"Tania Gillespie","gender":"female","company":"AUSTEX","email":"taniagillespie@austex.com","phone":"+1 (969) 527-3521"},{"_id":"54ff69d9f586c6e7e9a08b4b","index":13,"guid":"e6a006c4-1d5e-4a09-9dd6-496426fc4982","isActive":false,"balance":"$3,411.76","age":32,"eyeColor":"blue","name":"Joyner Suarez","gender":"male","company":"GEOFARM","email":"joynersuarez@geofarm.com","phone":"+1 (879) 571-3671"},{"_id":"54ff69d94eaa44d993966048","index":14,"guid":"00927bfa-dfd7-4850-bfd7-a2c25c476327","isActive":true,"balance":"$2,402.44","age":35,"eyeColor":"brown","name":"Hull Cooley","gender":"male","company":"ENERVATE","email":"hullcooley@enervate.com","phone":"+1 (910) 476-3577"},{"_id":"54ff69d9b341bfef697e75ac","index":15,"guid":"cd6a241c-35a4-4038-ae01-d32640719dc7","isActive":false,"balance":"$2,889.76","age":28,"eyeColor":"green","name":"Cortez Fleming","gender":"male","company":"CIPROMOX","email":"cortezfleming@cipromox.com","phone":"+1 (964) 460-3159"},{"_id":"54ff69d9a1f835d92cb8a017","index":16,"guid":"45ad04ed-c154-4f16-a60b-d091e2ab8c13","isActive":true,"balance":"$1,994.50","age":21,"eyeColor":"green","name":"Hazel Rodriguez","gender":"female","company":"SILODYNE","email":"hazelrodriguez@silodyne.com","phone":"+1 (962) 492-3107"},{"_id":"54ff69d93989153e00dc5f02","index":17,"guid":"b2a702d1-b47e-4f2b-98f2-4ab2e70b126f","isActive":true,"balance":"$2,826.88","age":30,"eyeColor":"green","name":"Keri Pearson","gender":"female","company":"CENTICE","email":"keripearson@centice.com","phone":"+1 (858) 417-3541"},{"_id":"54ff69d9377beb85134e2761","index":18,"guid":"9bbb9bd7-d517-4bbb-a9b6-76f4fab0e5ab","isActive":false,"balance":"$1,119.17","age":24,"eyeColor":"brown","name":"Daisy Mcconnell","gender":"female","company":"MONDICIL","email":"daisymcconnell@mondicil.com","phone":"+1 (836) 470-3995"},{"_id":"54ff69d999e3637d8287287f","index":19,"guid":"c2dbece0-7554-4666-9378-805a625789db","isActive":false,"balance":"$3,855.83","age":30,"eyeColor":"blue","name":"Michelle Espinoza","gender":"female","company":"STEELFAB","email":"michelleespinoza@steelfab.com","phone":"+1 (882) 508-2376"},{"_id":"54ff69d93826cfb24af88797","index":20,"guid":"20be5f38-dc45-4a2f-8889-e9ba5ade8bed","isActive":false,"balance":"$1,366.06","age":39,"eyeColor":"blue","name":"Wall Sears","gender":"male","company":"PLAYCE","email":"wallsears@playce.com","phone":"+1 (846) 505-3782"},{"_id":"54ff69d97f6a23afdd06849c","index":21,"guid":"66fc61ba-38ef-4d49-862d-eb7d5fa68245","isActive":false,"balance":"$2,379.73","age":20,"eyeColor":"green","name":"Caldwell Cain","gender":"male","company":"ORBIXTAR","email":"caldwellcain@orbixtar.com","phone":"+1 (831) 456-3297"},{"_id":"54ff69d970154f7ac17b1438","index":22,"guid":"85b6d275-3bff-4475-8c42-0c4f8ec2d385","isActive":true,"balance":"$2,572.21","age":20,"eyeColor":"green","name":"Viola Mckay","gender":"female","company":"SPRINGBEE","email":"violamckay@springbee.com","phone":"+1 (901) 412-3479"},{"_id":"54ff69d98ac67b26bce2d4a8","index":23,"guid":"1d7460af-09a7-479a-8476-c3187a85ba8d","isActive":false,"balance":"$2,467.39","age":40,"eyeColor":"blue","name":"Gutierrez Conway","gender":"male","company":"ULTRASURE","email":"gutierrezconway@ultrasure.com","phone":"+1 (939) 438-3340"},{"_id":"54ff69d93a9b81bdb7af6473","index":24,"guid":"2da97cff-a16c-47a2-b9b0-d05d7ce8655d","isActive":false,"balance":"$2,496.66","age":20,"eyeColor":"brown","name":"Chandler Schmidt","gender":"male","company":"ZANITY","email":"chandlerschmidt@zanity.com","phone":"+1 (822) 461-2247"},{"_id":"54ff69d99e5b0a9b8db8da2b","index":26,"guid":"b8081e85-d0a9-4575-9fdd-83baa0cfe79b","isActive":false,"balance":"$3,044.12","age":21,"eyeColor":"brown","name":"Bradshaw Ware","gender":"male","company":"BEDDER","email":"bradshawware@bedder.com","phone":"+1 (932) 496-3718"},{"_id":"54ff69d9a9827e6a14480e37","index":27,"guid":"f0d49a25-fa17-4319-9f6a-9e88bb974755","isActive":true,"balance":"$1,799.46","age":38,"eyeColor":"green","name":"Krystal Bush","gender":"female","company":"ZOLAREX","email":"krystalbush@zolarex.com","phone":"+1 (928) 577-3693"},{"_id":"54ff69d97e57e2cab6272464","index":28,"guid":"40860305-ba5a-44ec-9783-21d4a1a4927b","isActive":true,"balance":"$1,856.24","age":20,"eyeColor":"green","name":"Madeline Grant","gender":"female","company":"APEXIA","email":"madelinegrant@apexia.com","phone":"+1 (895) 521-2877"},{"_id":"54ff69d9431984c9fdb6f25a","index":29,"guid":"36d78b3f-a9dd-4180-bb66-c12a1147e92d","isActive":true,"balance":"$3,971.70","age":40,"eyeColor":"brown","name":"Flora Ortiz","gender":"female","company":"ACCUSAGE","email":"floraortiz@accusage.com","phone":"+1 (992) 561-2107"},{"_id":"54ff69d9c7c52140a4572361","index":30,"guid":"ba91387f-cab7-4487-a650-1bd94a650306","isActive":false,"balance":"$1,408.31","age":37,"eyeColor":"brown","name":"Bobbie Atkins","gender":"female","company":"GRAINSPOT","email":"bobbieatkins@grainspot.com","phone":"+1 (840) 497-2564"},{"_id":"54ff69d982ac77cad23cb28d","index":31,"guid":"7068b1b5-cb81-4127-b252-ccc3ff8d3b5a","isActive":true,"balance":"$3,375.36","age":39,"eyeColor":"brown","name":"Mayer Osborne","gender":"male","company":"DEEPENDS","email":"mayerosborne@deepends.com","phone":"+1 (952) 498-3050"},{"_id":"54ff69d99aefdc9cdd70a0df","index":32,"guid":"087771d5-4f39-46aa-bad7-7a051e807770","isActive":true,"balance":"$3,345.55","age":38,"eyeColor":"blue","name":"Sullivan Gibson","gender":"male","company":"AQUASURE","email":"sullivangibson@aquasure.com","phone":"+1 (833) 463-3464"},{"_id":"54ff69d970a46678753362fc","index":33,"guid":"23e28ddc-a102-4f7c-b53b-4e3b8e45c64e","isActive":false,"balance":"$2,521.22","age":28,"eyeColor":"green","name":"Nikki Whitley","gender":"female","company":"FUTURIS","email":"nikkiwhitley@futuris.com","phone":"+1 (883) 561-2974"},{"_id":"54ff69d9f7ca2fa585ecbac6","index":34,"guid":"b711bd69-e672-48f5-8138-d3120bbedb40","isActive":true,"balance":"$2,388.02","age":21,"eyeColor":"green","name":"Juana Doyle","gender":"female","company":"HOUSEDOWN","email":"juanadoyle@housedown.com","phone":"+1 (847) 428-3271"},{"_id":"54ff69d9295e29d7b81a31be","index":35,"guid":"d393a87f-0789-4762-8ab8-d0fb66fc0fcb","isActive":true,"balance":"$1,126.53","age":32,"eyeColor":"green","name":"Marci Shaffer","gender":"female","company":"TRASOLA","email":"marcishaffer@trasola.com","phone":"+1 (929) 502-2533"},{"_id":"54ff69d9d8f81e674722a7d5","index":36,"guid":"281bbeea-5bef-4c37-8e2a-22481c9616c3","isActive":false,"balance":"$2,616.22","age":26,"eyeColor":"green","name":"Maynard Watts","gender":"male","company":"AEORA","email":"maynardwatts@aeora.com","phone":"+1 (896) 418-3281"},{"_id":"54ff69d98f504a9e6c63dedb","index":37,"guid":"48698e76-8996-40d2-9abe-3fdd8fe98cf7","isActive":true,"balance":"$3,441.08","age":21,"eyeColor":"brown","name":"Ollie Mooney","gender":"female","company":"ACCUPRINT","email":"olliemooney@accuprint.com","phone":"+1 (811) 512-3357"},{"_id":"54ff69d9fc55f5cd34359bf9","index":38,"guid":"495c9d9e-95d8-48a2-83b4-c0f314f7aa26","isActive":true,"balance":"$1,134.21","age":30,"eyeColor":"green","name":"Mattie Collins","gender":"female","company":"EARGO","email":"mattiecollins@eargo.com","phone":"+1 (800) 463-2474"},{"_id":"54ff69d94692077fe1587d2b","index":39,"guid":"9c259004-63be-4056-b291-7989cd582d41","isActive":true,"balance":"$1,429.64","age":23,"eyeColor":"brown","name":"Weeks Mcdowell","gender":"male","company":"ORBAXTER","email":"weeksmcdowell@orbaxter.com","phone":"+1 (913) 562-2677"},{"_id":"54ff69d95c44a1cefcb13a58","index":40,"guid":"44fa1564-9ef2-4503-b887-5f0f282b1bd3","isActive":false,"balance":"$1,340.36","age":30,"eyeColor":"brown","name":"Hammond Valencia","gender":"male","company":"IZZBY","email":"hammondvalencia@izzby.com","phone":"+1 (899) 577-2537"},{"_id":"54ff69d9c513f5b3c8ba15d7","index":41,"guid":"70c237d2-4a51-4b41-a5e2-e3bc1def56c5","isActive":true,"balance":"$2,979.67","age":39,"eyeColor":"brown","name":"Ramona Fitzgerald","gender":"female","company":"GOLISTIC","email":"ramonafitzgerald@golistic.com","phone":"+1 (965) 432-2851"},{"_id":"54ff69d9affa1d1749cd11d5","index":42,"guid":"80ef3c8e-b6ca-4048-9920-e651fa2a11b0","isActive":false,"balance":"$3,671.11","age":27,"eyeColor":"blue","name":"Hyde Alford","gender":"male","company":"COFINE","email":"hydealford@cofine.com","phone":"+1 (806) 588-3800"},{"_id":"54ff69d9bd4f8a5bc1e34937","index":43,"guid":"3d5ed46a-0b40-4e2d-8438-ada9007f4d49","isActive":true,"balance":"$1,051.71","age":36,"eyeColor":"brown","name":"Sonia Salazar","gender":"female","company":"RENOVIZE","email":"soniasalazar@renovize.com","phone":"+1 (855) 547-2046"},{"_id":"54ff69d9c59ba53ca1b15c7f","index":44,"guid":"fe908aad-5474-4767-baf4-66a4e9fcf106","isActive":true,"balance":"$3,531.45","age":21,"eyeColor":"blue","name":"Johnston Nolan","gender":"male","company":"VELOS","email":"johnstonnolan@velos.com","phone":"+1 (950) 510-3191"},{"_id":"54ff69d96252c760ec1787a4","index":45,"guid":"efd7b2aa-804b-4463-a1e4-7931bcac6a18","isActive":true,"balance":"$2,238.60","age":40,"eyeColor":"green","name":"Salazar Walters","gender":"male","company":"GEEKNET","email":"salazarwalters@geeknet.com","phone":"+1 (834) 510-2779"},{"_id":"54ff69d9672f19a45f583e87","index":46,"guid":"25d3dddd-3983-49ae-b7f4-224e73bdacd9","isActive":true,"balance":"$2,092.02","age":21,"eyeColor":"brown","name":"Emma Mcfarland","gender":"female","company":"COWTOWN","email":"emmamcfarland@cowtown.com","phone":"+1 (858) 410-3273"},{"_id":"54ff69d902facac3a9fc9fbf","index":47,"guid":"e22f488c-a5ad-49d3-b9ec-f3dd9f287318","isActive":false,"balance":"$1,199.34","age":39,"eyeColor":"blue","name":"Lisa Sutton","gender":"female","company":"EXTRAGEN","email":"lisasutton@extragen.com","phone":"+1 (815) 583-2428"},{"_id":"54ff69d958481e8cde608526","index":48,"guid":"aa976349-e7dc-4a38-aae7-e497c986c288","isActive":true,"balance":"$3,680.82","age":37,"eyeColor":"blue","name":"Blackburn Ingram","gender":"male","company":"EXTREMO","email":"blackburningram@extremo.com","phone":"+1 (800) 407-3564"},{"_id":"54ff69d9e28a5207c6ce32f2","index":49,"guid":"e95d0949-d9e5-4665-bee0-29697d6b6e61","isActive":true,"balance":"$3,399.52","age":24,"eyeColor":"blue","name":"Preston Hardy","gender":"male","company":"PROXSOFT","email":"prestonhardy@proxsoft.com","phone":"+1 (960) 444-3169"},{"_id":"54ff69d92e96909171f3e1b1","index":50,"guid":"0d6b5e73-7b1d-4c96-9a16-d73d0e74c364","isActive":false,"balance":"$2,920.49","age":21,"eyeColor":"green","name":"Mia Mcgee","gender":"female","company":"GEEKOLOGY","email":"miamcgee@geekology.com","phone":"+1 (921) 464-2944"},{"_id":"54ff69d94e56363d2f4110cb","index":51,"guid":"c355ad3a-a137-4dc4-9eeb-2ef6c5385076","isActive":true,"balance":"$2,738.07","age":36,"eyeColor":"brown","name":"Doris Mccullough","gender":"female","company":"PRIMORDIA","email":"dorismccullough@primordia.com","phone":"+1 (823) 470-2961"},{"_id":"54ff69d99d447d751c48fefc","index":52,"guid":"564a646d-4bd9-4e4b-bb64-522eea292751","isActive":false,"balance":"$1,966.01","age":30,"eyeColor":"brown","name":"Fernandez Shepard","gender":"male","company":"PAWNAGRA","email":"fernandezshepard@pawnagra.com","phone":"+1 (903) 453-3876"},{"_id":"54ff69d949dfc5b655d10e58","index":53,"guid":"4b07ab75-7a20-4515-9561-10323a712c37","isActive":false,"balance":"$3,447.93","age":38,"eyeColor":"green","name":"Yvette Caldwell","gender":"female","company":"OLUCORE","email":"yvettecaldwell@olucore.com","phone":"+1 (861) 417-2291"},{"_id":"54ff69d9e7ab8c4e8029f2d6","index":54,"guid":"73917fc2-53d6-4331-8ac9-ec65943d8e75","isActive":false,"balance":"$1,949.14","age":25,"eyeColor":"green","name":"Gibson Molina","gender":"male","company":"STREZZO","email":"gibsonmolina@strezzo.com","phone":"+1 (809) 485-2161"},{"_id":"54ff69d958fcd9a733351136","index":55,"guid":"ad310b11-965c-480e-9088-4d65c27d6d04","isActive":false,"balance":"$2,512.16","age":40,"eyeColor":"brown","name":"Hicks Ferguson","gender":"male","company":"COMTEXT","email":"hicksferguson@comtext.com","phone":"+1 (897) 565-2845"},{"_id":"54ff69d94a48d9b5a556f495","index":56,"guid":"17bca210-7a7f-4236-badd-4d52abc4d73f","isActive":false,"balance":"$3,950.51","age":28,"eyeColor":"brown","name":"Dale Stephens","gender":"female","company":"ZENSOR","email":"dalestephens@zensor.com","phone":"+1 (867) 474-3050"},{"_id":"54ff69d94f91296292db728e","index":57,"guid":"1cd712d4-b477-496d-aea6-d8b75f0aebcc","isActive":false,"balance":"$1,385.99","age":37,"eyeColor":"brown","name":"Burris Nash","gender":"male","company":"BRAINCLIP","email":"burrisnash@brainclip.com","phone":"+1 (873) 533-2943"},{"_id":"54ff69d9b8edd89a22d08814","index":58,"guid":"3cab0ec2-bece-43a2-b49f-1213cbd8bbb0","isActive":false,"balance":"$3,652.39","age":37,"eyeColor":"brown","name":"Janie Harrington","gender":"female","company":"ZISIS","email":"janieharrington@zisis.com","phone":"+1 (920) 441-3329"},{"_id":"54ff69d90550f9ffe4676013","index":59,"guid":"536e1f5f-474f-412e-a4ad-258a20a7cb77","isActive":false,"balance":"$3,937.99","age":24,"eyeColor":"brown","name":"Beulah Burch","gender":"female","company":"PLASTO","email":"beulahburch@plasto.com","phone":"+1 (904) 452-2143"},{"_id":"54ff69d920a5eed9e3d2cb29","index":60,"guid":"54a44fee-8614-492f-a1bd-c4a6248fce48","isActive":true,"balance":"$3,024.67","age":25,"eyeColor":"green","name":"Osborne Carter","gender":"male","company":"ARTIQ","email":"osbornecarter@artiq.com","phone":"+1 (937) 431-2440"},{"_id":"54ff69d921ee90fcb998a583","index":61,"guid":"6e899cc3-f935-405d-995c-43635d3ed121","isActive":true,"balance":"$3,189.34","age":37,"eyeColor":"green","name":"Rice Mcclain","gender":"male","company":"EVENTIX","email":"ricemcclain@eventix.com","phone":"+1 (924) 448-3107"},{"_id":"54ff69d9c70b2ae884142f6f","index":62,"guid":"0e62a562-ced9-4922-9985-8c813a647d87","isActive":false,"balance":"$2,135.22","age":34,"eyeColor":"green","name":"Jerri Knowles","gender":"female","company":"VANTAGE","email":"jerriknowles@vantage.com","phone":"+1 (926) 566-3957"},{"_id":"54ff69d950ea8f13f7e0adc3","index":63,"guid":"70e8cbfa-9f24-4e58-b827-9d683765e383","isActive":false,"balance":"$1,360.09","age":24,"eyeColor":"blue","name":"Rose Chapman","gender":"male","company":"STEELTAB","email":"rosechapman@steeltab.com","phone":"+1 (922) 514-3065"},{"_id":"54ff69d939f6877321458bf6","index":64,"guid":"ddb4264b-de31-464b-89ff-dc7b89c120c5","isActive":true,"balance":"$1,331.51","age":32,"eyeColor":"green","name":"Larson Baxter","gender":"male","company":"HALAP","email":"larsonbaxter@halap.com","phone":"+1 (968) 451-2570"},{"_id":"54ff69d9e8c4ac69c408d5a5","index":65,"guid":"92f7f97e-469f-4e61-93ba-58d440f9bdee","isActive":false,"balance":"$3,771.47","age":28,"eyeColor":"green","name":"Sweeney Shepherd","gender":"male","company":"OVOLO","email":"sweeneyshepherd@ovolo.com","phone":"+1 (963) 413-2263"},{"_id":"54ff69d97caf29d7106b9a22","index":66,"guid":"ccff96f2-0dea-4d72-ae9b-5f2c5e1bccf8","isActive":false,"balance":"$3,022.08","age":35,"eyeColor":"blue","name":"Maribel Henry","gender":"female","company":"CHILLIUM","email":"maribelhenry@chillium.com","phone":"+1 (814) 489-2410"},{"_id":"54ff69d9ea34002e4fc91d67","index":67,"guid":"133b0c0a-1517-487c-84b9-b0eb1fc8bfd1","isActive":false,"balance":"$1,995.00","age":20,"eyeColor":"brown","name":"Deann Bray","gender":"female","company":"VERTON","email":"deannbray@verton.com","phone":"+1 (847) 540-2423"},{"_id":"54ff69d9837c8279be6854e0","index":68,"guid":"d562f05e-b605-475e-b7ea-e38cf8c6b32f","isActive":true,"balance":"$1,035.74","age":35,"eyeColor":"brown","name":"Hart Dillon","gender":"male","company":"SOLAREN","email":"hartdillon@solaren.com","phone":"+1 (885) 540-3322"},{"_id":"54ff69d975a0df7615047dda","index":69,"guid":"7ec2a46e-9d61-42ad-9aa0-d06596232252","isActive":false,"balance":"$1,317.78","age":40,"eyeColor":"green","name":"Daphne Mercado","gender":"female","company":"TERRASYS","email":"daphnemercado@terrasys.com","phone":"+1 (915) 491-2470"},{"_id":"54ff69d9a6aafdf53cf7899d","index":70,"guid":"99c23548-6731-4236-a6b1-0455172d931b","isActive":false,"balance":"$3,395.05","age":22,"eyeColor":"blue","name":"Aguilar Ramsey","gender":"male","company":"SONIQUE","email":"aguilarramsey@sonique.com","phone":"+1 (918) 407-2528"},{"_id":"54ff69d98368d84760f7ffb4","index":71,"guid":"919aa130-2a9a-4c18-9f82-a4cc5fa9d18f","isActive":true,"balance":"$3,961.57","age":23,"eyeColor":"blue","name":"Alyssa Garrett","gender":"female","company":"ZORK","email":"alyssagarrett@zork.com","phone":"+1 (816) 467-3019"},{"_id":"54ff69d97100f98d64a49826","index":72,"guid":"32301d04-6bd8-4db2-a1d0-b98ae4a53877","isActive":true,"balance":"$2,245.64","age":27,"eyeColor":"blue","name":"Vickie Castro","gender":"female","company":"QUOTEZART","email":"vickiecastro@quotezart.com","phone":"+1 (894) 530-3406"},{"_id":"54ff69d944ae1efb286accdf","index":73,"guid":"a15615f1-2077-4d7f-800c-f19aad0cf45a","isActive":false,"balance":"$3,610.39","age":26,"eyeColor":"brown","name":"Sheryl Cherry","gender":"female","company":"TOYLETRY","email":"sherylcherry@toyletry.com","phone":"+1 (883) 527-2393"}]});A=Ext.create("Ext.grid.Panel",{title:"Simpsons",store:F,height:350,width:600,renderTo:document.body,columns:[{text:"index",dataIndex:"index",locked:true},{text:"Name",dataIndex:"name",locked:true,cellWrap:true,width:75},{text:"Email",dataIndex:"email",flex:1},{text:"Phone",dataIndex:"phone"},{text:"isActive",dataIndex:"isActive"},{text:"eyeColor",dataIndex:"eyeColor"},{text:"company",dataIndex:"company"},{text:"gender",dataIndex:"gender"}],region:"center"});var Y=A.normalGrid.getView(),Z=A.lockedGrid.getView(),V=Z.getScrollable(),X=Y.getScrollable(),T=Y.all,U=Z.all,W=Y.getNavigationModel();waitsFor(function(){return Y.all.getCount()});runs(function(){W.setPosition(new Ext.grid.CellContext(Z).setPosition(0,0))});waitsFor(function(){var b=Ext.Element.getActiveElement(),c=W.getPosition();if(c){if(W.getCell()&&(b===W.getCell().dom)&&T.startIndex===U.startIndex&&V.getPosition().y===X.getPosition().y){jasmine.fireKeyEvent(b,"keydown",Ext.event.Event.PAGE_DOWN)}return(W.getPosition().rowIdx===F.getCount()-1)}},"down arrow to scroll to the last row. 20 seconds expired",20000);runs(function(){var a;expect(U.getCount()).toBe(T.getCount());expect(Z.bufferedRenderer.viewSize).toBe(Y.bufferedRenderer.viewSize);for(a=T.startIndex;a<=T.endIndex;a++){expect(T.item(a).getHeight()).toBe(U.item(a).getHeight())}})})});describe("gridpanel",function(){describe("locking grid",function(){function T(U){var V=[{text:"Col 1",dataIndex:"field1",width:100,locked:true},{text:"Col 2",dataIndex:"field2",width:100},{text:"Col 3",dataIndex:"field3",width:100},{text:"Col 4",dataIndex:"field4",width:100},{text:"Col 5",dataIndex:"field5",height:25,width:150,xtype:"widgetcolumn",widget:{xtype:"progressbarwidget",height:25,textTpl:['{percent:number("0")}% capacity']}}],W;Q({columns:V},{fields:["field1","field2","field3","field4","field5"],data:G(100)});J=A.view.normalView;W=J.all;if(U){A.reconfigure(null,V)}waitsFor(function(){if(W.endIndex===99&&J.bufferedRenderer.getLastVisibleRowIndex()===99){return true}else{J.scrollBy(null,20)}},"last node to scroll into view",10000,50);runs(function(){expect(J.el.down(".x-grid-item-container").getHeight()===J.lockingPartner.el.down(".x-grid-item-container").getHeight()).toBe(true)})}it("should have the same height for each locking partner when scrolling",function(){T(false)});it("should have the same height for each locking partner when scrolling after a reconfigure",function(){T(true)})});describe("locking grid with variableRowHeight",function(){I("should keep the row heights on both sides synchronized",function(){var U=[{text:"Col 1",dataIndex:"field1",width:100,locked:true,variableRowHeight:true},{text:"Col 2",dataIndex:"field2",width:100},{text:"Col 3",dataIndex:"field3",width:100},{text:"Col 4",dataIndex:"field4",width:100},{text:"Col 5",dataIndex:"field5",height:25,width:150,xtype:"widgetcolumn",widget:{xtype:"progressbarwidget",height:25,textTpl:['{percent:number("0")}% capacity']}}],W,V,X=0,T=function(){var d=V.all.slice(),Z=W.slice(),c=d.length,b=Z.length,Y,a=true;expect(c).toBe(b);for(Y=0;a&&Y<c;Y++){a=a&&Z[Y].offsetHeight===d[Y].offsetHeight}expect(a).toBe(true);X++};Q({columns:U,syncRowHeight:true},{fields:["field1","field2","field3","field4","field5"],data:G(1000,true)});V=A.view.lockedView;J=A.view.normalView;W=J.all;J.bufferedRenderer.syncRowHeights=Ext.Function.createSequence(J.bufferedRenderer.syncRowHeights,T);V.bufferedRenderer.syncRowHeights=Ext.Function.createSequence(J.bufferedRenderer.syncRowHeights,T);waitsFor(function(){var Y=W.startIndex<=99&&W.endIndex>=99;if(Y){return J.getScrollY()===V.getScrollY()&&W.startIndex===V.all.startIndex&&V.position===J.position&&V.bodyTop===J.bodyTop}else{J.scrollBy(null,20)}},"row 99 to be rendered",20000,50);runs(function(){expect(X).toBeGreaterThan(0);expect(J.el.down(".x-grid-item-container",true).offsetHeight===J.lockingPartner.el.down(".x-grid-item-container",true).offsetHeight).toBe(true);X=0});waitsFor(function(){var Y=J.bufferedRenderer.getLastVisibleRowIndex()>990;if(Y){return J.getScrollY()===V.getScrollY()&&J.all.startIndex===V.all.startIndex}else{J.scrollBy(null,1000)}},"row 990 to scroll into view",30000,100);if(Ext.isIE8){runs(function(){A.hide();A.show()})}runs(function(){expect(X).toBeGreaterThan(0);var Y=J.el.down(".x-grid-item-container").getHeight(),Z=J.lockingPartner.el.down(".x-grid-item-container").getHeight();expect(Z).toBe(Y);X=0})})});describe("locking grid with asymmetricRowHeight",function(){it("should keep the row heights on both sides synchronized",function(){var U=[{text:"Col 1",dataIndex:"field1",width:100,locked:true},{text:"Col 2",dataIndex:"field2",width:100},{text:"Col 3",dataIndex:"field3",width:100},{text:"Col 4",dataIndex:"field4",width:100},{text:"Col 5",dataIndex:"field5",height:25,width:150,xtype:"widgetcolumn",widget:{xtype:"progressbarwidget",height:25,textTpl:['{percent:number("0")}% capacity']}}],W,V,X=0,T=function(){var d=V.all.slice(),Z=W.slice(),c=d.length,b=Z.length,Y,a=true;expect(c).toBe(b);for(Y=0;a&&Y<c;Y++){a=a&&Z[Y].offsetHeight===d[Y].offsetHeight}expect(a).toBe(true);X++};Q({columns:U,syncRowHeight:true},{fields:["field1","field2","field3","field4","field5"],data:G(1000,false,true),groupField:undefined});V=A.view.lockedView;J=A.view.normalView;W=J.all;J.bufferedRenderer.syncRowHeights=Ext.Function.createSequence(J.bufferedRenderer.syncRowHeights,T);V.bufferedRenderer.syncRowHeights=Ext.Function.createSequence(J.bufferedRenderer.syncRowHeights,T);waitsFor(function(){var Y=W.startIndex<=99&&W.endIndex>=99;if(Y){return J.getScrollY()===V.getScrollY()&&W.startIndex===V.all.startIndex&&V.position===J.position&&V.bodyTop===J.bodyTop}else{J.scrollBy(null,20)}},"row 99 to be rendered",20000,50);runs(function(){expect(X).toBeGreaterThan(0);expect(J.el.down(".x-grid-item-container").getHeight()===J.lockingPartner.el.down(".x-grid-item-container").getHeight()).toBe(true);X=0});waitsFor(function(){var Y=J.bufferedRenderer.getLastVisibleRowIndex()>990;if(Y){return J.getScrollY()===V.getScrollY()&&J.all.startIndex===V.all.startIndex}else{J.scrollBy(null,1000)}},"row 990 to scroll into view",30000,100);if(Ext.isIE8){runs(function(){A.hide();A.show()})}runs(function(){expect(X).toBeGreaterThan(0);var Y=J.el.down(".x-grid-item-container").getHeight(),Z=J.lockingPartner.el.down(".x-grid-item-container").getHeight();expect(Z).toBe(Y);X=0})})});describe("reconfiguring",function(){it("should never return `undefined` records when called in a metachange event",function(){var U={success:true,totally:1000,data:[{first:"First",last:"Last"},{first:"First",last:"Last"}],metaData:{root:"data",totalProperty:"totally",fields:["first","last"],columns:[{text:"First",dataIndex:"first"},{text:"Last",dataIndex:"last"}]}},T=false;Q(null,{data:null,fields:[],leadingBufferZone:50,pageSize:25,proxy:{type:"ajax",url:"derp"},listeners:{metachange:function(V,W){A.reconfigure(V,W.columns);T=true}}});spyOn(F.data,"getCount").andCallFake(function(){F.totalCount=1000;return 25});F.load();N(U);expect(T).toBe(true)});describe("with grouping feature",function(){it("reconfiguring should bind the groupStore to the plugin",function(){Q({features:[{ftype:"grouping"}]});A.reconfigure(F);expect(A.view.bufferedRenderer.store.isFeatureStore).toBe(true)})})});describe("refreshing the view",function(){describe("filtering out all records",function(){function T(V){var X=[],W,Y;V=V||100;for(W=0;W<V;W++){Y="emp_"+W;X.push({name:Y,email:Y+"@sencha.com",phone:"1-888-"+W,age:W})}return X}function U(V){describe("scrolled = "+V,function(){it("should trigger a view refresh",function(){var W=false;Q({viewConfig:{listeners:{refresh:function(){W=true}}}});if(V){D.scrollTo(50)}F.filter("name","______");expect(W).toBe(true)});it("should reset the view body",function(){Q(null,{data:T(500)});if(V){D.scrollTo(50);expect(D.bodyTop).toBeGreaterThan(0);expect(D.scrollHeight).toBeGreaterThan(0)}F.filter("name","______");expect(D.bodyTop).toBe(0);expect(D.scrollHeight).toBe(0)})})}U(true);U(false)})})});describe("treepanel",function(){describe("expanding/collapsing",function(){it("should always render the view nodes when expanding",function(){var T;H({height:300},100);T=J.all;waitsFor(function(){if(T.endIndex===99&&J.bufferedRenderer.getLastVisibleRowIndex()===99){return true}else{J.scrollBy(null,10)}},"last node to scroll into view",10000,50);runs(function(){F.getAt(99).expand()});waitsFor(function(){if(T.endIndex===105){return true}else{J.scrollBy(null,10)}},"new last leaf node to scroll into view",10000,50);runs(function(){expect(J.getRecord(J.all.last()).get("treeData")).toBe("Child of 99, number 6");jasmine.fireMouseEvent(T.item(99).down(".x-tree-expander"),"click")})})});describe("loadMask config",function(){it("should create a mask by default if not configured",function(){H({store:{proxy:{type:"ajax",url:"foo"}}});expect(J.loadMask instanceof Ext.LoadMask).toBe(true)});it("should honor the value if configured",function(){H({store:{proxy:{type:"ajax",url:"foo"}},viewConfig:{loadMask:false}});expect(J.loadMask).toBe(false)})});describe("Measuring row height",function(){it("should measure row height",function(){Q(null,{groupField:null,data:[{"name":'<div style="height:30px">Lisa</div>',"email":"lisa@simpsons.com","phone":"555-111-1224","age":14},{"name":"Lisa","email":"aunt_lisa@simpsons.com","phone":"555-111-1274","age":34},{"name":"Bart","email":"bart@simpsons.com","phone":"555-222-1234","age":12},{"name":"Homer","email":"homer@simpsons.com","phone":"555-222-1244","age":44},{"name":"Marge","email":"marge@simpsons.com","phone":"555-222-1254","age":41}]});var U=J.all.first(),T=U.getHeight();if(Ext.isIE8){T-=U.getBorderWidth("b")}expect(D.rowHeight).toBe(T)})})});describe("filtering the store",function(){var U,T;afterEach(function(){Ext.destroy(U,T)});it("should reset the cached position so the grid-item-container is at the top of the view on filter",function(){U=Ext.define(null,{extend:"Ext.data.Model",fields:["name"],proxy:{type:"ajax",url:"/foo",reader:{rootProperty:"data"}}});T=new Ext.data.BufferedStore({model:U,remoteGroup:true,leadingBufferZone:300,pageSize:100,autoDestroy:true});Q({columns:[{dataIndex:"name",width:100}]},{store:T});T.load();N({total:5000,data:P(100)});N({total:5000,data:P(100,101)});N({total:5000,data:P(100,201)});N({total:5000,data:P(100,301)});waitsFor(function(){J.scrollBy(null,10);return J.all.startIndex<=199&&J.all.endIndex>=199},"row 199 to scroll into the rendered block",10000);runs(function(){T.addFilter({property:"name",value:"name212"});expect(D.bodyTop).toBe(0);expect(D.position).toBe(0)})});it("should reset the cached position so the grid-item-container is at the top of the view on clearFilter",function(){var V;U=Ext.define(null,{extend:"Ext.data.Model",fields:["name"],proxy:{type:"ajax",url:"/foo",reader:{rootProperty:"data"}}});T=new Ext.data.Store({model:U,remoteFilter:false,autoDestroy:true,proxy:{type:"memory",data:P(5000)},autoLoad:true});Q({columns:[{dataIndex:"name",width:100}],selModel:{type:"rowmodel",mode:"MULTI"}},{store:T});V=A.selModel;waitsFor(function(){return J.all.startIndex===0&&J.all.getCount()});runs(function(){T.addFilter({property:"id",value:2500,operator:"<="});expect(T.getCount()).toBe(2500);jasmine.fireMouseEvent(J.getCellByPosition({row:0,column:0},true),"click");expect(J.selModel.getSelection().length).toBe(1)});waitsFor(function(){J.scrollBy(null,100);return J.all.endIndex===2499},"scroll to end",10000);runs(function(){jasmine.fireMouseEvent(J.getCellByPosition({row:2499,column:0},true),"click",null,null,null,true);expect(J.selModel.getSelection().length).toBe(2500);T.remove(V.getSelection());expect(T.getCount()).toBe(0);expect(J.all.getCount()).toBe(0);expect(J.getScrollY()).toBe(0);expect(D.bodyTop).toBe(0);expect(D.position).toBe(0);T.clearFilter();expect(T.getCount()).toBe(2500);expect(D.bodyTop).toBe(0);expect(D.position).toBe(0)})})});describe("reloading store",function(){describe("from having items to not having items",function(){it("should not cause an error when reloading",function(){var T=new Ext.data.BufferedStore({fields:["id"],autoDestroy:true,proxy:{type:"ajax",url:"/foo",reader:{type:"json",rootProperty:"data",totalProperty:"total"}}});Q({columns:[{dataIndex:"name",width:100}]},{store:T});T.load();O();T.reload();O(0);expect(J.getNodes()).toEqual([])});it("should show emptyText if specified",function(){var T=new Ext.data.BufferedStore({fields:["id"],autoDestroy:true,proxy:{type:"ajax",url:"/foo",reader:{type:"json",rootProperty:"data",totalProperty:"total"}}});Q({columns:[{dataIndex:"name",width:100}],emptyText:"Empty"},{store:T});T.load();O();T.reload();O(0);expect(A.el.down("."+A.emptyCls,true)).hasHTML("Empty")})});describe("loading the bound store",function(){function T(U){H({columns:[{xtype:"treecolumn",text:"Tree Column",width:300,locked:U,dataIndex:"task"},{text:"Task1",dataIndex:"task1"},{text:"Task2",dataIndex:"task2"},{text:"Task3",dataIndex:"task3"},{text:"Task4",dataIndex:"task4"},{text:"Task5",dataIndex:"task5"}],},1000)}it("should not scroll the view, non-locked grid",function(){T(false);expect(J.el.dom.scrollTop).toBe(0);F.load();expect(J.el.dom.scrollTop).toBe(0)});it("should not scroll the view, locked grid",function(){var V,U;T(true);lockedViewDom=J.lockedView.el.dom;normalViewDom=J.normalView.el.dom;expect(lockedViewDom.scrollTop).toBe(0);expect(normalViewDom.scrollTop).toBe(0);F.load();expect(lockedViewDom.scrollTop).toBe(0);expect(normalViewDom.scrollTop).toBe(0)})})});describe("Expanding view size",function(){var T;afterEach(function(){T.destroy()});it("should scroll to top when view size expands to encapsulate whole dataset",function(){var X=Ext.define(null,{extend:"Ext.data.Model",fields:["name"],proxy:{type:"ajax",url:"/foo",reader:{rootProperty:"data"}}});var W=new Ext.data.Store({model:X,proxy:{type:"memory",data:P(52)}});W.load();var V=new Ext.data.Store({model:X,proxy:{type:"memory",data:P(52)}});V.load();var Y=new Ext.grid.Panel({hideMode:"offsets",title:"Grid 1",store:W,deferRowRender:false,columns:[{dataIndex:"id"},{dataIndex:"name"}]});var Z=new Ext.grid.Panel({hideMode:"offsets",title:"Grid 2",store:V,deferRowRender:false,columns:[{dataIndex:"id"},{dataIndex:"name"}]});T=new Ext.window.Window({title:"Test",height:395,width:800,x:10,y:10,autoShow:true,maximizable:true,minimizable:true,constrain:false,layout:"fit",items:{xtype:"tabpanel",items:[Y,Z]}});var a=T.child("tabpanel");var U=Y.getView();waitsFor(function(){U.scrollBy(null,100);return U.all.endIndex===U.store.getCount()-1},"scroll to end",10000);runs(function(){U.scrollBy(null,100);a.setActiveTab(1);Y.store.insert(0,{"title":"hi",replycount:5});Y.store.insert(0,{"title":"hi2",replycount:5});Z.store.insert(0,{"title":"hi",replycount:5});Z.store.insert(0,{"title":"hi2",replycount:5});a.setActiveTab(0);T.setHeight(940)});waitsFor(function(){U.scrollBy(null,-100);return U.getScrollY()===0},"scroll to top",10000);runs(function(){expect(U.bufferedRenderer.bodyTop).toBe(0)})})});describe("ensureVisible",function(){it("should work in a viewready listener",function(){var T,U=[{text:"Col 1",dataIndex:"field1",width:100},{text:"Col 2",dataIndex:"field2",width:100},{text:"Col 3",dataIndex:"field3",width:100},{text:"Col 4",dataIndex:"field4",width:100}];Q({columns:U,listeners:{viewready:function(V){V.ensureVisible(V.getStore().last(),{callback:function(){T=true}})}}},{fields:["field1","field2","field3","field4"],data:G(1000)});waitsFor(function(){return T});expect(J.all.endIndex).toBe(999);expect(J.bufferedRenderer.getLastVisibleRowIndex()).toBe(999)})})})