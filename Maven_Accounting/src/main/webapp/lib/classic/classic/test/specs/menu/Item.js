describe("Ext.menu.Item",function(){var D,C;function B(E,F){D=Ext.widget(Ext.apply({xtype:"menu",items:E},F));D.show();C=D.items.getAt(0)}afterEach(function(){Ext.destroy(D,C);D=C=null});function A(F,E){F=F||C;jasmine.fireMouseEvent(F.itemEl.dom,"click");if(E){F.itemEl.dom.click()}}describe("on click",function(){describe("click event/handler",function(){var E;beforeEach(function(){E=jasmine.createSpy()});afterEach(function(){E=null});describe("handler",function(){it("should fire the handler",function(){B({text:"Foo",handler:E});A();expect(E.callCount).toBe(1)});it("should not fire when disabled",function(){B({text:"Foo",handler:E,disabled:true});A();expect(E).not.toHaveBeenCalled()});it("should pass the item and the event object",function(){B({text:"Foo",handler:E});A();var F=E.mostRecentCall.args;expect(F[0]).toBe(C);expect(F[1] instanceof Ext.event.Event).toBe(true)});it("should default the scope to the item",function(){B({text:"Foo",handler:E});A();expect(E.mostRecentCall.object).toBe(C)});it("should used the passed scope",function(){var F={};B({text:"Foo",scope:F,handler:E});A();expect(E.mostRecentCall.object).toBe(F)});it("should be able to route the handler to a view controller",function(){var F=new Ext.app.ViewController();F.onFoo=E;B({text:"Foo",handler:"onFoo"},{controller:F});A();expect(E.callCount).toBe(1)});it("should have the menu hidden when the handler fires with hideOnClick: true",function(){var F;B({text:"Foo",handler:E.andCallFake(function(){F=D.isVisible()})});A();expect(F).toBe(false)});it("should fire the handler after the click event",function(){var F=[];B({text:"Foo",listeners:{click:function(){F.push("click")}},handler:function(){F.push("handler")}});A();expect(F).toEqual(["click","handler"])});it("should not call the handler if the click event returns false",function(){B({text:"Foo",listeners:{click:function(){return false}},handler:E});A();expect(E).not.toHaveBeenCalled()});it("it should not fire the callback if the menu is destroyed in the click event",function(){B({text:"Foo",listeners:{click:function(){D.destroy()}},handler:E});A();expect(E).not.toHaveBeenCalled()})});describe("click event",function(){it("should fire the click event",function(){B({text:"Foo",listeners:{click:E}});A();expect(E.callCount).toBe(1)});it("should not fire when disabled",function(){B({text:"Foo",listeners:{click:E},disabled:true});A();expect(E).not.toHaveBeenCalled()});it("should pass the item and the event object",function(){B({text:"Foo",listeners:{click:E}});A();var F=E.mostRecentCall.args;expect(F[0]).toBe(C);expect(F[1] instanceof Ext.event.Event).toBe(true)});it("should have the menu hidden when the handler fires with hideOnClick: true",function(){var F;B({text:"Foo",listeners:{click:E.andCallFake(function(){F=D.isVisible()})}});A();expect(F).toBe(false)})})});describe("hideOnClick",function(){it("should hide the menu with hideOnClick: true",function(){B({text:"Foo",hideOnClick:true});A();expect(D.isVisible()).toBe(false)});it("should not hide the menu with hideOnClick: false",function(){B({text:"Foo",hideOnClick:false});A();expect(D.isVisible()).toBe(true)});describe("hierarchy",function(){function E(F){F.activated=true;F.expandMenu(null,0);return F.menu}it("should hide a parent menu",function(){B({text:"Foo",menu:{items:[{text:"Bar"}]}});var G=D.items.first(),F=G.menu;E(G);A(F.items.first());expect(F.isVisible()).toBe(false);expect(D.isVisible()).toBe(false)});it("should hide all parent menus",function(){B({text:"Foo",menu:{items:{text:"Bar",menu:{items:{text:"Baz",menu:{items:{text:"Qux"}}}}}}});var H=E(D.items.first()),G=E(H.items.first()),F=E(G.items.first());A(F.items.first());expect(F.isVisible()).toBe(false);expect(G.isVisible()).toBe(false);expect(H.isVisible()).toBe(false);expect(D.isVisible()).toBe(false)})})});describe("href property",function(){var E;afterEach(function(){E=null;location.hash=""});it("should follow the target",function(){B([{text:"menu item one",href:"#ledzep"},{text:"menu item two"}]);D.activeItem=D.focusedItem=C;A(C,Ext.isIE9m);waitsFor(function(){return location.hash==="#ledzep"},"timed out waiting for hash to change",1000);runs(function(){expect(location.hash).toBe("#ledzep")})});(Ext.isIE10p?xit:it)("should not follow the target link if the click listener stops the event",function(){var F=Ext.isIE?"#":"";B([{text:"menu item one",href:"#motley",listeners:{click:function(G,H){H.preventDefault()}}},{text:"menu item two"}]);D.activeItem=D.focusedItem=C;A(C,Ext.isIE9m);waitsFor(function(){return location.hash===F},"timed out waiting for hash to change",1000);runs(function(){expect(location.hash).toBe(F)})})})});describe("disabled",function(){describe("when item has an href config",function(){it("should stop the event",function(){B({disabled:true,href:"#menu"});A();expect(location.hash).not.toBe("menu")})});it("should gain focus but not activate on mouseover",function(){B([{text:"Foo",disabled:true}]);var E=D.items.getAt(0);jasmine.fireMouseEvent(E.getEl(),"mouseover");waitsFor(function(){return E.containsFocus===true},"Never focused");runs(function(){expect(E.activated).toBe(false)})});describe("submenu",function(){it("should not show a submenu on mouseover",function(){B([{text:"Foo",disabled:true,menuExpandDelay:0,menu:{items:[{text:"Sub1"}]}}]);var F=D.items.getAt(0),E=F.getMenu();jasmine.fireMouseEvent(F.getEl(),"mouseover");waitsFor(function(){return F.containsFocus===true},"Never focused");runs(function(){expect(E.isVisible()).toBe(false)})})})});describe("when destroying",function(){var E;beforeEach(function(){E=new Ext.menu.Menu();B([{text:"The Office, UK",menu:E}]);C.destroy()});afterEach(function(){E=null});it("should destroy its menu",function(){expect(E.destroyed).toBe(true)});it("should cleanup its menu reference",function(){expect(C.menu).toBe(null)})});describe("binding",function(){it("should be able to bind properties higher up in the hierarchy",function(){var F=new Ext.app.ViewModel({data:{title:"someTitle"}});B({text:"Foo",menu:{bind:{title:"{title}"}}},{viewModel:F});var E=C.menu;E.show();F.notify();expect(E.getTitle()).toBe("someTitle")})});describe("ARIA",function(){function F(G,H){jasmine.expectAriaAttr(C,G,H)}function E(G){jasmine.expectNoAriaAttr(C,G)}describe("simple",function(){beforeEach(function(){B({text:"foo"});D.show()});it("should have itemEl as ariaEl",function(){expect(C.ariaEl).toBe(C.itemEl)});it("should have menuitem role",function(){F("role","menuitem")});it("should not have aria-haspopup",function(){E("aria-haspopup")});it("should not have aria-owns",function(){E("aria-owns")})});describe("plain",function(){beforeEach(function(){B({text:"plain",plain:true});D.show()});it("should have el as ariaEl",function(){expect(C.ariaEl).toBe(C.el)});it("should have menuitem role",function(){F("role","menuitem")});it("should not have aria-haspopup",function(){E("aria-haspopup")});it("should not have aria-owns",function(){E("aria-owns")})});describe("with submenu",function(){describe("via config",function(){beforeEach(function(){B({text:"submenu",menu:{items:[{text:"sub-item"}]}});D.show()});it("should have aria-haspopup",function(){F("aria-haspopup","true")});it("should have aria-owns",function(){F("aria-owns",C.menu.id)})});describe("adding via setMenu",function(){beforeEach(function(){B({text:"submenu"})});describe("before rendering",function(){beforeEach(function(){C.setMenu({items:[{text:"sub-item"}]});D.show()});it("should have aria-haspopup",function(){F("aria-haspopup","true")});it("should have aria-owns",function(){F("aria-owns",C.menu.id)})});describe("after rendering",function(){beforeEach(function(){D.show();C.setMenu({items:[{text:"sub-item"}]})});it("should have aria-haspopup",function(){F("aria-haspopup","true")});it("should have aria-owns",function(){F("aria-owns",C.menu.id)})})});describe("removing via setMenu",function(){beforeEach(function(){B({text:"submenu",menu:{items:[{text:"sub-item"}]}})});describe("before rendering",function(){beforeEach(function(){C.setMenu(null)});it("should not have aria-haspopup",function(){E("aria-haspopup")});it("should have no aria-owns",function(){E("aria-owns")})});describe("after rendering",function(){beforeEach(function(){D.show();C.setMenu(null)});it("should not have aria-haspopup",function(){E("aria-haspopup")});it("should not have aria-owns",function(){E("aria-owns")})})})})})})