describe("Ext.panel.Panel",function(){var B,D;function A(E){B=new Ext.panel.Panel(Ext.apply({renderTo:Ext.getBody()},E))}afterEach(function(){B=D=Ext.destroy(B,D)});function C(){B.el.dom.setAttribute("data-sticky","true");B=null}describe("toolbars",function(){describe("vertical toolbars",function(){describe("lbar",function(){it("should default to vertical: true",function(){A({lbar:[{text:"Foo"}]});expect(B.down("toolbar").vertical).toBe(true)});it("should respect a configured vertical: false",function(){A({lbar:{vertical:false,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({lbar:{vertical:true,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})});describe("rbar",function(){it("should default to vertical: true",function(){A({rbar:[{text:"Foo"}]});expect(B.down("toolbar").vertical).toBe(true)});it("should respect a configured vertical: false",function(){A({rbar:{vertical:false,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({rbar:{vertical:true,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})});describe("dock: left",function(){it("should default to vertical: true",function(){A({dockedItems:{xtype:"toolbar",dock:"left",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)});it("should respect a configured vertical: false",function(){A({dockedItems:{xtype:"toolbar",vertical:false,dock:"left",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({dockedItems:{xtype:"toolbar",vertical:true,dock:"left",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})});describe("dock: right",function(){it("should default to vertical: true",function(){A({dockedItems:{xtype:"toolbar",dock:"right",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)});it("should respect a configured vertical: false",function(){A({dockedItems:{xtype:"toolbar",vertical:false,dock:"right",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({dockedItems:{xtype:"toolbar",vertical:true,dock:"right",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})})});describe("horizontal toolbars",function(){describe("tbar",function(){it("should default to vertical: false",function(){A({tbar:[{text:"Foo"}]});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: false",function(){A({tbar:{vertical:false,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({tbar:{vertical:true,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})});describe("bbar",function(){it("should default to vertical: false",function(){A({bbar:[{text:"Foo"}]});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: false",function(){A({bbar:{vertical:false,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({bbar:{vertical:true,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})});describe("dock: top",function(){it("should default to vertical: false",function(){A({dockedItems:{xtype:"toolbar",dock:"top",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: false",function(){A({dockedItems:{xtype:"toolbar",vertical:false,dock:"top",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({dockedItems:{xtype:"toolbar",vertical:true,dock:"top",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})});describe("dock: bottom",function(){it("should default to vertical: false",function(){A({dockedItems:{xtype:"toolbar",dock:"bottom",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: false",function(){A({dockedItems:{xtype:"toolbar",vertical:false,dock:"bottom",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({dockedItems:{xtype:"toolbar",vertical:true,dock:"bottom",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})})})});describe("toolbars",function(){describe("vertical toolbars",function(){describe("lbar",function(){it("should default to vertical: true",function(){A({lbar:[{text:"Foo"}]});expect(B.down("toolbar").vertical).toBe(true)});it("should respect a configured vertical: false",function(){A({lbar:{vertical:false,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({lbar:{vertical:true,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})});describe("rbar",function(){it("should default to vertical: true",function(){A({rbar:[{text:"Foo"}]});expect(B.down("toolbar").vertical).toBe(true)});it("should respect a configured vertical: false",function(){A({rbar:{vertical:false,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({rbar:{vertical:true,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})});describe("dock: left",function(){it("should default to vertical: true",function(){A({dockedItems:{xtype:"toolbar",dock:"left",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)});it("should respect a configured vertical: false",function(){A({dockedItems:{xtype:"toolbar",vertical:false,dock:"left",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({dockedItems:{xtype:"toolbar",vertical:true,dock:"left",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})});describe("dock: right",function(){it("should default to vertical: true",function(){A({dockedItems:{xtype:"toolbar",dock:"right",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)});it("should respect a configured vertical: false",function(){A({dockedItems:{xtype:"toolbar",vertical:false,dock:"right",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({dockedItems:{xtype:"toolbar",vertical:true,dock:"right",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})})});describe("horizontal toolbars",function(){describe("tbar",function(){it("should default to vertical: false",function(){A({tbar:[{text:"Foo"}]});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: false",function(){A({tbar:{vertical:false,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({tbar:{vertical:true,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})});describe("bbar",function(){it("should default to vertical: false",function(){A({bbar:[{text:"Foo"}]});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: false",function(){A({bbar:{vertical:false,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({bbar:{vertical:true,items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})});describe("dock: top",function(){it("should default to vertical: false",function(){A({dockedItems:{xtype:"toolbar",dock:"top",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: false",function(){A({dockedItems:{xtype:"toolbar",vertical:false,dock:"top",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({dockedItems:{xtype:"toolbar",vertical:true,dock:"top",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})});describe("dock: bottom",function(){it("should default to vertical: false",function(){A({dockedItems:{xtype:"toolbar",dock:"bottom",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: false",function(){A({dockedItems:{xtype:"toolbar",vertical:false,dock:"bottom",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(false)});it("should respect a configured vertical: true",function(){A({dockedItems:{xtype:"toolbar",vertical:true,dock:"bottom",items:[{text:"Foo"}]}});expect(B.down("toolbar").vertical).toBe(true)})})})});describe("percentage width children of fixed width Panel",function(){it("should pass through %age widths to the child's style",function(){A({width:500,height:280,title:"AutoLayout Panel",layout:"auto",renderTo:Ext.getBody(),items:[{xtype:"panel",title:"Top Inner Panel",width:"35%",height:90},{xtype:"panel",title:"Bottom Inner Panel",width:"75%",height:90}]});expect(B.child("[title=Top Inner Panel]").el.dom.style.width).toEqual("35%");expect(B.child("[title=Bottom Inner Panel]").el.dom.style.width).toEqual("75%")})});describe("collapsible",function(){describe("horizontal collapsing",function(){it("should add the correct vertical classes",function(){A({width:100,height:100,title:"Foo",collapsible:true,animCollapse:false,collapseDirection:"left"});B.collapse();var E=B.getReExpander().getEl();expect(E).toHaveCls("x-panel-header-default-vertical")})});describe("collapse dimensions",function(){describe("static sizes",function(){describe("collapse vertical",function(){it("should restore an auto height",function(){A({width:100,title:"Foo",collapsible:true,animCollapse:false,html:'<div style="height: 20px;"></div>'});var E=B.getHeight();B.collapse();B.update('<div style="height: 50px;"></div>');B.expand();expect(B.getHeight()).toBe(E+30)});it("should restore a fixed height",function(){A({width:100,height:100,title:"Foo",collapsible:true,animCollapse:false});B.collapse();B.expand();expect(B.getHeight()).toBe(100)})});describe("collapse horizontal",function(){it("should restore an auto width",function(){A({collapseDirection:"left",height:100,title:"Foo",collapsible:true,animCollapse:false,html:'<div style="width: 20px;"></div>',shadow:false,floating:true});B.show();var E=B.getWidth();B.collapse();B.update('<div style="width: 50px;"></div>');B.expand();expect(B.getWidth()).toBe(E+30)});it("should restore a fixed width",function(){A({width:100,height:100,title:"Foo",collapsible:true,animCollapse:false});B.collapse();B.expand();expect(B.getWidth()).toBe(100)})})});describe("changing size while collapsed",function(){it("should set the width when the width changes while collapsed vertically",function(){A({width:100,height:100,title:"Foo",collapsible:true,animCollapse:false});B.collapse();B.setWidth(200);B.expand();expect(B.getWidth()).toBe(200)});it("should set the height when the height changes while collapsed horizontally",function(){A({collapseDirection:"left",width:100,height:100,title:"Foo",collapsible:true,animCollapse:false});B.collapse();B.setHeight(200);B.expand();expect(B.getHeight()).toBe(200)});describe("inside a container",function(){it("should resize width",function(){D=Ext.create("Ext.container.Container",{renderTo:Ext.getBody(),width:100,height:100,layout:"fit",items:{title:"Foo",collapsible:true,margin:10,animCollapse:false}});B=D.items.first();B.collapse();D.setWidth(200);B.expand();expect(B.getWidth()).toBe(180)});it("should resize height",function(){D=Ext.create("Ext.container.Container",{renderTo:Ext.getBody(),width:100,height:100,layout:"fit",items:{title:"Foo",collapsible:true,margin:10,animCollapse:false,collapseDirection:"left"}});B=D.items.first();B.collapse();D.setHeight(200);B.expand();expect(B.getHeight()).toBe(180)})})});describe("setCollapsed",function(){it("should call collapse the panel when true is passed",function(){A({collapsible:true});spyOn(B,"collapse").andCallThrough();B.setCollapsed(true);expect(B.collapse).toHaveBeenCalled();expect(B.collapsed).toBeTruthy()});it("should call expand() when false is passed",function(){A({collapsible:true,collapsed:true});spyOn(B,"expand").andCallThrough();B.setCollapsed(false);expect(B.expand).toHaveBeenCalled();expect(B.collapsed).toBe(false)})})});describe("collapseTool",function(){var E;beforeEach(function(){E=function(){return B.down("tool")}});afterEach(function(){E=null});it("should not create a collapse tool if collapsible: false",function(){A({width:50,height:50,title:"x",collapsible:false});expect(E()).toBeNull()});Ext.Array.forEach([{collapsed:false,collapseDirection:"top",expect:"collapse-top"},{collapsed:false,collapseDirection:"right",expect:"collapse-right"},{collapsed:false,collapseDirection:"bottom",expect:"collapse-bottom"},{collapsed:false,collapseDirection:"left",expect:"collapse-left"},{collapsed:true,collapseDirection:"top",expect:"expand-bottom"},{collapsed:true,collapseDirection:"right",expect:"expand-left"},{collapsed:true,collapseDirection:"bottom",expect:"expand-top"},{collapsed:true,collapseDirection:"left",expect:"expand-right"}],function(F){var G=F.expect;delete F.expect;it("should render the correct tool with default collapseMode "+Ext.encode(F),function(){A(Ext.apply({width:50,height:50,title:"x",collapsible:true},F));expect(E().type).toBe(G)})});Ext.Array.forEach([{collapsed:false,collapseDirection:"top",expect:"collapse-top"},{collapsed:false,collapseDirection:"right",expect:"collapse-right"},{collapsed:false,collapseDirection:"bottom",expect:"collapse-bottom"},{collapsed:false,collapseDirection:"left",expect:"collapse-left"},{collapsed:true,collapseDirection:"top",expect:"collapse-top"},{collapsed:true,collapseDirection:"right",expect:"collapse-right"},{collapsed:true,collapseDirection:"bottom",expect:"collapse-bottom"},{collapsed:true,collapseDirection:"left",expect:"collapse-left"}],function(F){var G=F.expect;delete F.expect;it("should render the correct tool with the collapseMode placeHolder "+Ext.encode(F),function(){var H=new Ext.container.Container({renderTo:Ext.getBody()});A(Ext.apply({renderTo:null,width:50,height:50,title:"x",collapsible:true,collapseMode:"placeholder"},F));H.add(B);expect(E().type).toBe(G);Ext.destroy(H)})})});describe("animation",function(){it("should honor numeric animCollapse value",function(){runs(function(){A({title:"Hello",animCollapse:50,collapsible:true,width:200,x:100,y:100,html:"<p>World!</p>"});B.collapse()});waitsFor(function(){return B.collapsed==="top"},"Never collapsed");runs(function(){expect(B.collapsed).toBe("top")})})})});describe("tools",function(){it("should add tools from the config",function(){A({renderTo:Ext.getBody(),tools:[{type:"help"},{type:"pin"}]});expect(B.tools[0].type).toBe("help");expect(B.tools[1].type).toBe("pin")});it("should add tools after rendering",function(){A({renderTo:Ext.getBody(),tools:[{type:"help"},{type:"pin"}]});B.addTool({type:"save"});expect(B.tools[2].type).toBe("save")})});describe("autoHeight with dock bottom item",function(){var E=Ext.failedLayouts;beforeEach(function(){E=Ext.failedLayouts});it("should work",function(){A({frame:true,title:"Test",width:500,bodyStyle:"background-color: yellow;",dockedItems:[{xtype:"component",dock:"top",style:"height:26px;background-color:red;"},{xtype:"component",dock:"bottom",style:"height:36px;background-color:blue;"}],items:[{xtype:"component",style:"width:100px; height:125px;background-color:green;"}]});expect(B.el.getHeight()).toBe(28+4+26+1+125+1+36+4+1);if(E!=Ext.failedLayouts){expect("failedLayout=true").toBe("false")}})});describe("render",function(){it("should allow a docked item to veto its render",function(){B=new Ext.panel.Panel({renderTo:Ext.getBody(),dockedItems:[{xtype:"component",itemId:"paneldockedchild",listeners:{beforerender:function(){return false}}}]});expect(B.child("#paneldockedchild").rendered).toBe(false)});it("should be able to modify during rendering",function(){B=new Ext.panel.Panel({renderTo:Ext.getBody(),items:{xtype:"component",listeners:{beforerender:function(E){E.ownerCt.disable()}}}});expect(B.getEl().hasCls(B.disabledCls)).toBe(true)})});describe("header",function(){var E="resources/images/foo.gif";it("should create a header if a header config is passed",function(){A({header:{title:"Foo"}});var F=B.header;expect(F.isHeader).toBe(true);expect(F.getTitle().getText()).toBe("Foo")});it("should create a header when specifying a title",function(){A({title:"Foo"});expect(B.header.isHeader).toBe(true)});it("should create a header when specifying an icon",function(){A({icon:E});expect(B.header.isHeader).toBe(true)});it("should create a header when specifying a iconCls",function(){A({iconCls:"Foo"});expect(B.header.isHeader).toBe(true)});it("should create a header when specifying tools",function(){A({tools:[{type:"refresh"}]});expect(B.header.isHeader).toBe(true)});it("should create a header when specifying collapsible",function(){A({collapsible:true});expect(B.header.isHeader).toBe(true)});describe("with header false",function(){it("should not create a header with header: false when specifying a title",function(){A({header:false,title:"Foo"});expect(B.header).toBe(false)});it("should not create a header with header: false when specifying an icon",function(){A({header:false,icon:E});expect(B.header).toBe(false)});it("should not create a header with header: false when specifying a iconCls",function(){A({header:false,iconCls:"Foo"});expect(B.header).toBe(false)});it("should not create a header with header: false when specifying tools",function(){A({header:false,tools:[{type:"refresh"}]});expect(B.header).toBe(false)});it("should not create a header with header: false when specifying collapsible",function(){A({header:false,collapsible:true});expect(B.header).toBe(false)})})});describe("setTitle",function(){describe("before render",function(){describe("with no title",function(){it("should update the title when rendered",function(){A({renderTo:null});B.setTitle("Bar");B.render(Ext.getBody());expect(B.header.getTitle().textEl.dom).hasHTML("Bar")});it("should not modify the tools when setting the title",function(){A({renderTo:null,tools:[{type:"close"}]});B.setTitle("Bar");B.render(Ext.getBody());expect(B.header.query("tool").length).toBe(1)});it("should be able to set the title in the beforerender listener",function(){A({renderTo:Ext.getBody(),listeners:{beforerender:function(E){E.setTitle("Bar")}}});expect(B.header.getTitle().textEl.dom).hasHTML("Bar")});it("should be able to set the title in the beforeRender template method",function(){var E=Ext.define(null,{extend:"Ext.panel.Panel",beforeRender:function(){this.callParent(arguments);this.setTitle("Bar")}});B=new E({renderTo:Ext.getBody()});expect(B.header.getTitle().textEl.dom).hasHTML("Bar")})});describe("with an existing title",function(){it("should update the title when rendered",function(){A({renderTo:null,title:"Foo"});B.setTitle("Bar");B.render(Ext.getBody());expect(B.header.getTitle().textEl.dom).hasHTML("Bar")});it("should not modify the tools when setting the title",function(){A({renderTo:null,tools:[{type:"close"}],title:"Foo"});B.setTitle("Bar");B.render(Ext.getBody());expect(B.header.query("tool").length).toBe(1)});it("should be able to set the title in the beforerender listener",function(){A({title:"Foo",renderTo:Ext.getBody(),listeners:{beforerender:function(E){E.setTitle("Bar")}}});expect(B.header.getTitle().textEl.dom).hasHTML("Bar")});it("should be able to set the title in the beforeRender template method",function(){var E=Ext.define(null,{extend:"Ext.panel.Panel",title:"Foo",beforeRender:function(){this.callParent(arguments);this.setTitle("Bar")}});B=new E({renderTo:Ext.getBody()});expect(B.header.getTitle().textEl.dom).hasHTML("Bar")})})});describe("after render",function(){describe("with no title",function(){it("should create the title when rendered",function(){A();B.setTitle("Bar");expect(B.header.getTitle().textEl.dom).hasHTML("Bar")})});describe("with a title",function(){it("should update the title when rendered",function(){A({title:"Foo"});B.setTitle("Bar");expect(B.header.getTitle().textEl.dom).hasHTML("Bar")})});it("should update the layout when the title is set after render",function(){B=Ext.create({xtype:"panel",renderTo:document.body,height:200,width:200,headerPosition:"left",header:{titleRotation:0}});B.header.setTitle('<div style="width:100px"></div>');expect(B.header.getWidth()).toBe(115);B.header.getTitle().setText('<div style="width:50px"></div>');expect(B.header.getWidth()).toBe(65);B.destroy()})})});describe("body styling",function(){var E=function(F){B=new Ext.panel.Panel(Ext.apply({},F))};describe("setBodyStyle",function(){describe("before rendering",function(){it("should be able to set a single key value pair",function(){E();B.setBodyStyle("color","red");B.render(Ext.getBody());expect(B.body.dom.style.color).toBe("red")});it("should be able to set a multiple key value pairs",function(){E();B.setBodyStyle("color","red");B.setBodyStyle("background-color","blue");B.render(Ext.getBody());expect(B.body.dom.style.color).toBe("red");expect(B.body.dom.style.backgroundColor).toBe("blue")});it("should be able to set a style string",function(){E();B.setBodyStyle("color: red; background-color: blue;");B.render(Ext.getBody());expect(B.body.dom.style.color).toBe("red");expect(B.body.dom.style.backgroundColor).toBe("blue")});it("should be able to set a style object",function(){E();B.setBodyStyle({color:"red",backgroundColor:"blue"});B.render(Ext.getBody());expect(B.body.dom.style.color).toBe("red");expect(B.body.dom.style.backgroundColor).toBe("blue")})});describe("after rendering",function(){it("should be able to set a single key value pair",function(){A();B.setBodyStyle("color","red");expect(B.body.dom.style.color).toBe("red")});it("should be able to set a multiple key value pairs",function(){A();B.setBodyStyle("color","red");B.setBodyStyle("background-color","blue");expect(B.body.dom.style.color).toBe("red");expect(B.body.dom.style.backgroundColor).toBe("blue")});it("should be able to set a style string",function(){A();B.setBodyStyle("color: red; background-color: blue;");expect(B.body.dom.style.color).toBe("red");expect(B.body.dom.style.backgroundColor).toBe("blue")});it("should be able to set a style object",function(){A();B.setBodyStyle({color:"red",backgroundColor:"blue"});expect(B.body.dom.style.color).toBe("red");expect(B.body.dom.style.backgroundColor).toBe("blue")})})});describe("addBodyCls",function(){describe("before rendering",function(){it("should add a class to the body",function(){E();B.addBodyCls("foo");B.render(Ext.getBody());expect(B.body.hasCls("foo")).toBe(true)});it("should add a class to the body after being removed",function(){E();B.addBodyCls("foo");B.removeBodyCls("foo");B.addBodyCls("foo");B.render(Ext.getBody());expect(B.body.hasCls("foo")).toBe(true)})});describe("after rendering",function(){it("should add a class to the body",function(){A();B.addBodyCls("foo");expect(B.body.hasCls("foo")).toBe(true)});it("should add a class to the body after being removed",function(){A();B.addBodyCls("foo");B.removeBodyCls("foo");B.addBodyCls("foo");expect(B.body.hasCls("foo")).toBe(true)})})});describe("removeBodyCls",function(){describe("before rendering",function(){it("should remove a class added to the body",function(){E();B.addBodyCls("foo");B.removeBodyCls("foo");B.render(Ext.getBody());expect(B.body.hasCls("foo")).toBe(false)})});describe("after rendering",function(){it("should remove a class added to the body",function(){A();B.addBodyCls("foo");B.removeBodyCls("foo");expect(B.body.hasCls("foo")).toBe(false)})})})});describe("margin",function(){it("should put configured margins on the element",function(){A({margin:10,width:200,height:200});var E=B.el.getMargin();expect(E.t).toBe(10);expect(E.r).toBe(10);expect(E.b).toBe(10);expect(E.l).toBe(10)});it("should set margins after render",function(){A({width:200,height:200});B.setMargin("1 2 3 4");var E=B.el.getMargin();expect(E.t).toBe(1);expect(E.r).toBe(2);expect(E.b).toBe(3);expect(E.l).toBe(4)});it("should relayout a parent to reposition if necessary",function(){var E=new Ext.container.Container({layout:"hbox",renderTo:Ext.getBody(),width:600,height:200,items:[{title:"Foo",width:100},{title:"Bar",margin:"0 0 0 50",width:100}]});var G=E.items.last(),F=G.getEl().getLeft();G.setMargin("0 0 0 100");expect(G.getEl().getLeft()).toBe(F+50);E.destroy()})});describe("minButtonWidth",function(){it("should apply minButtonWidth to button configs",function(){A({minButtonWidth:75,width:400,height:200,buttons:[{itemId:"a",text:"A"},{itemId:"b",text:"B"}]});expect(B.down("#a").minWidth).toBe(75);expect(B.down("#b").minWidth).toBe(75)});it("should apply minButtonWidth to button instances",function(){A({minButtonWidth:75,width:400,height:200,buttons:[new Ext.button.Button({itemId:"a",text:"A"}),new Ext.button.Button({itemId:"b",text:"B"})]});expect(B.down("#a").minWidth).toBe(75);expect(B.down("#b").minWidth).toBe(75)});it("should apply minButtonWidth to button subclass configs",function(){Ext.define("spec.CustomButton",{extend:"Ext.button.Button",alias:"widget.mybutton"});A({minButtonWidth:75,width:400,height:200,buttons:[{xtype:"mybutton",itemId:"a",text:"A"},{xtype:"mybutton",itemId:"b",text:"B"}]});expect(B.down("#a").minWidth).toBe(75);expect(B.down("#b").minWidth).toBe(75);Ext.undefine("spec.CustomButton")});it("should not apply minButtonWidth to non-button components",function(){A({minButtonWidth:75,width:400,height:200,buttons:[{xtype:"component",itemId:"a",text:"A"},new Ext.Component({xtype:"mybutton",itemId:"b",text:"B"})]});expect(B.down("#a").minWidth).not.toBe(75);expect(B.down("#b").minWidth).not.toBe(75)})});describe("draggable",function(){var E=function(G){B=new Ext.panel.Panel(G)},F;afterEach(function(){F=null});describe("draggable true",function(){it("should call initDraggable",function(){E({draggable:true});F=spyOn(B,"initDraggable");B.render(Ext.getBody());expect(F).wasCalled()});it("should have a DragSource instance if draggable",function(){E({draggable:true,renderTo:Ext.getBody()});expect(B.dd).toBeDefined()});it("should call endDrag on its DragSource instance when hiding",function(){E({draggable:true,renderTo:Ext.getBody()});F=spyOn(B.dd,"endDrag");B.hide();expect(F).wasCalled()});it("should not create a Component Dragger instance  with header: false",function(){E({draggable:true,header:false});expect(B.dd).toBeUndefined()})});describe("draggable false",function(){it("should not call initDraggable",function(){E({draggable:false});F=spyOn(B,"initDraggable");B.render(Ext.getBody());expect(F).wasNotCalled()});it("should not have a DragSource instance if not draggable",function(){E({draggable:false,renderTo:Ext.getBody()});expect(B.dd).toBeUndefined()});it("should not call attempt to call endDrag when hiding panel is not draggable",function(){E({draggable:false,renderTo:Ext.getBody()});B.hide();expect(B.dd).toBeUndefined()})})});describe("ghost",function(){var F;function E(G){B=Ext.widget(Ext.apply({xtype:"panel",floating:true,hidden:false,renderTo:document.body,height:100,width:300},G));F=B.ghost()}it("should instantiate a ghost panel",function(){E();expect(F.xtype).toBe("panel")});it("should instantiate a ghost window if the owner is a window",function(){E({xtype:"window"});expect(F.xtype).toBe("window")});it("should pass the owner UI along to the ghost",function(){E({ui:"foo"});expect(F.ui).toBe("foo")});it("should pass the owner's shim config along to the ghost",function(){E({shim:true});expect(F.shim).toBe(true)});it("should pass header configs along to the ghost header",function(){var G;E({titleAlign:"center",header:{titlePosition:2,tools:[{type:"close"},{type:"pin"}]}});G=F.header;expect(G.titleAlign).toBe("center");expect(G.titlePosition).toBe(2);expect(G.items.getAt(0).type).toBe("close");expect(G.items.getAt(1).type).toBe("pin");expect(G.items.getAt(2)).toBe(G.getTitle())})});describe("placeholder",function(){var H=false,G,F,J,I;function E(K,L){G=new Ext.container.Viewport(Ext.apply({layout:"border",items:[{region:"west",title:"west",collapsed:true,collapsible:true,animCollapse:false,width:150,split:L},{region:"center",title:"center",items:[]}],renderTo:Ext.getBody()},K||{}));F=G.down('panel[region="west"]');J=G.down('panel[region="center"]');I=F.placeholder}afterEach(function(){Ext.destroy(G,F,I);H=false});describe("hiding",function(){it("should hide when collapsed",function(){E(null,true);F.collapse();F.hide();expect(F.isVisible()).toBe(false);expect(F.splitter.isVisible()).toBe(false);expect(J.getWidth()).toBe(G.getWidth())});it("should hiding when floated from collapsed",function(){var K;E(null,true);F.on("float",function(){K=true});F.collapse();F.floatCollapsedPanel();waitsFor(function(){return K});runs(function(){F.hide();expect(F.isVisible()).toBe(false);expect(F.splitter.isVisible()).toBe(false);expect(J.getWidth()).toBe(G.getWidth())})})});describe("inheritable",function(){it("should correctly update the hidden state",function(){E();F.expand();expect(I.getInherited().hidden).toBe(true);F.collapse();expect(I.getInherited().hasOwnProperty("hidden")).toBe(false)});it("should correctly update the hidden state, animated",function(){E({items:[{region:"west",title:"west",collapsed:true,collapsible:true,animCollapse:1,width:150,listeners:{collapse:function(){H=true},expand:function(){H=true}}},{region:"center",title:"center",items:[]}]});F.expand(true);waitsFor(function(){return H});runs(function(){H=false;expect(I.getInherited().hidden).toBe(true);F.collapse("left",true)});waitsFor(function(){return H});runs(function(){expect(I.getInherited().hasOwnProperty("hidden")).toBe(false)})})})});describe("binding",function(){it("should bind the title",function(){A({session:true,referenceHolder:true,defaultListenerScope:true,wow:function(G){return G+"!!"},viewModel:{foo:""},items:[{xtype:"panel",reference:"subPanel",bind:{title:"Hello {foo:this.wow}!"}}]});var F=B.getViewModel(),E=B.lookupReference("subPanel");F.set("foo","Don");F.getScheduler().notify();expect(E.title).toBe("Hello Don!!!")})});describe("titleRotation",function(){var I=Ext.Element.prototype,F={0:I.styleHooks,90:I.verticalStyleHooks90,270:I.verticalStyleHooks270},G;function E(J){B=Ext.create(Ext.apply({xtype:"panel",renderTo:document.body,height:200,width:200,title:"Rotate Panel"},J));G=B.header.getTitle().el}function H(J){if(J){expect(G.vertical).toBe(true)}else{expect(G.vertical).toBeFalsy()}expect(G.styleHooks).toBe(F[J])}afterEach(function(){G=null});it("should default to non-rotated when headerPosition is top",function(){E();H(0)});it("should default to non-rotated when headerPosition is bottom",function(){E({headerPosition:"bottom"});H(0)});it("should default to 90 degree rotation when headerPosition is right",function(){E({headerPosition:"right"});H(90)});it("should default to 90 degree rotation when headerPosition is left",function(){E({headerPosition:"left"});H(90)});describe("headerPosition: top",function(){it("should rotate 0 degrees",function(){E({headerPosition:"top",titleRotation:0});H(0)});it("should rotate 90 degrees",function(){E({headerPosition:"top",titleRotation:1});H(90)});it("should rotate 270 degrees",function(){E({headerPosition:"top",titleRotation:2});H(270)})});describe("headerPosition: right",function(){it("should rotate 0 degrees",function(){E({headerPosition:"right",titleRotation:0});H(0)});it("should rotate 90 degrees",function(){E({headerPosition:"right",titleRotation:1});H(90)});it("should rotate 270 degrees",function(){E({headerPosition:"right",titleRotation:2});H(270)})});describe("headerPosition: bottom",function(){it("should rotate 0 degrees",function(){E({headerPosition:"bottom",titleRotation:0});H(0)});it("should rotate 90 degrees",function(){E({headerPosition:"bottom",titleRotation:1});H(90)});it("should rotate 270 degrees",function(){E({headerPosition:"bottom",titleRotation:2});H(270)})});describe("headerPosition: left",function(){it("should rotate 0 degrees",function(){E({headerPosition:"left",titleRotation:0});H(0)});it("should rotate 90 degrees",function(){E({headerPosition:"left",titleRotation:1});H(90)});it("should rotate 270 degrees",function(){E({headerPosition:"left",titleRotation:2});H(270)})})});(function(){function E(G){var K=G.renderTo,J=G.positionAbsolute,F=G.constrainHeader,H=G.isRtl,I=["constraining: renderTo = ",!!K,", positionAbsolute = ",!!J,", constrainHeader = ",!!F,", isRtl = ",!!H].join("");describe(I,function(){var Q,O,M,P,N;beforeEach(function(){Q=new Ext.panel.Panel({rtl:H,title:"A",style:{position:!J?"relative":"absolute"},width:400,height:400,renderTo:Ext.getBody()})});afterEach(function(){Ext.destroy(O,Q);Q=O=M=P=N=null});function L(S){var R=S[0],U=S[1]||30,T={};T[!F?"constrain":"constrainHeader"]=true;if(K){T.renderTo=Q.el}O=new Ext.panel.Panel(Ext.apply({title:"My Panel",width:100,height:100,x:R,y:U,html:"nothing to see here"},T));if(!K){O.render(Q.el)}M=O.el.dom.style;P=[O.x,O.y]}describe("the x offset",function(){it("should constrain a negative x offset",function(){L([-30]);expect(P[0]).toBe(0);expect(parseInt(M[!H?"left":"right"],10)).toBe(0);expect(parseInt(M.top,10)).toBe(30)});it("should not constrain a positive x offset",function(){L([30]);expect(P[0]).toBe(30);expect(parseInt(M[!H?"left":"right"],10)).toBe(30);expect(parseInt(M.top,10)).toBe(30)});it("should constrain a huge positive x offset",function(){L([3000]);expect(P[0]).toBe(300);expect(parseInt(M[!H?"left":"right"],10)).toBe(300);expect(parseInt(M.top,10)).toBe(30)});it("should constrain an overlapping x offset",function(){L([350]);expect(P[0]).toBe(300);expect(parseInt(M[!H?"left":"right"],10)).toBe(300);expect(parseInt(M.top,10)).toBe(30)})});describe("the y offset",function(){it("should constrain a negative y offset",function(){L([30,-30]);expect(P[1]).toBe(0);expect(parseInt(M[!H?"left":"right"],10)).toBe(30);expect(parseInt(M.top,10)).toBe(0)});it("should not constrain a positive y offset",function(){L([30,30]);expect(P[1]).toBe(30);expect(parseInt(M[!H?"left":"right"],10)).toBe(30);expect(parseInt(M.top,10)).toBe(30)});it("should constrain a huge positive y offset",function(){L([30,3000]);N=!F?300:373;expect(P[1]).toBe(N);expect(parseInt(M[!H?"left":"right"],10)).toBe(30);expect(parseInt(M.top,10)).toBe(N)});it("should constrain an overlapping y offset",function(){L([30,380]);N=!F?300:373;expect(P[1]).toBe(N);expect(parseInt(M[!H?"left":"right"],10)).toBe(30);expect(parseInt(M.top,10)).toBe(N)})});describe("both offsets",function(){it("should not constrain either if within accepted offsets",function(){L([171,133]);expect(P).toEqual([171,133]);expect(parseInt(M[!H?"left":"right"],10)).toBe(171);expect(parseInt(M.top,10)).toBe(133)});it("should constrain both if outside of accepted offsets (positive)",function(){L([11111,222222]);N=!F?[300,300]:[300,373];expect(P).toEqual(N);expect(parseInt(M[!H?"left":"right"],10)).toBe(N[0]);expect(parseInt(M.top,10)).toBe(N[1])});it("should constrain both if outside of accepted offsets (negative)",function(){L([-33333,-444444]);expect(P).toEqual([0,0]);expect(parseInt(M[!H?"left":"right"],10)).toBe(0);expect(parseInt(M.top,10)).toBe(0)});it("should constrain both if outside of accepted offsets (x = negative, y = positive)",function(){L([-555555,666666]);N=!F?[0,300]:[0,373];expect(P).toEqual(N);expect(parseInt(M[!H?"left":"right"],10)).toBe(N[0]);expect(parseInt(M.top,10)).toBe(N[1])});it("should constrain both if outside of accepted offsets (x = positive, y = negative)",function(){L([77777,-88888]);expect(P).toEqual([300,0]);expect(parseInt(M[!H?"left":"right"],10)).toBe(300);expect(parseInt(M.top,10)).toBe(0)});it("should constrain just one if outside of accepted offsets (x = ok, y = exceeds negative)",function(){L([79,-99999]);expect(P).toEqual([79,0]);expect(parseInt(M[!H?"left":"right"],10)).toBe(79);expect(parseInt(M.top,10)).toBe(0)});it("should constrain just one if outside of accepted offsets (x = ok, y = exceeds positive)",function(){L([42,99999]);N=!F?[42,300]:[42,373];expect(P[0]).toBeApprox(N[0],1);expect(P[1]).toBeApprox(N[1],1);expect(parseInt(M[!H?"left":"right"],10)).toBe(N[0]);expect(parseInt(M.top,10)).toBeApprox(N[1],1)});it("should constrain both if outside of accepted offsets (x = exceeds negative, y = ok)",function(){L([-10101,267]);expect(P).toEqual([0,267]);expect(parseInt(M[!H?"left":"right"],10)).toBe(0);expect(parseInt(M.top,10)).toBe(267)});it("should constrain both if outside of accepted offsets (x = exceeds positive, y = ok)",function(){L([10101,55]);expect(P).toEqual([300,55]);expect(parseInt(M[!H?"left":"right"],10)).toBe(300);expect(parseInt(M.top,10)).toBe(55)})})})}E({renderTo:true,positionAbsolute:true,constrainHeader:true});E({renderTo:false,positionAbsolute:true,constrainHeader:true});E({renderTo:true,positionAbsolute:false,constrainHeader:true});E({renderTo:false,positionAbsolute:false,constrainHeader:true});E({renderTo:true,positionAbsolute:true,constrainHeader:false});E({renderTo:false,positionAbsolute:true,constrainHeader:false});E({renderTo:true,positionAbsolute:false,constrainHeader:false});E({renderTo:false,positionAbsolute:false,constrainHeader:false})}());describe("defaultFocus",function(){function E(F){A(Ext.apply({width:100,height:100},F));D=B}describe("with defaultFocus",function(){var G,F;beforeEach(function(){E({items:[{xtype:"component",html:"foo"},{xtype:"component",itemId:"bar",html:"bar"}]});G=D.items.getAt(0);F=D.items.getAt(1)});it("should return foo",function(){D.defaultFocus="component";var H=D.getFocusEl();expect(H).toBe(G)});it("should return bar",function(){D.defaultFocus="#bar";var H=D.getFocusEl();expect(H).toBe(F)})});describe("no defaultFocus",function(){beforeEach(function(){E()});it("should return targetEl when focusable",function(){D.focusable=true;var F=D.getFocusEl();expect(F).toBe(D.getTargetEl())});it("should return undefined when not focusable",function(){var F=D.getFocusEl();expect(F).toBe(undefined)})})});describe("defaultButton referenceHolder == true",function(){var K=jasmine.pressKey,H,I,F,J,L,N,G,E;function M(O){O=Ext.apply({renderTo:undefined,x:10,y:10,width:400,height:400,items:[{xtype:"textfield",fieldLabel:"foo",reference:"fooInput"},{xtype:"textfield",fieldLabel:"bar",reference:"barInput"}],defaultButton:"okButton",buttons:[{reference:"okButton",text:"OK"},{reference:"cancelButton",text:"Cancel"}]},O);A(O);J=B.down("[reference=fooInput]");L=B.down("[reference=barInput]");N=B.down("[reference=okButton]");G=B.down("[reference=cancelButton]");B.on("boxready",function(){this.el.on("keydown",F)});H.andCallFake(function(P,Q){E=Q});F.andCallFake(function(P){E=P})}beforeEach(function(){H=jasmine.createSpy("OK button handler");I=jasmine.createSpy("Cancel button handler");F=jasmine.createSpy("Panel keydown")});afterEach(function(){if(B&&B.el){B.el.un("keydown",F)}H=I=F=J=L=G=null;E=null});describe("w/ referenceHolder == true",function(){beforeEach(function(){M({referenceHolder:true});N.on("click",H);G.on("click",I)});describe("no defaultButton",function(){beforeEach(function(){B.defaultButton=undefined;B.render(Ext.getBody())});it("should not fire OK handler",function(){K(J,"enter");waitForSpy(F);runs(function(){expect(H).not.toHaveBeenCalled()})});it("should not have stopped the keydown event",function(){K(L,"enter");waitForSpy(F);runs(function(){expect(E.isStopped).toBeFalsy()})})});describe("with defaultButton",function(){beforeEach(function(){B.render(Ext.getBody())});it("should fire OK handler in fooInput",function(){K(J,"enter");waitForSpy(H);runs(function(){expect(H).toHaveBeenCalled()})});it("should fire OK handler in barInput",function(){K(L,"enter");waitForSpy(H);runs(function(){expect(H).toHaveBeenCalled()})});it("should not fire OK handler on Cancel button",function(){K(G,"enter");waitForSpy(I);runs(function(){expect(H).not.toHaveBeenCalled()})});it("should have stopped the keydown event",function(){K(J,"enter");waitForSpy(H);runs(function(){expect(E.isStopped).toBeTruthy()})});it("should not have reached main el keydown listener",function(){K(L,"enter");waitForSpy(H);runs(function(){expect(F).not.toHaveBeenCalled()})})});describe("with defaultButton and defaultButtonTarget",function(){beforeEach(function(){B.defaultButtonTarget="el";B.render(Ext.getBody())});it("should fire OK handler in fooInput",function(){K(J,"enter");waitForSpy(H);runs(function(){expect(H).toHaveBeenCalled()})});it("should fire OK handler in barInput",function(){K(L,"enter");waitForSpy(H);runs(function(){expect(H).toHaveBeenCalled()})});it("should NOT fire OK handler on Cancel button",function(){K(G,"enter");waitForSpy(I);runs(function(){expect(H).not.toHaveBeenCalled()})});it("should have stopped the keydown event",function(){K(J,"enter");waitForSpy(H);runs(function(){expect(E.isStopped).toBeTruthy()})})});describe("nested panel",function(){var P,Q,T,S,R,O;beforeEach(function(){R=jasmine.createSpy("Nested OK handler");O=jasmine.createSpy("Nested Cancel handler");P=B.add({xtype:"panel",title:"nested",items:[{xtype:"textfield",fieldLabel:"Nested",reference:"nestedInput"}],buttons:[{text:"Nested OK",reference:"nestedOk",handler:R},{text:"Nested Cancel",reference:"nestedCancel",handler:O}]});Q=B.lookupReference("nestedInput");T=B.lookupReference("nestedOk");S=B.lookupReference("nestedCancel");R.andCallFake(function(U,V){E=V});O.andCallFake(function(U,V){E=V;V.stopEvent();return false})});afterEach(function(){R=O=null;Q=T=S=null});describe("no defaultButton config",function(){beforeEach(function(){B.render(Ext.getBody())});it("should fire outer OK handler on nested input",function(){K(Q,"enter");waitForSpy(H);runs(function(){expect(H).toHaveBeenCalled()})});it("should NOT fire outer OK handler on nested OK button",function(){K(T,"enter");waitForSpy(R);runs(function(){expect(H).not.toHaveBeenCalled()})});it("should NOT fire outer OK handler on nested Cancel button",function(){K(S,"enter");waitForSpy(O);runs(function(){expect(H).not.toHaveBeenCalled()})})});describe("with defaultButton config",function(){beforeEach(function(){P.defaultButton="nestedOk";B.render(Ext.getBody())});describe("on nested input",function(){beforeEach(function(){K(Q,"enter");waitForSpy(R)});it("should fire nested OK handler",function(){expect(R).toHaveBeenCalled()});it("should NOT fire outer OK handler",function(){expect(H).not.toHaveBeenCalled()});it("should have stopped the event",function(){expect(E.isStopped).toBeTruthy()});it("should not have reached outer keydown handler",function(){expect(F).not.toHaveBeenCalled()})});describe("on nested OK button",function(){beforeEach(function(){K(T,"enter");waitForSpy(R)});it("should fire nested OK handler",function(){expect(R).toHaveBeenCalled()});it("should NOT fire outer OK handler",function(){expect(H).not.toHaveBeenCalled()});it("should have stopped the event",function(){expect(E.isStopped).toBeTruthy()});it("should not have reached outer keydown handler",function(){expect(F).not.toHaveBeenCalled()})});describe("on nested Cancel button",function(){beforeEach(function(){K(S,"enter");waitForSpy(O)});it("should fire nested Cancel handler",function(){expect(O).toHaveBeenCalled()});it("should NOT fire nested OK handler",function(){expect(R).not.toHaveBeenCalled()});it("should NOT fire outer OK handler",function(){expect(H).not.toHaveBeenCalled()});it("should have not reached outer keydown handler",function(){expect(F).not.toHaveBeenCalled()});it("should have stopped the event",function(){expect(E.isStopped).toBeTruthy()})})})})});describe("nested w/ parent ViewController",function(){var O;beforeEach(function(){M({buttons:[{reference:"okButton",text:"OK",listeners:{click:"onOkButton"}},{reference:"cancelButton",text:"Cancel",listeners:{click:"onCancelButton"}}],controller:{xclass:"Ext.app.ViewController",onOkButton:H,onCancelButton:I}});O=new Ext.panel.Panel({renderTo:Ext.getBody(),x:10,y:10,width:400,height:400,items:[B],controller:{xclass:"Ext.app.ViewController"}})});afterEach(function(){B.el.un("keydown",F);O.destroy();O=null});it("should fire OK handler in fooInput",function(){K(J,"enter");waitForSpy(H);runs(function(){expect(H).toHaveBeenCalled()})});it("should fire OK handler in barInput",function(){K(L,"enter");waitForSpy(H);runs(function(){expect(H).toHaveBeenCalled()})});it("should not fire OK handler on Cancel button",function(){K(G,"enter");waitForSpy(I);runs(function(){expect(H).not.toHaveBeenCalled()})});it("should have stopped the keydown event",function(){K(J,"enter");waitForSpy(H);runs(function(){expect(E.isStopped).toBeTruthy()})});it("should not have reached main el keydown listener",function(){K(L,"enter");waitForSpy(H);runs(function(){expect(F).not.toHaveBeenCalled()})})})});describe("docked items",function(){var F,E,H;function G(I){I=Ext.apply({width:600,height:600,border:false,dockedItems:[{xtype:"component",dock:"top",height:50,itemId:"dockA"},{xtype:"component",dock:"top",height:50,itemId:"dockB"},{xtype:"component",dock:"top",height:50,itemId:"dockC"}]},I);A(I);F=B.down("#dockA");E=B.down("#dockB");H=B.down("#dockC")}afterEach(function(){F=E=H=null});describe("remove",function(){it("should forward calls to docked components to removeDocked",function(){G();var I=spyOn(B,"removeDocked").andCallThrough();B.remove(F);expect(I.callCount).toBe(1);expect(I.mostRecentCall.args[0]).toBe(F)})});describe("addDocked",function(){var J,I;beforeEach(function(){J=new Ext.Component({dock:"top",height:50,itemId:"dockD"});I=new Ext.Component({dock:"top",height:50,itemId:"dockE"})});afterEach(function(){J=I=Ext.destroy(J,I)});describe("single item",function(){describe("arg types",function(){it("should accept a component instance",function(){G();B.addDocked(J);var K=B.getDockedItems();expect(K.length).toBe(4);expect(Ext.Array.contains(K,J)).toBe(true)});it("should accept a component config",function(){G();B.addDocked({xtype:"component",itemId:"foo"});var K=B.getDockedItems();expect(K.length).toBe(4);expect(K[3].getItemId()).toBe("foo")})});describe("position",function(){it("should default to the end",function(){G();B.addDocked(J);expect(B.getDockedItems()[3]).toBe(J);B.addDocked(I);expect(B.getDockedItems()[4]).toBe(I)});it("should be able to insert at the start",function(){G();B.addDocked(J,0);expect(B.getDockedItems()[0]).toBe(J)});it("should be able to insert into the collection",function(){G();B.addDocked(J,1);expect(B.getDockedItems()[1]).toBe(J)});it("should limit the index if it is larger than the index",function(){G();B.addDocked(J,100);expect(B.getDockedItems()[3]).toBe(J)})});describe("return type",function(){it("should return an array of the added item",function(){G();expect(B.addDocked(J)).toEqual([J])})});describe("events/template methods",function(){beforeEach(function(){G()});it("should fire the dockedadd event and pass the container, item and index",function(){var L=jasmine.createSpy(),K;B.on("dockedadd",L);B.addDocked(J);expect(L.callCount).toBe(1);K=L.mostRecentCall.args;expect(K[0]).toBe(B);expect(K[1]).toBe(J);expect(K[2]).toBe(3)});it("should call the onAdded method on the item",function(){var L=spyOn(J,"onAdded").andCallThrough(),K;B.addDocked(J);expect(L.callCount).toBe(1);K=L.mostRecentCall.args;expect(K[0]).toBe(B);expect(K[1]).toBe(3);expect(K[2]).toBe(true)});it("should call onDockedAdd",function(){var K=spyOn(B,"onDockedAdd").andCallThrough();B.addDocked(J);expect(K.callCount).toBe(1);expect(K.mostRecentCall.args[0]).toBe(J)})});describe("layout",function(){beforeEach(function(){G()});it("should execute a layout",function(){expect(B.body.getHeight()).toBe(450);B.addDocked(J);expect(B.body.getHeight()).toBe(400)});it("should only run a single layout",function(){var K=B.componentLayoutCounter;B.addDocked(J);expect(B.componentLayoutCounter).toBe(K+1)})})});describe("multiple items",function(){describe("arg types",function(){it("should accept an array of component instance",function(){G();B.addDocked([J,I]);var K=B.getDockedItems();expect(K.length).toBe(5);expect(Ext.Array.contains(K,J)).toBe(true);expect(Ext.Array.contains(K,I)).toBe(true)});it("should accept an array of component configs",function(){G();B.addDocked([{xtype:"component",itemId:"foo"},{xtype:"component",itemId:"bar"}]);var K=B.getDockedItems();expect(K.length).toBe(5);expect(K[3].getItemId()).toBe("foo");expect(K[4].getItemId()).toBe("bar")});it("should accept a mix of configs and components",function(){G();B.addDocked([J,{xtype:"component",itemId:"foo"}]);var K=B.getDockedItems();expect(K.length).toBe(5);expect(K[3]).toBe(J);expect(K[4].getItemId()).toBe("foo")})});describe("position",function(){it("should default to the end",function(){G();B.addDocked([J,I]);expect(B.getDockedItems()[3]).toBe(J);B.addDocked(I);expect(B.getDockedItems()[4]).toBe(I)});it("should be able to insert at the start",function(){G();B.addDocked([J,I],0);expect(B.getDockedItems()[0]).toBe(J);expect(B.getDockedItems()[1]).toBe(I)});it("should be able to insert into the collection",function(){G();B.addDocked([J,I],1);expect(B.getDockedItems()[1]).toBe(J);expect(B.getDockedItems()[2]).toBe(I)});it("should limit the index if it is larger than the index",function(){G();B.addDocked([J,I],100);expect(B.getDockedItems()[3]).toBe(J);expect(B.getDockedItems()[4]).toBe(I)})});describe("return type",function(){it("should return an array of the added items, but not the same reference",function(){var L=[J,I],K;G();K=B.addDocked([J,I]);expect(K).toEqual([J,I]);expect(K).not.toBe(L)})});describe("events/template methods",function(){beforeEach(function(){G()});describe("without position",function(){it("should fire the dockedadd event and pass the container, item and index",function(){var L=jasmine.createSpy(),K;B.on("dockedadd",L);B.addDocked([J,I]);expect(L.callCount).toBe(2);K=L.calls[0].args;expect(K[0]).toBe(B);expect(K[1]).toBe(J);expect(K[2]).toBe(3);K=L.calls[1].args;expect(K[0]).toBe(B);expect(K[1]).toBe(I);expect(K[2]).toBe(4)});it("should call the onAdded method on the item",function(){var M=spyOn(J,"onAdded").andCallThrough(),L=spyOn(I,"onAdded").andCallThrough(),K;B.addDocked([J,I]);expect(M.callCount).toBe(1);K=M.mostRecentCall.args;expect(K[0]).toBe(B);expect(K[1]).toBe(3);expect(K[2]).toBe(true);expect(L.callCount).toBe(1);K=L.mostRecentCall.args;expect(K[0]).toBe(B);expect(K[1]).toBe(4);expect(K[2]).toBe(true)});it("should call onDockedAdd",function(){var K=spyOn(B,"onDockedAdd").andCallThrough();B.addDocked([J,I]);expect(K.callCount).toBe(2);expect(K.calls[0].args[0]).toBe(J);expect(K.calls[1].args[0]).toBe(I)})});describe("with position",function(){it("should fire the dockedadd event and pass the container, item and index",function(){var L=jasmine.createSpy(),K;B.on("dockedadd",L);B.addDocked([J,I],1);expect(L.callCount).toBe(2);K=L.calls[0].args;expect(K[0]).toBe(B);expect(K[1]).toBe(J);expect(K[2]).toBe(1);K=L.calls[1].args;expect(K[0]).toBe(B);expect(K[1]).toBe(I);expect(K[2]).toBe(2)});it("should call the onAdded method on the item",function(){var M=spyOn(J,"onAdded").andCallThrough(),L=spyOn(I,"onAdded").andCallThrough(),K;B.addDocked([J,I],1);expect(M.callCount).toBe(1);K=M.mostRecentCall.args;expect(K[0]).toBe(B);expect(K[1]).toBe(1);expect(K[2]).toBe(true);expect(L.callCount).toBe(1);K=L.mostRecentCall.args;expect(K[0]).toBe(B);expect(K[1]).toBe(2);expect(K[2]).toBe(true)});it("should call onDockedAdd",function(){var K=spyOn(B,"onDockedAdd").andCallThrough();B.addDocked([J,I],1);expect(K.callCount).toBe(2);expect(K.calls[0].args[0]).toBe(J);expect(K.calls[1].args[0]).toBe(I)})})});describe("layout",function(){beforeEach(function(){G()});it("should execute a layout",function(){expect(B.body.getHeight()).toBe(450);B.addDocked([J,I]);expect(B.body.getHeight()).toBe(350)});it("should only run a single layout",function(){var K=B.componentLayoutCounter;B.addDocked([J,I]);expect(B.componentLayoutCounter).toBe(K+1)})})})});describe("removeDocked",function(){it("should remove the item from the dockedItems",function(){G();B.removeDocked(E);var I=B.getDockedItems();expect(I.length).toBe(2);expect(Ext.Array.contains(I,E)).toBe(false)});describe("return value",function(){it("should return the passed item",function(){G();expect(B.removeDocked(F)).toBe(F)});it("should return the passed item when it is not contained in the docked items",function(){var I=new Ext.Component();G();expect(B.removeDocked(I)).toBe(I);I.destroy()})});describe("autoDestroy",function(){it("should not destroy with panel.autoDestroy=true & autoDestroy=false",function(){G({autoDestroy:true});B.removeDocked(F,false);expect(F.destroyed).not.toBe(true);F.destroy()});it("should destroy with panel.autoDestroy=true & autoDestroy=true",function(){G({autoDestroy:true});B.removeDocked(F,true);expect(F.destroyed).toBe(true)});it("should not destroy with panel.autoDestroy=false & autoDestroy=false",function(){G({autoDestroy:false});B.removeDocked(F,false);expect(F.destroyed).not.toBe(true);F.destroy()});it("should destroy with panel.autoDestroy=false & autoDestroy=true",function(){G({autoDestroy:true});B.removeDocked(F,true);expect(F.destroyed).toBe(true)})});describe("events/template methods",function(){beforeEach(function(){G()});it("should fire the dockedremove method and pass the container and item",function(){var J=jasmine.createSpy(),I;B.on("dockedremove",J);B.removeDocked(F);expect(J.callCount).toBe(1);I=J.mostRecentCall.args;expect(I[0]).toBe(B);expect(I[1]).toBe(F)});it("should call onRemoved on the item and pass the destroying flag",function(){var I=spyOn(F,"onRemoved").andCallThrough();B.removeDocked(F);expect(I.callCount).toBe(1);expect(I.mostRecentCall.args[0]).toBe(true)});it("should call onDockedRemove on the panel and pass the item",function(){var I=spyOn(B,"onDockedRemove").andCallThrough();B.removeDocked(F);expect(I.callCount).toBe(1);expect(I.mostRecentCall.args[0]).toBe(F)})});describe("layout",function(){beforeEach(function(){G()});it("should execute a layout",function(){expect(B.body.getHeight()).toBe(450);B.removeDocked(F);expect(B.body.getHeight()).toBe(500)});it("should only run a single layout",function(){var I=B.componentLayoutCounter;B.removeDocked(F);expect(B.componentLayoutCounter).toBe(I+1)})})})});describe("ARIA",function(){var E=jasmine.expectAriaAttr;function H(J,K){jasmine.expectAriaAttr(B,J,K)}function G(J){jasmine.expectNoAriaAttr(B,J)}function F(J,K){jasmine.expectAriaAttr(B.body,J,K)}function I(J){jasmine.expectNoAriaAttr(B.body,J)}describe("attributes",function(){describe("ariaEl",function(){beforeEach(function(){A()});it("should be main el",function(){expect(B.ariaEl).toBe(B.el)})});describe("main el",function(){describe("static roles",function(){beforeEach(function(){A()});it("should have presentation role by default",function(){H("role","presentation")})});describe("explicit widget role",function(){describe("in general",function(){beforeEach(function(){A({ariaRole:"foo"})});it("should set el role to ariaRole",function(){H("role","foo")});it("should not set ariaRole on the body el",function(){F("role","presentation")});it("should not have aria-expanded",function(){G("aria-expanded")})});describe("no header no title",function(){beforeEach(function(){A({ariaRole:"throbbe"})});it("should not have aria-label",function(){G("aria-label")});it("should not have aria-labelledby",function(){G("aria-labelledby")});it("should replace aria-labelledby",function(){B.ariaEl.dom.setAttribute("aria-labelledby","foo");B.setTitle("blerg");H("aria-labelledby",B.header.titleCmp.textEl.id)})});describe("no header with title",function(){beforeEach(function(){A({ariaRole:"bar",title:"blerg",header:false})});it("should not have aria-labelledby",function(){G("aria-labelledby")});xit("should have aria-label",function(){H("aria-label","blerg")});it("should not remove aria-labelledby",function(){B.ariaEl.dom.setAttribute("aria-labelledby","xyzzy");B.setTitle("throbbe");H("aria-labelledby","xyzzy")});it("should strip HTML markup from title",function(){B.setTitle('<span style="background-color: red">foo</span>');H("aria-label","foo")})});describe("with header",function(){beforeEach(function(){A({ariaRole:"baz",title:"frob"})});it("should have aria-labelledby",function(){H("aria-labelledby",B.header.titleCmp.textEl.id)});it("should not have aria-label",function(){G("aria-label")});it("should have presentation role on the header with no tools",function(){E(B.header,"role","presentation")});it("should have presentation role on titleCmp",function(){E(B.header.titleCmp,"role","presentation")});it("should not remove aria-labelledby",function(){B.setTitle("bonzo");H("aria-labelledby",B.header.titleCmp.textEl.id)})})});describe("region role",function(){beforeEach(function(){A({ariaRole:"region",title:"foo"})});it("should have aria-labelledby",function(){H("aria-labelledby",B.headingEl.id)});it("should not have aria-label",function(){G("aria-label")})});describe("tabpanel role",function(){beforeEach(function(){A({ariaRole:"tabpanel",title:"foo"})});it("should not set aria-labelledby",function(){G("aria-labelledby")});it("should not set aria-label",function(){G("aria-label")})})});describe("body el",function(){describe("static roles",function(){beforeEach(function(){A({bodyAriaRenderAttributes:{"aria-foo":"bar"}})});it("should have presentation role by default",function(){F("role","presentation")});it("should not render body ARIA attributes",function(){I("aria-foo")})});describe("widget roles",function(){beforeEach(function(){A({bodyAriaRole:"frob",bodyAriaRenderAttributes:{"aria-qux":"bonzo"}})});it("should set role to bodyAriaRole",function(){F("role","frob")});it("should render body ARIA attributes",function(){F("aria-qux","bonzo")});it("should not set bodyAriaRole on the main el",function(){H("role","presentation")})})});describe("standard tools",function(){var K,J,L;beforeEach(function(){A({title:"foo",closable:true,collapsible:true,animCollapse:false});K=B.down("tool[type=close]");J=B.collapseTool;L=B.expandTool});afterEach(function(){K=J=L=null});describe("close tool",function(){it("should be focusable",function(){expect(K.el.isFocusable()).toBe(true)});it("should have button role",function(){E(K,"role","button")});it("should have aria-label",function(){E(K,"aria-label","Close panel")})});describe("collapse tool",function(){it("should be focusable",function(){expect(J.el.isFocusable()).toBe(true)});it("should have button role",function(){E(J,"role","button")});it("should have aria-label",function(){E(J,"aria-label","Collapse panel")})});describe("expand tool",function(){beforeEach(function(){B.collapse()});it("should be focusable",function(){expect(L.el.isFocusable()).toBe(true)});it("should have button role",function(){E(L,"role","button")});it("should have aria-label",function(){E(L,"aria-label","Expand panel")})})})});describe("regions",function(){describe("automagic ariaRole",function(){it("should work when isViewportBorderChild",function(){A({isViewportBorderChild:true,title:"bonzo"});expect(B.ariaRole).toBe("region")});it("should not work when isViewportBorderChild and has ariaRole",function(){A({isViewportBorderChild:true,ariaRole:"plugh",title:"xyzzy"});expect(B.ariaRole).toBe("plugh")});it("should warn when isViewportBorderChild && !title",function(){spyOn(Ext.log,"warn");A({isViewportBorderChild:true});var J=Ext.log.warn.mostRecentCall.args[0];expect(J).toMatch(/does not have a title/)});it("should warn when ariaRole == region && !title",function(){spyOn(Ext.log,"warn");A({ariaRole:"region"});var J=Ext.log.warn.mostRecentCall.args[0];expect(J).toMatch(/does not have a title/)})});describe("headingEl",function(){describe("creation",function(){it("should be created when isViewportBorderChild",function(){A({isViewportBorderChild:true,title:"throbbe"});expect(B.headingEl).toBeDefined()});it("should be created when ariaRole == region",function(){A({ariaRole:"region",title:"foobaroo"});expect(B.headingEl).toBeDefined()})});describe("position and content",function(){beforeEach(function(){A({isViewportBorderChild:true,title:"frobbe"})});it("should be docked above the header",function(){var J=B.el.dom.childNodes[0];expect(J.getAttribute("role")).toBe("heading")});it("should have innerHTML set to the title",function(){expect(B.headingEl.getHtml()).toBe("frobbe")});it("should have innerHTML updated when title changes",function(){B.setTitle("vita voom");expect(B.headingEl.getHtml()).toBe("vita voom")})});describe("destruction",function(){var J;beforeEach(function(){A({ariaRole:"region",title:"blerg"});J=B.headingEl;spyOn(Ext.log,"warn");B.setTitle(null);B.header=false;B.updateHeader()});it("should be removed from docked items",function(){var K=B.el.query("[role=heading]");expect(K.length).toBe(0)});it("should be destroyed",function(){expect(J.destroyed).toBe(true)});it("should be nulled out",function(){expect(B.headingEl).toBe(null)})})})});describe("state",function(){describe("aria-expanded",function(){function J(K){describe("animCollapse: "+K,function(){describe("before rendering",function(){beforeEach(function(){A({ariaRole:"mymse",title:"foo",collapsible:true,animCollapse:K,renderTo:undefined})});describe("collapsed = false",function(){beforeEach(function(){B.collapsed=false});it("should set aria-expanded to true by default",function(){B.render(Ext.getBody());H("aria-expanded","true")});it("should set aria-expanded to false after collapsing",function(){B.collapse();B.render(Ext.getBody());H("aria-expanded","false")});it("should set aria-expanded to true after expanding",function(){B.collapse();B.expand();B.render(Ext.getBody());H("aria-expanded","true")})});describe("collapsed = true",function(){beforeEach(function(){B.collapsed=true});it("should set aria-expanded to false by default",function(){B.render(Ext.getBody());H("aria-expanded","false")});it("should set aria-expanded to true after expanding",function(){B.expand();B.render(Ext.getBody());H("aria-expanded","true")});it("should set aria-expanded to false after collapsing",function(){B.expand();B.collapse();B.render(Ext.getBody());H("aria-expanded","false")})})});describe("after rendering",function(){var L,M;beforeEach(function(){L=jasmine.createSpy("collapse");M=jasmine.createSpy("expand");A({ariaRole:"splurge",title:"foo",collapsible:true,animCollapse:K,listeners:{collapse:L,expand:M}})});it("should set aria-expanded to true by default",function(){H("aria-expanded","true")});it("should set aria-expanded to false after collapsing",function(){runs(function(){B.collapse()});waitsForSpy(L,"collapse",1000);runs(function(){H("aria-expanded","false")})});it("should set aria-expanded to true after expanding",function(){runs(function(){B.collapse()});waitsForSpy(L,"collapse",1000);runs(function(){B.expand()});waitsForSpy(M,"expand",1000);runs(function(){H("aria-expanded","true")})})})})}J(100);J(false)})});describe("tab guards",function(){it("should contain tab guard elements with no dockedItems",function(){A({tabGuard:true,width:300});var J=B.el.dom.childNodes;expect(J.length).toBe(3);expect(J[0].id).toBe(B.tabGuardBeforeEl.id);expect(J[1].id).toBe(B.body.id);expect(J[2].id).toBe(B.tabGuardAfterEl.id)});it("should contain tab guard elements with header, tbar and bbar",function(){A({tabGuard:true,width:300,title:"Hello",tbar:[{xtype:"component",html:"first"}],bbar:[{xtype:"component",html:"last"}]});var J=B.el.dom.childNodes;var K=B.dockedItems;expect(J.length).toBe(6);expect(J[0].id).toBe(B.tabGuardBeforeEl.id);expect(J[1].id).toBe(B.header.id);expect(J[1].id).toBe(K.getAt(0).id);expect(J[2].id).toBe(K.getAt(1).id);expect(J[3].id).toBe(B.body.id);expect(J[4].id).toBe(K.getAt(2).id);expect(J[5].id).toBe(B.tabGuardAfterEl.id)});it("should contain tab guard elements with tbar and bbar",function(){A({tabGuard:true,width:300,tbar:[{xtype:"component",html:"first"}],bbar:[{xtype:"component",html:"last"}]});var J=B.el.dom.childNodes;var K=B.dockedItems;expect(J.length).toBe(5);expect(J[0].id).toBe(B.tabGuardBeforeEl.id);expect(J[1].id).toBe(K.getAt(0).id);expect(J[2].id).toBe(B.body.id);expect(J[3].id).toBe(K.getAt(1).id);expect(J[4].id).toBe(B.tabGuardAfterEl.id)});it("should contain tab guard elements with header adding tbar then bbar",function(){A({tabGuard:true,width:300,title:"Hello"});var J=B.el.dom.childNodes;var M=B.dockedItems;expect(J.length).toBe(4);var L=B.addDocked({xtype:"toolbar",dock:"top",items:[{xtype:"component",html:"first"}]});var K=B.addDocked({xtype:"toolbar",dock:"bottom",items:[{xtype:"component",html:"last"}]});expect(J.length).toBe(6);expect(J[0].id).toBe(B.tabGuardBeforeEl.id);expect(J[1].id).toBe(B.header.id);expect(J[1].id).toBe(M.getAt(0).id);expect(J[2].id).toBe(M.getAt(1).id);expect(J[2].id).toBe(L[0].id);expect(J[3].id).toBe(B.body.id);expect(J[4].id).toBe(M.getAt(2).id);expect(J[4].id).toBe(K[0].id);expect(J[5].id).toBe(B.tabGuardAfterEl.id)});it("should contain tab guard elements with header adding bbar then tbar",function(){A({tabGuard:true,width:300,title:"Hello"});var J=B.el.dom.childNodes;var M=B.dockedItems;expect(J.length).toBe(4);var K=B.addDocked({xtype:"toolbar",dock:"bottom",items:[{xtype:"component",html:"last"}]});var L=B.addDocked({xtype:"toolbar",dock:"top",items:[{xtype:"component",html:"first"}]});expect(J.length).toBe(6);expect(J[0].id).toBe(B.tabGuardBeforeEl.id);expect(J[1].id).toBe(B.header.id);expect(J[1].id).toBe(M.getAt(0).id);expect(J[2].id).toBe(M.getAt(2).id);expect(J[2].id).toBe(L[0].id);expect(J[3].id).toBe(B.body.id);expect(J[4].id).toBe(M.getAt(1).id);expect(J[4].id).toBe(K[0].id);expect(J[5].id).toBe(B.tabGuardAfterEl.id)});it("should contain tab guard elements with header adding all bars",function(){A({tabGuard:true,width:300,title:"Hello"});var K=B.el.dom.childNodes;var O=B.dockedItems;expect(K.length).toBe(4);var M=B.addDocked({xtype:"toolbar",dock:"bottom",items:[{xtype:"component",html:"bottom"}]});var L=B.addDocked({xtype:"toolbar",dock:"right",items:[{xtype:"component",html:"right"}]});var J=B.addDocked({xtype:"toolbar",dock:"left",items:[{xtype:"component",html:"left"}]});var N=B.addDocked({xtype:"toolbar",dock:"top",items:[{xtype:"component",html:"top"}]});expect(K.length).toBe(8);expect(K[0].id).toBe(B.tabGuardBeforeEl.id);expect(K[1].id).toBe(B.header.id);expect(K[1].id).toBe(O.getAt(0).id);expect(K[2].id).toBe(O.getAt(4).id);expect(K[2].id).toBe(N[0].id);expect(K[3].id).toBe(O.getAt(3).id);expect(K[3].id).toBe(J[0].id);expect(K[4].id).toBe(B.body.id);expect(K[5].id).toBe(O.getAt(2).id);expect(K[5].id).toBe(L[0].id);expect(K[6].id).toBe(O.getAt(1).id);expect(K[6].id).toBe(M[0].id);expect(K[7].id).toBe(B.tabGuardAfterEl.id)})})});describe("Docked component",function(){it("should restore its visibility when panel is expanded",function(){var F=false,E=false;A({collapsible:true,collapseDirection:"top",title:"Foo",dockedItems:[{itemId:"foo",xtype:"panel",title:"Docked",dock:"right",width:100,html:"Test"}],listeners:{collapse:function(){F=true},expand:function(){E=true}}});B.collapse();waitsFor(function(){return F});runs(function(){var G=B.down("#foo");expect(G.el.isVisible()).toBe(false);G.destroy();B.addDocked({itemId:"nofoo",xtype:"panel",title:"Docked foo",dock:"left",width:50,html:"No foo"});B.expand();waitsFor(function(){return E});runs(function(){expect(B.down("#nofoo").el.isVisible()).toBe(true)})})})})})