Ext.define("Ext.data.amf.XmlDecoder",{alias:"data.amf.xmldecoder",statics:{readXml:function(A){var B;if(window.DOMParser){B=(new DOMParser()).parseFromString(A,"text/xml")}else{B=new ActiveXObject("Microsoft.XMLDOM");B.loadXML(A)}return B},readByteArray:function(C){var A=[],E,B,D;D=C.firstChild.nodeValue;for(B=0;B<D.length;B=B+2){E=D.substr(B,2);A.push(parseInt(E,16))}return A},readAMF3Value:function(A){var B;B=Ext.create("Ext.data.amf.Packet");return B.decodeValue(A)},decodeTidFromFlexUID:function(A){var B;B=A.substr(0,8);return parseInt(B,16)}},constructor:function(A){this.initConfig(A);this.clear()},clear:function(){this.objectReferences=[];this.traitsReferences=[];this.stringReferences=[]},readAmfxMessage:function(B){var E,D,A,C,F={};this.clear();E=Ext.data.amf.XmlDecoder.readXml(B);D=E.getElementsByTagName("amfx")[0];if(!D){Ext.warn.log("No AMFX tag in message")}if(D.getAttribute("ver")!="3"){Ext.raise("Unsupported AMFX version: "+D.getAttribute("ver"))}A=D.getElementsByTagName("body")[0];F.targetURI=A.getAttribute("targetURI");F.responseURI=A.getAttribute("responseURI");for(C=0;C<A.childNodes.length;C++){if(A.childNodes.item(C).nodeType!=1){continue}F.message=this.readValue(A.childNodes.item(C));break}return F},readValue:function(A){var B;if(typeof A.normalize==="function"){A.normalize()}if(A.tagName=="null"){return null}else{if(A.tagName=="true"){return true}else{if(A.tagName=="false"){return false}else{if(A.tagName=="string"){return this.readString(A)}else{if(A.tagName=="int"){return parseInt(A.firstChild.nodeValue)}else{if(A.tagName=="double"){return parseFloat(A.firstChild.nodeValue)}else{if(A.tagName=="date"){B=new Date(parseFloat(A.firstChild.nodeValue));this.objectReferences.push(B);return B}else{if(A.tagName=="dictionary"){return this.readDictionary(A)}else{if(A.tagName=="array"){return this.readArray(A)}else{if(A.tagName=="ref"){return this.readObjectRef(A)}else{if(A.tagName=="object"){return this.readObject(A)}else{if(A.tagName=="xml"){return Ext.data.amf.XmlDecoder.readXml(A.firstChild.nodeValue)}else{if(A.tagName=="bytearray"){return Ext.data.amf.XmlDecoder.readAMF3Value(Ext.data.amf.XmlDecoder.readByteArray(A))}}}}}}}}}}}}}Ext.raise("Unknown tag type: "+A.tagName);return null},readString:function(A){var B;if(A.getAttributeNode("id")){return this.stringReferences[parseInt(A.getAttribute("id"))]}B=(A.firstChild?A.firstChild.nodeValue:"")||"";this.stringReferences.push(B);return B},readTraits:function(B){var C=[],A,D;if(B===null){return null}if(B.getAttribute("externalizable")=="true"){return null}if(B.getAttributeNode("id")){return this.traitsReferences[parseInt(B.getAttributeNode("id").value)]}D=B.childNodes;for(A=0;A<D.length;A++){if(D.item(A).nodeType!=1){continue}C.push(this.readValue(D.item(A)))}this.traitsReferences.push(C);return C},readObjectRef:function(A){var B;B=parseInt(A.getAttribute("id"));return this.objectReferences[B]},readObject:function(C){var E,J=[],I,F,D,B,K,A,G=null,H;H=C.getAttribute("type");if(H){G=Ext.ClassManager.getByAlias("amfx."+H)}E=G?new G():(H?{$className:H}:{});if((!G)&&this.converters[H]){E=this.converters[H](this,C);return E}I=C.getElementsByTagName("traits")[0];J=this.readTraits(I);if(J===null){Ext.raise("No support for externalizable object: "+H)}this.objectReferences.push(E);D=0;for(F=0;F<C.childNodes.length;F++){B=C.childNodes.item(F);if(B.nodeType!=1){continue}if(B.tagName=="traits"){continue}K=J[D];A=this.readValue(B);D=D+1;E[K]=A;if(D>J.length){Ext.raise("Too many items for object, not enough traits: "+H)}}return E},readArray:function(E){var I=[],C,H,G,F,A,D,J,B,K;this.objectReferences.push(I);J=parseInt(E.getAttributeNode("length").value);H=0;for(F=0;F<E.childNodes.length;F++){C=E.childNodes.item(F);if(C.nodeType!=1){continue}if(C.tagName=="item"){A=C.getAttributeNode("name").value;B=C.childNodes;for(G=0;G<B.length;G++){K=B.item(G);if(K.nodeType!=1){continue}D=this.readValue(K);break}I[A]=D}else{I[H]=this.readValue(C);H++;if(H>J){Ext.raise("Array has more items than declared length: "+H+" > "+J)}}}if(H<J){Ext.raise("Array has less items than declared length: "+H+" < "+J)}return I},readDictionary:function(E){var H={},D,F,C,B,G,A;A=parseInt(E.getAttribute("length"));this.objectReferences.push(H);D=null;F=null;B=0;for(C=0;C<E.childNodes.length;C++){G=E.childNodes.item(C);if(G.nodeType!=1){continue}if(!D){D=this.readValue(G);continue}F=this.readValue(G);B=B+1;H[D]=F;D=null;F=null}if(B!=A){Ext.raise("Incorrect number of dictionary values: "+B+" != "+A)}return H},convertObjectWithSourceField:function(B){var A,D,C;for(A=0;A<B.childNodes.length;A++){D=B.childNodes.item(A);if(D.tagName=="bytearray"){C=this.readValue(D);this.objectReferences.push(C);return C}}return null},converters:{"flex.messaging.io.ArrayCollection":function(B,A){return B.convertObjectWithSourceField(A)},"mx.collections.ArrayList":function(B,A){return B.convertObjectWithSourceField(A)},"mx.collections.ArrayCollection":function(B,A){return B.convertObjectWithSourceField(A)}}})