var page=require("webpage").create();var format="#{format}";var data="#{data}";var scale=parseFloat("#{scale}",10);var width=parseInt("#{width}",10);var height=parseInt("#{height}",10);try{var pdfOptions=JSON.parse("#{pdf}"||null)}catch(e){console.error("Parsing PDF options failed.")}try{var jpegOptions=JSON.parse("#{jpeg}"||null)}catch(e){console.error("Parsing JPEG options failed.")}if(format==="pdf"){page.paperSize=pdfOptions||{format:"Letter",orientation:"portrait",border:"1cm"}}page.content='<img id="chart" src="'+data+'" style="-webkit-transform-origin: left top">';window.setTimeout(adjustSize,1);function adjustSize(){var A=page.evaluate(function(){var C=document.createElement("style"),D=document.createTextNode("body { margin: 0 }");C.setAttribute("type","text/css");C.appendChild(D);document.head.insertBefore(C,document.head.firstChild);var B=document.getElementById("chart");return{width:B.naturalWidth,height:B.naturalHeight}});if(width&&height){if(width!==A.width||height!==A.height){page.viewportSize={width:width,height:height};page.clipRect={left:0,top:0,width:width,height:height}}}width=Math.round((width||A.width)*scale);height=Math.round((height||A.height)*scale);page.evaluate(function(D,B){var C=document.getElementById("chart");C.style.width=D;C.style.height=B},width,height);window.setTimeout(render,1)}function render(){page.render("#{filename}",{format:format,quality:jpegOptions&&jpegOptions.quality||80});phantom.exit()}