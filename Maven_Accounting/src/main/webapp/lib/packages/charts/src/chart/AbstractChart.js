Ext.define("Ext.chart.AbstractChart",{extend:"Ext.draw.Container",requires:["Ext.chart.theme.Default","Ext.chart.series.Series","Ext.chart.interactions.Abstract","Ext.chart.axis.Axis","Ext.data.StoreManager","Ext.chart.Legend","Ext.data.Store"],isChart:true,defaultBindProperty:"store",config:{store:"ext-empty-store",theme:"default",style:null,animation:!Ext.isIE8,series:[],axes:[],legend:null,colors:null,insetPadding:{top:10,left:10,right:10,bottom:10},background:null,interactions:[],mainRect:null,resizeHandler:null,highlightItem:null},animationSuspendCount:0,chartLayoutSuspendCount:0,axisThicknessSuspendCount:0,isThicknessChanged:false,surfaceZIndexes:{background:0,main:1,grid:2,series:3,axis:4,chart:5,overlay:6,events:7},constructor:function(A){var B=this;B.itemListeners={};B.surfaceMap={};B.chartComponents={};B.isInitializing=true;B.suspendChartLayout();B.animationSuspendCount++;B.callParent(arguments);delete B.isInitializing;B.getSurface("main");B.getSurface("chart").setFlipRtlText(B.getInherited().rtl);B.getSurface("overlay").waitFor(B.getSurface("series"));B.animationSuspendCount--;B.resumeChartLayout()},applyAnimation:function(A,B){if(!A){A={duration:0}}else{if(A===true){A={easing:"easeInOut",duration:500}}}return B?Ext.apply({},A,B):A},getAnimation:function(){if(this.animationSuspendCount){return{duration:0}}else{return this.callParent()}},applyInsetPadding:function(B,A){if(!Ext.isObject(B)){return Ext.util.Format.parseBox(B)}else{if(!A){return B}else{return Ext.apply(A,B)}}},suspendAnimation:function(){var D=this,C=D.getSeries(),E=C.length,B=-1,A;D.animationSuspendCount++;if(D.animationSuspendCount===1){while(++B<E){A=C[B];A.setAnimation(A.getAnimation())}}},resumeAnimation:function(){var D=this,C=D.getSeries(),F=C.length,B=-1,A,E;D.animationSuspendCount--;if(D.animationSuspendCount===0){while(++B<F){A=C[B];E=A.getAnimation();A.setAnimation(E.duration&&E||D.getAnimation())}}},suspendChartLayout:function(){this.chartLayoutSuspendCount++;if(this.chartLayoutSuspendCount===1){if(this.scheduledLayoutId){this.layoutInSuspension=true;this.cancelChartLayout()}else{this.layoutInSuspension=false}}},resumeChartLayout:function(){this.chartLayoutSuspendCount--;if(this.chartLayoutSuspendCount===0){if(this.layoutInSuspension){this.scheduleLayout()}}},cancelChartLayout:function(){if(this.scheduledLayoutId){Ext.draw.Animator.cancel(this.scheduledLayoutId);this.scheduledLayoutId=null}},scheduleLayout:function(){var A=this;if(A.allowSchedule()&&!A.scheduledLayoutId){A.scheduledLayoutId=Ext.draw.Animator.schedule("doScheduleLayout",A)}},allowSchedule:function(){return true},doScheduleLayout:function(){if(this.chartLayoutSuspendCount){this.layoutInSuspension=true}else{this.performLayout()}},suspendThicknessChanged:function(){this.axisThicknessSuspendCount++},resumeThicknessChanged:function(){if(this.axisThicknessSuspendCount>0){this.axisThicknessSuspendCount--;if(this.axisThicknessSuspendCount===0&&this.isThicknessChanged){this.onThicknessChanged()}}},onThicknessChanged:function(){if(this.axisThicknessSuspendCount===0){this.isThicknessChanged=false;this.performLayout()}else{this.isThicknessChanged=true}},applySprites:function(B){var A=this.getSurface("chart");B=Ext.Array.from(B);A.removeAll(true);A.add(B);return B},initItems:function(){var A=this.items,B,D,C;if(A&&!A.isMixedCollection){this.items=[];A=Ext.Array.from(A);for(B=0,D=A.length;B<D;B++){C=A[B];if(C.type){Ext.raise("To add custom sprites to the chart use the 'sprites' config.")}else{this.items.push(C)}}}this.callParent()},applyBackground:function(C,E){var B=this.getSurface("background"),D,A,F;if(C){if(E){D=E.attr.width;A=E.attr.height;F=E.type===(C.type||"rect")}if(C.isSprite){E=C}else{if(C.type==="image"&&Ext.isString(C.src)){if(F){E.setAttributes({src:C.src})}else{B.remove(E,true);E=B.add(C)}}else{if(F){E.setAttributes({fillStyle:C})}else{B.remove(E,true);E=B.add({type:"rect",fillStyle:C,fx:{customDurations:{x:0,y:0,width:0,height:0}}})}}}}if(D&&A){E.setAttributes({width:D,height:A})}E.setAnimation(this.getAnimation());return E},getLegendStore:function(){return this.legendStore},refreshLegendStore:function(){if(this.getLegendStore()){var D,E,C=this.getSeries(),B,A=[];if(C){for(D=0,E=C.length;D<E;D++){B=C[D];if(B.getShowInLegend()){B.provideLegendInfo(A)}}}this.getLegendStore().setData(A)}},resetLegendStore:function(){var C=this.getLegendStore(),E,D,A,B;if(C){E=this.getLegendStore().getData().items;for(D=0,A=E.length;D<A;D++){B=E[D];B.beginEdit();B.set("disabled",false);B.commit()}}},onUpdateLegendStore:function(B,A){var D=this.getSeries(),C;if(A&&D){C=D.map[A.get("series")];if(C){C.setHiddenByIndex(A.get("index"),A.get("disabled"));this.redraw()}}},defaultResizeHandler:function(A){this.scheduleLayout();return false},applyMainRect:function(A,B){if(!B){return A}this.getSeries();this.getAxes();if(A[0]===B[0]&&A[1]===B[1]&&A[2]===B[2]&&A[3]===B[3]){return B}else{return A}},register:function(A){var B=this.chartComponents,C=A.getId();if(C===undefined){Ext.raise("Chart component id is undefined. Please ensure the component has an id.")}if(C in B){Ext.raise('Registering duplicate chart component id "'+C+'"')}B[C]=A},unregister:function(A){var B=this.chartComponents,C=A.getId();delete B[C]},get:function(A){return this.chartComponents[A]},getAxis:function(A){if(A instanceof Ext.chart.axis.Axis){return A}else{if(Ext.isNumber(A)){return this.getAxes()[A]}else{if(Ext.isString(A)){return this.get(A)}}}},getSurface:function(B,C){B=B||"main";C=C||B;var D=this,A=this.callParent([B]),F=D.surfaceZIndexes,E=D.surfaceMap;if(C in F){A.element.setStyle("zIndex",F[C])}if(!E[C]){E[C]=[]}if(Ext.Array.indexOf(E[C],A)<0){A.type=C;E[C].push(A);A.on("destroy",D.forgetSurface,D)}return A},forgetSurface:function(A){var D=this.surfaceMap;if(!D||this.isDestroying){return }var C=D[A.type],B=C?Ext.Array.indexOf(C,A):-1;if(B>=0){C.splice(B,1)}},applyAxes:function(B,J){var K=this,G={left:"right",right:"left"},L=[],C,D,E,A,F,H,I;K.animationSuspendCount++;K.getStore();if(!J){J=[];J.map={}}I=J.map;L.map={};B=Ext.Array.from(B,true);for(F=0,H=B.length;F<H;F++){C=B[F];if(!C){continue}if(C instanceof Ext.chart.axis.Axis){D=I[C.getId()];C.setChart(K)}else{C=Ext.Object.chain(C);E=C.linkedTo;A=C.id;if(Ext.isNumber(E)){C=Ext.merge({},B[E],C)}else{if(Ext.isString(E)){Ext.Array.each(B,function(M){if(M.id===C.linkedTo){C=Ext.merge({},M,C);return false}})}}C.id=A;C.chart=K;if(K.getInherited().rtl){C.position=G[C.position]||C.position}A=C.getId&&C.getId()||C.id;C=Ext.factory(C,null,D=I[A],"axis")}if(C){L.push(C);L.map[C.getId()]=C;if(!D){C.on("animationstart","onAnimationStart",K);C.on("animationend","onAnimationEnd",K)}}}for(F in I){if(!L.map[F]){I[F].destroy()}}K.animationSuspendCount--;return L},updateAxes:function(){if(!this.isDestroying){this.scheduleLayout()}},circularCopyArray:function(E,F,D){var C=[],B,A=E&&E.length;if(A){for(B=0;B<D;B++){C.push(E[(F+B)%A])}}return C},circularCopyObject:function(F,G,D){var C=this,B,E,A={};if(D){for(B in F){if(F.hasOwnProperty(B)){E=F[B];if(Ext.isArray(E)){A[B]=C.circularCopyArray(E,G,D)}else{A[B]=E}}}}return A},getColors:function(){var B=this,A=B.config.colors,C=B.getTheme();if(Ext.isArray(A)&&A.length>0){A=B.applyColors(A)}return A||(C&&C.getColors())},applyColors:function(A){A=Ext.Array.map(A,function(B){if(Ext.isString(B)){return B}else{return B.toString()}});return A},updateColors:function(C){var J=this,E=J.getTheme(),A=C||(E&&E.getColors()),K=0,F=J.getSeries(),D=F&&F.length,G,I,B,H;if(A.length){for(G=0;G<D;G++){I=F[G];H=I.themeColorCount();B=J.circularCopyArray(A,K,H);K+=H;I.updateChartColors(B)}}J.refreshLegendStore()},applyTheme:function(A){if(A&&A.isTheme){return A}return Ext.Factory.chartTheme(A)},updateTheme:function(G){var E=this,F=E.getAxes(),D=E.getSeries(),A=E.getColors(),C,B;E.updateChartTheme(G);for(B=0;B<F.length;B++){F[B].updateTheme(G)}for(B=0;B<D.length;B++){C=D[B];C.updateTheme(G)}E.updateSpriteTheme(G);E.updateColors(A);E.redraw()},themeOnlyIfConfigured:{},updateChartTheme:function(C){var I=this,K=C.getChart(),N=I.getInitialConfig(),B=I.defaultConfig,E=I.getConfigurator().configs,F=K.defaults,G=K[I.xtype],H=I.themeOnlyIfConfigured,L,J,O,A,M,D;K=Ext.merge({},F,G);for(L in K){J=K[L];D=E[L];if(J!==null&&J!==undefined&&D){M=N[L];O=Ext.isObject(J);A=M===B[L];if(O){if(A&&H[L]){continue}J=Ext.merge({},J,M)}if(A||O){I[D.names.set](J)}}}},updateSpriteTheme:function(C){this.getSprites();var I=this,E=I.getSurface("chart"),H=E.getItems(),L=C.getSprites(),J,A,K,F,D,B,G;for(B=0,G=H.length;B<G;B++){J=H[B];A=L[J.type];if(A){F={};D=J.type==="text";for(K in A){if(!(K in J.config)){if(!(D&&K.indexOf("font")===0&&J.config.font)){F[K]=A[K]}}}J.setAttributes(F)}}},addSeries:function(B){var A=this.getSeries();Ext.Array.push(A,B);this.setSeries(A)},removeSeries:function(D){D=Ext.Array.from(D);var B=this.getSeries(),F=[],A=D.length,G={},C,E;for(C=0;C<A;C++){E=D[C];if(typeof E!=="string"){E=E.getId()}G[E]=true}for(C=0,A=B.length;C<A;C++){if(!G[B[C].getId()]){F.push(B[C])}}this.setSeries(F)},applySeries:function(E,D){var G=this,I=[],H,A,C,F,B;G.animationSuspendCount++;G.getAxes();if(D){H=D.map}else{D=[];H=D.map={}}I.map={};E=Ext.Array.from(E,true);for(C=0,F=E.length;C<F;C++){B=E[C];if(!B){continue}A=H[B.getId&&B.getId()||B.id];if(B instanceof Ext.chart.series.Series){if(A&&A!==B){A.destroy()}B.setChart(G)}else{if(Ext.isObject(B)){if(A){A.setConfig(B);B=A}else{if(Ext.isString(B)){B={type:B}}B.chart=G;B=Ext.create(B.xclass||("series."+B.type),B);B.on("animationstart","onAnimationStart",G);B.on("animationend","onAnimationEnd",G)}}}I.push(B);I.map[B.getId()]=B}for(C in H){if(!I.map[H[C].getId()]){H[C].destroy()}}G.animationSuspendCount--;return I},applyLegend:function(B,A){return Ext.factory(B,Ext.chart.Legend,A)},updateLegend:function(B,A){if(A){A.destroy()}if(B){this.getItems();this.legendStore=new Ext.data.Store({autoDestroy:true,fields:["id","name","mark","disabled","series","index"]});B.setStore(this.legendStore);this.refreshLegendStore();this.legendStore.on("update","onUpdateLegendStore",this)}},updateSeries:function(B,A){var C=this;if(C.isDestroying){return }C.animationSuspendCount++;C.fireEvent("serieschange",C,B,A);C.refreshLegendStore();if(!Ext.isEmpty(B)){C.updateTheme(C.getTheme())}C.scheduleLayout();C.animationSuspendCount--},applyInteractions:function(H,D){if(!D){D=[];D.map={}}var G=this,A=[],C=D.map,E,F,B;A.map={};H=Ext.Array.from(H,true);for(E=0,F=H.length;E<F;E++){B=H[E];if(!B){continue}B=Ext.factory(B,null,C[B.getId&&B.getId()||B.id],"interaction");if(B){B.setChart(G);A.push(B);A.map[B.getId()]=B}}for(E in C){if(!A.map[E]){C[E].destroy()}}return A},getInteraction:function(E){var F=this.getInteractions(),A=F&&F.length,C=null,B,D;if(A){for(D=0;D<A;++D){B=F[D];if(B.type===E){C=B;break}}}return C},applyStore:function(A){return A&&Ext.StoreManager.lookup(A)},updateStore:function(A,C){var B=this;if(C){C.un({datachanged:"onDataChanged",update:"onDataChanged",scope:B,order:"after"});if(C.autoDestroy){C.destroy()}}if(A){A.on({datachanged:"onDataChanged",update:"onDataChanged",scope:B,order:"after"})}B.fireEvent("storechange",B,A,C);B.onDataChanged()},redraw:function(){this.fireEvent("redraw",this)},performLayout:function(){var D=this,B=D.getChartSize(true),C=[0,0,B.width,B.height],A=D.getBackground();D.hasFirstLayout=true;D.fireEvent("layout",D);D.cancelChartLayout();D.getSurface("background").setRect(C);D.getSurface("chart").setRect(C);A.setAttributes({width:B.width,height:B.height})},getChartSize:function(B){var A=this;if(B){A.chartSize=null}return A.chartSize||(A.chartSize=A.innerElement.getSize())},getEventXY:function(A){return this.getSurface().getEventXY(A)},getItemForPoint:function(H,G){var F=this,A=F.getSeries(),E=F.getMainRect(),D=A.length,B=F.hasFirstLayout?D-1:-1,C,I;if(!(E&&H>=0&&H<=E[2]&&G>=0&&G<=E[3])){return null}for(;B>=0;B--){C=A[B];I=C.getItemForPoint(H,G);if(I){return I}}return null},getItemsForPoint:function(H,G){var F=this,A=F.getSeries(),D=A.length,B=F.hasFirstLayout?D-1:-1,E=[],C,I;for(;B>=0;B--){C=A[B];I=C.getItemForPoint(H,G);if(I){E.push(I)}}return E},onAnimationStart:function(){this.fireEvent("animationstart",this)},onAnimationEnd:function(){this.fireEvent("animationend",this)},onDataChanged:function(){var D=this;if(D.isInitializing){return }var C=D.getMainRect(),A=D.getStore(),B=D.getSeries(),E=D.getAxes();if(!A||!E||!B){return }if(!C){D.on({redraw:D.onDataChanged,scope:D,single:true});return }D.processData();D.redraw()},recordCount:0,processData:function(){var G=this,E=G.getStore().getCount(),C=G.getSeries(),F=C.length,D=false,B=0,A;for(;B<F;B++){A=C[B];A.processData();if(!D&&A.isStoreDependantColorCount){D=true}}if(D&&E>G.recordCount){G.updateColors(G.getColors());G.recordCount=E}},bindStore:function(A){this.setStore(A)},applyHighlightItem:function(F,A){if(F===A){return }if(Ext.isObject(F)&&Ext.isObject(A)){var E=F,D=A,C=E.sprite&&(E.sprite[0]||E.sprite),B=D.sprite&&(D.sprite[0]||D.sprite);if(C===B&&E.index===D.index){return }}return F},updateHighlightItem:function(B,A){if(A){A.series.setAttributesForItem(A,{highlighted:false})}if(B){B.series.setAttributesForItem(B,{highlighted:true});this.fireEvent("itemhighlight",this,B,A)}this.fireEvent("itemhighlightchange",this,B,A)},destroyChart:function(){var F=this,D=F.getLegend(),G=F.getAxes(),C=F.getSeries(),H=F.getInteractions(),B=[],A,E;F.surfaceMap=null;for(A=0,E=H.length;A<E;A++){H[A].destroy()}for(A=0,E=G.length;A<E;A++){G[A].destroy()}for(A=0,E=C.length;A<E;A++){C[A].destroy()}F.setInteractions(B);F.setAxes(B);F.setSeries(B);if(D){D.destroy();F.setLegend(null)}F.legendStore=null;F.setStore(null);F.cancelChartLayout()},getRefItems:function(B){var G=this,E=G.getSeries(),H=G.getAxes(),A=G.getInteractions(),C=[],D,F;for(D=0,F=E.length;D<F;D++){C.push(E[D]);if(E[D].getRefItems){C.push.apply(C,E[D].getRefItems(B))}}for(D=0,F=H.length;D<F;D++){C.push(H[D]);if(H[D].getRefItems){C.push.apply(C,H[D].getRefItems(B))}}for(D=0,F=A.length;D<F;D++){C.push(A[D]);if(A[D].getRefItems){C.push.apply(C,A[D].getRefItems(B))}}return C}})