Ext.define("Ext.chart.CartesianChart",{extend:"Ext.chart.AbstractChart",alternateClassName:"Ext.chart.Chart",requires:["Ext.chart.grid.HorizontalGrid","Ext.chart.grid.VerticalGrid"],xtype:["cartesian","chart"],isCartesian:true,config:{flipXY:false,innerRect:[0,0,1,1],innerPadding:{top:0,left:0,right:0,bottom:0}},applyInnerPadding:function(B,A){if(!Ext.isObject(B)){return Ext.util.Format.parseBox(B)}else{if(!A){return B}else{return Ext.apply(A,B)}}},getDirectionForAxis:function(A){var B=this.getFlipXY();if(A==="left"||A==="right"){if(B){return"X"}else{return"Y"}}else{if(B){return"Y"}else{return"X"}}},performLayout:function(){var Z=this;Z.animationSuspendCount++;if(Z.callParent()===false){--Z.animationSuspendCount;return }Z.suspendThicknessChanged();var D=Z.getSurface("chart").getRect(),N=D[2],M=D[3],Y=Z.getAxes(),B,P=Z.getSeries(),H,K,A,F=Z.getInsetPadding(),U=Z.getInnerPadding(),Q,C,E=Ext.apply({},F),T,O,R,J,L,X,S,W,G,I=Z.getInherited().rtl,V=Z.getFlipXY();if(N<=0||M<=0){return }for(W=0;W<Y.length;W++){B=Y[W];K=B.getSurface();L=B.getFloating();X=L?L.value:null;A=B.getThickness();switch(B.getPosition()){case"top":K.setRect([0,E.top+1,N,A]);break;case"bottom":K.setRect([0,M-(E.bottom+A),N,A]);break;case"left":K.setRect([E.left,0,A,M]);break;case"right":K.setRect([N-(E.right+A),0,A,M]);break}if(X===null){E[B.getPosition()]+=A}}N-=E.left+E.right;M-=E.top+E.bottom;T=[E.left,E.top,N,M];E.left+=U.left;E.top+=U.top;E.right+=U.right;E.bottom+=U.bottom;O=N-U.left-U.right;R=M-U.top-U.bottom;Z.setInnerRect([E.left,E.top,O,R]);if(O<=0||R<=0){return }Z.setMainRect(T);Z.getSurface().setRect(T);for(W=0,G=Z.surfaceMap.grid&&Z.surfaceMap.grid.length;W<G;W++){C=Z.surfaceMap.grid[W];C.setRect(T);C.matrix.set(1,0,0,1,U.left,U.top);C.matrix.inverse(C.inverseMatrix)}for(W=0;W<Y.length;W++){B=Y[W];K=B.getSurface();S=K.matrix;J=S.elements;switch(B.getPosition()){case"top":case"bottom":J[4]=E.left;B.setLength(O);break;case"left":case"right":J[5]=E.top;B.setLength(R);break}B.updateTitleSprite();S.inverse(K.inverseMatrix)}for(W=0,G=P.length;W<G;W++){H=P[W];Q=H.getSurface();Q.setRect(T);if(V){if(I){Q.matrix.set(0,-1,-1,0,U.left+O,U.top+R)}else{Q.matrix.set(0,-1,1,0,U.left,U.top+R)}}else{Q.matrix.set(1,0,0,-1,U.left,U.top+R)}Q.matrix.inverse(Q.inverseMatrix);H.getOverlaySurface().setRect(T)}Z.redraw();Z.animationSuspendCount--;Z.resumeThicknessChanged()},refloatAxes:function(){var H=this,G=H.getAxes(),N=(G&&G.length)||0,C,D,M,F,K,B,J,Q=H.getChartSize(),P=H.getInsetPadding(),O=H.getInnerPadding(),A=Q.width-P.left-P.right,L=Q.height-P.top-P.bottom,I,E;for(E=0;E<N;E++){C=G[E];F=C.getFloating();K=F?F.value:null;if(K===null){delete C.floatingAtCoord;continue}D=C.getSurface();M=D.getRect();if(!M){continue}M=M.slice();B=H.getAxis(F.alongAxis);if(B){I=B.getAlignment()==="horizontal";if(Ext.isString(K)){K=B.getCoordFor(K)}B.floatingAxes[C.getId()]=K;J=B.getSprites()[0].attr.matrix;if(I){K=K*J.getXX()+J.getDX();C.floatingAtCoord=K+O.left+O.right}else{K=K*J.getYY()+J.getDY();C.floatingAtCoord=K+O.top+O.bottom}}else{I=C.getAlignment()==="horizontal";if(I){C.floatingAtCoord=K+O.top+O.bottom}else{C.floatingAtCoord=K+O.left+O.right}K=D.roundPixel(0.01*K*(I?L:A))}switch(C.getPosition()){case"top":M[1]=P.top+O.top+K-M[3]+1;break;case"bottom":M[1]=P.top+O.top+(B?K:L-K);break;case"left":M[0]=P.left+O.left+K-M[2];break;case"right":M[0]=P.left+O.left+(B?K:A-K)-1;break}D.setRect(M)}},redraw:function(){var a=this,P=a.getSeries(),X=a.getAxes(),B=a.getMainRect(),N,R,U=a.getInnerPadding(),F,J,Q,E,O,Y,T,G,D,C,A,I,L,W=a.getFlipXY(),V=1000,K,S,H,M,Z;if(!B){return }N=B[2]-U.left-U.right;R=B[3]-U.top-U.bottom;for(Y=0;Y<P.length;Y++){H=P[Y];if((C=H.getXAxis())){L=C.getVisibleRange();J=C.getRange();J=[J[0]+(J[1]-J[0])*L[0],J[0]+(J[1]-J[0])*L[1]]}else{J=H.getXRange()}if((A=H.getYAxis())){L=A.getVisibleRange();Q=A.getRange();Q=[Q[0]+(Q[1]-Q[0])*L[0],Q[0]+(Q[1]-Q[0])*L[1]]}else{Q=H.getYRange()}O={visibleMinX:J[0],visibleMaxX:J[1],visibleMinY:Q[0],visibleMaxY:Q[1],innerWidth:N,innerHeight:R,flipXY:W};F=H.getSprites();for(T=0,G=F.length;T<G;T++){M=F[T];K=M.attr.zIndex;if(K<V){K+=(Y+1)*100+V;M.attr.zIndex=K;Z=M.getMarker("items");if(Z){S=Z.attr.zIndex;if(S===Number.MAX_VALUE){Z.attr.zIndex=K}else{if(S<V){Z.attr.zIndex=K+S}}}}M.setAttributes(O,true)}}for(Y=0;Y<X.length;Y++){D=X[Y];E=D.isSide();F=D.getSprites();I=D.getRange();L=D.getVisibleRange();O={dataMin:I[0],dataMax:I[1],visibleMin:L[0],visibleMax:L[1]};if(E){O.length=R;O.startGap=U.bottom;O.endGap=U.top}else{O.length=N;O.startGap=U.left;O.endGap=U.right}for(T=0,G=F.length;T<G;T++){F[T].setAttributes(O,true)}}a.renderFrame();a.callParent(arguments)},renderFrame:function(){this.refloatAxes();this.callParent()}})