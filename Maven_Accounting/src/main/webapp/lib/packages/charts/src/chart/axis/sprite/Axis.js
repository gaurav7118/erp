Ext.define("Ext.chart.axis.sprite.Axis",{extend:"Ext.draw.sprite.Sprite",alias:"sprite.axis",type:"axis",mixins:{markerHolder:"Ext.chart.MarkerHolder"},requires:["Ext.draw.sprite.Text"],inheritableStatics:{def:{processors:{grid:"bool",axisLine:"bool",minorTicks:"bool",minorTickSize:"number",majorTicks:"bool",majorTickSize:"number",length:"number",startGap:"number",endGap:"number",dataMin:"number",dataMax:"number",visibleMin:"number",visibleMax:"number",position:"enums(left,right,top,bottom,angular,radial,gauge)",minStepSize:"number",estStepSize:"number",titleOffset:"number",textPadding:"number",min:"number",max:"number",centerX:"number",centerY:"number",radius:"number",totalAngle:"number",baseRotation:"number",data:"default",enlargeEstStepSizeByText:"bool"},defaults:{grid:false,axisLine:true,minorTicks:false,minorTickSize:3,majorTicks:true,majorTickSize:5,length:0,startGap:0,endGap:0,visibleMin:0,visibleMax:1,dataMin:0,dataMax:1,position:"",minStepSize:0,estStepSize:20,min:0,max:1,centerX:0,centerY:0,radius:1,baseRotation:0,data:null,titleOffset:0,textPadding:0,scalingCenterY:0,scalingCenterX:0,strokeStyle:"black",enlargeEstStepSizeByText:false},triggers:{minorTickSize:"bbox",majorTickSize:"bbox",position:"bbox,layout",axisLine:"bbox,layout",min:"layout",max:"layout",length:"layout",minStepSize:"layout",estStepSize:"layout",data:"layout",dataMin:"layout",dataMax:"layout",visibleMin:"layout",visibleMax:"layout",enlargeEstStepSizeByText:"layout"},updaters:{layout:"layoutUpdater"}}},config:{label:null,layout:null,segmenter:null,renderer:null,layoutContext:null,axis:null},thickness:0,stepSize:0,getBBox:function(){return null},defaultRenderer:function(A){return this.segmenter.renderer(A,this)},layoutUpdater:function(){var H=this,F=H.getAxis().getChart();if(F.isInitializing){return }var E=H.attr,D=H.getLayout(),G=F.getInherited().rtl,B=E.dataMin+(E.dataMax-E.dataMin)*E.visibleMin,I=E.dataMin+(E.dataMax-E.dataMin)*E.visibleMax,C=E.position,A={attr:E,segmenter:H.getSegmenter(),renderer:H.defaultRenderer};if(C==="left"||C==="right"){E.translationX=0;E.translationY=I*E.length/(I-B);E.scalingX=1;E.scalingY=-E.length/(I-B);E.scalingCenterY=0;E.scalingCenterX=0;H.applyTransformations(true)}else{if(C==="top"||C==="bottom"){if(G){E.translationX=E.length+B*E.length/(I-B)+1}else{E.translationX=-B*E.length/(I-B)}E.translationY=0;E.scalingX=(G?-1:1)*E.length/(I-B);E.scalingY=1;E.scalingCenterY=0;E.scalingCenterX=0;H.applyTransformations(true)}}if(D){D.calculateLayout(A);H.setLayoutContext(A)}},iterate:function(E,I){var C,G,A,B,H,D,J=Ext.Array.some,L=Math.abs,F;if(E.getLabel){if(E.min<E.from){I.call(this,E.min,E.getLabel(E.min),-1,E)}for(C=0;C<=E.steps;C++){I.call(this,E.get(C),E.getLabel(C),C,E)}if(E.max>E.to){I.call(this,E.max,E.getLabel(E.max),E.steps+1,E)}}else{B=this.getAxis();H=B.floatingAxes;D=[];F=(E.to-E.from)/(E.steps+1);if(B.getFloating()){for(A in H){D.push(H[A])}}function K(M){return !D.length||J(D,function(N){return L(N-M)>F})}if(E.min<E.from&&K(E.min)){I.call(this,E.min,E.min,-1,E)}for(C=0;C<=E.steps;C++){G=E.get(C);if(K(G)){I.call(this,G,G,C,E)}}if(E.max>E.to&&K(E.max)){I.call(this,E.max,E.max,E.steps+1,E)}}},renderTicks:function(L,M,S,P){var V=this,K=V.attr,U=K.position,N=K.matrix,E=0.5*K.lineWidth,F=N.getXX(),I=N.getDX(),J=N.getYY(),H=N.getDY(),O=S.majorTicks,D=K.majorTickSize,A=S.minorTicks,R=K.minorTickSize;if(O){switch(U){case"right":function Q(W){return function(X,Z,Y){X=L.roundPixel(X*J+H)+E;M.moveTo(0,X);M.lineTo(W,X)}}V.iterate(O,Q(D));A&&V.iterate(A,Q(R));break;case"left":function T(W){return function(X,Z,Y){X=L.roundPixel(X*J+H)+E;M.moveTo(P[2]-W,X);M.lineTo(P[2],X)}}V.iterate(O,T(D));A&&V.iterate(A,T(R));break;case"bottom":function C(W){return function(X,Z,Y){X=L.roundPixel(X*F+I)-E;M.moveTo(X,0);M.lineTo(X,W)}}V.iterate(O,C(D));A&&V.iterate(A,C(R));break;case"top":function B(W){return function(X,Z,Y){X=L.roundPixel(X*F+I)-E;M.moveTo(X,P[3]);M.lineTo(X,P[3]-W)}}V.iterate(O,B(D));A&&V.iterate(A,B(R));break;case"angular":V.iterate(O,function(W,Y,X){W=W/(K.max+1)*Math.PI*2+K.baseRotation;M.moveTo(K.centerX+(K.length)*Math.cos(W),K.centerY+(K.length)*Math.sin(W));M.lineTo(K.centerX+(K.length+D)*Math.cos(W),K.centerY+(K.length+D)*Math.sin(W))});break;case"gauge":var G=V.getGaugeAngles();V.iterate(O,function(W,Y,X){W=(W-K.min)/(K.max-K.min+1)*K.totalAngle-K.totalAngle+G.start;M.moveTo(K.centerX+(K.length)*Math.cos(W),K.centerY+(K.length)*Math.sin(W));M.lineTo(K.centerX+(K.length+D)*Math.cos(W),K.centerY+(K.length+D)*Math.sin(W))});break}}},renderLabels:function(e,Q,d,k){var O=this,K=O.attr,I=0.5*K.lineWidth,U=K.position,Y=K.matrix,a=K.textPadding,X=Y.getXX(),D=Y.getDX(),G=Y.getYY(),C=Y.getDY(),N=0,i=d.majorTicks,g=Math.max(K.majorTickSize,K.minorTickSize)+K.lineWidth,F=Ext.draw.Draw.isBBoxIntersect,f=O.getLabel(),j,S,R=null,W=0,B=0,M=d.segmenter,b=O.getRenderer(),T=O.getAxis(),Z=T.getTitle(),A=Z&&Z.attr.text!==""&&Z.getBBox(),L,H=null,P,c,V,E,h;if(i&&f&&!f.attr.hidden){j=f.attr.font;if(Q.font!==j){Q.font=j}f.setAttributes({translationX:0,translationY:0},true);f.applyTransformations();L=f.attr.inverseMatrix.elements.slice(0);switch(U){case"left":E=A?A.x+A.width:0;switch(f.attr.textAlign){case"start":h=e.roundPixel(E+D)-I;break;case"end":h=e.roundPixel(k[2]-g+D)-I;break;default:h=e.roundPixel(E+(k[2]-E-g)/2+D)-I}f.setAttributes({translationX:h},true);break;case"right":E=A?k[2]-A.x:0;switch(f.attr.textAlign){case"start":h=e.roundPixel(g+D)+I;break;case"end":h=e.roundPixel(k[2]-E+D)+I;break;default:h=e.roundPixel(g+(k[2]-g-E)/2+D)+I}f.setAttributes({translationX:h},true);break;case"top":E=A?A.y+A.height:0;f.setAttributes({translationY:e.roundPixel(E+(k[3]-E-g)/2)-I},true);break;case"bottom":E=A?k[3]-A.y:0;f.setAttributes({translationY:e.roundPixel(g+(k[3]-g-E)/2)+I},true);break;case"radial":f.setAttributes({translationX:K.centerX},true);break;case"angular":f.setAttributes({translationY:K.centerY},true);break;case"gauge":f.setAttributes({translationY:K.centerY},true);break}if(U==="left"||U==="right"){O.iterate(i,function(l,n,m){if(n===undefined){return }if(b){V=Ext.callback(b,null,[T,n,d,R],0,T)}else{V=M.renderer(n,d,R)}R=n;f.setAttributes({text:String(V),translationY:e.roundPixel(l*G+C)},true);f.applyTransformations();N=Math.max(N,f.getBBox().width+g);if(N<=O.thickness){c=Ext.draw.Matrix.fly(f.attr.matrix.elements.slice(0));P=c.prepend.apply(c,L).transformBBox(f.getBBox(true));if(H&&!F(P,H,a)){return }e.renderSprite(f);H=P;W+=P.height;B++}})}else{if(U==="top"||U==="bottom"){O.iterate(i,function(l,n,m){if(n===undefined){return }if(b){V=Ext.callback(b,null,[T,n,d,R],0,T)}else{V=M.renderer(n,d,R)}R=n;f.setAttributes({text:String(V),translationX:e.roundPixel(l*X+D)},true);f.applyTransformations();N=Math.max(N,f.getBBox().height+g);if(N<=O.thickness){c=Ext.draw.Matrix.fly(f.attr.matrix.elements.slice(0));P=c.prepend.apply(c,L).transformBBox(f.getBBox(true));if(H&&!F(P,H,a)){return }e.renderSprite(f);H=P;W+=P.width;B++}})}else{if(U==="radial"){O.iterate(i,function(l,n,m){if(n===undefined){return }if(b){V=Ext.callback(b,null,[T,n,d,R],0,T)}else{V=M.renderer(n,d,R)}R=n;if(typeof V!=="undefined"){f.setAttributes({text:String(V),translationX:K.centerX-e.roundPixel(l)/K.max*K.length*Math.cos(K.baseRotation+Math.PI/2),translationY:K.centerY-e.roundPixel(l)/K.max*K.length*Math.sin(K.baseRotation+Math.PI/2)},true);f.applyTransformations();P=f.attr.matrix.transformBBox(f.getBBox(true));if(H&&!F(P,H)){return }e.renderSprite(f);H=P;W+=P.width;B++}})}else{if(U==="angular"){S=K.majorTickSize+K.lineWidth*0.5+(parseInt(f.attr.fontSize,10)||10)/2;O.iterate(i,function(l,n,m){if(n===undefined){return }if(b){V=Ext.callback(b,null,[T,n,d,R],0,T)}else{V=M.renderer(n,d,R)}R=n;N=Math.max(N,Math.max(K.majorTickSize,K.minorTickSize)+(K.lineCap!=="butt"?K.lineWidth*0.5:0));if(typeof V!=="undefined"){var o=l/(K.max+1)*Math.PI*2+K.baseRotation;f.setAttributes({text:String(V),translationX:K.centerX+(K.length+S)*Math.cos(o),translationY:K.centerY+(K.length+S)*Math.sin(o)},true);f.applyTransformations();P=f.attr.matrix.transformBBox(f.getBBox(true));if(H&&!F(P,H)){return }e.renderSprite(f);H=P;W+=P.width;B++}})}else{if(U==="gauge"){var J=O.getGaugeAngles();O.iterate(i,function(l,n,m){if(n===undefined){return }if(b){V=Ext.callback(b,null,[T,n,d,R],0,T)}else{V=M.renderer(n,d,R)}R=n;if(typeof V!=="undefined"){var o=(l-K.min)/(K.max-K.min+1)*K.totalAngle-K.totalAngle+J.start;f.setAttributes({text:String(V),translationX:K.centerX+(K.length+10)*Math.cos(o),translationY:K.centerY+(K.length+10)*Math.sin(o)},true);f.applyTransformations();P=f.attr.matrix.transformBBox(f.getBBox(true));if(H&&!F(P,H)){return }e.renderSprite(f);H=P;W+=P.width;B++}})}}}}}if(K.enlargeEstStepSizeByText&&B){W/=B;W+=g;W*=2;if(K.estStepSize<W){K.estStepSize=W}}if(Math.abs(O.thickness-(N))>1){O.thickness=N;K.bbox.plain.dirty=true;K.bbox.transform.dirty=true;O.doThicknessChanged();return false}}},renderAxisLine:function(A,I,E,C){var H=this,G=H.attr,B=G.lineWidth*0.5,J=G.position,D,F;if(G.axisLine&&G.length){switch(J){case"left":D=A.roundPixel(C[2])-B;I.moveTo(D,-G.endGap);I.lineTo(D,G.length+G.startGap+1);break;case"right":I.moveTo(B,-G.endGap);I.lineTo(B,G.length+G.startGap+1);break;case"bottom":I.moveTo(-G.startGap,B);I.lineTo(G.length+G.endGap,B);break;case"top":D=A.roundPixel(C[3])-B;I.moveTo(-G.startGap,D);I.lineTo(G.length+G.endGap,D);break;case"angular":I.moveTo(G.centerX+G.length,G.centerY);I.arc(G.centerX,G.centerY,G.length,0,Math.PI*2,true);break;case"gauge":F=H.getGaugeAngles();I.moveTo(G.centerX+Math.cos(F.start)*G.length,G.centerY+Math.sin(F.start)*G.length);I.arc(G.centerX,G.centerY,G.length,F.start,F.end,true);break}}},getGaugeAngles:function(){var A=this,C=A.attr.totalAngle,B;if(C<=Math.PI){B=(Math.PI-C)*0.5}else{B=-(Math.PI*2-C)*0.5}B=Math.PI*2-B;return{start:B,end:B-C}},renderGridLines:function(L,M,R,Q){var S=this,B=S.getAxis(),K=S.attr,O=K.matrix,D=K.startGap,A=K.endGap,C=O.getXX(),J=O.getYY(),H=O.getDX(),G=O.getDY(),T=K.position,F=B.getGridAlignment(),P=R.majorTicks,E,N,I;if(K.grid){if(P){if(T==="left"||T==="right"){I=K.min*J+G+A+D;S.iterate(P,function(U,W,V){E=U*J+G+A;S.putMarker(F+"-"+(V%2?"odd":"even"),{y:E,height:I-E},N=V,true);I=E});N++;E=0;S.putMarker(F+"-"+(N%2?"odd":"even"),{y:E,height:I-E},N,true)}else{if(T==="top"||T==="bottom"){I=K.min*C+H+D;if(D){S.putMarker(F+"-even",{x:0,width:I},-1,true)}S.iterate(P,function(U,W,V){E=U*C+H+D;S.putMarker(F+"-"+(V%2?"odd":"even"),{x:E,width:I-E},N=V,true);I=E});N++;E=K.length+K.startGap+K.endGap;S.putMarker(F+"-"+(N%2?"odd":"even"),{x:E,width:I-E},N,true)}else{if(T==="radial"){S.iterate(P,function(U,W,V){if(!U){return }E=U/K.max*K.length;S.putMarker(F+"-"+(V%2?"odd":"even"),{scalingX:E,scalingY:E},V,true);I=E})}else{if(T==="angular"){S.iterate(P,function(U,W,V){if(!K.length){return }E=U/(K.max+1)*Math.PI*2+K.baseRotation;S.putMarker(F+"-"+(V%2?"odd":"even"),{rotationRads:E,rotationCenterX:0,rotationCenterY:0,scalingX:K.length,scalingY:K.length},V,true);I=E})}}}}}}},renderLimits:function(N){var S=this,A=S.getAxis(),H=A.getChart(),O=H.getInnerPadding(),D=Ext.Array.from(A.getLimits());if(!D.length){return }var Q=A.limits.surface.getRect(),L=S.attr,M=L.matrix,T=L.position,J=Ext.Object.chain,U=A.limits.titles,C,I,B,R,K,P,F,G,E;U.instances=[];U.position=0;if(T==="left"||T==="right"){for(P=0,F=D.length;P<F;P++){R=J(D[P]);!R.line&&(R.line={});K=Ext.isString(R.value)?A.getCoordFor(R.value):R.value;K=K*M.getYY()+M.getDY();R.line.y=K+O.top;R.line.strokeStyle=R.line.strokeStyle||L.strokeStyle;S.putMarker("horizontal-limit-lines",R.line,P,true);if(R.line.title){U.createInstance(R.line.title);C=U.getBBoxFor(U.position-1);I=R.line.title.position||(T==="left"?"start":"end");switch(I){case"start":G=10;break;case"end":G=Q[2]-10;break;case"middle":G=Q[2]/2;break}U.setAttributesFor(U.position-1,{x:G,y:R.line.y-C.height/2,textAlign:I,fillStyle:R.line.title.fillStyle||R.line.strokeStyle})}}}else{if(T==="top"||T==="bottom"){for(P=0,F=D.length;P<F;P++){R=J(D[P]);!R.line&&(R.line={});K=Ext.isString(R.value)?A.getCoordFor(R.value):R.value;K=K*M.getXX()+M.getDX();R.line.x=K+O.left;R.line.strokeStyle=R.line.strokeStyle||L.strokeStyle;S.putMarker("vertical-limit-lines",R.line,P,true);if(R.line.title){U.createInstance(R.line.title);C=U.getBBoxFor(U.position-1);I=R.line.title.position||(T==="top"?"end":"start");switch(I){case"start":E=Q[3]-C.width/2-10;break;case"end":E=C.width/2+10;break;case"middle":E=Q[3]/2;break}U.setAttributesFor(U.position-1,{x:R.line.x+C.height/2,y:E,fillStyle:R.line.title.fillStyle||R.line.strokeStyle,rotationRads:Math.PI/2})}}}else{if(T==="radial"){for(P=0,F=D.length;P<F;P++){R=J(D[P]);!R.line&&(R.line={});K=Ext.isString(R.value)?A.getCoordFor(R.value):R.value;if(K>L.max){continue}K=K/L.max*L.length;R.line.cx=L.centerX;R.line.cy=L.centerY;R.line.scalingX=K;R.line.scalingY=K;R.line.strokeStyle=R.line.strokeStyle||L.strokeStyle;S.putMarker("circular-limit-lines",R.line,P,true);if(R.line.title){U.createInstance(R.line.title);C=U.getBBoxFor(U.position-1);U.setAttributesFor(U.position-1,{x:L.centerX,y:L.centerY-K-C.height/2,fillStyle:R.line.title.fillStyle||R.line.strokeStyle})}}}else{if(T==="angular"){for(P=0,F=D.length;P<F;P++){R=J(D[P]);!R.line&&(R.line={});K=Ext.isString(R.value)?A.getCoordFor(R.value):R.value;K=K/(L.max+1)*Math.PI*2+L.baseRotation;R.line.translationX=L.centerX;R.line.translationY=L.centerY;R.line.rotationRads=K;R.line.rotationCenterX=0;R.line.rotationCenterY=0;R.line.scalingX=L.length;R.line.scalingY=L.length;R.line.strokeStyle=R.line.strokeStyle||L.strokeStyle;S.putMarker("radial-limit-lines",R.line,P,true);if(R.line.title){U.createInstance(R.line.title);C=U.getBBoxFor(U.position-1);B=((K>-0.5*Math.PI&&K<0.5*Math.PI)||(K>1.5*Math.PI&&K<2*Math.PI))?1:-1;U.setAttributesFor(U.position-1,{x:L.centerX+0.5*L.length*Math.cos(K)+B*C.height/2*Math.sin(K),y:L.centerY+0.5*L.length*Math.sin(K)-B*C.height/2*Math.cos(K),rotationRads:B===1?K:K-Math.PI,fillStyle:R.line.title.fillStyle||R.line.strokeStyle})}}}else{if(T==="gauge"){}}}}}},doThicknessChanged:function(){var A=this.getAxis();if(A){A.onThicknessChanged()}},render:function(A,C,D){var E=this,B=E.getLayoutContext();if(B){if(false===E.renderLabels(A,C,B,D)){return false}C.beginPath();E.renderTicks(A,C,B,D);E.renderAxisLine(A,C,B,D);E.renderGridLines(A,C,B,D);E.renderLimits(D);C.stroke()}}})