Ext.define("Ext.chart.interactions.CrossZoom",{extend:"Ext.chart.interactions.Abstract",type:"crosszoom",alias:"interaction.crosszoom",isCrossZoom:true,config:{axes:true,gestures:{dragstart:"onGestureStart",drag:"onGesture",dragend:"onGestureEnd",dblclick:"onDoubleTap"},undoButton:{}},stopAnimationBeforeSync:false,zoomAnimationInProgress:false,constructor:function(){this.callParent(arguments);this.zoomHistory=[]},applyAxes:function(B){var A={};if(B===true){return{top:{},right:{},bottom:{},left:{}}}else{if(Ext.isArray(B)){A={};Ext.each(B,function(C){A[C]={}})}else{if(Ext.isObject(B)){Ext.iterate(B,function(C,D){if(D===true){A[C]={}}else{if(D!==false){A[C]=D}}})}}}return A},applyUndoButton:function(B,A){var C=this;if(A){A.destroy()}if(B){return Ext.create("Ext.Button",Ext.apply({cls:[],text:"Undo Zoom",disabled:true,handler:function(){C.undoZoom()}},B))}},getSurface:function(){return this.getChart()&&this.getChart().getSurface("main")},setSeriesOpacity:function(B){var A=this.getChart()&&this.getChart().getSurface("series");if(A){A.element.setStyle("opacity",B)}},onGestureStart:function(G){var I=this,H=I.getChart(),D=I.getSurface(),K=H.getInnerRect(),C=H.getInnerPadding(),F=C.left,B=F+K[2],E=C.top,A=E+K[3],M=H.getEventXY(G),L=M[0],J=M[1];if(I.zoomAnimationInProgress){return }if(L>F&&L<B&&J>E&&J<A){I.gestureEvent="drag";I.lockEvents(I.gestureEvent);I.startX=L;I.startY=J;I.selectionRect=D.add({type:"rect",globalAlpha:0.5,fillStyle:"rgba(80,80,140,0.5)",strokeStyle:"rgba(80,80,140,1)",lineWidth:2,x:L,y:J,width:0,height:0,zIndex:10000});I.setSeriesOpacity(0.8);return false}},onGesture:function(G){var I=this;if(I.zoomAnimationInProgress){return }if(I.getLocks()[I.gestureEvent]===I){var H=I.getChart(),D=I.getSurface(),K=H.getInnerRect(),C=H.getInnerPadding(),F=C.left,B=F+K[2],E=C.top,A=E+K[3],M=H.getEventXY(G),L=M[0],J=M[1];if(L<F){L=F}else{if(L>B){L=B}}if(J<E){J=E}else{if(J>A){J=A}}I.selectionRect.setAttributes({width:L-I.startX,height:J-I.startY});if(Math.abs(I.startX-L)<11||Math.abs(I.startY-J)<11){I.selectionRect.setAttributes({globalAlpha:0.5})}else{I.selectionRect.setAttributes({globalAlpha:1})}D.renderFrame();return false}},onGestureEnd:function(H){var K=this;if(K.zoomAnimationInProgress){return }if(K.getLocks()[K.gestureEvent]===K){var J=K.getChart(),D=K.getSurface(),M=J.getInnerRect(),C=J.getInnerPadding(),F=C.left,B=F+M[2],E=C.top,A=E+M[3],G=M[2],I=M[3],O=J.getEventXY(H),N=O[0],L=O[1];if(N<F){N=F}else{if(N>B){N=B}}if(L<E){L=E}else{if(L>A){L=A}}if(Math.abs(K.startX-N)<11||Math.abs(K.startY-L)<11){D.remove(K.selectionRect)}else{K.zoomBy([Math.min(K.startX,N)/G,1-Math.max(K.startY,L)/I,Math.max(K.startX,N)/G,1-Math.min(K.startY,L)/I]);K.selectionRect.setAttributes({x:Math.min(K.startX,N),y:Math.min(K.startY,L),width:Math.abs(K.startX-N),height:Math.abs(K.startY-L)});K.selectionRect.setAnimation(J.getAnimation()||{duration:0});K.selectionRect.setAttributes({globalAlpha:0,x:0,y:0,width:G,height:I});K.zoomAnimationInProgress=true;J.suspendThicknessChanged();K.selectionRect.fx.on("animationend",function(){J.resumeThicknessChanged();D.remove(K.selectionRect);K.selectionRect=null;K.zoomAnimationInProgress=false})}D.renderFrame();K.sync();K.unlockEvents(K.gestureEvent);K.setSeriesOpacity(1);if(!K.zoomAnimationInProgress){D.remove(K.selectionRect);K.selectionRect=null}}},zoomBy:function(N){var M=this,A=M.getAxes(),J=M.getChart(),I=J.getAxes(),K=J.getInherited().rtl,F,D={},C,B;if(K){N=N.slice();C=1-N[0];B=1-N[2];N[0]=Math.min(C,B);N[2]=Math.max(C,B)}for(var H=0;H<I.length;H++){var G=I[H];F=A[G.getPosition()];if(F&&F.allowZoom!==false){var E=G.isSide(),L=G.getVisibleRange();D[G.getId()]=L.slice(0);if(!E){G.setVisibleRange([(L[1]-L[0])*N[0]+L[0],(L[1]-L[0])*N[2]+L[0]])}else{G.setVisibleRange([(L[1]-L[0])*N[1]+L[0],(L[1]-L[0])*N[3]+L[0]])}}}M.zoomHistory.push(D);M.getUndoButton().setDisabled(false)},undoZoom:function(){var C=this.zoomHistory.pop(),D=this.getChart().getAxes();if(C){for(var A=0;A<D.length;A++){var B=D[A];if(C[B.getId()]){B.setVisibleRange(C[B.getId()])}}}this.getUndoButton().setDisabled(this.zoomHistory.length===0);this.sync()},onDoubleTap:function(A){this.undoZoom()},destroy:function(){this.setUndoButton(null);this.callParent(arguments)}})