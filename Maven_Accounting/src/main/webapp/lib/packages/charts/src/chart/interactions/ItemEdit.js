Ext.define("Ext.chart.interactions.ItemEdit",{extend:"Ext.chart.interactions.ItemHighlight",requires:["Ext.tip.ToolTip"],type:"itemedit",alias:"interaction.itemedit",isItemEdit:true,config:{style:null,renderer:null,tooltip:true,gestures:{dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd"},cursors:{ewResize:"ew-resize",nsResize:"ns-resize",move:"move"}},item:null,applyTooltip:function(B){if(B){var A=Ext.apply({},B,{renderer:this.defaultTooltipRenderer,constrainPosition:true,shrinkWrapDock:true,autoHide:true,offsetX:10,offsetY:10});B=new Ext.tip.ToolTip(A)}return B},defaultTooltipRenderer:function(B,A,E,D){var C=[];if(E.xField){C.push(E.xField+": "+E.xValue)}if(E.yField){C.push(E.yField+": "+E.yValue)}B.setHtml(C.join("<br>"))},onDragStart:function(D){var C=this,A=C.getChart(),B=A.getHighlightItem();if(B){A.fireEvent("beginitemedit",A,C,C.item=B);return false}},onDrag:function(E){var D=this,B=D.getChart(),C=B.getHighlightItem(),A=C&&C.sprite.type;if(C){switch(A){case"barSeries":return D.onDragBar(E);break;case"scatterSeries":return D.onDragScatter(E);break}}},highlight:function(F){var E=this,D=E.getChart(),A=D.getFlipXY(),G=E.getCursors(),C=F&&F.sprite.type,B=D.el.dom.style;E.callParent([F]);if(F){switch(C){case"barSeries":if(A){B.cursor=G.ewResize}else{B.cursor=G.nsResize}break;case"scatterSeries":B.cursor=G.move;break}}else{D.el.dom.style.cursor="default"}},onDragBar:function(H){var L=this,J=L.getChart(),K=J.getInherited().rtl,E=J.isCartesian&&J.getFlipXY(),P=J.getHighlightItem(),F=P.sprite.getMarker("items"),O=F.getMarkerFor(P.sprite.getId(),P.index),B=P.sprite.getSurface(),C=B.getRect(),Q=B.getEventXY(H),N=P.sprite.attr.matrix,I=L.getRenderer(),A,M,D,G;if(E){G=K?C[2]-Q[0]:Q[0]}else{G=C[3]-Q[1]}A={x:O.x,y:G,width:O.width,height:O.height+(O.y-G),radius:O.radius,fillStyle:"none",lineDash:[4,4],zIndex:100};Ext.apply(A,L.getStyle());if(Ext.isArray(P.series.getYField())){G=G-O.y-O.height}L.target={index:P.index,yField:P.field,yValue:(G-N.getDY())/N.getYY()};D=[J,{target:L.target,style:A,item:P}];M=Ext.callback(I,null,D,0,J);if(M){Ext.apply(A,M)}P.sprite.putMarker("items",A,"itemedit");L.showTooltip(H,L.target,P);B.renderFrame()},onDragScatter:function(M){var S=this,F=S.getChart(),D=F.getInherited().rtl,K=F.isCartesian&&F.getFlipXY(),N=F.getHighlightItem(),B=N.sprite.getMarker("items"),O=B.getMarkerFor(N.sprite.getId(),N.index),I=N.sprite.getSurface(),G=I.getRect(),A=I.getEventXY(M),J=N.sprite.attr.matrix,C=N.series.getXAxis(),E=C&&C.getLayout().isContinuous,H=S.getRenderer(),L,T,P,R,Q;if(K){Q=D?G[2]-A[0]:A[0]}else{Q=G[3]-A[1]}if(E){if(K){R=G[3]-A[1]}else{R=A[0]}}else{R=O.translationX}L={translationX:R,translationY:Q,scalingX:O.scalingX,scalingY:O.scalingY,r:O.r,fillStyle:"none",lineDash:[4,4],zIndex:100};Ext.apply(L,S.getStyle());S.target={index:N.index,yField:N.field,yValue:(Q-J.getDY())/J.getYY()};if(E){Ext.apply(S.target,{xField:N.series.getXField(),xValue:(R-J.getDX())/J.getXX()})}P=[F,{target:S.target,style:L,item:N}];T=Ext.callback(H,null,P,0,F);if(T){Ext.apply(L,T)}N.sprite.putMarker("items",L,"itemedit");S.showTooltip(M,S.target,N);I.renderFrame()},showTooltip:function(F,E,C){var D=this.getTooltip(),A,B;if(D&&Ext.toolkit!=="modern"){A=D.config;B=this.getChart();Ext.callback(A.renderer,null,[D,C,E,F],0,B);D.show([F.x+A.offsetX,F.y+A.offsetY])}},hideTooltip:function(){var A=this.getTooltip();if(A&&Ext.toolkit!=="modern"){A.hide()}},onDragEnd:function(F){var D=this,E=D.target,C=D.getChart(),B=C.getStore(),A;if(E){A=B.getAt(E.index);if(E.yField){A.set(E.yField,E.yValue,{convert:false})}if(E.xField){A.set(E.xField,E.xValue,{convert:false})}if(E.yField||E.xField){D.getChart().onDataChanged()}D.target=null}D.hideTooltip();if(D.item){C.fireEvent("enditemedit",C,D,D.item,E)}D.highlight(D.item=null)},destroy:function(){var A=this.getConfig("tooltip",true);Ext.destroy(A);this.callParent()}})