Ext.define("Ext.chart.series.Pie",{extend:"Ext.chart.series.Polar",requires:["Ext.chart.series.sprite.PieSlice"],type:"pie",alias:"series.pie",seriesType:"pieslice",config:{donut:0,rotation:0,clockwise:true,totalAngle:2*Math.PI,hidden:[],radiusFactor:100,highlightCfg:{margin:20},style:{}},directions:["X"],applyLabel:function(A,B){if(Ext.isObject(A)&&!Ext.isString(A.orientation)){Ext.apply(A=Ext.Object.chain(A),{orientation:"vertical"})}return this.callParent([A,B])},updateLabelData:function(){var H=this,I=H.getStore(),G=I.getData().items,E=H.getSprites(),A=H.getLabel().getTemplate().getField(),D=H.getHidden(),B,F,C,J;if(E.length&&A){C=[];for(B=0,F=G.length;B<F;B++){C.push(G[B].get(A))}for(B=0,F=E.length;B<F;B++){J=E[B];J.setAttributes({label:C[B]});J.putMarker("labels",{hidden:D[B]},J.attr.attributeId)}}},coordinateX:function(){var S=this,F=S.getStore(),P=F.getData().items,C=P.length,B=S.getXField(),E=S.getYField(),K,A=0,L,J,R=0,N=S.getHidden(),D=[],O,G=0,H=S.getTotalAngle(),Q=S.getClockwise()?1:-1,I=S.getSprites(),M;if(!I){return }for(O=0;O<C;O++){K=Math.abs(Number(P[O].get(B)))||0;J=E&&Math.abs(Number(P[O].get(E)))||0;if(!N[O]){A+=K;if(J>R){R=J}}D[O]=A;if(O>=N.length){N[O]=false}}N.length=C;S.maxY=R;if(A!==0){L=H/A}for(O=0;O<C;O++){I[O].setAttributes({startAngle:G,endAngle:G=(L?Q*D[O]*L:0),globalAlpha:1})}if(C<S.sprites.length){for(O=C;O<S.sprites.length;O++){M=S.sprites[O];M.getMarker("labels").clear(M.getId());M.releaseMarker("labels");M.destroy()}S.sprites.length=C}for(O=C;O<S.sprites.length;O++){I[O].setAttributes({startAngle:H,endAngle:H,globalAlpha:0})}S.getChart().refreshLegendStore()},updateCenter:function(A){this.setStyle({translationX:A[0]+this.getOffsetX(),translationY:A[1]+this.getOffsetY()});this.doUpdateStyles()},updateRadius:function(A){this.setStyle({startRho:A*this.getDonut()*0.01,endRho:A*this.getRadiusFactor()*0.01});this.doUpdateStyles()},getStyleByIndex:function(C){var G=this,I=G.getStore(),J=I.getAt(C),F=G.getYField(),D=G.getRadius(),A={},E,B,H;if(J){H=F&&Math.abs(Number(J.get(F)))||0;E=D*G.getDonut()*0.01;B=D*G.getRadiusFactor()*0.01;A=G.callParent([C]);A.startRho=E;A.endRho=G.maxY?(E+(B-E)*H/G.maxY):B}return A},updateDonut:function(B){var A=this.getRadius();this.setStyle({startRho:A*B*0.01,endRho:A*this.getRadiusFactor()*0.01});this.doUpdateStyles()},rotationOffset:-Math.PI/2,updateRotation:function(A){this.setStyle({rotationRads:A+this.rotationOffset});this.doUpdateStyles()},updateTotalAngle:function(A){this.processData()},getSprites:function(){var J=this,H=J.getChart(),M=J.getStore();if(!H||!M){return[]}J.getColors();J.getSubStyle();var I=M.getData().items,B=I.length,D=J.getAnimation()||H&&H.getAnimation(),G=J.sprites,N,K=0,F,E,C=false,L=J.getLabel(),A=L.getTemplate();F={store:M,field:J.getXField(),angleField:J.getXField(),radiusField:J.getYField(),series:J};for(E=0;E<B;E++){N=G[E];if(!N){N=J.createSprite();if(J.getHighlight()){N.config.highlight=J.getHighlight();N.addModifier("highlight",true)}if(A.getField()){A.setAttributes({labelOverflowPadding:J.getLabelOverflowPadding()});A.fx.setCustomDurations({"callout":200})}N.setAttributes(J.getStyleByIndex(E));N.rendererData=F;N.rendererIndex=K++;C=true}N.setAnimation(D)}if(C){J.doUpdateStyles()}return J.sprites},betweenAngle:function(B,D,A){var C=Math.PI*2,E=this.rotationOffset;if(!this.getClockwise()){B*=-1;D*=-1;A*=-1;D-=E;A-=E}else{D+=E;A+=E}B-=D;A-=D;B%=C;A%=C;B+=C;A+=C;B%=C;A%=C;return B<A||A===0},getItemForAngle:function(A){var H=this,F=H.getSprites(),D;A%=Math.PI*2;while(A<0){A+=Math.PI*2}if(F){var I=H.getStore(),G=I.getData().items,C=H.getHidden(),B=0,E=I.getCount();for(;B<E;B++){if(!C[B]){D=F[B].attr;if(D.startAngle<=A&&D.endAngle>=A){return{series:H,sprite:F[B],index:B,record:G[B],field:H.getXField()}}}}}return null},getItemForPoint:function(F,E){var S=this,C=S.getSprites();if(C){var R=S.getCenter(),P=S.getOffsetX(),O=S.getOffsetY(),I=F-R[0]+P,H=E-R[1]+O,B=S.getStore(),G=S.getDonut(),N=B.getData().items,Q=Math.atan2(H,I)-S.getRotation(),A=Math.sqrt(I*I+H*H),K=S.getRadius()*G*0.01,L=S.getHidden(),M,D,J;for(M=0,D=N.length;M<D;M++){if(!L[M]){J=C[M].attr;if(A>=K+J.margin&&A<=J.endRho+J.margin){if(S.betweenAngle(Q,J.startAngle,J.endAngle)){return{series:S,sprite:C[M],index:M,record:N[M],field:S.getXField()}}}}}return null}},provideLegendInfo:function(F){var H=this,I=H.getStore();if(I){var G=I.getData().items,B=H.getLabel().getTemplate().getField(),C=H.getXField(),E=H.getHidden(),D,A,J;for(D=0;D<G.length;D++){A=H.getStyleByIndex(D);J=A.fillStyle;if(Ext.isObject(J)){J=J.stops&&J.stops[0].color}F.push({name:B?String(G[D].get(B)):C+" "+D,mark:J||A.strokeStyle||"black",disabled:E[D],series:H.getId(),index:D})}}}})