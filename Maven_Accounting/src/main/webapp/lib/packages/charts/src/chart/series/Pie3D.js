Ext.define("Ext.chart.series.Pie3D",{extend:"Ext.chart.series.Polar",requires:["Ext.chart.series.sprite.Pie3DPart","Ext.draw.PathUtil"],type:"pie3d",seriesType:"pie3d",alias:"series.pie3d",isPie3D:true,config:{rect:[0,0,0,0],thickness:35,distortion:0.5,donut:false,hidden:[],highlightCfg:{margin:20},shadow:false},rotationOffset:-Math.PI/2,setField:function(A){return this.setXField(A)},getField:function(){return this.getXField()},updateRotation:function(A){this.setStyle({baseRotation:A+this.rotationOffset});this.doUpdateStyles()},updateDistortion:function(){this.setRadius()},updateThickness:function(){this.setRadius()},updateColors:function(A){this.setSubStyle({baseColor:A})},applyShadow:function(A){if(A===true){A={shadowColor:"rgba(0,0,0,0.8)",shadowBlur:30}}else{if(!Ext.isObject(A)){A={shadowColor:Ext.draw.Color.RGBA_NONE}}}return A},updateShadow:function(G){var E=this,F=E.getSprites(),D=E.spritesPerSlice,C=F&&F.length,B,A;for(B=1;B<C;B+=D){A=F[B];if(A.attr.part="bottom"){A.setAttributes(G)}}},getStyleByIndex:function(B){var D=this.callParent([B]),C=this.getStyle(),A=D.fillStyle||D.fill||D.color,E=C.strokeStyle||C.stroke;if(A){D.baseColor=A;delete D.fillStyle;delete D.fill;delete D.color}if(E){D.strokeStyle=E}return D},doUpdateStyles:function(){var G=this,H=G.getSprites(),F=G.spritesPerSlice,E=H&&H.length,C=0,B=0,A,D;for(;C<E;C+=F,B++){D=G.getStyleByIndex(B);for(A=0;A<F;A++){H[C+A].setAttributes(D)}}},coordinateX:function(){var U=this,K=U.getChart(),S=K&&K.getAnimation(),F=U.getStore(),R=F.getData().items,D=R.length,B=U.getXField(),N=U.getRotation(),Q=U.getHidden(),L,C=0,H,E=[],I=U.getSprites(),A=I.length,J=U.spritesPerSlice,G=0,M=Math.PI*2,T=1e-10,P,O;for(P=0;P<D;P++){L=Math.abs(Number(R[P].get(B)))||0;if(!Q[P]){C+=L}E[P]=C;if(P>=Q.length){Q[P]=false}}Q.length=D;if(C===0){return }H=2*Math.PI/C;for(P=0;P<D;P++){E[P]*=H}for(P=0;P<A;P++){I[P].setAnimation(S)}for(P=0;P<D;P++){for(O=0;O<J;O++){I[P*J+O].setAttributes({startAngle:G,endAngle:E[P]-T,globalAlpha:1,baseRotation:N})}G=E[P]}for(P*=J;P<A;P++){I[P].setAnimation(S);I[P].setAttributes({startAngle:M,endAngle:M,globalAlpha:0,baseRotation:N})}},updateLabelData:function(){var J=this,K=J.getStore(),I=K.getData().items,H=J.getSprites(),B=J.getLabel().getTemplate().getField(),F=J.getHidden(),A=J.spritesPerSlice,D,C,G,E,L;if(H.length&&B){E=[];for(D=0,G=I.length;D<G;D++){E.push(I[D].get(B))}for(D=0,C=0,G=H.length;D<G;D+=A,C++){L=H[D];L.setAttributes({label:E[C]});L.putMarker("labels",{hidden:F[C]},L.attr.attributeId)}}},applyRadius:function(){var F=this,D=F.getChart(),H=D.getInnerPadding(),E=D.getMainRect()||[0,0,1,1],C=E[2]-H*2,A=E[3]-H*2-F.getThickness(),G=C/2,B=G*F.getDistortion();if(B>A/2){return A/(F.getDistortion()*2)}else{return G}},getSprites:function(){var W=this,E=W.getStore();if(!E){return[]}var L=W.getChart(),N=W.getSurface(),R=E.getData().items,J=W.spritesPerSlice,A=R.length,T=W.getAnimation()||L&&L.getAnimation(),V=W.getCenter(),U=W.getOffsetX(),S=W.getOffsetY(),B=W.getRadius(),O=W.getRotation(),D=W.getHighlight(),C={centerX:V[0]+U,centerY:V[1]+S-W.getThickness()/2,endRho:B,startRho:B*W.getDonut()/100,thickness:W.getThickness(),distortion:W.getDistortion()},I=W.sprites,H=W.getLabel(),F=H.getTemplate(),K,G,M,Q,P;for(Q=0;Q<A;Q++){G=Ext.apply({},this.getStyleByIndex(Q),C);if(!I[Q*J]){for(P=0;P<W.partNames.length;P++){M=N.add({type:"pie3dPart",part:W.partNames[P]});if(P===0&&F.getField()){M.bindMarker("labels",H)}M.fx.setDurationOn("baseRotation",O);if(D){M.config.highlight=D;M.addModifier("highlight",true)}M.setAttributes(G);I.push(M)}}else{K=I.slice(Q*J,(Q+1)*J);for(P=0;P<K.length;P++){M=K[P];if(T){M.setAnimation(T)}M.setAttributes(G)}}}return I},betweenAngle:function(B,D,A){var C=Math.PI*2,E=this.rotationOffset;D+=E;A+=E;B-=D;A-=D;B%=C;A%=C;B+=C;A+=C;B%=C;A%=C;return B<A||A===0},getItemForPoint:function(J,I){var H=this,G=H.getSprites();if(G){var K=H.getStore(),B=K.getData().items,A=H.spritesPerSlice,E=H.getHidden(),C,F,L,D;for(C=0,F=B.length;C<F;C++){if(!E[C]){D=C*A;L=G[D];if(L.hitTest([J,I])){return{series:H,sprite:G.slice(D,D+A),index:C,record:B[C],category:"sprites",field:H.getXField()}}}}return null}},provideLegendInfo:function(F){var H=this,J=H.getStore();if(J){var G=J.getData().items,B=H.getLabel().getTemplate().getField(),I=H.getField(),E=H.getHidden(),D,A,C;for(D=0;D<G.length;D++){A=H.getStyleByIndex(D);C=A.baseColor;F.push({name:B?String(G[D].get(B)):I+" "+D,mark:C||"black",disabled:E[D],series:H.getId(),index:D})}}}},function(){var B=this.prototype,A=Ext.chart.series.sprite.Pie3DPart.def.getInitialConfig().processors.part;B.partNames=A.replace(/^enums\(|\)/g,"").split(",");B.spritesPerSlice=B.partNames.length})