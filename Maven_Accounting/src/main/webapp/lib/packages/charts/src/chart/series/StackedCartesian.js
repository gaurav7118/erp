Ext.define("Ext.chart.series.StackedCartesian",{extend:"Ext.chart.series.Cartesian",config:{stacked:true,splitStacks:true,fullStack:false,fullStackTotal:100,hidden:[]},spriteAnimationCount:0,themeColorCount:function(){var B=this,A=B.getYField();return Ext.isArray(A)?A.length:1},updateStacked:function(){this.processData()},updateSplitStacks:function(){this.processData()},coordinateY:function(){return this.coordinateStacked("Y",1,2)},coordinateStacked:function(a,E,J){var c=this,F=c.getStore(),O=F.getData().items,Y=O.length,C=c["get"+a+"Axis"](),U=c.getHidden(),A=c.getSplitStacks(),W=c.getFullStack(),I=c.getFullStackTotal(),M={min:0,max:0},K=c["fieldCategory"+a],Z=[],L=[],b=[],H,X=c.getStacked(),G=c.getSprites(),N=[],T,S,R,P,e,V,B,D,d,Q;if(!G.length){return }for(T=0;T<K.length;T++){D=K[T];P=c.getFields([D]);e=P.length;for(S=0;S<Y;S++){Z[S]=0;L[S]=0;b[S]=0}for(S=0;S<e;S++){if(!U[S]){N[S]=c.coordinateData(O,P[S],C)}}if(X&&W){V=[];if(A){B=[]}for(S=0;S<Y;S++){V[S]=0;if(A){B[S]=0}for(R=0;R<e;R++){d=N[R];if(!d){continue}d=d[S];if(d>=0||!A){V[S]+=d}else{if(d<0){B[S]+=d}}}}}for(S=0;S<e;S++){Q={};if(U[S]){Q["dataStart"+D]=Z;Q["data"+D]=Z;G[S].setAttributes(Q);continue}d=N[S];if(X){H=[];for(R=0;R<Y;R++){if(!d[R]){d[R]=0}if(d[R]>=0||!A){if(W&&V[R]){d[R]*=I/V[R]}Z[R]=L[R];L[R]+=d[R];H[R]=L[R]}else{if(W&&B[R]){d[R]*=I/B[R]}Z[R]=b[R];b[R]+=d[R];H[R]=b[R]}}Q["dataStart"+D]=Z;Q["data"+D]=H;c.getRangeOfData(Z,M);c.getRangeOfData(H,M)}else{Q["dataStart"+D]=Z;Q["data"+D]=d;c.getRangeOfData(d,M)}G[S].setAttributes(Q)}}c.dataRange[E]=M.min;c.dataRange[E+J]=M.max;Q={};Q["dataMin"+a]=M.min;Q["dataMax"+a]=M.max;for(T=0;T<G.length;T++){G[T].setAttributes(Q)}},getFields:function(F){var E=this,A=[],C,B,D;for(B=0,D=F.length;B<D;B++){C=E["get"+F[B]+"Field"]();if(Ext.isArray(C)){A.push.apply(A,C)}else{A.push(C)}}return A},updateLabelOverflowPadding:function(A){this.getLabel().setAttributes({labelOverflowPadding:A})},getSprites:function(){var J=this,I=J.getChart(),C=J.getAnimation()||I&&I.getAnimation(),F=J.getFields(J.fieldCategoryY),B=J.getItemInstancing(),H=J.sprites,K,E=J.getHidden(),G=false,D,A=F.length;if(!I){return[]}for(D=0;D<A;D++){K=H[D];if(!K){K=J.createSprite();K.setAttributes({zIndex:-D});K.setField(F[D]);G=true;E.push(false);if(B){K.itemsMarker.getTemplate().setAttributes(J.getStyleByIndex(D))}else{K.setAttributes(J.getStyleByIndex(D))}}if(C){if(B){K.itemsMarker.getTemplate().setAnimation(C)}K.setAnimation(C)}}if(G){J.updateHidden(E)}return H},getItemForPoint:function(J,I){if(this.getSprites()){var H=this,B,G,L,A=H.getItemInstancing(),F=H.getSprites(),K=H.getStore(),C=H.getHidden(),M,D,E;for(B=0,G=F.length;B<G;B++){if(!C[B]){L=F[B];D=L.getIndexNearPoint(J,I);if(D!==-1){E=H.getYField();M={series:H,index:D,category:A?"items":"markers",record:K.getData().items[D],field:typeof E==="string"?E:E[B],sprite:L};return M}}}return null}},provideLegendInfo:function(E){var G=this,F=G.getSprites(),H=G.getTitle(),I=G.getYField(),D=G.getHidden(),J=F.length===1,B,K,C,A;for(C=0;C<F.length;C++){B=G.getStyleByIndex(C);K=B.fillStyle;if(H){if(Ext.isArray(H)){A=H[C]}else{if(J){A=H}}}else{if(Ext.isArray(I)){A=I[C]}else{A=G.getId()}}E.push({name:A,mark:(Ext.isObject(K)?K.stops&&K.stops[0].color:K)||B.strokeStyle||"black",disabled:D[C],series:G.getId(),index:C})}},onSpriteAnimationStart:function(A){this.spriteAnimationCount++;if(this.spriteAnimationCount===1){this.fireEvent("animationstart")}},onSpriteAnimationEnd:function(A){this.spriteAnimationCount--;if(this.spriteAnimationCount===0){this.fireEvent("animationend")}}})