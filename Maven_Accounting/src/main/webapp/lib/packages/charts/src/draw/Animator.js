Ext.define("Ext.draw.Animator",{uses:["Ext.draw.Draw"],singleton:true,frameCallbacks:{},frameCallbackId:0,scheduled:0,frameStartTimeOffset:Ext.now(),animations:[],running:false,animationTime:function(){return Ext.AnimationQueue.frameStartTime-this.frameStartTimeOffset},add:function(B){var A=this;if(!A.contains(B)){A.animations.push(B);A.ignite();if("fireEvent" in B){B.fireEvent("animationstart",B)}}},remove:function(D){var C=this,E=C.animations,B=0,A=E.length;for(;B<A;++B){if(E[B]===D){E.splice(B,1);if("fireEvent" in D){D.fireEvent("animationend",D)}return }}},contains:function(A){return Ext.Array.indexOf(this.animations,A)>-1},empty:function(){return this.animations.length===0},step:function(D){var C=this,F=C.animations,E,A=0,B=F.length;for(;A<B;A++){E=F[A];E.step(D);if(!E.animating){F.splice(A,1);A--;B--;if(E.fireEvent){E.fireEvent("animationend",E)}}}},schedule:function(C,A){A=A||this;var B="frameCallback"+(this.frameCallbackId++);if(Ext.isString(C)){C=A[C]}Ext.draw.Animator.frameCallbacks[B]={fn:C,scope:A,once:true};this.scheduled++;Ext.draw.Animator.ignite();return B},scheduleIf:function(E,B){B=B||this;var C=Ext.draw.Animator.frameCallbacks,A,D;if(Ext.isString(E)){E=B[E]}for(D in C){A=C[D];if(A.once&&A.fn===E&&A.scope===B){return null}}return this.schedule(E,B)},cancel:function(A){if(Ext.draw.Animator.frameCallbacks[A]&&Ext.draw.Animator.frameCallbacks[A].once){this.scheduled--;delete Ext.draw.Animator.frameCallbacks[A]}},addFrameCallback:function(C,A){A=A||this;if(Ext.isString(C)){C=A[C]}var B="frameCallback"+(this.frameCallbackId++);Ext.draw.Animator.frameCallbacks[B]={fn:C,scope:A};return B},removeFrameCallback:function(A){delete Ext.draw.Animator.frameCallbacks[A]},fireFrameCallbacks:function(){var C=this.frameCallbacks,D,B,A;for(D in C){A=C[D];B=A.fn;if(Ext.isString(B)){B=A.scope[B]}B.call(A.scope);if(C[D]&&A.once){this.scheduled--;delete C[D]}}},handleFrame:function(){this.step(this.animationTime());this.fireFrameCallbacks();if(!this.scheduled&&this.empty()){Ext.AnimationQueue.stop(this.handleFrame,this);this.running=false;Ext.draw.Draw.endUpdateIOS()}},ignite:function(){if(!this.running){this.running=true;Ext.AnimationQueue.start(this.handleFrame,this);Ext.draw.Draw.beginUpdateIOS()}}})