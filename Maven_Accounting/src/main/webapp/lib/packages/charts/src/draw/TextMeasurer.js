Ext.define("Ext.draw.TextMeasurer",{singleton:true,requires:["Ext.util.TextMetrics"],measureDiv:null,measureCache:{},precise:Ext.isIE8,measureDivTpl:{tag:"div",style:{overflow:"hidden",position:"relative","float":"left",width:0,height:0},"data-sticky":true,children:{tag:"div",style:{display:"block",position:"absolute",x:-100000,y:-100000,padding:0,margin:0,"z-index":-100000,"white-space":"nowrap"}}},actualMeasureText:function(G,B){var E=Ext.draw.TextMeasurer,F=E.measureDiv,A=100000,C;if(!F){var D=Ext.Element.create({"data-sticky":true,style:{"overflow":"hidden","position":"relative","float":"left","width":0,"height":0}});E.measureDiv=F=Ext.Element.create({style:{"position":"absolute","x":A,"y":A,"z-index":-A,"white-space":"nowrap","display":"block","padding":0,"margin":0}});Ext.getBody().appendChild(D);D.appendChild(F)}if(B){F.setStyle({font:B,lineHeight:"normal"})}F.setText("("+G+")");C=F.getSize();F.setText("()");C.width-=F.getSize().width;return C},measureTextSingleLine:function(H,D){if(this.precise){return this.preciseMeasureTextSingleLine(H,D)}H=H.toString();var A=this.measureCache,G=H.split(""),C=0,I=0,K,B,E,F,J;if(!A[D]){A[D]={}}A=A[D];if(A[H]){return A[H]}for(E=0,F=G.length;E<F;E++){B=G[E];if(!(K=A[B])){J=this.actualMeasureText(B,D);K=A[B]=J}C+=K.width;I=Math.max(I,K.height)}return A[H]={width:C,height:I}},preciseMeasureTextSingleLine:function(C,A){C=C.toString();var B=this.measureDiv||(this.measureDiv=Ext.getBody().createChild(this.measureDivTpl).down("div"));B.setStyle({font:A||""});return Ext.util.TextMetrics.measure(B,C)},measureText:function(E,B){var H=E.split("\n"),D=H.length,F=0,A=0,I,C,G;if(D===1){return this.measureTextSingleLine(E,B)}G=[];for(C=0;C<D;C++){I=this.measureTextSingleLine(H[C],B);G.push(I);F+=I.height;A=Math.max(A,I.width)}return{width:A,height:F,sizes:G}}})