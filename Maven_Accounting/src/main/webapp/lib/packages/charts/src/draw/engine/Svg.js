Ext.define("Ext.draw.engine.Svg",{extend:"Ext.draw.Surface",requires:["Ext.draw.engine.SvgContext"],statics:{BBoxTextCache:{}},config:{highPrecision:false},getElementConfig:function(){return{reference:"element",style:{position:"absolute"},children:[{reference:"innerElement",style:{width:"100%",height:"100%",position:"relative"},children:[{tag:"svg",reference:"svgElement",namespace:"http://www.w3.org/2000/svg",width:"100%",height:"100%",version:1.1}]}]}},constructor:function(A){var B=this;B.callParent([A]);B.mainGroup=B.createSvgNode("g");B.defElement=B.createSvgNode("defs");B.svgElement.appendChild(B.mainGroup);B.svgElement.appendChild(B.defElement);B.ctx=new Ext.draw.engine.SvgContext(B)},createSvgNode:function(A){var B=document.createElementNS("http://www.w3.org/2000/svg",A);return Ext.get(B)},getSvgElement:function(D,B,A){var C;if(D.dom.childNodes.length>A){C=D.dom.childNodes[A];if(C.tagName===B){return Ext.get(C)}else{Ext.destroy(C)}}C=Ext.get(this.createSvgNode(B));if(A===0){D.insertFirst(C)}else{C.insertAfter(Ext.fly(D.dom.childNodes[A-1]))}C.cache={};return C},setElementAttributes:function(D,B){var F=D.dom,A=D.cache,C,E;for(C in B){E=B[C];if(A[C]!==E){A[C]=E;F.setAttribute(C,E)}}},getNextDef:function(A){return this.getSvgElement(this.defElement,A,this.defPosition++)},clearTransform:function(){var A=this;A.mainGroup.set({transform:A.matrix.toSvg()})},clear:function(){this.ctx.clear();this.defPosition=0},renderSprite:function(B){var D=this,C=D.getRect(),A=D.ctx;if(B.attr.hidden||B.attr.globalAlpha===0){A.save();A.restore();return }B.element=A.save();B.preRender(this);B.useAttributes(A,C);if(false===B.render(this,A,[0,0,C[2],C[3]])){return false}B.setDirty(false);A.restore()},flatten:function(E,B){var C='<?xml version="1.0" standalone="yes"?>',F=Ext.getClassName(this),A,G,D;C+='<svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" width="'+E.width+'" height="'+E.height+'">';for(D=0;D<B.length;D++){A=B[D];if(Ext.getClassName(A)!==F){continue}G=A.getRect();C+='<g transform="translate('+G[0]+","+G[1]+')">';C+=this.serializeNode(A.svgElement.dom);C+="</g>"}C+="</svg>";return{data:"data:image/svg+xml;utf8,"+encodeURIComponent(C),type:"svg"}},serializeNode:function(D){var B="",C,F,A,E;if(D.nodeType===document.TEXT_NODE){return D.nodeValue}B+="<"+D.nodeName;if(D.attributes.length){for(C=0,F=D.attributes.length;C<F;C++){A=D.attributes[C];B+=" "+A.name+'="'+A.value+'"'}}B+=">";if(D.childNodes&&D.childNodes.length){for(C=0,F=D.childNodes.length;C<F;C++){E=D.childNodes[C];B+=this.serializeNode(E)}}B+="</"+D.nodeName+">";return B},destroy:function(){var A=this;A.ctx.destroy();A.mainGroup.destroy();delete A.mainGroup;delete A.ctx;A.callParent()},remove:function(A,B){if(A&&A.element){if(this.ctx){this.ctx.removeElement(A.element)}else{A.element.destroy()}A.element=null}this.callParent(arguments)}})