Ext.define("Ext.draw.modifier.Animation",{requires:["Ext.draw.TimingFunctions","Ext.draw.Animator"],extend:"Ext.draw.modifier.Modifier",alias:"modifier.animation",config:{easing:Ext.identityFn,duration:0,customEasings:{},customDurations:{},customDuration:null},constructor:function(A){var B=this;B.anyAnimation=B.anySpecialAnimations=false;B.animating=0;B.animatingPool=[];B.callParent([A])},prepareAttributes:function(A){if(!A.hasOwnProperty("timers")){A.animating=false;A.timers={};A.animationOriginal=Ext.Object.chain(A);A.animationOriginal.prototype=A}if(this._previous){this._previous.prepareAttributes(A.animationOriginal)}},updateSprite:function(A){this.setConfig(A.config.fx)},updateDuration:function(A){this.anyAnimation=A>0},applyEasing:function(A){if(typeof A==="string"){A=Ext.draw.TimingFunctions.easingMap[A]}return A},applyCustomEasings:function(A,E){E=E||{};var G,D,B,H,C,F;for(D in A){G=true;H=A[D];B=D.split(",");if(typeof H==="string"){H=Ext.draw.TimingFunctions.easingMap[H]}for(C=0,F=B.length;C<F;C++){E[B[C]]=H}}if(G){this.anySpecialAnimations=G}return E},setEasingOn:function(A,E){A=Ext.Array.from(A).slice();var C={},D=A.length,B=0;for(;B<D;B++){C[A[B]]=E}this.setCustomEasings(C)},clearEasingOn:function(A){A=Ext.Array.from(A,true);var B=0,C=A.length;for(;B<C;B++){delete this._customEasings[A[B]]}},applyCustomDurations:function(G,H){H=H||{};var E,C,F,A,B,D;for(C in G){E=true;F=G[C];A=C.split(",");for(B=0,D=A.length;B<D;B++){H[A[B]]=F}}if(E){this.anySpecialAnimations=E}return H},applyCustomDuration:function(A,B){if(A){this.getCustomDurations();this.setCustomDurations(A);Ext.log.warn("'customDuration' config is deprecated. Use 'customDurations' config instead.")}},setDurationOn:function(B,E){B=Ext.Array.from(B).slice();var A={},C=0,D=B.length;for(;C<D;C++){A[B[C]]=E}this.setCustomDurations(A)},clearDurationOn:function(A){A=Ext.Array.from(A,true);var B=0,C=A.length;for(;B<C;B++){delete this._customDurations[A[B]]}},setAnimating:function(A,B){var E=this,D=E.animatingPool;if(A.animating!==B){A.animating=B;if(B){D.push(A);if(E.animating===0){Ext.draw.Animator.add(E)}E.animating++}else{for(var C=D.length;C--;){if(D[C]===A){D.splice(C,1)}}E.animating=D.length}}},setAttrs:function(R,T){var S=this,M=R.timers,H=S._sprite.self.def._animationProcessors,F=S._easing,E=S._duration,J=S._customDurations,I=S._customEasings,G=S.anySpecialAnimations,N=S.anyAnimation||G,O=R.animationOriginal,D=false,K,U,L,P,C,Q,A;if(!N){for(U in T){if(R[U]===T[U]){delete T[U]}else{R[U]=T[U]}delete O[U];delete M[U]}return T}else{for(U in T){L=T[U];P=R[U];if(L!==P&&P!==undefined&&P!==null&&(C=H[U])){Q=F;A=E;if(G){if(U in I){Q=I[U]}if(U in J){A=J[U]}}if(P&&P.isGradient||L&&L.isGradient){A=0}if(A){if(!M[U]){M[U]={}}K=M[U];K.start=0;K.easing=Q;K.duration=A;K.compute=C.compute;K.serve=C.serve||Ext.identityFn;K.remove=T.removeFromInstance&&T.removeFromInstance[U];if(C.parseInitial){var B=C.parseInitial(P,L);K.source=B[0];K.target=B[1]}else{if(C.parse){K.source=C.parse(P);K.target=C.parse(L)}else{K.source=P;K.target=L}}O[U]=L;delete T[U];D=true;continue}else{delete O[U]}}else{delete O[U]}delete M[U]}}if(D&&!R.animating){S.setAnimating(R,true)}return T},updateAttributes:function(G){if(!G.animating){return{}}var H={},E=false,D=G.timers,F=G.animationOriginal,C=Ext.draw.Animator.animationTime(),A,B,I;if(G.lastUpdate===C){return null}for(A in D){B=D[A];if(!B.start){B.start=C;I=0}else{I=(C-B.start)/B.duration}if(I>=1){H[A]=F[A];delete F[A];if(D[A].remove){H.removeFromInstance=H.removeFromInstance||{};H.removeFromInstance[A]=true}delete D[A]}else{H[A]=B.serve(B.compute(B.source,B.target,B.easing(I),G[A]));E=true}}G.lastUpdate=C;this.setAnimating(G,E);return H},pushDown:function(A,B){B=this.callParent([A.animationOriginal,B]);return this.setAttrs(A,B)},popUp:function(A,B){A=A.prototype;B=this.setAttrs(A,B);if(this._next){return this._next.popUp(A,B)}else{return Ext.apply(A,B)}},step:function(G){var F=this,C=F.animatingPool.slice(),E=C.length,B=0,A,D;for(;B<E;B++){A=C[B];D=F.updateAttributes(A);if(D&&F._next){F._next.popUp(A,D)}}},stop:function(){this.step();var D=this,B=D.animatingPool,A,C;for(A=0,C=B.length;A<C;A++){B[A].animating=false}D.animatingPool.length=0;D.animating=0;Ext.draw.Animator.remove(D)},destroy:function(){this.animatingPool.length=0;this.animating=0;this.callParent()}})