Ext.define("Ext.AnimationQueue",{singleton:true,constructor:function(){var A=this;A.queue=[];A.taskQueue=[];A.runningQueue=[];A.idleQueue=[];A.isRunning=false;A.isIdle=true;A.run=Ext.Function.bind(A.run,A);if(Ext.os.is.iOS){Ext.interval(A.watch,500,A)}},start:function(C,B,A){var D=this;D.queue.push(arguments);if(!D.isRunning){if(D.hasOwnProperty("idleTimer")){clearTimeout(D.idleTimer);delete D.idleTimer}if(D.hasOwnProperty("idleQueueTimer")){clearTimeout(D.idleQueueTimer);delete D.idleQueueTimer}D.isIdle=false;D.isRunning=true;D.startCountTime=Ext.now();D.count=0;D.doStart()}},watch:function(){if(this.isRunning&&Ext.now()-this.lastRunTime>=500){this.run()}},run:function(){var G=this;if(!G.isRunning){return }var A=G.runningQueue,B=Ext.now(),D,F;G.lastRunTime=B;G.frameStartTime=B;A.push.apply(A,G.queue);for(D=0,F=A.length;D<F;D++){G.invoke(A[D])}A.length=0;var C=G.frameStartTime-G.startCountTime,E=++G.count;if(C>=200){G.onFpsChanged(E*1000/C,E,C);G.startCountTime=G.frameStartTime;G.count=0}G.doIterate()},onFpsChanged:Ext.emptyFn,onStop:Ext.emptyFn,doStart:function(){this.animationFrameId=Ext.Function.requestAnimationFrame(this.run);this.lastRunTime=Ext.now()},doIterate:function(){this.animationFrameId=Ext.Function.requestAnimationFrame(this.run)},doStop:function(){Ext.Function.cancelAnimationFrame(this.animationFrameId)},stop:function(E,D,B){var H=this;if(!H.isRunning){return }var A=H.queue,G=A.length,C,F;for(C=0;C<G;C++){F=A[C];if(F[0]===E&&F[1]===D&&F[2]===B){A.splice(C,1);C--;G--}}if(G===0){H.doStop();H.onStop();H.isRunning=false;H.idleTimer=Ext.defer(H.whenIdle,100,H)}},onIdle:function(E,D,A){var C=this.idleQueue,B,F,G;for(B=0,F=C.length;B<F;B++){G=C[B];if(E===G[0]&&D===G[1]&&A===G[2]){return }}C.push(arguments);if(this.isIdle){this.processIdleQueue()}},unIdle:function(E,D,A){var C=this.idleQueue,B,F,G;for(B=0,F=C.length;B<F;B++){G=C[B];if(E===G[0]&&D===G[1]&&A===G[2]){C.splice(B,1);return true}}return false},queueTask:function(C,B,A){this.taskQueue.push(arguments);this.processTaskQueue()},dequeueTask:function(E,D,A){var C=this.taskQueue,B,F,G;for(B=0,F=C.length;B<F;B++){G=C[B];if(E===G[0]&&D===G[1]&&A===G[2]){C.splice(B,1);B--;F--}}},invoke:function(D){var C=D[0],B=D[1],A=D[2];C=(typeof C=="string"?B[C]:C);if(Ext.isArray(A)){C.apply(B,A)}else{C.call(B,A)}},whenIdle:function(){this.isIdle=true;this.processIdleQueue()},processIdleQueue:function(){if(!this.hasOwnProperty("idleQueueTimer")){this.idleQueueTimer=Ext.defer(this.processIdleQueueItem,1,this)}},processIdleQueueItem:function(){delete this.idleQueueTimer;if(!this.isIdle){return }var A=this.idleQueue,B;if(A.length>0){B=A.shift();this.invoke(B);this.processIdleQueue()}},processTaskQueue:function(){if(!this.hasOwnProperty("taskQueueTimer")){this.taskQueueTimer=Ext.defer(this.processTaskQueueItem,15,this)}},processTaskQueueItem:function(){delete this.taskQueueTimer;var A=this.taskQueue,B;if(A.length>0){B=A.shift();this.invoke(B);this.processTaskQueue()}},showFps:function(){var A={color:"white","background-color":"black","text-align":"center","font-family":"sans-serif","font-size":"8px","font-weight":"normal","font-style":"normal","line-height":"20px","-webkit-font-smoothing":"antialiased","zIndex":100000,position:"absolute"};Ext.getBody().append([{style:Ext.applyIf({bottom:"50px",left:0,width:"50px",height:"20px"},A),html:"Average"},{style:Ext.applyIf({"background-color":"red","font-size":"18px","line-height":"50px",bottom:0,left:0,width:"50px",height:"50px"},A),id:"__averageFps",html:"0"},{style:Ext.applyIf({bottom:"50px",left:"50px",width:"50px",height:"20px"},A),html:"Min (Last 1k)"},{style:Ext.applyIf({"background-color":"orange","font-size":"18px","line-height":"50px",bottom:0,left:"50px",width:"50px",height:"50px"},A),id:"__minFps",html:"0"},{style:Ext.applyIf({bottom:"50px",left:"100px",width:"50px",height:"20px"},A),html:"Max (Last 1k)"},{style:Ext.applyIf({"background-color":"maroon","font-size":"18px","line-height":"50px",bottom:0,left:"100px",width:"50px",height:"50px"},A),id:"__maxFps",html:"0"},{style:Ext.applyIf({bottom:"50px",left:"150px",width:"50px",height:"20px"},A),html:"Current"},{style:Ext.applyIf({"background-color":"green","font-size":"18px","line-height":"50px",bottom:0,left:"150px",width:"50px",height:"50px"},A),id:"__currentFps",html:"0"}]);Ext.AnimationQueue.resetFps()},resetFps:function(){var C=Ext.get("__currentFps"),B=Ext.get("__averageFps"),H=Ext.get("__minFps"),G=Ext.get("__maxFps"),D=1000,A=0,F=0,E=0;if(!C){return }Ext.AnimationQueue.onFpsChanged=function(I){F++;if(!(F%10)){D=1000;A=0}E+=I;D=Math.min(D,I);A=Math.max(A,I);C.setHtml(Math.round(I));B.setHtml(Math.round(E/F));H.setHtml(Math.round(D));G.setHtml(Math.round(A))}}},function(){var A=window.location.search.substr(1),B=A.split("&");if(Ext.Array.contains(B,"showfps")){Ext.onReady(Ext.Function.bind(this.showFps,this))}})