Ext.define("Ext.app.ViewModel",{mixins:["Ext.mixin.Factoryable","Ext.mixin.Identifiable"],requires:["Ext.util.Scheduler","Ext.data.Session","Ext.app.bind.RootStub","Ext.app.bind.LinkStub","Ext.app.bind.Multi","Ext.app.bind.Formula","Ext.app.bind.TemplateBinding","Ext.data.ChainedStore"],alias:"viewmodel.default",isViewModel:true,factoryConfig:{name:"viewModel"},collectTimeout:100,expressionRe:/^(?:\{[!]?(?:(\d+)|([a-z_][\w\-\.]*))\})$/i,$configStrict:false,config:{data:true,formulas:{$value:null,merge:function(D,A,C,B){return this.mergeNew(D,A,C,B)}},links:null,parent:null,root:true,scheduler:null,schema:"default",session:null,stores:null,view:null},constructor:function(A){this.hadValue={};this.bindings={};this.initConfig(A)},destroy:function(){var F=this,D=F._scheduler,J=F.storeInfo,H=F.getParent(),C=F.collectTask,B=F.children,A=F.bindings,I,G,E;F.destroying=true;if(C){C.cancel();F.collectTask=null}if(B){for(I in B){B[I].destroy()}}if(J){for(I in J){G=J[I];E=G.autoDestroy;if(E||(!G.$wasInstance&&E!==false)){G.destroy()}Ext.destroy(G.$binding)}}if(H){H.unregisterChild(F)}F.getRoot().destroy();for(I in A){A[I].destroy()}if(D&&D.$owner===F){D.$owner=null;D.destroy()}F.hadValue=F.children=F.storeInfo=F._session=F._view=F._scheduler=F.bindings=F._root=F._parent=F.formulaFn=F.$formulaData=null;F.destroying=false;F.callParent()},bind:function(E,G,C,B){var D=this,F,A;C=C||D;if(!B&&E.bindTo!==undefined&&!Ext.isString(E)){B=E;E=B.bindTo}if(!Ext.isString(E)){F=new Ext.app.bind.Multi(E,D,G,C,B);A=true}else{if(D.expressionRe.test(E)){E=E.substring(1,E.length-1);F=D.bindExpression(E,G,C,B)}else{F=new Ext.app.bind.TemplateBinding(E,D,G,C,B);A=true}}if(A){D.bindings[F.id]=F}return F},getSession:function(){var B=this,C=B._session,A;if(!C&&(A=B.getParent())){B.setSession(C=A.getSession())}return C||null},getStore:function(B){var C=this.storeInfo,A;if(C){A=C[B]}return A||null},linkTo:function(I,D){var H=this,C,F,A,B,G,E;if(I.indexOf(".")>-1){Ext.raise('Links can only be at the top-level: "'+I+'"')}if(D.isModel){D={type:D.entityName,id:D.id}}B=D.type||D.reference;F=D.create;if(B){A=D.id;if(!D.create&&Ext.isEmpty(A)){Ext.raise('No id specified. To create a phantom model, specify "create: true" as part of the reference.')}if(F){A=undefined}E=H.getRecord(B,A);if(Ext.isObject(F)){E.set(F);E.commit();E.phantom=true}C=H.getRoot().createStubChild(I);C.set(E)}else{C=H.getStub(I);if(!C.isLinkStub){G=new Ext.app.bind.LinkStub(H,C.name);C.graft(G);C=G}C.link(D)}},notify:function(){this.getScheduler().notify()},get:function(A){return this.getStub(A).getValue()},set:function(E,B){var A=this,D,C;A.getData();if(B===undefined&&E&&E.constructor===Object){C=A.getRoot();B=E}else{if(E&&E.indexOf(".")<0){D={};D[E]=B;B=D;C=A.getRoot()}else{C=A.getStub(E)}}C.set(B)},privates:{registerChild:function(B){var A=this.children;if(!A){this.children=A={}}A[B.getId()]=B},unregisterChild:function(B){var A=this.children;if(!this.destroying&&A){delete A[B.getId()]}},getRecord:function(B,F){var D=this.getSession(),E=B,C=F!==undefined,A;if(D){if(C){A=D.getRecord(B,F)}else{A=D.createRecord(B)}}else{if(!E.$isClass){E=this.getSchema().getEntity(E);if(!E){Ext.raise("Invalid model name: "+B)}}if(C){A=E.createWithId(F);A.load()}else{A=new E()}}return A},notFn:function(A){return !A},bindExpression:function(B,F,G,I){var A=B.charAt(0),D=(A==="!"),H=D?B.substring(1):B,C=this.getStub(H),E;E=C.bind(F,G,I);if(D){E.transform=this.notFn}return E},applyScheduler:function(A){if(A&&!A.isInstance){A=new Ext.util.Scheduler(A);A.$owner=this}return A},getScheduler:function(){var C=this,A=C._scheduler,B;if(!A){if(!(B=C.getParent())){A=new Ext.util.Scheduler({preSort:"kind,-depth"});A.$owner=C}else{A=B.getScheduler()}C.setScheduler(A)}return A},getStub:function(B){var A=this.getRoot();return B?A.getChild(B):A},collect:function(){var C=this,B=C.getParent(),A=C.collectTask;if(B){B.collect();return }if(!A){A=C.collectTask=new Ext.util.DelayedTask(C.doCollect,C)}if(C.collectTimeout===0){C.doCollect()}else{A.delay(C.collectTimeout)}},doCollect:function(){var B=this.children,A;if(B){for(A in B){B[A].doCollect()}}this.getRoot().collect()},onBindDestroy:function(D,A){var C=this,B;if(C.destroying){return }if(!A){delete C.bindings[D.id]}B=C.getParent();if(B){B.onBindDestroy(D,true)}else{C.collect()}},applyData:function(C,E){var D=this,A,B;D.getSession();if(!E){B=D.getParent();D.linkData=A=B?Ext.Object.chain(B.getData()):{};D.data=D._data=Ext.Object.chain(A)}if(C&&C.constructor===Object){D.getRoot().set(C)}},applyParent:function(A){if(A){A.registerChild(this)}return A},applyStores:function(I){var D=this,F=D.getRoot(),H,C,A,B,E,G;D.storeInfo={};D.listenerScopeFn=function(){return D.getView().getInheritedConfig("defaultListenerScope")};for(H in I){C=I[H];if(C.isStore){C.$wasInstance=true;D.setupStore(C,H);continue}else{if(Ext.isString(C)){C={source:C}}else{C=Ext.apply({},C)}}E=C.listeners;delete C.listeners;A=D.bind(C,D.onStoreBind,D,{trackStatics:true});if(A.isStatic()){A.destroy();D.createStore(H,C,E)}else{A.$storeKey=H;A.$listeners=E;B=F.createStubChild(H);B.setStore(A)}}},onStoreBind:function(A,C,G){var F=this.storeInfo,E=G.$storeKey,B=F[E],D;if(!B){this.createStore(E,A,G.$listeners,G)}else{A=Ext.merge({},G.pruneStaticKeys());D=A.proxy;delete A.type;delete A.model;delete A.fields;delete A.proxy;delete A.listeners;if(D){delete D.reader;delete D.writer;B.getProxy().setConfig(D)}B.setConfig(A)}},createStore:function(C,A,D,F){var E=this.getSession(),B;A=Ext.apply({},A);if(A.session){A.session=E}if(A.source){A.type=A.type||"chained"}A.listeners=D;B=Ext.Factory.store(A);B.$binding=F;this.setupStore(B,C)},setupStore:function(A,B){A.resolveListenerScope=this.listenerScopeFn;this.storeInfo[B]=A;this.set(B,A)},applyFormulas:function(C){var D=this,A=D.getRoot(),B,E;D.getData();for(B in C){if(B.indexOf(".")>=0){Ext.raise("Formula names cannot contain dots: "+B)}A.createStubChild(B);E=D.getStub(B);E.setFormula(C[B])}return C},applyLinks:function(A){for(var B in A){this.linkTo(B,A[B])}},applySchema:function(A){return Ext.data.schema.Schema.get(A)},applyRoot:function(){var A=new Ext.app.bind.RootStub(this),B=this.getParent();if(B){A.depth=B.getRoot().depth-1000}return A},getFormulaFn:function(C){var B=this,A=B.formulaFn;if(!A){A=B.formulaFn=function(D){return B.$formulaData[D]}}B.$formulaData=C;return A}}})