Ext.define("Ext.data.JsonP",{singleton:true,requestCount:0,requests:{},timeout:30000,disableCaching:true,disableCachingParam:"_dc",callbackKey:"callback",request:function(M){M=Ext.apply({},M);if(!M.url){Ext.raise("A url must be specified for a JSONP request.")}var I=this,D=Ext.isDefined(M.disableCaching)?M.disableCaching:I.disableCaching,G=M.disableCachingParam||I.disableCachingParam,C=++I.requestCount,K=M.callbackName||"callback"+C,H=M.callbackKey||I.callbackKey,L=Ext.isDefined(M.timeout)?M.timeout:I.timeout,E=Ext.apply({},M.params),B=M.url,A=Ext.name,F,J;if(D&&!E[G]){E[G]=Ext.Date.now()}M.params=E;E[H]=A+".data.JsonP."+K;J=I.createScript(B,E,M);I.requests[C]=F={url:B,params:E,script:J,id:C,scope:M.scope,success:M.success,failure:M.failure,callback:M.callback,callbackKey:H,callbackName:K};if(L>0){F.timeout=Ext.defer(I.handleTimeout,L,I,[F])}I.setupErrorHandling(F);I[K]=Ext.bind(I.handleResponse,I,[F],true);I.loadScript(F);return F},abort:function(C){var B=this,D=B.requests,A;if(C){if(!C.id){C=D[C]}B.handleAbort(C)}else{for(A in D){if(D.hasOwnProperty(A)){B.abort(D[A])}}}},setupErrorHandling:function(A){A.script.onerror=Ext.bind(this.handleError,this,[A])},handleAbort:function(A){A.errorType="abort";this.handleResponse(null,A)},handleError:function(A){A.errorType="error";this.handleResponse(null,A)},cleanupErrorHandling:function(A){A.script.onerror=null},handleTimeout:function(A){A.errorType="timeout";this.handleResponse(null,A)},handleResponse:function(B,C){var D=true,A=Ext.GlobalEvents;if(C.timeout){clearTimeout(C.timeout)}delete this[C.callbackName];delete this.requests[C.id];this.cleanupErrorHandling(C);Ext.fly(C.script).destroy();if(C.errorType){D=false;Ext.callback(C.failure,C.scope,[C.errorType])}else{Ext.callback(C.success,C.scope,[B])}Ext.callback(C.callback,C.scope,[D,B,C.errorType]);if(A.hasListeners.idle){A.fireEvent("idle")}},createScript:function(C,D,B){var A=document.createElement("script");A.setAttribute("src",Ext.urlAppend(C,Ext.Object.toQueryString(D)));A.setAttribute("async",true);A.setAttribute("type","text/javascript");return A},loadScript:function(A){Ext.getHead().appendChild(A.script)}})