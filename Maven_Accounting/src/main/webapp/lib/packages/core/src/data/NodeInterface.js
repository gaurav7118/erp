Ext.define("Ext.data.NodeInterface",{requires:["Ext.data.field.Boolean","Ext.data.field.Integer","Ext.data.field.String","Ext.data.writer.Json","Ext.mixin.Observable"],statics:{decorate:function(B){var D=Ext.data.schema.Schema.lookupEntity(B),F=D.prototype,A,C,E;if(!D.prototype.isObservable){D.mixin(Ext.mixin.Observable.prototype.mixinId,Ext.mixin.Observable)}if(F.isNode){return }A=F.idProperty;C=D.getField(A);E=C.type;D.override(this.getPrototypeBody());D.addFields([{name:"parentId",type:E,defaultValue:null,allowNull:C.allowNull},{name:"index",type:"int",defaultValue:-1,persist:false,convert:null},{name:"depth",type:"int",defaultValue:0,persist:false,convert:null},{name:"expanded",type:"bool",defaultValue:false,persist:false,convert:null},{name:"expandable",type:"bool",defaultValue:true,persist:false,convert:null},{name:"checked",type:"auto",defaultValue:null,persist:false,convert:null},{name:"leaf",type:"bool",defaultValue:false},{name:"cls",type:"string",defaultValue:"",persist:false,convert:null},{name:"iconCls",type:"string",defaultValue:"",persist:false,convert:null},{name:"icon",type:"string",defaultValue:"",persist:false,convert:null},{name:"root",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"isLast",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"isFirst",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"allowDrop",type:"boolean",defaultValue:true,persist:false,convert:null},{name:"allowDrag",type:"boolean",defaultValue:true,persist:false,convert:null},{name:"loaded",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"loading",type:"boolean",defaultValue:false,persist:false,convert:null},{name:"href",type:"string",defaultValue:"",persist:false,convert:null},{name:"hrefTarget",type:"string",defaultValue:"",persist:false,convert:null},{name:"qtip",type:"string",defaultValue:"",persist:false,convert:null},{name:"qtitle",type:"string",defaultValue:"",persist:false,convert:null},{name:"qshowDelay",type:"int",defaultValue:0,persist:false,convert:null},{name:"children",type:"auto",defaultValue:null,persist:false,convert:null},{name:"visible",type:"boolean",defaultValue:true,persist:false},{name:"text",type:"string",persist:false}])},getPrototypeBody:function(){var A={idchanged:true,append:true,remove:true,move:true,insert:true,beforeappend:true,beforeremove:true,beforemove:true,beforeinsert:true,expand:true,collapse:true,beforeexpand:true,beforecollapse:true,sort:true},B={silent:true};return{isNode:true,firstChild:null,lastChild:null,parentNode:null,previousSibling:null,nextSibling:null,constructor:function(){var C=this;C.mixins.observable.constructor.call(C);C.callParent(arguments);C.childNodes=[];return C},createNode:function(C){var I=this,G=I.childType,L,J,E,K,H,F,D=I.self;if(!C.isModel){if(G){D=I.schema.getEntity(G)}else{L=I.getTreeStore();J=L&&L.getProxy().getReader();E=I.getProxy();K=E?E.getReader():null;H=!J||(K&&K.initialConfig.typeProperty)?K:J;if(H){F=H.getTypeProperty();if(F){D=H.getChildType(I.schema,C,F)}}}C=new D(C)}if(!C.childNodes){C.firstChild=C.lastChild=C.parentNode=C.previousSibling=C.nextSibling=null;C.childNodes=[]}return C},isLeaf:function(){return this.get("leaf")===true},setFirstChild:function(C){this.firstChild=C},setLastChild:function(C){this.lastChild=C},updateInfo:function(H,S){var U=this,D=U.data,T=D.depth,F={},E=U.childNodes,R=E.length,I=U.phantom,P=U.fields,G=U.modified||(U.modified={}),N,M,C,J,V,K=S.parentId,L,O,Q;if(!S){Ext.raise("NodeInterface expects update info to be passed")}for(N in S){C=P[U.fieldOrdinals[N]];M=S[N];O=C&&C.persist;J=D[N];L=O&&(N==="index")&&(J!==-1)&&(K&&K!==G.parentId);if(!L&&U.isEqual(J,M)){continue}D[N]=M;if(O){if(!L&&G.hasOwnProperty(N)){if(U.isEqual(G[N],M)){delete G[N];U.dirty=false;for(V in G){if(G.hasOwnProperty(V)){U.dirty=true;break}}}}else{U.dirty=true;G[N]=J}}}if(H){U.commit();U.phantom=I}if(U.data.depth!==T){F={depth:U.data.depth+1};for(Q=0;Q<R;Q++){E[Q].updateInfo(H,F)}}},isLast:function(){return this.get("isLast")},isFirst:function(){return this.get("isFirst")},hasChildNodes:function(){return !this.isLeaf()&&this.childNodes.length>0},isExpandable:function(){var C=this;if(C.get("expandable")){return !(C.isLeaf()||(C.isLoaded()&&!C.phantom&&!C.hasChildNodes()))}return false},triggerUIUpdate:function(){this.callJoined("afterEdit",[])},appendChild:function(F,M,G){var K=this,H,J,I,L,C,O={isLast:true,parentId:K.getId(),depth:(K.data.depth||0)+1},N,E=K.getTreeStore(),D=E&&E.bulkUpdate;Ext.suspendLayouts();if(Ext.isArray(F)){J=F.length;N=new Array(J);K.callTreeStore("beginFill");for(H=0;H<J;H++){N[H]=K.appendChild(F[H],M,G)}K.callTreeStore("endFill",[N])}else{F=K.createNode(F);if(M!==true&&K.fireEventArgs("beforeappend",[K,F])===false){Ext.resumeLayouts(true);return false}I=K.childNodes.length;L=F.parentNode;if(L){if(M!==true&&F.fireEventArgs("beforemove",[F,L,K,I])===false){Ext.resumeLayouts(true);return false}if(L.removeChild(F,false,M,L.getTreeStore()===E)===false){Ext.resumeLayouts(true);return false}}E&&E.beginUpdate();I=K.childNodes.length;if(I===0){K.setFirstChild(F)}K.childNodes[I]=F;F.parentNode=K;F.nextSibling=null;K.setLastChild(F);C=K.childNodes[I-1];if(C){F.previousSibling=C;C.nextSibling=F;C.updateInfo(G,{isLast:false});if(!D){C.triggerUIUpdate()}}else{F.previousSibling=null}O.isFirst=I===0;O.index=I;F.updateInfo(G,O);if(K.isLeaf()){K.set("leaf",false)}if(!K.isLoaded()){if(D){K.data.loaded=true}else{K.set("loaded",true)}}else{if(K.childNodes.length===1&&!D){K.triggerUIUpdate()}}if(I&&K.childNodes[I-1].isExpanded()&&!D){K.childNodes[I-1].cascadeBy(K.triggerUIUpdate)}if(E){E.registerNode(K,!D);if(D){E.registerNode(F)}}if(M!==true){K.fireEventArgs("append",[K,F,I]);if(L){F.fireEventArgs("move",[F,L,K,I])}}K.callTreeStore("onNodeAppend",[F,I]);N=F;if(E){E.endUpdate()}}Ext.resumeLayouts(true);return N},getOwnerTree:function(){var C=this.getTreeStore();if(C){return C.ownerTree}},getTreeStore:function(){var C=this;while(C&&!C.treeStore){C=C.parentNode}return C&&C.treeStore},removeChild:function(G,E,N,M){var L=this,K=L.indexOf(G),I,H,C,F=L.getTreeStore(),D=F&&F.bulkUpdate,J;if(K===-1||(N!==true&&L.fireEventArgs("beforeremove",[L,G,!!M])===false)){return false}Ext.suspendLayouts();F&&F.beginUpdate();Ext.Array.erase(L.childNodes,K,1);if(L.firstChild===G){L.setFirstChild(G.nextSibling)}if(L.lastChild===G){L.setLastChild(G.previousSibling)}C=G.previousSibling;if(C){G.previousSibling.nextSibling=G.nextSibling}if(G.nextSibling){G.nextSibling.previousSibling=G.previousSibling;if(K===0){G.nextSibling.updateInfo(false,{isFirst:true})}for(I=K,H=L.childNodes.length;I<H;I++){L.childNodes[I].updateInfo(false,{index:I})}}else{if(C){C.updateInfo(false,{isLast:true});if(!D){if(C.isExpanded()){C.cascadeBy(L.triggerUIUpdate)}else{C.triggerUIUpdate()}}}}if(!L.childNodes.length&&!D){L.triggerUIUpdate()}Ext.resumeLayouts(true);if(N!==true){J={parentNode:G.parentNode,previousSibling:G.previousSibling,nextSibling:G.nextSibling};L.callTreeStore("beforeNodeRemove",[[G],!!M]);G.previousSibling=G.nextSibling=G.parentNode=null;L.fireEventArgs("remove",[L,G,!!M,J]);L.callTreeStore("onNodeRemove",[[G],!!M])}if(E){G.erase(true)}else{G.clear()}if(!M){G.set({parentId:null,lastParentId:L.getId()},B)}if(F){F.endUpdate()}return G},copy:function(F,E){var H=this,D=H.callParent([F]),C=H.childNodes?H.childNodes.length:0,G;if(E){for(G=0;G<C;G++){D.appendChild(H.childNodes[G].copy(undefined,true))}}return D},clear:function(C){var D=this;D.parentNode=D.previousSibling=D.nextSibling=null;if(C){D.firstChild=D.lastChild=D.childNodes=null}},drop:function(){var G=this,I=G.childNodes,D=G.parentNode,C=I?I.length:0,E,F,H;G.callParent();if(D){H=G.getTreeStore();D.removeChild(G)}else{if(G.get("root")){H=G.getTreeStore();H.setRoot(null)}}H&&H.beginUpdate();for(E=0;E<C;E++){F=I[E];F.clear();F.drop()}H&&H.endUpdate()},erase:function(D){var G=this,H=G.childNodes,C=H&&H.length,E,F;G.remove();G.clear(true);G.callParent([D]);for(E=0;E<C;E++){F=H[E];F.parentNode=null;F.erase(D)}},insertBefore:function(F,J,N){var K=this,I=K.indexOf(J),L=F.parentNode,M=I,G,C,H,E=K.getTreeStore(),D=E&&E.bulkUpdate;if(!J){return K.appendChild(F)}if(F===J){return false}F=K.createNode(F);if(N!==true&&K.fireEventArgs("beforeinsert",[K,F,J])===false){return false}if(L===K&&K.indexOf(F)<I){M--}if(L){if(N!==true&&F.fireEventArgs("beforemove",[F,L,K,I,J])===false){return false}if(L.removeChild(F,false,N,L.getTreeStore()===E)===false){return false}}E&&E.beginUpdate();if(M===0){K.setFirstChild(F)}Ext.Array.splice(K.childNodes,M,0,F);F.parentNode=K;F.nextSibling=J;J.previousSibling=F;C=K.childNodes[M-1];if(C){F.previousSibling=C;C.nextSibling=F}else{F.previousSibling=null}F.updateInfo(false,{parentId:K.getId(),index:M,isFirst:M===0,isLast:false,depth:(K.data.depth||0)+1});for(H=M+1,G=K.childNodes.length;H<G;H++){K.childNodes[H].updateInfo(false,{index:H})}if(!K.isLoaded()){if(D){K.data.loaded=true}else{K.set("loaded",true)}}else{if(K.childNodes.length===1&&!D){K.triggerUIUpdate()}}if(E){E.registerNode(K,!D)}if(N!==true){K.fireEventArgs("insert",[K,F,J]);if(L){F.fireEventArgs("move",[F,L,K,M,J])}}K.callTreeStore("onNodeInsert",[F,M]);if(E){E.endUpdate()}return F},insertChild:function(C,E){var D=this.childNodes[C];if(D){return this.insertBefore(E,D)}else{return this.appendChild(E)}},isLastVisible:function(){var E=this,C=E.data.isLast,D=E.nextSibling;if(!C&&E.getTreeStore().isFiltered()){while(D){if(D.data.visible){return false}D=D.nextSibling}return true}return C},remove:function(D,E){var F=this,C=F.parentNode;if(C){C.removeChild(F,D,E)}else{if(D){F.erase(true)}}return F},removeAll:function(C,K,F){var I=this,J=I.childNodes,H=J.length,E,D,G;if(!H){return }if(!F){D=I.getTreeStore();if(D){D.beginUpdate();D.suspendEvent("remove");I.callTreeStore("beforeNodeRemove",[J,false])}}for(G=0;G<H;++G){E=J[G];E.previousSibling=E.nextSibling=E.parentNode=null;I.fireEventArgs("remove",[I,E,false]);if(C){E.erase(true)}else{E.removeAll(false,K,true)}}if(!F&&D){D.resumeEvent("remove");I.callTreeStore("onNodeRemove",[J,false]);D.endUpdate()}I.firstChild=I.lastChild=null;J.length=0;if(!F){I.triggerUIUpdate()}return I},getChildAt:function(C){return this.childNodes[C]},replaceChild:function(C,F,E){var D=F?F.nextSibling:null;this.removeChild(F,false,E);this.insertBefore(C,D,E);return F},indexOf:function(C){return Ext.Array.indexOf(this.childNodes,C)},indexOfId:function(F){var E=this.childNodes,C=E.length,D=0;for(;D<C;++D){if(E[D].getId()===F){return D}}return -1},getPath:function(F,E){F=F||this.idProperty;E=E||"/";var D=[this.get(F)],C=this.parentNode;while(C){D.unshift(C.get(F));C=C.parentNode}return E+D.join(E)},getDepth:function(){return this.get("depth")},bubble:function(E,D,C){var F=this;while(F){if(E.apply(D||F,C||[F])===false){break}F=F.parentNode}},cascade:function(){if(Ext.isDefined(Ext.global.console)){Ext.global.console.warn("Ext.data.Node: cascade has been deprecated. Please use cascadeBy instead.")}return this.cascadeBy.apply(this,arguments)},cascadeBy:function(H,E,C,J){var G=this;if(arguments.length===1&&!Ext.isFunction(H)){J=H.after;E=H.scope;C=H.args;H=H.before}if(!H||H.apply(E||G,C||[G])!==false){var I=G.childNodes,F=I.length,D;for(D=0;D<F;D++){I[D].cascadeBy.call(I[D],H,E,C,J)}if(J){J.apply(E||G,C||[G])}}},eachChild:function(F,E,C){var H=this.childNodes,G=H.length,D;for(D=0;D<G;D++){if(F.apply(E||this,C||[H[D]])===false){break}}},findChild:function(D,E,C){return this.findChildBy(function(){return this.get(D)==E},null,C)},findChildBy:function(I,H,D){var G=this.childNodes,C=G.length,F=0,J,E;for(;F<C;F++){J=G[F];if(I.call(H||J,J)===true){return J}else{if(D){E=J.findChildBy(I,H,D);if(E!==null){return E}}}}return null},contains:function(C){return C.isAncestor(this)},isAncestor:function(C){var D=this.parentNode;while(D){if(D===C){return true}D=D.parentNode}return false},sort:function(K,E,J){var H=this,I=H.childNodes,G=I.length,F,D,C={isFirst:true};if(G>0){if(!K){K=H.getTreeStore().getSortFn()}Ext.Array.sort(I,K);H.setFirstChild(I[0]);H.setLastChild(I[G-1]);for(F=0;F<G;F++){D=I[F];D.previousSibling=I[F-1];D.nextSibling=I[F+1];C.isLast=(F===G-1);C.index=F;D.updateInfo(false,C);C.isFirst=false;if(E&&!D.isLeaf()){D.sort(K,true,true)}}if(J!==true){H.fireEventArgs("sort",[H,I]);H.callTreeStore("onNodeSort",[I])}}},isExpanded:function(){return this.get("expanded")},isLoaded:function(){return this.get("loaded")},isBranchLoaded:function(){var C=!this.isLeaf()&&this.isLoaded();if(C){this.cascadeBy(function(D){if(!D.isLeaf()){C=C||D.isBranchLoaded()}return C})}return C},isLoading:function(){return this.get("loading")},isRoot:function(){return !this.parentNode},isVisible:function(){var C=this.parentNode;while(C){if(!C.isExpanded()){return false}C=C.parentNode}return true},expand:function(C,H,D){var E=this,F,G;if(!E.isLeaf()){if(E.isLoading()){E.on("expand",function(){E.expand(C,H,D)},E,{single:true})}else{if(!E.isExpanded()){if(E.fireEventArgs("beforeexpand",[E])!==false){if(C){if(E.parentNode&&E.parentNode.isSynchronousRecursiveExpand){E.isSynchronousRecursiveExpand=true}else{F=E.getTreeStore();if(F.getProxy().isSynchronous||E.isBranchLoaded()){E.isSynchronousRecursiveExpand=true;F.suspendEvent("add");G=true}}}E.callTreeStore("onBeforeNodeExpand",[E.onChildNodesAvailable,E,[C,H,D]]);if(G){F.resumeEvent("add");F.fireEvent("refresh",F)}E.isSynchronousRecursiveExpand=false}}else{if(C){E.expandChildren(true,H,D)}else{Ext.callback(H,D||E,[E.childNodes])}}}}else{Ext.callback(H,D||E)}},onChildNodesAvailable:function(F,E,K,L){var I=this,D=I.getTreeStore(),C=D&&D.bulkUpdate,H,G,J;Ext.suspendLayouts();for(H=I.parentNode;H;H=H.parentNode){if(!H.isExpanded()){(J||(J=[])).unshift(H)}}if(C){I.data.expanded=true}else{I.set("expanded",true)}if(J){for(G=1;G<J.length;G++){H=J[G];if(C){H.data.expanded=true}else{H.set("expanded",true)}}J[0].expand();for(G=1;G<J.length;G++){H=J[G];H.fireEventArgs("expand",[H,H.childNodes])}}else{I.callTreeStore("onNodeExpand",[F,false])}I.fireEventArgs("expand",[I,F]);if(E){I.expandChildren(true,K,L)}else{Ext.callback(K,L||I,[I.childNodes])}Ext.resumeLayouts(true)},expandChildren:function(G,M,N,H){var K=this,L,I,D,C,J,F,E;if(Ext.isBoolean(M)){L=M;M=N;N=H;H=L}if(H===undefined){E=K.getTreeStore();H=E&&E.singleExpand}D=K.childNodes;C=[];J=H?Math.min(D.length,1):D.length;for(I=0;I<J;++I){F=D[I];if(!F.isLeaf()){C[C.length]=F}}J=C.length;for(I=0;I<J;++I){C[I].expand(G)}if(M){Ext.callback(M,N||K,[K.childNodes])}},collapse:function(E,K,L){var J=this,H=J.isExpanded(),D=J.getTreeStore(),C=D&&D.bulkUpdate,I=J.childNodes.length,F,G;if(!J.isLeaf()&&((!H&&E)||J.fireEventArgs("beforecollapse",[J])!==false)){Ext.suspendLayouts();if(J.isExpanded()){if(E){G=function(){for(F=0;F<I;F++){J.childNodes[F].setCollapsed(true)}};if(K){K=Ext.Function.createSequence(G,Ext.Function.bind(K,L,[J.childNodes]))}else{K=G}}else{if(K){K=Ext.Function.bind(K,L,[J.childNodes])}}if(C){J.data.expanded=false}else{J.set("expanded",false)}J.callTreeStore("onNodeCollapse",[J.childNodes,K,L]);J.fireEventArgs("collapse",[J,J.childNodes]);K=null}else{if(E){for(F=0;F<I;F++){J.childNodes[F].setCollapsed(true)}}}Ext.resumeLayouts(true)}Ext.callback(K,L||J,[J.childNodes])},setCollapsed:function(D){var F=this,C=F.childNodes.length,E;if(!F.isLeaf()&&F.fireEventArgs("beforecollapse",[F])!==false){F.data.expanded=false;F.fireEventArgs("collapse",[F,F.childNodes]);if(D){for(E=0;E<C;E++){F.childNodes[E].setCollapsed(true)}}}},collapseChildren:function(E,J,K){var I=this,G,C=I.childNodes,H=C.length,F=[],D;for(G=0;G<H;++G){D=C[G];if(!D.isLeaf()&&D.isLoaded()&&D.isExpanded()){F.push(D)}}H=F.length;if(H){for(G=0;G<H;++G){D=F[G];if(G===H-1){D.collapse(E,J,K)}else{D.collapse(E)}}}else{Ext.callback(J,K)}},fireEvent:function(C){return this.fireEventArgs(C,Ext.Array.slice(arguments,1))},fireEventArgs:function(D,F){var H=Ext.mixin.Observable.prototype.fireEventArgs,C,G,E;if(A[D]){for(G=this;C!==false&&G;G=(E=G).parentNode){if(G.hasListeners&&G.hasListeners[D]){C=H.call(G,D,F)}}if(C!==false){G=E.getTreeStore();if(G&&G.hasListeners&&G.hasListeners[D="node"+D]){C=G.fireEventArgs(D,F)}}return C}else{return H.apply(this,arguments)}},serialize:function(E){var H=E||new Ext.data.writer.Json({writeAllFields:true}),D=H.getRecordData(this),I=this.childNodes,C=I.length,G,F;if(C>0){D.children=G=[];for(F=0;F<C;F++){G.push(I[F].serialize(H))}}return D},callTreeStore:function(G,C){var E=this,F=E.getTreeStore(),D=F&&F[G];if(F&&D){C=C||[];if(C[0]!==E){C.unshift(E)}D.apply(F,C)}},privates:{join:function(C){if(C.isTreeStore){if(this.isRoot()){this.treeStore=this.store=C}}else{this.callParent([C])}},callJoined:function(D,C){this.callParent([D,C]);this.callTreeStore(D,C)}}}}}})