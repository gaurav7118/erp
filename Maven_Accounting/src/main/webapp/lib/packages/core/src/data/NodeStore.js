Ext.define("Ext.data.NodeStore",{extend:"Ext.data.Store",alias:"store.node",requires:["Ext.data.TreeModel","Ext.data.NodeInterface"],isNodeStore:true,config:{node:null,recursive:false,rootVisible:false,folderSort:false},implicitModel:"Ext.data.TreeModel",getTotalCount:function(){return this.getCount()},updateFolderSort:function(B){var A=this.getData();A.setTrackGroups(false);if(B){A.setGrouper({groupFn:this.folderSortFn})}else{A.setGrouper(null)}},folderSortFn:function(A){return A.data.leaf?1:0},afterReject:function(A){var B=this;if(B.contains(A)){B.onUpdate(A,Ext.data.Model.REJECT,null);B.fireEvent("update",B,A,Ext.data.Model.REJECT,null)}},afterCommit:function(A,C){var B=this;if(!C){C=null}if(B.contains(A)){B.onUpdate(A,Ext.data.Model.COMMIT,C);B.fireEvent("update",B,A,Ext.data.Model.COMMIT,C)}},onNodeAppend:function(A,B){if(A===this.getNode()){this.add([B].concat(this.retrieveChildNodes(B)))}},onNodeInsert:function(C,E,B){var D=this,A;if(C===D.getNode()){A=D.indexOf(B)||0;D.insert(0,[E].concat(D.retrieveChildNodes(E)))}},onNodeRemove:function(A,B){if(A===this.getNode()){this.remove([B].concat(this.retrieveChildNodes(B)))}},onNodeExpand:function(B,A){if(B===this.getNode()){this.loadRecords(A)}},applyNode:function(A){if(A){if(!A.isModel){A=new (this.getModel())(A)}if(!A.isNode){Ext.data.NodeInterface.decorate(A)}}return A},updateNode:function(B,D){var A=this,C;if(D&&!D.destroyed){D.un({append:"onNodeAppend",insert:"onNodeInsert",remove:"onNodeRemove",scope:A});D.unjoin(A)}if(B){B.on({scope:A,append:"onNodeAppend",insert:"onNodeInsert",remove:"onNodeRemove"});B.join(A);C=[];if(B.childNodes.length){C=C.concat(A.retrieveChildNodes(B))}if(A.getRootVisible()){C.push(B)}else{if(B.isLoaded()||B.isLoading()){B.set("expanded",true)}}A.getData().clear();A.fireEvent("clear",A);A.suspendEvents();if(A.isInitializing){A.inlineData=C}else{A.add(C)}A.resumeEvents();if(C.length===0){A.loaded=B.loaded=true}A.fireEvent("refresh",A,A.data)}},isVisible:function(B){var A=B.parentNode;if(!this.getRecursive()&&A!==this.getNode()){return false}while(A){if(!A.isExpanded()){return false}if(A===this.getNode()){break}A=A.parentNode}return true},privates:{retrieveChildNodes:function(A){var D=this.getNode(),B=this.getRecursive(),C=[],E=A;if(!A.childNodes.length||(!B&&A!==D)){return C}if(!B){return A.childNodes}while(E){if(E._added){delete E._added;if(E===A){break}else{E=E.nextSibling||E.parentNode}}else{if(E!==A){C.push(E)}if(E.firstChild){E._added=true;E=E.firstChild}else{E=E.nextSibling||E.parentNode}}}return C}}})