Ext.define("Ext.data.PageMap",{extend:"Ext.util.LruCache",config:{store:null,pageSize:0,rootProperty:""},clear:function(A){var B=this;B.pageMapGeneration=(B.pageMapGeneration||0)+1;B.indexMap={};B.callParent([A])},updatePageSize:function(B,A){if(A!=null){throw"pageMap page size may not be changed"}},forEach:function(I,K){var G=this,D=Ext.Object.getKeys(G.map),A=D.length,H=G.getPageSize(),C,B,J,F,E;for(C=0;C<A;C++){D[C]=+D[C]}Ext.Array.sort(D,Ext.Array.numericSortFn);K=K||G;for(C=0;C<A;C++){J=D[C];F=G.getPage(J);E=F.length;for(B=0;B<E;B++){if(I.call(K,F[B],(J-1)*H+B)===false){return }}}},findBy:function(C,B){var D=this,A=null;B=B||D;D.forEach(function(F,E){if(C.call(B,F,E)){A=F;return false}});return A},findIndexBy:function(C,B){var D=this,A=-1;B=B||D;D.forEach(function(F,E){if(C.call(B,F)){A=E;return false}});return A},find:function(G,F,H,D,C,B){if(Ext.isEmpty(F,false)){return null}var E=Ext.String.createRegex(F,D,C,B),A=this.getRootProperty();return this.findBy(function(I){return I&&E.test((A?I[A]:I)[G])},null,H)},findIndex:function(G,F,H,D,C,B){if(Ext.isEmpty(F,false)){return null}var E=Ext.String.createRegex(F,D,C,B),A=this.getRootProperty();return this.findIndexBy(function(I){return I&&E.test((A?I[A]:I)[G])},null,H)},getPageFromRecordIndex:function(A){return Math.floor(A/this.getPageSize())+1},addAll:function(A){if(this.getCount()){Ext.raise("Cannot addAll to a non-empty PageMap")}this.addPage(1,A)},addPage:function(K,A){var I=this,J=I.getPageSize(),C=K+Math.floor((A.length-1)/J),H=(K-1)*J,F=I.indexMap,E,B,D,G;for(G=0;K<=C;K++,G+=J){E=Ext.Array.slice(A,G,G+J);for(B=0,D=E.length;B<D;B++){F[E[B].internalId]=H++}I.add(K,E);I.fireEvent("pageadd",I,K,E)}},getCount:function(){var A=this.callParent();if(A){A=(A-1)*this.getPageSize()+this.last.value.length}return A},getByInternalId:function(A){var B=this.indexMap[A];if(B!=null){return this.getAt(B)}},indexOf:function(B){var A=-1;if(B){A=this.indexMap[B.internalId];if(A==null){A=-1}}return A},insert:function(){Ext.raise("insert operation not suppported into buffered Store")},remove:function(){Ext.raise("remove operation not suppported from buffered Store")},removeAt:function(){Ext.raise("removeAt operation not suppported from buffered Store")},removeAtKey:function(F){var E=this,C=E.getPage(F),B,D,A;if(C){if(E.fireEvent("beforepageremove",E,F,C)!==false){B=C.length;for(D=0;D<B;D++){delete E.indexMap[C[D].internalId]}A=E.callParent(arguments);E.fireEvent("pageremove",E,F,C);C.length=0}}return A},getPage:function(A){return this.get(A)},hasRange:function(E,B){var C=this,A=C.getPageFromRecordIndex(E),D=C.getPageFromRecordIndex(B);for(;A<=D;A++){if(!C.hasPage(A)){return false}}return(D-1)*C._pageSize+C.getPage(D).length>B},hasPage:function(A){return !!this.get(A)},peekPage:function(A){return this.map[A]},getAt:function(A){return this.getRange(A,A+1)[0]},getRange:function(A,B){B--;if(!this.hasRange(A,B)){Ext.raise("PageMap asked for range which it does not have")}var G=this,D=Ext.Array,H=G.getPageSize(),K=G.getPageFromRecordIndex(A),E=G.getPageFromRecordIndex(B),C=(K-1)*H,M=(E*H)-1,I=K,N=[],L,F,J;for(;I<=E;I++){if(I===K){L=A-C;J=L>0}else{L=0;J=false}if(I===E){F=H-(M-B);J=J||F<H}if(J){D.push(N,D.slice(G.getPage(I),L,F))}else{D.push(N,G.getPage(I))}}return N},destroy:function(){this.callParent();this.indexMap={}}})