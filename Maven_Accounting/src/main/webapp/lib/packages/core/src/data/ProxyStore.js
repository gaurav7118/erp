Ext.define("Ext.data.ProxyStore",{extend:"Ext.data.AbstractStore",requires:["Ext.data.Model","Ext.data.proxy.Proxy","Ext.data.proxy.Memory","Ext.data.operation.*"],config:{model:undefined,fields:null,proxy:undefined,autoLoad:undefined,autoSync:false,batchUpdateMode:"operation",sortOnLoad:true,trackRemoved:true,asynchronousLoad:undefined},onClassExtended:function(B,D,A){var C=D.model,E;if(typeof C==="string"){E=A.onBeforeCreated;A.onBeforeCreated=function(){var G=this,F=arguments;Ext.require(C,function(){E.apply(G,F)})}}},implicitModel:"Ext.data.Model",autoSyncSuspended:0,constructor:function(B){var D=this;var C=D.model;D.removed=[];D.callParent(arguments);if(D.getAsynchronousLoad()===false){D.flushLoad()}if(!D.getModel()&&D.useModelWarning!==false&&D.getStoreId()!=="ext-empty-store"){var A=[Ext.getClassName(D)||"Store"," created with no model."];if(typeof C==="string"){A.push(" The name '",C,"'"," does not correspond to a valid model.")}Ext.log.warn(A.join(""))}},applyAsynchronousLoad:function(A){if(A==null){A=!this.loadsSynchronously()}return A},updateAutoLoad:function(A){this.getData();if(A){this.load(Ext.isObject(A)?A:undefined)}},getTotalCount:function(){return this.totalCount||0},applyFields:function(A){if(A){this.createImplicitModel(A)}},applyModel:function(A){if(A){A=Ext.data.schema.Schema.lookupEntity(A)}else{this.getFields();A=this.getModel()||this.createImplicitModel()}return A},applyProxy:function(B){var A=this.getModel();if(B!==null){if(B){if(B.isProxy){B.setModel(A)}else{if(Ext.isString(B)){B={type:B,model:A}}else{if(!B.model){B=Ext.apply({model:A},B)}}B=Ext.createByAlias("proxy."+B.type,B);B.autoCreated=true}}else{if(A){B=A.getProxy()}}if(!B){B=Ext.createByAlias("proxy.memory");B.autoCreated=true}}return B},applyState:function(B){var A=this;A.callParent([B]);if(A.getAutoLoad()||A.isLoaded()){A.load()}},updateProxy:function(B,A){this.proxyListeners=Ext.destroy(this.proxyListeners)},updateTrackRemoved:function(A){this.cleanRemoved();this.removed=A?[]:null},onMetaChange:function(A,B){this.fireEvent("metachange",this,B)},create:function(E,C){var D=this,F=D.getModel(),A=new F(E),B;C=Ext.apply({},C);if(!C.records){C.records=[A]}C.internalScope=D;C.internalCallback=D.onProxyWrite;B=D.createOperation("create",C);return B.execute()},read:function(){return this.load.apply(this,arguments)},update:function(B){var C=this,A;B=Ext.apply({},B);if(!B.records){B.records=C.getUpdatedRecords()}B.internalScope=C;B.internalCallback=C.onProxyWrite;A=C.createOperation("update",B);return A.execute()},onProxyWrite:function(B){var C=this,D=B.wasSuccessful(),A=B.getRecords();switch(B.getAction()){case"create":C.onCreateRecords(A,B,D);break;case"update":C.onUpdateRecords(A,B,D);break;case"destroy":C.onDestroyRecords(A,B,D);break}if(D){C.fireEvent("write",C,B);C.fireEvent("datachanged",C)}},onCreateRecords:Ext.emptyFn,onUpdateRecords:Ext.emptyFn,onDestroyRecords:function(B,A,C){if(C){this.cleanRemoved()}},erase:function(B){var C=this,A;B=Ext.apply({},B);if(!B.records){B.records=C.getRemovedRecords()}B.internalScope=C;B.internalCallback=C.onProxyWrite;A=C.createOperation("destroy",B);return A.execute()},onBatchOperationComplete:function(B,A){return this.onProxyWrite(A)},onBatchComplete:function(C,A){var F=this,B=C.operations,E=B.length,D;if(F.batchUpdateMode!=="operation"){F.suspendEvents();for(D=0;D<E;D++){F.onProxyWrite(B[D])}F.resumeEvents()}F.isSyncing=false;F.fireEvent("datachanged",F)},onBatchException:function(B,A){},filterNew:function(A){return A.phantom===true&&A.isValid()},getNewRecords:function(){return[]},getUpdatedRecords:function(){return[]},getModifiedRecords:function(){return[].concat(this.getNewRecords(),this.getUpdatedRecords())},filterUpdated:function(A){return A.dirty===true&&A.phantom!==true&&A.isValid()},getRemovedRecords:function(){var A=this.getRawRemovedRecords();return A?Ext.Array.clone(A):A},sync:function(C){var E=this,B={},F=E.getNewRecords(),D=E.getUpdatedRecords(),A=E.getRemovedRecords(),G=false;if(E.isSyncing){Ext.log.warn("Sync called while a sync operation is in progress. Consider configuring autoSync as false.")}E.needsSync=false;if(F.length>0){B.create=F;G=true}if(D.length>0){B.update=D;G=true}if(A.length>0){B.destroy=A;G=true}if(G&&E.fireEvent("beforesync",B)!==false){E.isSyncing=true;C=C||{};E.proxy.batch(Ext.apply(C,{operations:B,listeners:E.getBatchListeners()}))}return E},getBatchListeners:function(){var B=this,A={scope:B,exception:B.onBatchException,complete:B.onBatchComplete};if(B.batchUpdateMode==="operation"){A.operationcomplete=B.onBatchOperationComplete}return A},save:function(){return this.sync.apply(this,arguments)},load:function(A){var B=this;if(typeof A==="function"){A={callback:A}}else{A=A?Ext.Object.chain(A):{}}B.pendingLoadOptions=A;if(B.getAsynchronousLoad()){if(!B.loadTimer){B.loadTimer=Ext.asap(B.flushLoad,B)}}else{B.flushLoad()}return B},flushLoad:function(){var C=this,B=C.pendingLoadOptions,A;C.clearLoadTask();if(!B){return }C.setLoadOptions(B);if(C.getRemoteSort()&&B.sorters){C.fireEvent("beforesort",C,B.sorters)}A=Ext.apply({internalScope:C,internalCallback:C.onProxyLoad,scope:C},B);C.lastOptions=A;A=C.createOperation("read",A);if(C.fireEvent("beforeload",C,A)!==false){C.onBeforeLoad(A);C.loading=true;A.execute()}},reload:function(A){var B=Ext.apply({},A,this.lastOptions);return this.load(B)},onEndUpdate:function(){var A=this;if(A.needsSync&&A.autoSync&&!A.autoSyncSuspended){A.sync()}},afterReject:function(A){var B=this;if(B.contains(A)){B.onUpdate(A,Ext.data.Model.REJECT,null);B.fireEvent("update",B,A,Ext.data.Model.REJECT,null)}},afterCommit:function(A,C){var B=this;if(!C){C=null}if(B.contains(A)){B.onUpdate(A,Ext.data.Model.COMMIT,C);B.fireEvent("update",B,A,Ext.data.Model.COMMIT,C)}},afterErase:function(A){this.onErase(A)},onErase:Ext.emptyFn,onUpdate:Ext.emptyFn,onDestroy:function(){var B=this,A=B.getProxy();B.clearLoadTask();B.getData().destroy();B.data=null;B.setProxy(null);if(A.autoCreated){A.destroy()}B.setModel(null)},hasPendingLoad:function(){return !!this.pendingLoadOptions||this.isLoading()},isLoading:function(){return !!this.loading},isLoaded:function(){return this.loadCount>0},suspendAutoSync:function(){++this.autoSyncSuspended},resumeAutoSync:function(B){var A=this;if(!A.autoSyncSuspended){Ext.log.warn("Mismatched call to resumeAutoSync - auto synchronization is currently not suspended.")}if(A.autoSyncSuspended&&!--A.autoSyncSuspended){if(B){A.sync()}}},removeAll:Ext.emptyFn,clearData:Ext.emptyFn,privates:{getRawRemovedRecords:function(){return this.removed},onExtraParamsChanged:function(){},clearLoadTask:function(){Ext.asapCancel(this.loadTimer);this.pendingLoadOptions=this.loadTimer=null},cleanRemoved:function(){var C=this.getRawRemovedRecords(),A,B;if(C){for(B=0,A=C.length;B<A;++B){C[B].unjoin(this)}C.length=0}},createOperation:function(D,A){var E=this,B=E.getProxy(),C;if(!E.proxyListeners){C={scope:E,destroyable:true,beginprocessresponse:E.beginUpdate,endprocessresponse:E.endUpdate};if(!E.disableMetaChangeEvent){C.metachange=E.onMetaChange}E.proxyListeners=B.on(C)}return B.createOperation(D,A)},createImplicitModel:function(A){var E=this,B={extend:E.implicitModel,statics:{defaultProxy:"memory"}},D,C;if(A){B.fields=A}C=Ext.define(null,B);E.setModel(C);D=E.getProxy();if(D){C.setProxy(D)}else{E.setProxy(C.getProxy())}},loadsSynchronously:function(){return this.getProxy().isSynchronous},onBeforeLoad:Ext.privateFn,removeFromRemoved:function(A){var B=this.getRawRemovedRecords();if(B){Ext.Array.remove(B,A);A.unjoin(this)}},setLoadOptions:function(A){var C=this,B,D;if(C.getRemoteFilter()){B=C.getFilters(false);if(B&&B.getCount()){A.filters=B.getRange()}}if(C.getRemoteSort()){D=C.getSorters(false);if(D&&D.getCount()){A.sorters=D.getRange()}}}}})