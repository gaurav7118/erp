Ext.define("Ext.data.Store",{extend:"Ext.data.ProxyStore",alias:"store.store",mixins:["Ext.data.LocalStore"],requires:["Ext.data.Model","Ext.data.proxy.Ajax","Ext.data.reader.Json","Ext.data.writer.Json","Ext.util.GroupCollection","Ext.util.DelayedTask"],uses:["Ext.data.StoreManager","Ext.util.Grouper"],config:{data:0,clearRemovedOnLoad:true,clearOnPageLoad:true,associatedEntity:null,role:null,session:null},addRecordsOptions:{addRecords:true},loadCount:0,complete:false,moveMapCount:0,constructor:function(A){var B=this,C;if(A){if(A.buffered){if(this.self!==Ext.data.Store){Ext.raise("buffered config not supported on derived Store classes. Please derive from Ext.data.BufferedStore.")}return new Ext.data.BufferedStore(A)}if(A.remoteGroup){Ext.log.warn("Ext.data.Store: remoteGroup has been removed. Use remoteSort instead.")}}B.callParent([A]);B.getData().addObserver(B);C=B.inlineData;if(C){delete B.inlineData;B.loadInlineData(C)}},onCollectionBeginUpdate:function(){this.beginUpdate()},onCollectionEndUpdate:function(){this.endUpdate()},applyData:function(C,A){var B=this;B.getFields();B.getModel();if(C&&C.isCollection){A=C}else{if(!A){A=B.constructDataCollection()}if(C){if(B.isInitializing){B.inlineData=C}else{B.loadData(C)}}}return A},loadInlineData:function(C){var B=this,A=B.getProxy();if(A&&A.isMemoryProxy){A.setData(C);B.suspendEvents();B.read();B.resumeEvents()}else{B.removeAll(true);B.suspendEvents();B.loadData(C);B.resumeEvents()}},onCollectionAdd:function(B,A){this.onCollectionAddItems(B,A.items,A)},onCollectionFilterAdd:function(B,A){this.onCollectionAddItems(B,A)},onCollectionAddItems:function(F,B,A){var J=this,H=B.length,L=A?!A.next:false,G=J.removed,E=J.ignoreCollectionAdd,I=J.getSession(),N=A&&A.replaced,C,K,D,M;for(C=0;C<H;++C){D=B[C];if(I){I.adopt(D)}if(!E){D.join(J);if(G&&G.length){Ext.Array.remove(G,D)}K=K||D.phantom||D.dirty}}if(E){return }if(N){M=[];do{Ext.Array.push(M,N.items);N=N.next}while(N);J.setMoving(M,true)}if(A){if(A.replaced){if(L){J.fireEvent("refresh",J)}}else{J.fireEvent("add",J,B,A.at);if(L){J.fireEvent("datachanged",J)}}}if(M){J.setMoving(M,false)}J.needsSync=J.needsSync||K},onCollectionFilteredItemChange:function(){this.onCollectionItemChange.apply(this,arguments)},onCollectionItemChange:function(F,E){var D=this,A=E.item,C=E.modified||null,B=E.meta;if(D.fireChangeEvent(A)){D.onUpdate(A,B,C,E);D.fireEvent("update",D,A,B,C,E)}},fireChangeEvent:function(A){return this.getDataSource().contains(A)},afterChange:function(A,C,B){this.getData().itemChanged(A,C||null,undefined,B)},afterCommit:function(A,B){this.afterChange(A,B,Ext.data.Model.COMMIT)},afterEdit:function(A,B){this.needsSync=this.needsSync||A.dirty;this.afterChange(A,B,Ext.data.Model.EDIT)},afterReject:function(A){this.afterChange(A,null,Ext.data.Model.REJECT)},afterDrop:function(A){this.getData().remove(A)},afterErase:function(A){this.removeFromRemoved(A)},addSorted:function(A){var C=this,E=C.getRemoteSort(),D=C.getData(),B;if(E){D.setSorters(C.getSorters())}B=D.findInsertionIndex(A);if(E){D.setSorters(null)}return C.insert(B,A)},remove:function(B,I,G){var H=this,C=H.getDataSource(),F,D,A,E;if(B){if(B.isModel){if(C.indexOf(B)>-1){A=[B];F=1}else{F=0}}else{A=[];for(D=0,F=B.length;D<F;++D){E=B[D];if(E&&E.isEntity){if(!C.contains(E)){continue}}else{if(!(E=C.getAt(E))){continue}}A.push(E)}F=A.length}}if(!F){return[]}H.removeIsMove=I===true;H.removeIsSilent=G;C.remove(A);H.removeIsSilent=false;return A},onCollectionRemove:function(G,A){var L=this,H=L.removed,C=A.items,J=C.length,I=A.at,B=A.replacement,N=L.removeIsMove||(B&&Ext.Array.equals(C,B.items)),K=L.removeIsSilent,M=!A.next,E=L.getDataSource(),D,F;if(L.ignoreCollectionRemove){return }if(B){L.setMoving(B.items,true)}for(D=0;D<J;++D){F=C[D];if(!E.contains(F)){if(H&&!N&&!F.phantom&&!F.erasing){F.removedFrom=I+D;H.push(F);L.needsSync=true}else{F.unjoin(L)}}}if(!K){if(!B||!B.items.length){L.fireEvent("remove",L,C,I,N);if(M){L.fireEvent("datachanged",L)}}}if(B){L.setMoving(B.items,false)}},onFilterEndUpdate:function(){this.callParent(arguments);this.callObservers("Filter")},removeAt:function(A,B){var C=this.getData();A=Math.max(A,0);if(A<C.length){if(arguments.length===1){B=1}else{if(!B){return }}C.removeAt(A,B)}},removeAll:function(B){var C=this,D=C.getData(),E=C.hasListeners.clear,A=D.getRange();if(D.length){C.removeIsSilent=true;C.callObservers("BeforeRemoveAll");D.removeAll();C.removeIsSilent=false;if(!B){C.fireEvent("clear",C,A);C.fireEvent("datachanged",C)}C.callObservers("AfterRemoveAll",[!!B])}return A},setRecords:function(A){var B=this.getCount();++this.loadCount;if(B){this.getData().splice(0,B,A)}else{this.add(A)}},splice:function(A,C,B){return this.getData().splice(A,C,B)},onProxyLoad:function(B){var D=this,C=B.getResultSet(),A=B.getRecords(),E=B.wasSuccessful();if(D.destroyed){return }if(C){D.totalCount=C.getTotal()}if(E){A=D.processAssociation(A);D.loadRecords(A,B.getAddRecords()?{addRecords:true}:undefined)}else{D.loading=false}if(D.hasListeners.load){D.fireEvent("load",D,A,E,B)}D.callObservers("AfterLoad",[A,E,B])},filterDataSource:function(E){var F=this.getDataSource(),B=F.items,A=B.length,C=[],D;for(D=0;D<A;D++){if(E.call(F,B[D])){C.push(B[D])}}return C},getNewRecords:function(){return this.filterDataSource(this.filterNew)},getRejectRecords:function(){return this.filterDataSource(this.filterRejects)},getUpdatedRecords:function(){return this.filterDataSource(this.filterUpdated)},loadData:function(F,A){var E=this,D=F.length,C=[],B;for(B=0;B<D;B++){C.push(E.createModel(F[B]))}C=E.processAssociation(C);E.loadRecords(C,A?E.addRecordsOptions:undefined)},loadRawData:function(E,B){var D=this,F=D.getSession(),A=D.getProxy().getReader().read(E,F?{recordCreator:F.recordCreator}:undefined),C=A.getRecords(),G=A.getSuccess();if(G){D.totalCount=A.getTotal();D.loadRecords(C,B?D.addRecordsOptions:undefined)}return G},loadRecords:function(A,C){var G=this,F=A.length,H=G.getData(),E,D,B;if(C){E=C.addRecords}if(!G.getRemoteSort()&&!G.getSortOnLoad()){B=true;H.setAutoSort(false)}if(!E){G.clearData(true)}G.loading=false;G.ignoreCollectionAdd=true;G.callObservers("BeforePopulate");H.add(A);G.ignoreCollectionAdd=false;if(B){H.setAutoSort(true)}for(D=0;D<F;D++){A[D].join(G)}++G.loadCount;G.complete=true;G.fireEvent("datachanged",G);G.fireEvent("refresh",G);G.callObservers("AfterPopulate")},loadPage:function(D,A){var C=this,B=C.getPageSize();C.currentPage=D;A=Ext.apply({page:D,start:(D-1)*B,limit:B,addRecords:!C.getClearOnPageLoad()},A);C.read(A)},nextPage:function(A){this.loadPage(this.currentPage+1,A)},previousPage:function(A){this.loadPage(this.currentPage-1,A)},clearData:function(C){var I=this,G=I.removed,D=I.getDataSource(),H=I.getClearRemovedOnLoad(),J=G&&C&&!H,A,E,B,F;if(D){A=D.items;for(B=0,F=A.length;B<F;++B){E=A[B];if(J&&Ext.Array.contains(G,E)){continue}E.unjoin(I)}I.ignoreCollectionRemove=true;I.callObservers("BeforeClear");D.removeAll();I.ignoreCollectionRemove=false;I.callObservers("AfterClear")}if(G&&(!C||H)){G.length=0}},onIdChanged:function(C,B,A){this.getData().updateKey(C,B);this.fireEvent("idchanged",this,C,B,A)},commitChanges:function(){var C=this,D=C.getModifiedRecords(),A=D.length,B=0;Ext.suspendLayouts();C.beginUpdate();for(;B<A;B++){D[B].commit()}C.cleanRemoved();C.endUpdate();Ext.resumeLayouts(true)},filterNewOnly:function(A){return A.phantom===true},filterRejects:function(A){return A.phantom||A.dirty},rejectChanges:function(){var H=this,I=H.getRejectRecords(),F=I.length,D,B,A,G,C,E;Ext.suspendLayouts();H.beginUpdate();for(D=0;D<F;D++){B=I[D];if(B.phantom){A=A||[];A.push(B)}else{B.reject()}}if(A){H.remove(A);for(D=0,F=A.length;D<F;++D){A[D].reject()}}I=H.getRawRemovedRecords();if(I){F=I.length;G=!H.getRemoteSort()&&H.isSorted();if(G){C=H.getData();E=C.getAutoSort();C.setAutoSort(false)}for(D=F-1;D>=0;D--){B=I[D];B.reject();if(!G){H.insert(B.removedFrom||0,B)}}if(G){C.setAutoSort(E);H.add(I)}I.length=0}H.endUpdate();Ext.resumeLayouts(true)},onDestroy:function(){var B=this,A=B.loadTask,D=B.getData(),C=D.getSource();B.clearData();B.callParent();B.setSession(null);B.observers=null;if(A){A.cancel();B.loadTask=null}if(C){C.destroy()}},privates:{fetch:function(B){B=Ext.apply({},B);this.setLoadOptions(B);var A=this.createOperation("read",B);A.execute()},onBeforeLoad:function(A){this.callObservers("BeforeLoad",[A])},onRemoteFilterSet:function(A,B){if(A){this.getData().setFilters(B?null:A)}this.callParent([A,B])},onRemoteSortSet:function(B,C){var A=this.getData();if(B){A.setSorters(C?null:B)}A.setAutoGroup(!C);this.callParent([B,C])},isMoving:function(C,E){var F=this.moveMap,B=0,A,D;if(F){if(C){if(Ext.isArray(C)){for(D=0,A=C.length;D<A;++D){B+=F[C[D].id]?1:0}}else{if(F[C.id]){++B}}}else{B=E?F:this.moveMapCount}}return B},setLoadOptions:function(C){var D=this,A=D.getPageSize(),E,B;if(D.getRemoteSort()&&!C.grouper){B=D.getGrouper();if(B){C.grouper=B}}if(A||"start" in C||"limit" in C||"page" in C){C.page=C.page!=null?C.page:D.currentPage;C.start=(C.start!==undefined)?C.start:(C.page-1)*A;C.limit=C.limit!=null?C.limit:A;D.currentPage=C.page}C.addRecords=C.addRecords||false;if(!C.recordCreator){E=D.getSession();if(E){C.recordCreator=E.recordCreator}}D.callParent([C])},setMoving:function(B,F){var D=this,E=D.moveMap||(D.moveMap={}),A=B.length,C,G;for(C=0;C<A;++C){G=B[C].id;if(F){if(E[G]){++E[G]}else{E[G]=1;++D.moveMapCount}}else{if(--E[G]===0){delete E[G];--D.moveMapCount}}}if(D.moveMapCount===0){D.moveMap=null}},processAssociation:function(A){var C=this,B=C.getAssociatedEntity();if(B){A=C.getRole().processLoad(C,B,A,C.getSession())}return A}}})