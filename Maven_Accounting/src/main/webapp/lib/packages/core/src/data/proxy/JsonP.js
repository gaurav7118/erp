Ext.define("Ext.data.proxy.JsonP",{extend:"Ext.data.proxy.Server",alternateClassName:"Ext.data.ScriptTagProxy",alias:["proxy.jsonp","proxy.scripttag"],requires:["Ext.data.JsonP"],config:{callbackKey:"callback",recordParam:"records",autoAppendParams:true},doRequest:function(A){var C=this,B=C.buildRequest(A),D=B.getParams();B.setConfig({callbackKey:C.callbackKey,timeout:C.timeout,scope:C,disableCaching:false,callback:C.createRequestCallback(B,A)});if(C.getAutoAppendParams()){B.setParams({})}B.setRawRequest(Ext.data.JsonP.request(B.getCurrentConfig()));B.setParams(D);C.lastRequest=B;return B},createRequestCallback:function(C,A){var B=this;return function(F,D,E){if(C===B.lastRequest){B.lastRequest=null}B.processResponse(F,A,C,D)}},setException:function(B,A){B.setException(B.getRequest().getRawRequest().errorType)},buildUrl:function(G){var I=this,A=I.callParent(arguments),D=G.getRecords(),E=I.getWriter(),F,C,B,H,J;if(E&&G.getOperation().allowWrite()){G=E.write(G)}F=G.getParams();C=F.filters;delete F.filters;if(C&&C.length){for(H=0;H<C.length;H++){B=C[H];J=B.getValue();if(J){F[B.getProperty()]=J}}}if(Ext.isArray(D)&&D.length>0&&(!E||!E.getEncode())){F[I.getRecordParam()]=I.encodeRecords(D)}if(I.getAutoAppendParams()){A=Ext.urlAppend(A,Ext.Object.toQueryString(F))}return A},abort:function(A){A=A||this.lastRequest;if(A){Ext.data.JsonP.abort(A.getRawRequest())}},encodeRecords:function(B){var D=[],C=0,A=B.length;for(;C<A;C++){D.push(Ext.encode(B[C].getData()))}return D}})