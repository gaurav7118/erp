Ext.define("Ext.data.proxy.Server",{extend:"Ext.data.proxy.Proxy",alias:"proxy.server",alternateClassName:"Ext.data.ServerProxy",uses:["Ext.data.Request"],isRemote:true,config:{url:"",pageParam:"page",startParam:"start",limitParam:"limit",groupParam:"group",groupDirectionParam:"groupDir",sortParam:"sort",filterParam:"filter",directionParam:"dir",idParam:"id",simpleSortMode:false,simpleGroupMode:false,noCache:true,cacheString:"_dc",timeout:30000,api:{create:undefined,read:undefined,update:undefined,destroy:undefined},extraParams:{}},create:function(){return this.doRequest.apply(this,arguments)},read:function(){return this.doRequest.apply(this,arguments)},update:function(){return this.doRequest.apply(this,arguments)},erase:function(){return this.doRequest.apply(this,arguments)},setExtraParam:function(A,B){var C=this.getExtraParams();C[A]=B;this.fireEvent("extraparamschanged",C)},updateExtraParams:function(B,A){this.fireEvent("extraparamschanged",B)},buildRequest:function(A){var F=this,B=Ext.apply({},A.getParams()),G=Ext.applyIf(B,F.getExtraParams()||{}),E,D,C;Ext.applyIf(G,F.getParams(A));D=A.getId();C=F.getIdParam();if(D!==undefined&&G[C]===undefined){G[C]=D}E=new Ext.data.Request({params:G,action:A.getAction(),records:A.getRecords(),url:A.getUrl(),operation:A,proxy:F});E.setUrl(F.buildUrl(E));A.setRequest(E);return E},processResponse:function(H,C,G,B){var F=this,D,A,E;F.fireEvent("beginprocessresponse",F,B,C);if(H===true){A=F.getReader();if(B.status===204){E=A.getNullResultSet()}else{E=A.read(F.extractResponseData(B),{recordCreator:C.getRecordCreator()})}C.process(E,G,B);D=!C.wasSuccessful()}else{F.setException(C,B);D=true}if(D){F.fireEvent("exception",F,B,C)}F.afterRequest(G,H);F.fireEvent("endprocessresponse",F,B,C)},setException:function(B,A){B.setException({status:A.status,statusText:A.statusText,response:A})},extractResponseData:Ext.identityFn,applyEncoding:function(A){return Ext.encode(A)},encodeSorters:function(E,C){var A=[],D=E.length,B;for(B=0;B<D;B++){A[B]=E[B].serialize()}return this.applyEncoding(C?A[0]:A)},encodeFilters:function(D){var A=[],C=D.length,B,E;for(B=0;B<C;B++){A[B]=D[B].serialize()}return this.applyEncoding(A)},getParams:function(O){if(!O.isReadOperation){return{}}var U=this,T={},R=O.getGrouper(),A=O.getSorters(),M=O.getFilters(),H=O.getPage(),G=O.getStart(),S=O.getLimit(),K=U.getSimpleSortMode(),D=U.getSimpleGroupMode(),Q=U.getPageParam(),E=U.getStartParam(),B=U.getLimitParam(),C=U.getGroupParam(),L=U.getGroupDirectionParam(),F=U.getSortParam(),P=U.getFilterParam(),N=U.getDirectionParam(),J,I;if(Q&&H){T[Q]=H}if(E&&(G||G===0)){T[E]=G}if(B&&S){T[B]=S}J=C&&R;if(J){if(D){T[C]=R.getProperty();T[L]=R.getDirection()}else{T[C]=U.encodeSorters([R],true)}}if(F&&A&&A.length>0){if(K){I=0;if(A.length>1&&J){I=1}T[F]=A[I].getProperty();T[N]=A[I].getDirection()}else{T[F]=U.encodeSorters(A)}}if(P&&M&&M.length>0){T[P]=U.encodeFilters(M)}return T},buildUrl:function(C){var B=this,A=B.getUrl(C);if(!A){Ext.raise("You are using a ServerProxy but have not supplied it with a url.")}if(B.getNoCache()){A=Ext.urlAppend(A,Ext.String.format("{0}={1}",B.getCacheString(),Ext.Date.now()))}return A},getUrl:function(B){var A;if(B){A=B.getUrl()||this.getApi()[B.getAction()]}return A?A:this.callParent()},doRequest:function(A){Ext.raise("The doRequest function has not been implemented on your Ext.data.proxy.Server subclass. See src/data/ServerProxy.js for details")},afterRequest:Ext.emptyFn,destroy:function(){this.callParent();Ext.destroy(this.getReader(),this.getWriter());this.reader=this.writer=null}})