Ext.define("Ext.data.reader.Reader",{alternateClassName:["Ext.data.Reader","Ext.data.DataReader"],requires:["Ext.data.ResultSet","Ext.XTemplate","Ext.util.LruCache"],mixins:["Ext.mixin.Observable","Ext.mixin.Factoryable"],alias:"reader.base",factoryConfig:{defaultType:null},config:{totalProperty:"total",successProperty:"success",rootProperty:"",messageProperty:"",typeProperty:"",implicitIncludes:true,readRecordsOnFailure:true,model:null,proxy:null,transform:null,keepRawData:null},isReader:true,constructor:function(A){if(A&&A.hasOwnProperty("root")){A=Ext.apply({},A);A.rootProperty=A.root;delete A.root;Ext.log.error('Ext.data.reader.Reader: Using the deprecated "root" configuration. Use "rootProperty" instead.')}var B=this;B.duringInit=1;B.mixins.observable.constructor.call(B,A);--B.duringInit;B.buildExtractors()},applyModel:function(A){return Ext.data.schema.Schema.lookupEntity(A)},applyTransform:function(A){if(A){if(Ext.isFunction(A)){A={fn:A}}else{if(A.charAt){A={fn:this[A]}}}return A.fn.bind(A.scope||this)}return A},forceBuildExtractors:function(){if(!this.duringInit){this.buildExtractors(true)}},updateTotalProperty:function(){this.forceBuildExtractors()},updateMessageProperty:function(){this.forceBuildExtractors()},updateSuccessProperty:function(){this.forceBuildExtractors()},read:function(B,D){var C,A;if(B){if(B.responseText){A=this.getResponseData(B);if(A&&A.__$isError){return new Ext.data.ResultSet({total:0,count:0,records:[],success:false,message:A.msg})}else{C=this.readRecords(A,D)}}else{C=this.readRecords(B,D)}}return C||this.nullResultSet},getNullResultSet:function(){return this.nullResultSet},createReadError:function(A){return{__$isError:true,msg:A}},readRecords:function(E,C,G){var H=this,F=G&&G.recordsOnly,L=G&&G.asRoot,M,D,B,J,I,K,N,A;A=this.getTransform();if(A){E=A(E)}H.buildExtractors();if(H.getKeepRawData()){H.rawData=E}if(H.hasListeners.rawdata){H.fireEventArgs("rawdata",[E])}E=H.getData(E);M=true;D=0;B=[];if(H.getSuccessProperty()){K=H.getSuccess(E);if(K===false||K==="false"){M=false}}if(H.getMessageProperty()){N=H.getMessage(E)}if(M||H.getReadRecordsOnFailure()){J=(L||Ext.isArray(E))?E:H.getRoot(E);if(J){I=J.length}if(H.getTotalProperty()){K=parseInt(H.getTotal(E),10);if(!isNaN(K)){I=K}}if(J){B=H.extractData(J,C);D=B.length}}return F?B:new Ext.data.ResultSet({total:I||D,count:D,records:B,success:M,message:N})},extractData:function(N,F){var L=this,G=F&&F.model?Ext.data.schema.Schema.lookupEntity(F.model):L.getModel(),D=G.schema,O=D.hasAssociations(G)&&L.getImplicitIncludes(),M=L.getFieldExtractorInfo(G.fieldExtractors),A=N.length,C=new Array(A),J=L.getTypeProperty(),K,B,E,I,H;if(!A&&Ext.isObject(N)){N=[N];A=1}for(H=0;H<A;H++){I=N[H];if(!I.isModel){B=I;if(J&&(E=L.getChildType(D,B,J))){K=E.getProxy().getReader();I=K.extractRecord(B,F,E,D.hasAssociations(E)&&K.getImplicitIncludes(),K.getFieldExtractorInfo(E.fieldExtractors))}else{I=L.extractRecord(B,F,G,O,M)}if(I.isModel&&I.isNode){I.raw=B}}if(I.onLoad){I.onLoad()}C[H]=I}return C},getChildType:function(B,C,D){var A;switch(typeof D){case"string":return B.getEntity(C[D]);case"object":A=D.namespace;return B.getEntity((A?A+".":"")+C[D.name]);case"function":return B.getEntity(D(C))}},extractRecordData:function(C,D){var B=D&&D.model?Ext.data.schema.Schema.lookupEntity(D.model):this.getModel(),A=this.getFieldExtractorInfo(B.fieldExtractors);return this.extractRecord(C,D,B,false,A)},extractRecord:function(A,B,C,I,G){var F=this,E=(B&&B.recordCreator)||F.defaultRecordCreator,H,D;H=F.extractModelData(A,G);D=E.call(F,H,C||F.getModel(),B);if(I&&D.isModel){F.readAssociated(D,A,B)}return D},getFieldExtractorInfo:function(C){if(!C){return }var A=this.$className,B=C[A];if(B===undefined){C[A]=B=this.buildFieldExtractors()}return B},buildFieldExtractors:function(){var G=this.getFields(),H=G.length,E=[],J=[],D=null,B=0,I,A,F,C;for(F=0;F<H;++F){I=G[F];C=this.createFieldAccessor(I);if(C){A=I.name;E.push("val = extractors["+B+"](raw); if (val !== undefined) { data['"+A+"'] = val; }");J.push(C);++B}}if(E.length){D={extractors:J,fn:new Function("raw","data","extractors","var val;"+E.join(""))}}return D},defaultRecordCreator:function(B,C){var A=new C(B);A.phantom=false;return A},getModelData:function(A){return{}},extractModelData:function(B,A){var D=this.getModelData(B),C;if(A){C=A.fn;C(B,D,A.extractors)}return D},readAssociated:function(A,E,D){var C=A.associations,B,F;for(B in C){if(C.hasOwnProperty(B)){F=C[B];if(F.cls){F.read(A,E,this,D)}}}},getFields:function(){return this.getModel().fields},getData:Ext.identityFn,getRoot:Ext.identityFn,getResponseData:function(A){Ext.raise("getResponseData must be implemented in the Ext.data.reader.Reader subclass")},onMetaChange:function(G){var F=this,B=G.fields,C,E,A,D;F.metaData=G;if(G.root){F.setRootProperty(G.root)}if(G.totalProperty){F.setTotalProperty(G.totalProperty)}if(G.successProperty){F.setSuccessProperty(G.successProperty)}if(G.messageProperty){F.setMessageProperty(G.messageProperty)}A=G.clientIdProperty;if(B){E=Ext.define(null,{extend:"Ext.data.Model",fields:B,clientIdProperty:A});F.setModel(E);D=F.getProxy();if(D){D.setModel(E)}}else{if(A){C=F.getModel();if(C){C.self.prototype.clientIdProperty=A}}}},buildExtractors:function(D){var B=this,C,A,E;if(D||!B.hasExtractors){C=B.getTotalProperty();A=B.getSuccessProperty();E=B.getMessageProperty();if(C){B.getTotal=B.getAccessor(C)}if(A){B.getSuccess=B.getAccessor(A)}if(E){B.getMessage=B.getAccessor(E)}B.hasExtractors=true;return true}},getAccessor:function(E){var D=this,A=D.extractorCache,B,C;if(typeof E==="string"){C=D.getAccessorKey(E);B=A.get(C);if(!B){B=D.createAccessor(E);A.add(C,B)}}else{B=D.createAccessor(E)}return B},getAccessorKey:function(A){return this.$className+A},createAccessor:Ext.emptyFn,createFieldAccessor:Ext.emptyFn,destroy:function(){var A=this;A.model=A.getTotal=A.getSuccess=A.getMessage=A.rawData=null;A.onMetaChange=null;A.transform=null;A.callParent()},privates:{copyFrom:function(A){var B=this;A.buildExtractors();B.getTotal=A.getTotal;B.getSuccess=A.getSuccess;B.getMessage=A.getMessage;++B.duringInit;B.setConfig(A.getConfig());--B.duringInit;B.hasExtractors=true}}},function(B){var A=B.prototype;Ext.apply(A,{nullResultSet:new Ext.data.ResultSet({total:0,count:0,records:[],success:true,message:""})});A.extractorCache=new Ext.util.LruCache()})