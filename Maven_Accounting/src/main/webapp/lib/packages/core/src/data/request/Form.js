Ext.define("Ext.data.request.Form",{extend:"Ext.data.request.Base",alias:"request.form",start:function(D){var C=this,B=C.options,A=C.requestOptions;C.callParent([D]);C.form=C.upload(B.form,A.url,A.data,B);return C},abort:function(B){var A=this,D;if(A.isLoading()){try{D=A.frame.dom;if(D.stop){D.stop()}else{D.document.execCommand("Stop")}}catch(C){}}A.callParent([B]);A.onComplete();A.cleanup()},cleanup:function(){var A=this,B=A.frame;if(B){B.un("load",A.onComplete,A);Ext.removeNode(B)}A.frame=A.form=null},isLoading:function(){return !!this.frame},upload:function(B,G,S,F){B=Ext.getDom(B);F=F||{};var Q=document.createElement("iframe"),K=Ext.get(Q),M=K.id,C=[],D="multipart/form-data",R={target:B.target,method:B.method,encoding:B.encoding,enctype:B.enctype,action:B.action},A=function(U,V){H=document.createElement("input");Ext.fly(H).set({type:"hidden",value:V,name:U});B.appendChild(H);C.push(H)},H,J,O,T,N,I,L,P,E;K.set({name:M,cls:Ext.baseCSSPrefix+"hidden-display",src:Ext.SSL_SECURE_URL,tabIndex:-1});document.body.appendChild(Q);if(document.frames){document.frames[M].name=M}Ext.fly(B).set({target:M,method:"POST",enctype:D,encoding:D,action:G||R.action});if(S){J=Ext.Object.fromQueryString(S)||{};for(T in J){if(J.hasOwnProperty(T)){O=J[T];if(Ext.isArray(O)){N=O.length;for(I=0;I<N;I++){A(T,O[I])}}else{A(T,O)}}}}this.frame=K;K.on({load:this.onComplete,scope:this,single:!Ext.isOpera});B.submit();Ext.fly(B).set(R);for(L=C.length,P=0;P<L;P++){Ext.removeNode(C[P])}return B},getDoc:function(){var A=this.frame.dom;return(A&&(A.contentWindow.document||A.contentDocument))||(window.frames[A.id]||{}).document},getTimeout:function(){return this.options.timeout},onComplete:function(){var F=this,B=F.frame,A=F.owner,J=F.options,H,G,I,D,C;if(!B){return }if(F.aborted||F.timedout){F.result=C=F.createException();C.responseXML=null;C.responseText='{success:false,message:"'+Ext.String.trim(C.statusText)+'"}';H=J.failure;I=false}else{try{G=F.getDoc();F.result=C={responseText:"",responseXML:null};if(G){if(Ext.isOpera&&G.location==Ext.SSL_SECURE_URL){return }if(G.body){if((D=G.body.firstChild)&&/pre/i.test(D.tagName)){C.responseText=D.textContent||D.innerText}else{if((D=G.getElementsByTagName("textarea")[0])){C.responseText=D.value}else{C.responseText=G.body.textContent||G.body.innerText}}}C.responseXML=G.XMLDocument||G;H=J.success;I=true;C.status=200}else{Ext.raise("Could not acquire a suitable connection for the file upload service.")}}catch(E){F.result=C=F.createException();C.status=400;C.statusText=(E.message||E.description)+"";C.responseText='{success:false,message:"'+Ext.String.trim(C.statusText)+'"}';C.responseXML=null;H=J.failure;I=false}}F.frame=null;F.success=I;A.fireEvent(I?"requestcomplete":"requestexception",A,C,J);Ext.callback(H,J.scope,[C,J]);Ext.callback(J.callback,J.scope,[J,I,C]);A.onRequestComplete(F);Ext.asap(B.destroy,B);F.callParent()},destroy:function(){this.cleanup();this.callParent()}})