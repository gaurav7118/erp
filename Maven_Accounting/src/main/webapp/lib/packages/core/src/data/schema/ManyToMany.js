Ext.define("Ext.data.schema.ManyToMany",{extend:"Ext.data.schema.Association",isManyToMany:true,isToMany:true,kind:"many-to-many",Left:Ext.define(null,{extend:"Ext.data.schema.Role",isMany:true,digitRe:/^\d+$/,findRecords:function(J,K,D){var L=J.getMatrixSlice(this.inverse,K.id),E=L.members,I=[],M=this.cls,A,G,H,B,F,C;if(D){A={};for(G=0,H=D.length;G<H;++G){C=D[G];B=C.id;F=E[B];if(!(F&&F[2]===-1)){I.push(C)}A[B]=true}}for(B in E){F=E[B];if(!A||!A[B]&&(F&&F[2]!==-1)){C=J.peekRecord(M,B);if(C){I.push(C)}}}return I},processLoad:function(B,A,E,D){var C=E;if(D){C=this.findRecords(D,A,E);this.onAddToMany(B,C,true)}return C},processUpdate:function(F,B){var G=this,D=G.inverse.cls,E=B.R,A,H,I,C;if(E){for(A in E){H=F.peekRecord(D,A);if(H){C=F.getEntityList(G.cls,E[A]);I=G.getAssociatedItem(H);if(I){I.loadData(C);I.complete=true}else{H[G.getterName](null,null,C)}}else{F.onInvalidAssociationEntity(D,A)}}}G.processMatrixBlock(F,B.C,1);G.processMatrixBlock(F,B.D,-1)},checkMembership:function(H,I){var J=H.getMatrix(this.association,true),G,D,E,L,M,A,C,F,B,K;if(!J){return }G=this.left?J.right:J.left;D=G.inverse.role.cls;E=this.inverse;M=G.slices;if(M){L=M[I.id];if(L){C=L.members;for(A in C){F=C[A];if(F[2]!==-1){B=H.peekRecord(D,A);if(B){K=E.getAssociatedItem(B);if(K){K.matrixUpdate=1;K.add(I);K.matrixUpdate=0}}}}}}},onStoreCreate:function(B,D,E){var C=this,A;if(D){A=D.getMatrixSlice(C.inverse,E);A.attach(B);A.notify=C.onMatrixUpdate;A.scope=C}},processMatrixBlock:function(E,D,C){var A=this.inverse,B=this.digitRe,F,G;if(D){for(G in D){if(B.test(G)){G=parseInt(G,10)}F=E.getMatrixSlice(A,G);F.update(D[G],C)}}},createGetter:function(){var A=this;return function(B,C,D){return A.getAssociatedStore(this,B,C,D,false)}},onAddToMany:function(A,C,B){if(!A.matrixUpdate){A.matrixUpdate=1;A.matrix.update(C,B===true?0:1);A.matrixUpdate=0}},onRemoveFromMany:function(B,A){if(!B.matrixUpdate){B.matrixUpdate=1;B.matrix.update(A,-1);B.matrixUpdate=0}},read:function(A,D,B,E){var C=this,F=C.callParent([A,D,B,E]);if(F){A[C.getterName](null,null,F);delete A.data[C.role]}},onMatrixUpdate:function(E,G,D){var A=E.store,B,F,C;if(A&&!A.loading&&!A.matrixUpdate){A.matrixUpdate=1;B=A.indexOfId(G);if(D<0){if(B>=0){A.remove([B])}}else{if(B<0){C=A.getSession().getEntry(this.type,G);F=C&&C.record;if(F){A.add(F)}}}A.matrixUpdate=0}},adoptAssociated:function(B,F){var D=this.getAssociatedItem(B),C,E,A;if(D){D.setSession(F);this.onStoreCreate(D,F,B.getId());C=D.getData().items;for(E=0,A=C.length;E<A;++E){F.adopt(C[E])}}}},function(){var A=this;Ext.ClassManager.onCreated(function(){Ext.data.schema.ManyToMany.prototype.Right=Ext.define(null,{extend:A,left:false,side:"right"})},null,"Ext.data.schema.ManyToMany")})})