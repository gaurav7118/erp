Ext.define("Ext.data.session.ChangesVisitor",{constructor:function(C){var A=this,B;A.session=C;B=C.getCrudProperties();A.result=null;A.writerOptions={};A.createKey=B.create;A.readKey=B.read;A.updateKey=B.update;A.dropKey=B.drop},onDirtyRecord:function(F){var I=this,L=I.crud,E=F.phantom,C=F.dropped,G=!E&&!C,J=F.$className,B=(E||C)?"allDataOptions":"partialDataOptions",H=I.writerOptions,A=F.entityName,N,D,K,M;if(E&&C){return false}L=E?I.createKey:(C?I.dropKey:I.updateKey);H=H[J]||(H[J]={});if(C){if(!(N=H.drop)){H.drop=N={all:F.getProxy().getWriter().getWriteAllFields()}}if(!N.all){K=F.id}}if(!K){if(!(N=H[B])){N=F.getProxy().getWriter().getConfig(B);H[B]=N=Ext.Object.chain(N);I.setupOptions(N)}K=F.getData(N)}M=I.result||(I.result={});D=M[A]||(M[A]={});D=D[L]||(D[L]=[]);D.push(K)},setupOptions:function(A){A.serialize=true},onMatrixChange:function(D,I,H,A){var G=this,B=D.left.type,F=D.right.role,E=A<0?G.dropKey:G.createKey,C,J;J=G.result||(G.result={});C=J[B]||(J[B]={});C=C[F]||(C[F]={});C=C[E]||(C[E]={});C=C[I]||(C[I]=[]);C.push(H)}})