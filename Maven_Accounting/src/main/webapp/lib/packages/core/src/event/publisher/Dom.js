Ext.define("Ext.event.publisher.Dom",{extend:"Ext.event.publisher.Publisher",requires:["Ext.event.Event"],type:"dom",handledDomEvents:[],reEnterCount:0,captureEvents:{animationstart:1,animationend:1,resize:1,focus:1,blur:1,scroll:1},directEvents:{mouseenter:1,mouseleave:1,pointerenter:1,pointerleave:1,MSPointerEnter:1,MSPointerLeave:1,load:1,unload:1,beforeunload:1,error:1,DOMContentLoaded:1,DOMFrameContentLoaded:1,hashchange:1},blockedPointerEvents:{pointerover:1,pointerout:1,pointerenter:1,pointerleave:1,MSPointerOver:1,MSPointerOut:1,MSPointerEnter:1,MSPointerLeave:1},blockedCompatibilityMouseEvents:{mouseenter:1,mouseleave:1},constructor:function(){var A=this;A.bubbleSubscribers={};A.captureSubscribers={};A.directSubscribers={};A.directCaptureSubscribers={};A.delegatedListeners={};A.initHandlers();Ext.onInternalReady(A.onReady,A);A.callParent()},registerEvents:function(){var F=this,D=Ext.event.publisher.Publisher.publishersByEvent,A=F.handledDomEvents,E=A.length,C=0,B;for(;C<E;C++){B=A[C];F.handles[B]=1;D[B]=F}this.callParent()},onReady:function(){var D=this,A=D.handledDomEvents,C,B;if(A){for(B=0,C=A.length;B<C;B++){D.addDelegatedListener(A[B])}}Ext.getWin().on("unload",D.destroy,D)},initHandlers:function(){var A=this;A.onDelegatedEvent=Ext.bind(A.onDelegatedEvent,A);A.onDirectEvent=Ext.bind(A.onDirectEvent,A);A.onDirectCaptureEvent=Ext.bind(A.onDirectCaptureEvent,A)},addDelegatedListener:function(A){this.delegatedListeners[A]=1;this.target.addEventListener(A,this.onDelegatedEvent,!!this.captureEvents[A])},removeDelegatedListener:function(A){delete this.delegatedListeners[A];this.target.removeEventListener(A,this.onDelegatedEvent,!!this.captureEvents[A])},addDirectListener:function(B,C,A){C.dom.addEventListener(B,A?this.onDirectCaptureEvent:this.onDirectEvent,A)},removeDirectListener:function(B,C,A){C.dom.removeEventListener(B,A?this.onDirectCaptureEvent:this.onDirectEvent,A)},subscribe:function(C,B,F,A){var D=this,E,G;if(F&&!D.directEvents[B]){E=A?D.captureSubscribers:D.bubbleSubscribers;if(!D.handles[B]&&!D.delegatedListeners[B]){D.addDelegatedListener(B)}if(E[B]){++E[B]}else{E[B]=1}}else{E=A?D.directCaptureSubscribers:D.directSubscribers;G=C.id;E=E[B]||(E[B]={});if(E[G]){++E[G]}else{E[G]=1;D.addDirectListener(B,C,A)}}},unsubscribe:function(E,F,B,I){var H=this,G,D,A,C;if(B&&!H.directEvents[F]){G=H.captureSubscribers;D=H.bubbleSubscribers;A=I?G:D;if(A[F]){--A[F]}if(!H.handles[F]&&!D[F]&&!G[F]){this.removeDelegatedListener(F)}}else{A=I?H.directCaptureSubscribers:H.directSubscribers;C=E.id;A=A[F];if(A[C]){--A[C]}if(!A[C]){delete A[C];H.removeDirectListener(F,E,I)}}},getPropagatingTargets:function(D){var C=D,B=[],A;while(C){B.push(C);A=C.parentNode;if(!A){A=C.defaultView}C=A}return B},publish:function(B,H,G){var F=this,A,D,C,E;if(Ext.isArray(H)){A=H}else{if(F.captureEvents[B]){D=Ext.cache[H.id];A=D?[D]:[]}else{A=F.getPropagatingTargets(H)}}E=A.length;if(F.captureSubscribers[B]){for(C=E;C--;){D=Ext.cache[A[C].id];if(D){F.fire(D,B,G,false,true);if(G.isStopped){break}}}}if(!G.isStopped&&F.bubbleSubscribers[B]){for(C=0;C<E;C++){D=Ext.cache[A[C].id];if(D){F.fire(D,B,G,false,false);if(G.isStopped){break}}}}},fire:function(C,B,E,F,A){var D;if(C.hasListeners[B]){D=C.events[B];if(D){if(A&&F){D=D.directCaptures}else{if(A){D=D.captures}else{if(F){D=D.directs}}}if(D){E.setCurrentTarget(C.dom);D.fire(E,E.target)}}}},onDelegatedEvent:function(A){if(Ext.elevateFunction){Ext.elevateFunction(this.doDelegatedEvent,this,[A])}else{this.doDelegatedEvent(A)}},doDelegatedEvent:function(D,C){var B=this,A=D.timeStamp;D=new Ext.event.Event(D);if(B.isEventBlocked(D)){return false}B.beforeEvent(D);Ext.frameStartTime=A;B.reEnterCount++;B.publish(D.type,D.target,D);B.reEnterCount--;if(C!==false){B.afterEvent(D)}return D},onDirectEvent:function(A){if(Ext.elevateFunction){Ext.elevateFunction(this.doDirectEvent,this,[A,false])}else{this.doDirectEvent(A,false)}},onDirectCaptureEvent:function(A){if(Ext.elevateFunction){Ext.elevateFunction(this.doDirectEvent,this,[A,true])}else{this.doDirectEvent(A,true)}},doDirectEvent:function(F,B){var D=this,E=F.currentTarget,A=F.timeStamp,C;F=new Ext.event.Event(F);if(D.isEventBlocked(F)){return }D.beforeEvent(F);Ext.frameStartTime=A;C=Ext.cache[E.id];if(C){D.reEnterCount++;D.fire(C,F.type,F,true,B);D.reEnterCount--}D.afterEvent(F)},beforeEvent:function(C){var E=C.browserEvent,A=Ext.event.publisher.Dom,B,D;if(E.type==="touchstart"){B=E.touches;if(B.length===1){D=B[0];A.lastTouchStartX=D.pageX;A.lastTouchStartY=D.pageY}}},afterEvent:function(D){var E=D.browserEvent,C=E.type,B=Ext.event.publisher.Dom,A=Ext.GlobalEvents;if(D.self.pointerEvents[C]&&D.pointerType!=="mouse"){B.lastScreenPointerEventTime=Ext.now()}if(C==="touchend"){B.lastTouchEndTime=Ext.now()}if(!this.reEnterCount&&A.hasListeners.idle&&!A.idleEventMask[C]){A.fireEvent("idle")}},isEventBlocked:function(E){var D=this,C=E.type,A=Ext.event.publisher.Dom,B=Ext.now();if(Ext.isGecko&&E.type==="click"&&E.button===2){return true}return(D.blockedPointerEvents[C]&&E.pointerType!=="mouse")||(D.blockedCompatibilityMouseEvents[C]&&(B-A.lastScreenPointerEventTime<1000))||(Ext.supports.TouchEvents&&E.self.mouseEvents[E.type]&&Math.abs(E.pageX-A.lastTouchStartX)<15&&Math.abs(E.pageY-A.lastTouchStartY)<15&&(Ext.now()-A.lastTouchEndTime)<1000)},destroy:function(){var A;for(A in this.delegatedListeners){this.removeDelegatedListener(A)}this.callParent()},reset:function(){var A=Ext.event.publisher.Dom;A.lastScreenPointerEventTime=A.lastTouchEndTime=A.lastTouchStartX=A.lastTouchStartY=undefined}},function(B){var D=document,C=D.defaultView,A=B.prototype;if((Ext.os.is.iOS&&Ext.os.version.getMajor()<5)||Ext.browser.is.AndroidStock||!(C&&C.addEventListener)){A.target=D}else{A.target=C}B.instance=new B()})