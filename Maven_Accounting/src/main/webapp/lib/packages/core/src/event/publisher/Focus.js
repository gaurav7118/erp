Ext.define("Ext.event.publisher.Focus",{extend:"Ext.event.publisher.Dom",requires:["Ext.dom.Element","Ext.GlobalEvents"],type:"focus",handledEvents:["focusenter","focusleave","focusmove"],handledDomEvents:["focusin","focusout"],doDelegatedEvent:function(D,C){var B=this,A;D=B.callParent([D,false]);if(D){if(D.type==="focusout"){if(D.relatedTarget==null){B.processFocusIn(D,D.target,document.body,C)}}else{A=D.relatedTarget;B.processFocusIn(D,(A==null||!A.tagName)?document.body:A,D.target,C)}}},processFocusIn:function(H,I,C,K){var J=this,L,B,G=[],A,F,E,D;E=Ext.fly(I);D=Ext.fly(C);if((E&&E.isFocusSuspended())||(D&&D.isFocusSuspended())){return }for(B=I,L=Ext.dom.Element.getCommonAncestor(C,I,true);B&&B!==L;B=B.parentNode){G.push(B)}if(G.length){A=J.createSyntheticEvent("focusleave",H,I,C);J.publish("focusleave",G,A);if(A.isStopped){return }}G.length=0;for(B=C;B!==L;B=B.parentNode){G.push(B)}F=J.createSyntheticEvent("focusenter",H,C,I);if(G.length){J.publish("focusenter",G,F);if(F.isStopped){return }}G=J.getPropagatingTargets(L);if(G.length){A=J.createSyntheticEvent("focusmove",H,C,I);J.publish("focusmove",G,A);if(A.isStopped){return }}if(K){J.afterEvent(H)}Ext.GlobalEvents.fireEvent("focus",{event:F,toElement:C,fromElement:I})},createSyntheticEvent:function(B,E,D,A){var C=new Ext.event.Event(E);C.type=B;C.relatedTarget=A;C.target=D;return C}},function(B){var A;B.instance=new B();if(!Ext.supports.FocusinFocusoutEvents){this.override({handledDomEvents:["focus","blur"],doDelegatedEvent:function(F,E){var D=this;F=D.callSuper([F,false]);if(F){clearTimeout(A);A=0;if(F.type==="blur"){var C=F.target===window?document.body:F.target;A=setTimeout(function(){A=0;D.processFocusIn(F,C,document.body,E);B.previousActiveElement=null},0);if(F.target===window||F.target===document){B.previousActiveElement=null}else{B.previousActiveElement=F.target}}else{D.processFocusIn(F,B.previousActiveElement||document.body,F.target===window?document.body:F.target,E)}}}})}})