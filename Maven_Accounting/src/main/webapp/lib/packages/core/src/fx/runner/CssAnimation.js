Ext.define("Ext.fx.runner.CssAnimation",{extend:"Ext.fx.runner.Css",constructor:function(){this.runningAnimationsMap={};this.elementEndStates={};this.animationElementMap={};this.keyframesRulesCache={};this.uniqueId=0;return this.callParent(arguments)},attachListeners:function(){this.listenersAttached=true;Ext.getWin().on({animationstart:"onAnimationStart",animationend:"onAnimationEnd",scope:this})},onAnimationStart:function(F){var B=F.browserEvent.animationName,A=this.animationElementMap[B],E=this.runningAnimationsMap[A][B],G=this.elementEndStates,C=G[A],D={};if(C){delete G[A];D[A]=C;this.applyStyles(D)}if(E.before){D[A]=E.before;this.applyStyles(D)}},onAnimationEnd:function(H){var C=H.target,B=H.browserEvent.animationName,D=this.animationElementMap,A=D[B],E=this.runningAnimationsMap,G=E[A],F=G[B];if(F.onBeforeEnd){F.onBeforeEnd.call(F.scope||this,C)}if(F.onEnd){F.onEnd.call(F.scope||this,C)}delete D[B];delete G[B];this.removeKeyframesRule(B)},generateAnimationId:function(){return"animation-"+(++this.uniqueId)},run:function(F){var R={},S=this.elementEndStates,N=this.animationElementMap,Q=this.runningAnimationsMap,B,D,H,J,O,G,P,T,L,K,C,E,A,I,M;if(!this.listenersAttached){this.attachListeners()}F=Ext.Array.from(F);for(O=0,G=F.length;O<G;O++){P=F[O];P=Ext.factory(P,Ext.fx.Animation);H=P.getElement().getId();J=P.getName()||this.generateAnimationId();N[J]=H;P=P.getData();D=P.states;this.addKeyframesRule(J,D);B=Q[H];if(!B){B=Q[H]={}}B[J]=P;K=[];C=[];E=[];A=[];I=[];M=[];for(T in B){if(B.hasOwnProperty(T)){L=B[T];K.push(T);C.push(L.duration);E.push(L.easing);A.push(L.delay);I.push(L.direction);M.push(L.iteration)}}R[H]={"animation-name":K,"animation-duration":C,"animation-timing-function":E,"animation-delay":A,"animation-direction":I,"animation-iteration-count":M};if(P.preserveEndState){S[H]=D["100%"]}}this.applyStyles(R)},addKeyframesRule:function(A,C){var K,E,B,G,I,J,D,H,F;G=this.getStyleSheet();I=G.cssRules;D=I.length;G.insertRule("@"+this.vendorPrefix+"keyframes "+A+"{}",D);B=I[D];for(K in C){E=C[K];I=B.cssRules;D=I.length;J=[];for(H in E){F=this.formatValue(E[H],H);H=this.formatName(H);J.push(H+":"+F)}B.insertRule(K+"{"+J.join(";")+"}",D)}return this},removeKeyframesRule:function(A){var F=this.getStyleSheet(),E=F.cssRules,B,C,D;for(B=0,C=E.length;B<C;B++){D=E[B];if(D.name===A){F.removeRule(B);break}}return this}})