Ext.define("Ext.util.LocalStorage",{id:null,destroyed:false,lazyKeys:true,prefix:"",session:false,_keys:null,_store:null,_users:0,statics:{cache:{},get:function(E){var D=this,B=D.cache,C={_users:1},A;if(Ext.isString(E)){C.id=E}else{Ext.apply(C,E)}if(!(A=B[C.id])){A=new D(C)}else{if(A===true){Ext.raise('Creating a shared instance of private local store "'+D.id+'".')}++A._users}return A},supported:true},constructor:function(A){var B=this;Ext.apply(B,A);if(!B.hasOwnProperty("id")){Ext.raise("No id was provided to the local store.")}if(B._users){Ext.util.LocalStorage.cache[B.id]=B}else{if(Ext.util.LocalStorage.cache[B.id]){Ext.raise('Cannot create duplicate instance of local store "'+B.id+'". Use Ext.util.LocalStorage.get() to share instances.')}Ext.util.LocalStorage.cache[B.id]=true}B.init()},init:function(){var A=this,B=A.id;if(!A.prefix&&B){A.prefix=B+"-"}A._store=(A.session?window.sessionStorage:window.localStorage)},destroy:function(){var A=this;if(A._users){Ext.log.warn("LocalStorage(id="+A.id+") destroyed while in use")}delete Ext.util.LocalStorage.cache[A.id];A._store=A._keys=null;A.callParent()},getKeys:function(){var E=this,A=E._store,F=E.prefix,D=E._keys,G=F.length,C,B;if(!D){E._keys=D=[];for(C=A.length;C--;){B=A.key(C);if(B.length>G){if(F===B.substring(0,G)){D.push(B.substring(G))}}}}return D},release:function(){if(!--this._users){this.destroy()}},save:Ext.emptyFn,clear:function(){var D=this,A=D._store,E=D.prefix,C=D._keys||D.getKeys(),B;for(B=C.length;B--;){A.removeItem(E+C[B])}C.length=0},key:function(A){var B=this._keys||this.getKeys();return(0<=A&&A<B.length)?B[A]:null},getItem:function(B){var A=this.prefix+B;return this._store.getItem(A)},removeItem:function(C){var F=this,B=F.prefix+C,A=F._store,E=F._keys,D=A.length;A.removeItem(B);if(E&&D!==A.length){if(F.lazyKeys){F._keys=null}else{Ext.Array.remove(E,C)}}},setItem:function(C,G){var F=this,B=F.prefix+C,A=F._store,E=A.length,D=F._keys;A.setItem(B,G);if(D&&E!==A.length){D.push(C)}}},function(){var A=this;if("localStorage" in window){return }if(!Ext.isIE){A.supported=false;A.prototype.init=function(){Ext.raise("Local storage is not supported on this browser")};return }A.override({data:null,flushDelay:1,init:function(){var C=this,D=C.data,B;C.el=B=document.createElement("div");B.id=(C.id||(C.id="extjs-localstore"));B.addBehavior("#default#userdata");Ext.getHead().dom.appendChild(B);B.load(C.id);D=B.getAttribute("xdata");C.data=D=(D?Ext.decode(D):{});C._flushFn=function(){C._timer=null;C.save(0)}},destroy:function(){var C=this,B=C.el;if(B){if(C._timer){C.save()}B.parentNode.removeChild(B);C.data=C.el=null;C.callParent()}},getKeys:function(){var C=this,B=C._keys;if(!B){C._keys=B=Ext.Object.getKeys(C.data)}return B},save:function(B){var C=this;if(!B){if(C._timer){clearTimeout(C._timer);C._timer=null}C.el.setAttribute("xdata",Ext.encode(C.data));C.el.save(C.id)}else{if(!C._timer){C._timer=Ext.defer(C._flushFn,B)}}},clear:function(){var B=this;B.data={};B._keys=null;B.save(B.flushDelay)},getItem:function(B){var C=this.data;return(B in C)?C[B]:null},removeItem:function(B){var D=this,C=D._keys,E=D.data;if(B in E){delete E[B];if(C){if(D.lazyKeys){D._keys=null}else{Ext.Array.remove(C,B)}}D.save(D.flushDelay)}},setItem:function(B,F){var D=this,E=D.data,C=D._keys;if(C&&!(B in E)){C.push(B)}E[B]=F;D.save(D.flushDelay)}})})