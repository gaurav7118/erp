describe("Ext.Widget",function(){var B;function C(E,D){Ext.define("spec.Widget",Ext.apply({extend:"Ext.Widget"},D));if(!E){var E=new spec.Widget();E.destroy()}}afterEach(function(){if(B){B.destroy()}Ext.undefine("spec.Widget")});function A(D){describe(D?"first instance":"second instance",function(){it("should have an element when 'element' reference is defined on the main element",function(){C(D);B=new spec.Widget();expect(B.element instanceof Ext.dom.Element).toBe(true);expect(B.el).toBe(B.element)});if(D){it("should throw an error when no 'element' reference is defined",function(){C(D,{element:{}});function E(){new spec.Widget()}expect(E).toThrow("No 'element' reference found in 'spec.Widget' template.")});it("should throw an error if multiple 'element' references are defined",function(){C(D,{element:{reference:"element",children:[{reference:"element"}]}});function E(){new spec.Widget()}expect(E).toThrow("Duplicate 'element' reference detected in 'spec.Widget' template.")})}it("should allow the 'element' reference to be a descendant of the main template element",function(){C(D,{element:{children:[{cls:"foo",reference:"element"}]}});B=new spec.Widget();expect(B.element.dom.className).toBe("foo")});it("should resolve element references, and remove the 'reference' attributes from the dom",function(){C(D,{element:{reference:"element",children:[{cls:"foo",reference:"foo",children:[{cls:"baz",reference:"baz"}]},{cls:"bar",reference:"bar"}]}});B=new spec.Widget();expect(B.foo instanceof Ext.dom.Element).toBe(true);expect(B.foo.dom.className).toBe("foo");expect(B.foo.dom.getAttribute("reference")).toBeNull();expect(B.bar instanceof Ext.dom.Element).toBe(true);expect(B.bar.dom.className).toBe("bar");expect(B.bar.dom.getAttribute("reference")).toBeNull();expect(B.baz instanceof Ext.dom.Element).toBe(true);expect(B.baz.dom.className).toBe("baz");expect(B.baz.dom.getAttribute("reference")).toBeNull();expect(B.element.dom.getAttribute("reference")).toBeNull()});it("should set skipGarbageCollection on element references",function(){C(D,{element:{reference:"element",children:[{reference:"foo"}]}});B=new spec.Widget();expect(B.element.skipGarbageCollection).toBe(true);expect(B.foo.skipGarbageCollection).toBe(true)});it("should generate an id if not configured",function(){C(D);B=new spec.Widget();expect(B.id).toBeDefined();expect(B.element.id).toBe(B.id)});it("should use configured id",function(){var E="my-widget";C(D);B=new spec.Widget({id:E});expect(B.id).toBe(E);expect(B.element.id).toBe(E)});it("should add a listener to the main element",function(){var E=jasmine.createSpy();C(D,{element:{reference:"element",listeners:{click:"onClick"}},onClick:E});B=new spec.Widget();Ext.getBody().appendChild(B.element);jasmine.fireMouseEvent(B.element,"click");expect(E).toHaveBeenCalled();expect(E.mostRecentCall.object).toBe(B);B.destroy()});it("should add listeners to child elements",function(){var E,G,K,I,F=jasmine.createSpy(),H=jasmine.createSpy(),L=jasmine.createSpy(),J=jasmine.createSpy();C(D,{element:{reference:"element",children:[{reference:"foo",listeners:{click:"fooClick"}},{cls:"bar",reference:"bar",listeners:{click:{fn:"barClick"}},children:[{reference:"baz",listeners:{click:"bazClick"},scope:{}},{reference:"jazz",listeners:{click:{fn:"jazzClick",scope:{}}}}]}]},fooClick:F,barClick:H,bazClick:L,jazzClick:J});B=new spec.Widget();Ext.getBody().appendChild(B.element);jasmine.fireMouseEvent(B.foo,"click");expect(F).toHaveBeenCalled();expect(F.mostRecentCall.object).toBe(B);jasmine.fireMouseEvent(B.bar,"click");expect(H).toHaveBeenCalled();expect(H.mostRecentCall.object).toBe(B);jasmine.fireMouseEvent(B.baz,"click");expect(L).toHaveBeenCalled();expect(L.mostRecentCall.object).toBe(B);jasmine.fireMouseEvent(B.jazz,"click");expect(J).toHaveBeenCalled();expect(J.mostRecentCall.object).toBe(B);B.destroy()})})}A(true);A(false);describe("element listener merging",function(){var D,F,G,E;it("should not allow listeners declared in a subclass to pollute the superclass cache (no listeners on superclass)",function(){D=Ext.define(null,{extend:Ext.Widget});F=Ext.define(null,{extend:D,element:{reference:"element",listeners:{click:"onClick"}},onClick:Ext.emptyFn});G=new D();E=new F();expect(D.prototype._elementListeners).toEqual({});expect(F.prototype.hasOwnProperty("_elementListeners")).toBe(true);Ext.destroy(E,G)});it("should not allow listeners declared in a subclass to pollute the superclass cache (with listeners on superclass)",function(){D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",listeners:{mousedown:"onMouseDown"}},onMouseDown:Ext.emptyFn});F=Ext.define(null,{extend:D,element:{reference:"element",listeners:{click:"onClick"}},onClick:Ext.emptyFn});G=new D();E=new F();expect(D.prototype._elementListeners).toEqual({element:{mousedown:"onMouseDown"}});expect(F.prototype.hasOwnProperty("_elementListeners")).toBe(true);Ext.destroy(E,G)});describe("when first instance of superclass has already been created",function(){var M,K,J,I,H,L;beforeEach(function(){M=jasmine.createSpy();K=jasmine.createSpy();J=jasmine.createSpy();I=jasmine.createSpy();H=jasmine.createSpy();L=jasmine.createSpy()});afterEach(function(){if(G){G.destroy()}if(E){E.destroy()}});it("should merge subclass element listeners with superclass element listeners",function(){D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",listeners:{click:"superOnClick",mousedown:"superOnMouseDown"}},superOnClick:J,superOnMouseDown:M});F=Ext.define(null,{extend:D,element:{reference:"element",listeners:{click:"subOnClick",mouseup:"subOnMouseUp"}},subOnClick:L,subOnMouseUp:H});G=new D();E=new F();Ext.getBody().appendChild(E.element);jasmine.fireMouseEvent(E.element,"click");expect(M.callCount).toBe(1);expect(J).not.toHaveBeenCalled();expect(L.callCount).toBe(1);expect(H.callCount).toBe(1)});it("should inherit element listeners from superclass",function(){D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",listeners:{click:"superOnClick"}},superOnClick:J});F=Ext.define(null,{extend:D});G=new D();E=new F();Ext.getBody().appendChild(E.element);jasmine.fireMouseEvent(E.element,"click");expect(J.callCount).toBe(1)});it("should merge subclass child element listeners with superclass child element listeners",function(){D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",children:[{reference:"foo",listeners:{click:"superOnClick",mousedown:"superOnMouseDown"}}]},superOnClick:J,superOnMouseDown:M});F=Ext.define(null,{extend:D,element:{reference:"element",children:[{reference:"foo",listeners:{click:"subOnClick",mouseup:"subOnMouseUp"}}]},subOnClick:L,subOnMouseUp:H});G=new D();E=new F();Ext.getBody().appendChild(E.element);jasmine.fireMouseEvent(E.foo,"click");expect(M.callCount).toBe(1);expect(J).not.toHaveBeenCalled();expect(L.callCount).toBe(1);expect(H.callCount).toBe(1)});it("should inherit child element listeners from superclass",function(){D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",children:[{reference:"foo",listeners:{click:"superOnClick"}}]},superOnClick:J});F=Ext.define(null,{extend:D});G=new D();E=new F();Ext.getBody().appendChild(E.element);jasmine.fireMouseEvent(E.foo,"click");expect(J.callCount).toBe(1)});it("should add listeners to subclass child elements that do not have a corresponding reference in the superclass template",function(){D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",children:[{reference:"foo",listeners:{click:"superOnClick"}}]},superOnClick:J});F=Ext.define(null,{extend:D,element:{reference:"element",children:[{reference:"bar",listeners:{click:"subOnClick"}}]},subOnClick:L});G=new D();E=new F();Ext.getBody().appendChild(E.element);jasmine.fireMouseEvent(E.bar,"click");expect(J.callCount).toBe(0);expect(L.callCount).toBe(1)});it("should merge subclass element listeners with superclass element listeners (multiple levels of inheritance)",function(){var O=jasmine.createSpy(),N;D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",listeners:{click:"superOnClick",mousedown:"superOnMouseDown"}},superOnClick:J,superOnMouseDown:M});F=Ext.define(null,{extend:D,element:{reference:"element",listeners:{click:"subOnClick",mouseup:"subOnMouseUp"}},subOnClick:L,subOnMouseUp:H});N=Ext.define(null,{extend:F,element:{reference:"element",listeners:{mouseup:"onMouseUp"}},onMouseUp:O});G=new D();E=new F();B=new N();Ext.getBody().appendChild(B.element);jasmine.fireMouseEvent(B.element,"click");expect(M.callCount).toBe(1);expect(J).not.toHaveBeenCalled();expect(L.callCount).toBe(1);expect(H).not.toHaveBeenCalled();expect(O.callCount).toBe(1)});it("should inherit child element listeners from superclass over multiple inheritance levels",function(){var N;D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",children:[{reference:"foo",listeners:{click:"superOnClick"}}]},superOnClick:J});F=Ext.define(null,{extend:D});N=Ext.define(null,{extend:F});G=new D();E=new F();B=new N();Ext.getBody().appendChild(B.element);jasmine.fireMouseEvent(B.foo,"click");expect(J.callCount).toBe(1)})});describe("when first instance of superclass has not yet been created",function(){var M,K,J,I,H,L;beforeEach(function(){M=jasmine.createSpy();K=jasmine.createSpy();J=jasmine.createSpy();I=jasmine.createSpy();H=jasmine.createSpy();L=jasmine.createSpy()});afterEach(function(){if(G){G.destroy()}if(E){E.destroy()}});it("should merge subclass element listeners with superclass element listeners",function(){D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",listeners:{click:"superOnClick",mousedown:"superOnMouseDown"}},superOnClick:J,superOnMouseDown:M});F=Ext.define(null,{extend:D,element:{reference:"element",listeners:{click:"subOnClick",mouseup:"subOnMouseUp"}},subOnClick:L,subOnMouseUp:H});E=new F();Ext.getBody().appendChild(E.element);jasmine.fireMouseEvent(E.element,"click");expect(M.callCount).toBe(1);expect(J).not.toHaveBeenCalled();expect(L.callCount).toBe(1);expect(H.callCount).toBe(1)});it("should inherit element listeners from superclass",function(){D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",listeners:{click:"superOnClick"}},superOnClick:J});F=Ext.define(null,{extend:D});E=new F();Ext.getBody().appendChild(E.element);jasmine.fireMouseEvent(E.element,"click");expect(J.callCount).toBe(1)});it("should merge subclass child element listeners with superclass child element listeners",function(){D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",children:[{reference:"foo",listeners:{click:"superOnClick",mousedown:"superOnMouseDown"}}]},superOnClick:J,superOnMouseDown:M});F=Ext.define(null,{extend:D,element:{reference:"element",children:[{reference:"foo",listeners:{click:"subOnClick",mouseup:"subOnMouseUp"}}]},subOnClick:L,subOnMouseUp:H});E=new F();Ext.getBody().appendChild(E.element);jasmine.fireMouseEvent(E.foo,"click");expect(M.callCount).toBe(1);expect(J).not.toHaveBeenCalled();expect(L.callCount).toBe(1);expect(H.callCount).toBe(1)});it("should inherit child element listeners from superclass",function(){D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",children:[{reference:"foo",listeners:{click:"superOnClick"}}]},superOnClick:J});F=Ext.define(null,{extend:D});E=new F();Ext.getBody().appendChild(E.element);jasmine.fireMouseEvent(E.foo,"click");expect(J.callCount).toBe(1)});it("should add listeners to subclass child elements that do not have a corresponding reference in the superclass template",function(){D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",children:[{reference:"foo",listeners:{click:"superOnClick"}}]},superOnClick:J});F=Ext.define(null,{extend:D,element:{reference:"element",children:[{reference:"bar",listeners:{click:"subOnClick"}}]},subOnClick:L});E=new F();Ext.getBody().appendChild(E.element);jasmine.fireMouseEvent(E.bar,"click");expect(J.callCount).toBe(0);expect(L.callCount).toBe(1)});it("should merge subclass element listeners with superclass element listeners (multiple levels of inheritance)",function(){var O=jasmine.createSpy(),N;D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",listeners:{click:"superOnClick",mousedown:"superOnMouseDown"}},superOnClick:J,superOnMouseDown:M});F=Ext.define(null,{extend:D,element:{reference:"element",listeners:{click:"subOnClick",mouseup:"subOnMouseUp"}},subOnClick:L,subOnMouseUp:H});N=Ext.define(null,{extend:F,element:{reference:"element",listeners:{mouseup:"onMouseUp"}},onMouseUp:O});B=new N();Ext.getBody().appendChild(B.element);jasmine.fireMouseEvent(B.element,"click");expect(M.callCount).toBe(1);expect(J).not.toHaveBeenCalled();expect(L.callCount).toBe(1);expect(H).not.toHaveBeenCalled();expect(O.callCount).toBe(1)});it("should inherit child element listeners from superclass over multiple inheritance levels",function(){var N;D=Ext.define(null,{extend:Ext.Widget,element:{reference:"element",children:[{reference:"foo",listeners:{click:"superOnClick"}}]},superOnClick:J});F=Ext.define(null,{extend:D});N=Ext.define(null,{extend:F});B=new N();Ext.getBody().appendChild(B.element);jasmine.fireMouseEvent(B.foo,"click");expect(J.callCount).toBe(1)})})});describe("listener scope resolution",function(){var K,Q,N,L,F,P,M,E,I,J,D;function H(R){F=Ext.define(null,Ext.apply({extend:"Ext.Container",onFoo:K.parent},R))}function O(R){M=Ext.define(null,Ext.apply({extend:"Ext.Container",onFoo:K.grandparent},R))}function G(T){var U={widget:L,controller:L.getController(),parent:P,parentController:P&&P.getController(),grandparent:E,grandparentController:E&&E.getController()},R,S;for(R in K){S=K[R];if(R===T){expect(S).toHaveBeenCalled();expect(S.mostRecentCall.object).toBe(U[R])}else{expect(S).not.toHaveBeenCalled()}}}beforeEach(function(){K={widget:jasmine.createSpy(),controller:jasmine.createSpy(),parent:jasmine.createSpy(),parentController:jasmine.createSpy(),grandparent:jasmine.createSpy(),grandparentController:jasmine.createSpy()};I=Ext.define(null,{extend:"Ext.app.ViewController",onFoo:K.controller});J=Ext.define(null,{extend:"Ext.app.ViewController",onFoo:K.parentController});D=Ext.define(null,{extend:"Ext.app.ViewController",onFoo:K.grandparentController})});afterEach(function(){if(L){L.destroy()}if(P){P.destroy()}if(E){E.destroy()}});describe("listener declared on class body",function(){function R(S){N=Ext.define(null,Ext.merge({extend:"Ext.Widget",listeners:{foo:"onFoo"},onFoo:K.widget},S))}it("should resolve to the widget with unspecified scope",function(){R();L=new N();L.fireEvent("foo");G("widget")});it("should fail with scope:'controller'",function(){R({listeners:{scope:"controller"}});L=new N();expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){R({listeners:{scope:"this"}});L=new N();L.fireEvent("foo");G("widget")});describe("with view controller",function(){it("should resolve to the view controller with unspecified scope",function(){R({controller:new I()});L=new N();L.fireEvent("foo");G("controller")});it("should resolve to the view controller with scope:'controller'",function(){R({controller:new I(),listeners:{scope:"controller"}});L=new N();L.fireEvent("foo");G("controller")});it("should resolve to the widget with scope:'this'",function(){R({controller:new I(),listeners:{scope:"this"}});L=new N();L.fireEvent("foo");G("widget")})});describe("with defaultListenerScope",function(){it("should resolve to the widget with unspecified scope",function(){R({defaultListenerScope:true});L=new N();L.fireEvent("foo");G("widget")});it("should fail with scope:'controller'",function(){R({defaultListenerScope:true,listeners:{scope:"controller"}});L=new N();expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){R({defaultListenerScope:true,listeners:{scope:"this"}});L=new N();L.fireEvent("foo");G("widget")})});describe("with view controller and defaultListenerScope",function(){it("should resolve to the widget with unspecified scope",function(){R({controller:new I(),defaultListenerScope:true});L=new N();L.fireEvent("foo");G("widget")});it("should resolve to the view controller with scope:'controller'",function(){R({controller:new I(),defaultListenerScope:true,listeners:{scope:"controller"}});L=new N();L.fireEvent("foo");G("controller")});it("should resolve to the widget with scope:'this'",function(){R({controller:new I(),defaultListenerScope:true,listeners:{scope:"this"}});L=new N();L.fireEvent("foo");G("widget")})});describe("with defaultListenerScope on parent",function(){beforeEach(function(){H({defaultListenerScope:true})});it("should resolve to the parent with unspecified scope",function(){R();L=new N();P=new F({items:L});L.fireEvent("foo");G("parent")});it("should fail with scope:'controller'",function(){R({listeners:{scope:"controller"}});L=new N();P=new F({items:L});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){R({listeners:{scope:"this"}});L=new N();P=new F({items:L});L.fireEvent("foo");G("widget")})});describe("with view controller on parent",function(){beforeEach(function(){H({controller:new J()})});it("should resolve to the parent view controller with unspecified scope",function(){R();L=new N();P=new F({items:L});L.fireEvent("foo");G("parentController")});it("should resolve to the parent view controller with scope:'controller'",function(){R({listeners:{scope:"controller"}});L=new N();P=new F({items:L});L.fireEvent("foo");G("parentController")});it("should resolve to the widget with scope:'this'",function(){R({listeners:{scope:"this"}});L=new N();P=new F({items:L});L.fireEvent("foo");G("widget")})});describe("with view controller and defaultListenerScope on parent",function(){beforeEach(function(){H({controller:new J(),defaultListenerScope:true})});it("should resolve to the parent with unspecified scope",function(){R();L=new N();P=new F({items:L});L.fireEvent("foo");G("parent")});it("should resolve to the parent view controller with scope:'controller'",function(){R({listeners:{scope:"controller"}});L=new N();P=new F({items:L});L.fireEvent("foo");G("parentController")});it("should resolve to the widget with scope:'this'",function(){R({listeners:{scope:"this"}});L=new N();P=new F({items:L});L.fireEvent("foo");G("widget")})});describe("with defaultListenerScope on grandparent",function(){beforeEach(function(){O({defaultListenerScope:true})});it("should resolve to the grandparent with unspecified scope",function(){R();L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("grandparent")});it("should fail with scope:'controller'",function(){R({listeners:{scope:"controller"}});L=new N();E=new M({items:{items:L}});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){R({listeners:{scope:"this"}});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("widget")})});describe("with view controller on grandparent",function(){beforeEach(function(){O({controller:new D()})});it("should resolve to the grandparent view controller with unspecified scope",function(){R();L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("grandparentController")});it("should resolve to the grandparent view controller with scope:'controller'",function(){R({listeners:{scope:"controller"}});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("grandparentController")});it("should resolve to the widget with scope:'this'",function(){R({listeners:{scope:"this"}});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("widget")})});describe("with view controller and defaultListenerScope on grandparent",function(){beforeEach(function(){O({controller:new D(),defaultListenerScope:true})});it("should resolve to the grandparent with unspecified scope",function(){R();L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("grandparent")});it("should resolve to the grandparent view controller with scope:'controller'",function(){R({listeners:{scope:"controller"}});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("grandparentController")});it("should resolve to the widget with scope:'this'",function(){R({listeners:{scope:"this"}});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("widget")})});describe("with view controller on child and view controller on parent",function(){beforeEach(function(){H({controller:new J()})});it("should resolve to the child view controller with unspecified scope",function(){R({controller:new I()});L=new N();P=new F({items:L});L.fireEvent("foo");G("controller")});it("should resolve to the child view controller with scope:'controller'",function(){R({controller:new I(),listeners:{scope:"controller"}});L=new N();P=new F({items:L});L.fireEvent("foo");G("controller")});it("should resolve to the widget with scope:'this'",function(){R({controller:new I(),listeners:{scope:"this"}});L=new N();P=new F({items:L});L.fireEvent("foo");G("widget")})});describe("with view controller on child and view controller on grandparent",function(){beforeEach(function(){O({controller:new D()})});it("should resolve to the child view controller with unspecified scope",function(){R({controller:new I()});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("controller")});it("should resolve to the child view controller with scope:'controller'",function(){R({controller:new I(),listeners:{scope:"controller"}});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("controller")});it("should resolve to the widget with scope:'this'",function(){R({controller:new I(),listeners:{scope:"this"}});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("widget")})});describe("with view controller on child and defaultListenerScope on parent",function(){beforeEach(function(){H({defaultListenerScope:true})});it("should resolve to the child view controller with unspecified scope",function(){R({controller:new I()});L=new N();P=new F({items:L});L.fireEvent("foo");G("controller")});it("should resolve to the child view controller with scope:'controller'",function(){R({controller:new I(),listeners:{scope:"controller"}});L=new N();P=new F({items:L});L.fireEvent("foo");G("controller")});it("should resolve to the widget with scope:'this'",function(){R({controller:new I(),listeners:{scope:"this"}});L=new N();P=new F({items:L});L.fireEvent("foo");G("widget")})});describe("with view controller on parent and defaultListenerScope on child",function(){beforeEach(function(){H({controller:new J()})});it("should resolve to the widget with unspecified scope",function(){R({defaultListenerScope:true});L=new N();P=new F({items:L});L.fireEvent("foo");G("widget")});it("should resolve to the parent view controller with scope:'controller'",function(){R({defaultListenerScope:true,listeners:{scope:"controller"}});L=new N();P=new F({items:L});L.fireEvent("foo");G("parentController")});it("should resolve to the widget with scope:'this'",function(){R({defaultListenerScope:true,listeners:{scope:"this"}});L=new N();P=new F({items:L});L.fireEvent("foo");G("widget")})});describe("with view controller on child and defaultListenerScope on grandparent",function(){beforeEach(function(){O({defaultListenerScope:true})});it("should resolve to the child view controller with unspecified scope",function(){R({controller:new I()});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("controller")});it("should resolve to the child view controller with scope:'controller'",function(){R({controller:new I(),listeners:{scope:"controller"}});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("controller")});it("should resolve to the widget with scope:'this'",function(){R({controller:new I(),listeners:{scope:"this"}});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("widget")})});describe("with view controller on grandparent and defaultListenerScope on child",function(){beforeEach(function(){O({controller:new D()})});it("should resolve to the widget with unspecified scope",function(){R({defaultListenerScope:true});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("widget")});it("should resolve to the grandparent view controller with scope:'controller'",function(){R({defaultListenerScope:true,listeners:{scope:"controller"}});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("grandparentController")});it("should resolve to the widget with scope:'this'",function(){R({defaultListenerScope:true,listeners:{scope:"this"}});L=new N();E=new M({items:{items:L}});L.fireEvent("foo");G("widget")})});describe("with scope declared on inner object",function(){it("should resolve to controller with unspecified outer scope",function(){R({defaultListenerScope:true,controller:new I(),listeners:{foo:{fn:"onFoo",scope:"controller"}}});L=new N();L.fireEvent("foo");G("controller")});it("should resolve to controller with outer scope of controller",function(){R({defaultListenerScope:true,controller:new I(),listeners:{scope:"controller",foo:{fn:"onFoo",scope:"controller"}}});L=new N();L.fireEvent("foo");G("controller")})});describe("with handler declared as a function reference",function(){var T,S;function U(V){N=Ext.define(null,Ext.merge({extend:"Ext.Widget",listeners:{foo:T}},V))}beforeEach(function(){T=jasmine.createSpy();T.andCallFake(function(){S=this})});afterEach(function(){S=null});it("should use the widget as the default scope",function(){U();L=new N();L.fireEvent("foo");expect(T).toHaveBeenCalled();expect(T.mostRecentCall.object).toBe(L)});it("should use an arbitrary object as the scope",function(){var V={};U({listeners:{scope:V}});L=new N();L.fireEvent("foo");expect(S).toBe(S)});it("should use the widget with scope:'this'",function(){U({listeners:{scope:"this"}});L=new N();L.fireEvent("foo");expect(S).toBe(L)});it("should fail with scope:'controller'",function(){U({listeners:{scope:"controller"}});L=new N();expect(function(){L.fireEvent("foo")}).toThrow()});it("should use the widget with scope:'this' specified on an inner object",function(){U({listeners:{foo:{fn:T,scope:"this"}}});L=new N();L.fireEvent("foo");expect(S).toBe(L)});it("should fail with scope:'controller' specified on an inner object",function(){U({listeners:{foo:{fn:T,scope:"controller"}}});L=new N();expect(function(){L.fireEvent("foo")}).toThrow()});describe("with view controller",function(){it("should resolve to the widget with unspecified scope",function(){U({controller:new I()});L=new N();L.fireEvent("foo");expect(S).toBe(L)});it("should resolve to the view controller with scope:'controller'",function(){U({controller:new I(),listeners:{scope:"controller"}});L=new N();L.fireEvent("foo");expect(S).toBe(L.getController())});it("should resolve to the widget with scope:'this'",function(){U({controller:new I(),listeners:{scope:"this"}});L=new N();L.fireEvent("foo");expect(S).toBe(L)})});describe("with defaultListenerScope",function(){it("should resolve to the widget with unspecified scope",function(){U({defaultListenerScope:true});L=new N();L.fireEvent("foo");expect(S).toBe(L)});it("should fail with scope:'controller'",function(){U({defaultListenerScope:true,listeners:{scope:"controller"}});L=new N();expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){U({defaultListenerScope:true,listeners:{scope:"this"}});L=new N();L.fireEvent("foo");expect(S).toBe(L)})});describe("with view controller and defaultListenerScope",function(){it("should resolve to the widget with unspecified scope",function(){U({controller:new I(),defaultListenerScope:true});L=new N();L.fireEvent("foo");expect(S).toBe(L)});it("should resolve to the view controller with scope:'controller'",function(){U({controller:new I(),defaultListenerScope:true,listeners:{scope:"controller"}});L=new N();L.fireEvent("foo");expect(S).toBe(L.getController())});it("should resolve to the widget with scope:'this'",function(){U({controller:new I(),defaultListenerScope:true,listeners:{scope:"this"}});L=new N();L.fireEvent("foo");expect(S).toBe(L)})});describe("with defaultListenerScope on parent",function(){beforeEach(function(){H({defaultListenerScope:true})});it("should resolve to the widget with unspecified scope",function(){U();L=new N();P=new F({items:L});L.fireEvent("foo");expect(S).toBe(L)});it("should fail with scope:'controller'",function(){U({listeners:{scope:"controller"}});L=new N();P=new F({items:L});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){U({listeners:{scope:"this"}});L=new N();P=new F({items:L});L.fireEvent("foo");expect(S).toBe(L)})});describe("with view controller on parent",function(){beforeEach(function(){H({controller:new J()})});it("should resolve to the widget with unspecified scope",function(){U();L=new N();P=new F({items:L});L.fireEvent("foo");expect(S).toBe(L)});it("should resolve to the parent view controller with scope:'controller'",function(){U({listeners:{scope:"controller"}});L=new N();P=new F({items:L});L.fireEvent("foo");expect(S).toBe(P.getController())});it("should resolve to the widget with scope:'this'",function(){U({listeners:{scope:"this"}});L=new N();P=new F({items:L});L.fireEvent("foo");expect(S).toBe(L)})})})});describe("listener declared on instance config",function(){function R(S){N=Ext.define(null,Ext.merge({extend:"Ext.Widget",onFoo:K.widget},S))}it("should resolve to the widget with unspecified scope",function(){R();L=new N({listeners:{foo:"onFoo"}});L.fireEvent("foo");G("widget")});it("should fail with scope:'controller'",function(){R();L=new N({listeners:{foo:"onFoo",scope:"controller"}});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){R();L=new N({listeners:{foo:"onFoo",scope:"this"}});L.fireEvent("foo");G("widget")});describe("with view controller",function(){beforeEach(function(){R({controller:new I()})});it("should resolve to the widget with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});L.fireEvent("foo");G("widget")});it("should fail with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});L.fireEvent("foo");G("widget")})});describe("with defaultListenerScope",function(){beforeEach(function(){R({defaultListenerScope:true})});it("should resolve to the widget with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});L.fireEvent("foo");G("widget")});it("should fail with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});L.fireEvent("foo");G("widget")})});describe("with view controller and defaultListenerScope",function(){beforeEach(function(){R({controller:new I(),defaultListenerScope:true})});it("should resolve to the widget with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});L.fireEvent("foo");G("widget")});it("should fail with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});L.fireEvent("foo");G("widget")})});describe("with defaultListenerScope on parent",function(){beforeEach(function(){H({defaultListenerScope:true});R()});it("should resolve to the parent with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});P=new F({items:L});L.fireEvent("foo");G("parent")});it("should fail with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});P=new F({items:L});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});P=new F({items:L});L.fireEvent("foo");G("widget")})});describe("with view controller on parent",function(){beforeEach(function(){H({controller:new J()});R()});it("should resolve to the parent view controller with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});P=new F({items:L});L.fireEvent("foo");G("parentController")});it("should resolve to the parent view controller with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});P=new F({items:L});L.fireEvent("foo");G("parentController")});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});P=new F({items:L});L.fireEvent("foo");G("widget")})});describe("with view controller and defaultListenerScope on parent",function(){beforeEach(function(){H({controller:new J(),defaultListenerScope:true});R()});it("should resolve to the parent with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});P=new F({items:L});L.fireEvent("foo");G("parent")});it("should resolve to the parent view controller with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});P=new F({items:L});L.fireEvent("foo");G("parentController")});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});P=new F({items:L});L.fireEvent("foo");G("widget")})});describe("with defaultListenerScope on grandparent",function(){beforeEach(function(){O({defaultListenerScope:true});R()});it("should resolve to the grandparent with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});E=new M({items:{items:L}});L.fireEvent("foo");G("grandparent")});it("should fail with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});E=new M({items:{items:L}});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});E=new M({items:{items:L}});L.fireEvent("foo");G("widget")})});describe("with view controller on grandparent",function(){beforeEach(function(){O({controller:new D()});R()});it("should resolve to the grandparent view controller with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});E=new M({items:{items:L}});L.fireEvent("foo");G("grandparentController")});it("should resolve to the grandparent view controller with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});E=new M({items:{items:L}});L.fireEvent("foo");G("grandparentController")});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});E=new M({items:{items:L}});L.fireEvent("foo");G("widget")})});describe("with view controller and defaultListenerScope on grandparent",function(){beforeEach(function(){O({controller:new D(),defaultListenerScope:true});R()});it("should resolve to the grandparent with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});E=new M({items:{items:L}});L.fireEvent("foo");G("grandparent")});it("should resolve to the grandparent view controller with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});E=new M({items:{items:L}});L.fireEvent("foo");G("grandparentController")});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});E=new M({items:{items:L}});L.fireEvent("foo");G("widget")})});describe("with view controller on child and view controller on parent",function(){beforeEach(function(){H({controller:new J()});R({controller:new I()})});it("should resolve to the parent view controller with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});P=new F({items:L});L.fireEvent("foo");G("parentController")});it("should resolve to the parent view controller with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});P=new F({items:L});L.fireEvent("foo");G("parentController")});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});P=new F({items:L});L.fireEvent("foo");G("widget")})});describe("with view controller on child and view controller on grandparent",function(){beforeEach(function(){O({controller:new D()});R({controller:new I()})});it("should resolve to the grandparent view controller with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});E=new M({items:{items:L}});L.fireEvent("foo");G("grandparentController")});it("should resolve to the grandparent view controller with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});E=new M({items:{items:L}});L.fireEvent("foo");G("grandparentController")});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});E=new M({items:{items:L}});L.fireEvent("foo");G("widget")})});describe("with view controller on child and defaultListenerScope on parent",function(){beforeEach(function(){H({defaultListenerScope:true});R({controller:new I()})});it("should resolve to the parent with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});P=new F({items:L});L.fireEvent("foo");G("parent")});it("should fail with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});P=new F({items:L});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});P=new F({items:L});L.fireEvent("foo");G("widget")})});describe("with view controller on parent and defaultListenerScope on child",function(){beforeEach(function(){H({controller:new J()});R({defaultListenerScope:true})});it("should resolve to the parent view controller with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});P=new F({items:L});L.fireEvent("foo");G("parentController")});it("should resolve to the parent view controller with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});P=new F({items:L});L.fireEvent("foo");G("parentController")});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});P=new F({items:L});L.fireEvent("foo");G("widget")})});describe("with view controller on child and defaultListenerScope on grandparent",function(){beforeEach(function(){O({defaultListenerScope:true});R({controller:new I()})});it("should resolve to the grandparent with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});E=new M({items:{items:L}});L.fireEvent("foo");G("grandparent")});it("should fail with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});E=new M({items:{items:L}});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});E=new M({items:{items:L}});L.fireEvent("foo");G("widget")})});describe("with view controller on grandparent and defaultListenerScope on child",function(){beforeEach(function(){O({controller:new D()});R({defaultListenerScope:true})});it("should resolve to the grandparent view controller with unspecified scope",function(){L=new N({listeners:{foo:"onFoo"}});E=new M({items:{items:L}});L.fireEvent("foo");G("grandparentController")});it("should resolve to the grandparent view controller with scope:'controller'",function(){L=new N({listeners:{foo:"onFoo",scope:"controller"}});E=new M({items:{items:L}});L.fireEvent("foo");G("grandparentController")});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:"onFoo",scope:"this"}});E=new M({items:{items:L}});L.fireEvent("foo");G("widget")})});describe("with handler declared as a function reference",function(){var T,S;function U(V){N=Ext.define(null,Ext.merge({extend:"Ext.Widget"},V))}beforeEach(function(){T=jasmine.createSpy();T.andCallFake(function(){S=this})});afterEach(function(){S=null});it("should use the widget as the default scope",function(){U();L=new N({listeners:{foo:T}});L.fireEvent("foo");expect(S).toBe(L)});it("should use an arbitrary object as the scope",function(){U();var V={};L=new N({listeners:{foo:T,scope:V}});L.fireEvent("foo");expect(V).toBe(V)});it("should use the widget with scope:'this'",function(){U();L=new N({listeners:{foo:T,scope:"this"}});L.fireEvent("foo");expect(S).toBe(L)});it("should fail with scope:'controller'",function(){U();L=new N({listeners:{foo:T,scope:"controller"}});expect(function(){L.fireEvent("foo")}).toThrow()});it("should use the widget with scope:'this' specified on an inner object",function(){U();L=new N({listeners:{foo:{fn:T,scope:"this"}}});L.fireEvent("foo");expect(S).toBe(L)});it("should fail with scope:'controller' specified on an inner object",function(){U();L=new N({listeners:{foo:{fn:T,scope:"controller"}}});expect(function(){L.fireEvent("foo")}).toThrow()});describe("with view controller",function(){beforeEach(function(){U({controller:new I()})});it("should resolve to the widget with unspecified scope",function(){L=new N({listeners:{foo:T}});L.fireEvent("foo");expect(S).toBe(L)});it("should fail with scope:'controller'",function(){L=new N({listeners:{foo:T,scope:"controller"}});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:T,scope:"this"}});L.fireEvent("foo");expect(S).toBe(L)})});describe("with defaultListenerScope",function(){beforeEach(function(){U({defaultListenerScope:true})});it("should resolve to the widget with unspecified scope",function(){L=new N({listeners:{foo:T}});L.fireEvent("foo");expect(S).toBe(L)});it("should fail with scope:'controller'",function(){L=new N({listeners:{foo:T,scope:"controller"}});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:T,scope:"this"}});L.fireEvent("foo");expect(S).toBe(L)})});describe("with defaultListenerScope on parent",function(){beforeEach(function(){H({defaultListenerScope:true});U()});it("should resolve to the widget with unspecified scope",function(){L=new N({listeners:{foo:T}});P=new F({items:L});L.fireEvent("foo");expect(S).toBe(L)});it("should fail with scope:'controller'",function(){L=new N({listeners:{foo:T,scope:"controller"}});P=new F({items:L});expect(function(){L.fireEvent("foo")}).toThrow()});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:T,scope:"this"}});P=new F({items:L});L.fireEvent("foo");expect(S).toBe(L)})});describe("with view controller on parent",function(){beforeEach(function(){H({controller:new J()});U()});it("should resolve to the widget with unspecified scope",function(){L=new N({listeners:{foo:T}});P=new F({items:L});L.fireEvent("foo");expect(S).toBe(L)});it("should resolve to the parent view controller with scope:'controller'",function(){L=new N({listeners:{foo:T,scope:"controller"}});P=new F({items:L});L.fireEvent("foo");expect(S).toBe(P.getController())});it("should resolve to the widget with scope:'this'",function(){L=new N({listeners:{foo:T,scope:"this"}});P=new F({items:L});L.fireEvent("foo");expect(S).toBe(L)})})})})})})