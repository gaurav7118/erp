describe("Ext.data.operation.Update",function(){var F,C,E,B,D;function A(G){F=new Ext.data.operation.Update(G)}beforeEach(function(){Ext.define("spec.Alien",{extend:"Ext.data.Model",fields:["name","age","planet"]});C=new spec.Alien({name:"Thor",age:5000,planet:"Orilla"});B=new spec.Alien({name:"Teal'c",age:130,planet:"Chulak"});E={id:5,name:"Baal",age:3000,planet:"P3X-888"};D={id:12,name:"Jolinar",age:1500,planet:"Vorash"}});afterEach(function(){F=C=E=B=D=null;Ext.data.Model.schema.clear();Ext.undefine("spec.Alien")});describe("execute",function(){it("should call the proxy update method and pass itself",function(){var G=new Ext.data.proxy.Proxy();spyOn(G,"update").andReturn(new Ext.data.Request());A({proxy:G});F.execute();expect(G.update).toHaveBeenCalledWith(F)})});describe("updating records",function(){describe("single record",function(){beforeEach(function(){C.setId(E.id);C.dirty=false;C.phantom=false;A({records:[C]});F.process(new Ext.data.ResultSet({success:true,records:[E]}))});it("should update the client record with the server record's data",function(){expect(C.get("id")).toBe(E.id);expect(C.get("name")).toBe(E.name);expect(C.get("age")).toBe(E.age);expect(C.get("planet")).toBe(E.planet)});it("should mark the client record as not dirty",function(){expect(C.dirty).toBe(false)});it("should mark the client record as not phantom",function(){expect(C.phantom).toBe(false)})});describe("updating a single record with no matching server record id",function(){beforeEach(function(){C.setId(100);C.dirty=false;C.phantom=false;A({records:[C]});spyOn(Ext.log,"warn");spec.Alien.prototype.clientIdProperty="clientId";F.process(new Ext.data.ResultSet({success:true,records:[E]}))});it("should update the client record with the server record's data",function(){expect(C.get("id")).not.toBe(E.id);expect(C.get("name")).not.toBe(E.name);expect(C.get("age")).not.toBe(E.age);expect(C.get("planet")).not.toBe(E.planet)});it("should mark the client record as not dirty",function(){expect(C.dirty).toBe(false)});it("should mark the client record as not phantom",function(){expect(C.phantom).toBe(false)})});describe("updating multiple records without a clientIdProperty",function(){beforeEach(function(){C.dirty=true;B.setId(100);B.dirty=true;D.clientId=C.id;spyOn(B,"set").andCallThrough();A({records:[C,B]});spyOn(Ext.log,"warn");spec.Alien.prototype.clientIdProperty="clientId";F.process(new Ext.data.ResultSet({success:true,records:[E,D]}))});it("should update the client records with the server records' data",function(){expect(C.get("id")).toBe(D.id);expect(C.get("name")).toBe(D.name);expect(C.get("age")).toBe(D.age);expect(C.get("planet")).toBe(D.planet);expect(B.set).not.toHaveBeenCalled()});it("should mark the client records as not dirty",function(){expect(C.dirty).toBe(false);expect(B.dirty).toBe(false)});it("should mark the client records as not phantom",function(){expect(C.phantom).toBe(false);expect(B.phantom).toBe(false)})})})})