describe("Ext.data.proxy.Rest",function(){var A;beforeEach(function(){Ext.ClassManager.enableNamespaceParseCache=false;A=new Ext.data.proxy.Rest({})});afterEach(function(){Ext.ClassManager.enableNamespaceParseCache=true});describe("instantiation",function(){it("should extend Ext.data.proxy.Ajax",function(){expect(A.superclass).toEqual(Ext.data.proxy.Ajax.prototype)});it("should have correct actionMethods",function(){var B={create:"POST",read:"GET",update:"PUT",destroy:"DELETE"};expect(A.getActionMethods()).toEqual(B)})});describe("building URLs",function(){var C,F,B,H,E;function G(I){return new Ext.data.proxy.Rest(Ext.apply({},I,{url:"/users"}))}function D(I){return I.split("?")[0]}beforeEach(function(){var I=Ext.define("spec.User",{extend:"Ext.data.Model",fields:["id","name","email"]});E=new I({id:2,name:"Ed Spencer",email:"ed@sencha.com"});C=new Ext.data.operation.Read({records:[]});F=new Ext.data.operation.Read({records:[E]});B=new Ext.data.Request({operation:C,action:C.getAction()});H=new Ext.data.Request({operation:F})});afterEach(function(){Ext.data.Model.schema.clear();Ext.undefine("spec.User")});describe("if there are no records in the Operation",function(){it("should not fail",function(){C=new Ext.data.operation.Read({});B=new Ext.data.Request({operation:C,action:C.getAction()});A=G({appendId:false});expect(D(A.buildUrl(B))).toEqual("/users")})});describe("if appendId is false",function(){beforeEach(function(){A=G({appendId:false})});it("should not append the ID to a single Operation",function(){expect(D(A.buildUrl(B))).toEqual("/users")});it("should not append the ID to a collection Operation",function(){expect(D(A.buildUrl(H))).toEqual("/users")})});describe("if appendId is true",function(){beforeEach(function(){A=G({appendId:true})});it("should not append the ID to a collection Operation",function(){expect(D(A.buildUrl(B))).toBe("/users")});it("should append the ID to a single Operation",function(){expect(D(A.buildUrl(H))).toBe("/users/2")});it("should url encode the id",function(){E.set("id","Foo & Bar");expect(D(A.buildUrl(H))).toBe("/users/Foo%20%26%20Bar")});it("should not append a phantom record",function(){E.setId("User-1");E.phantom=true;expect(D(A.buildUrl(H))).toBe("/users")});it("should append an id of 0",function(){E.setId(0);expect(D(A.buildUrl(H))).toBe("/users/0")});it("should not append an empty string",function(){E.setId("");expect(D(A.buildUrl(H))).toBe("/users")});it("should not append null",function(){E.setId(null);expect(D(A.buildUrl(H))).toBe("/users")});it("should not append undefined",function(){E.setId(undefined);expect(D(A.buildUrl(H))).toBe("/users")});it("should not have id=foo in the params",function(){var I=A.buildUrl(H);expect(I.indexOf("id=2")).toBe(-1)})});describe("if format is undefined",function(){beforeEach(function(){A=G({appendId:false,format:undefined})});it("should not append the format to a single Operation",function(){expect(D(A.buildUrl(B))).toEqual("/users")});it("should not append the format to a collection Operation",function(){expect(D(A.buildUrl(H))).toEqual("/users")})});describe("if a format is given",function(){beforeEach(function(){A=G({appendId:true,format:"json"})});it("should append the format to a single Operation",function(){expect(D(A.buildUrl(B))).toEqual("/users.json")});it("should append the format to a collection Operation",function(){expect(D(A.buildUrl(H))).toEqual("/users/2.json")})});it("should respect the api configuration",function(){A=G({api:{read:"/users1"}});expect(D(A.buildUrl(B))).toEqual("/users1")})})})