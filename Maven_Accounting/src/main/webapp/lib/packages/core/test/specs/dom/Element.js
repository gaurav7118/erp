describe("Ext.dom.Element",function(){describe("instantiation",function(){var C,B;beforeEach(function(){B=document.createElement("div");document.body.appendChild(B)});afterEach(function(){var D=Ext.cache[B.id];if(D){D.destroy()}else{document.body.removeChild(B)}});it("should set dom element id if it hasn't already one",function(){C=new Ext.dom.Element(B);expect(B.id).toBeDefined()});it("should not set dom element id if it has already one",function(){var D=Ext.id();B.id=D;C=new Ext.dom.Element(B);expect(B.id).toEqual(D)});it("should set dom property to dom element",function(){C=new Ext.dom.Element(B);expect(C.dom).toBe(B)});it("should set id property to dom id",function(){var D=Ext.id();B.id=D;C=new Ext.dom.Element(B);expect(C.id).toEqual(D)});it("should find a dom element if a string corresponding to it's id is passed as first argument",function(){var D=Ext.id();B.id=D;C=new Ext.dom.Element(D);expect(C.dom).toBe(B)});it("should throw error if the Element has an invalid id",function(){function D(F){var E=document.createElement("div");E.id=F;document.body.appendChild(E);expect(function(){new Ext.Element(E)}).toThrow('Invalid Element "id": "'+F+'"');document.body.removeChild(E)}D(".abcdef");D("0a...");D("12345");D(".abc-def");D("<12345/>");D("1<>234.567")});it("should not call initConfig",function(){spyOn(Ext.dom.Element.prototype,"initConfig").andCallThrough();C=new Ext.dom.Element(B);expect(Ext.dom.Element.prototype.initConfig).not.toHaveBeenCalled()})});function A(B){describe("methods (using "+(B?"Ext.fly()":"new Ext.dom.Element()")+")",function(){var C,D;function E(F){C=document.createElement(F||"div");document.body.appendChild(C);return B?Ext.fly(C):Ext.get(C)}afterEach(function(){if(D){spyOn(Ext.Logger,"warn");D.destroy();D=null}});describe("clone",function(){var G,F='<span class="bar" style="color:red">Some Text</span>';afterEach(function(){if(C){Ext.fly(C).destroy()}if(G){G.destroy()}});it("should create an exact copy",function(){C=document.createElement("div");C.innerHTML=F;document.body.appendChild(C);G=Ext.fly(C).clone();expect(G.dom.innerHTML).toBe("")});describe("deep",function(){xit("should create an exact copy",function(){C=document.createElement("div");C.innerHTML=F;document.body.appendChild(C);G=Ext.fly(C).clone(true);expect(G.dom.innerHTML).toBe(F)})})});describe("classes",function(){describe("addCls",function(){beforeEach(function(){D=E();C=D.dom});it("should not throw an exception when className is null",function(){expect(function(){D.addCls(null)}).not.toThrow()});describe("return type",function(){it("should return the element when the class is null",function(){expect(D.addCls(null)).toBe(D)});it("should return the element when the class is a string",function(){expect(D.addCls("foo")).toBe(D)});it("should return the element when the class is an array",function(){expect(D.addCls(["foo","bar"])).toBe(D)})});describe("synchronization",function(){it("should keep the classList/classMap up to date",function(){D.addCls(["foo","bar"]);var F=D.getData();expect(F.classList).toEqual(["foo","bar"]);expect(F.classMap).toEqual({foo:true,bar:true})})});describe("argument types",function(){describe("with a string",function(){describe("without spaces",function(){it("should add a class to the element",function(){D.addCls("foo");expect(C.className).toBe("foo")});it("should add a class when another class already exists",function(){C.className="foo";D.addCls("bar");expect(C.className).toBe("foo bar")});it("should not duplicate the class if it exists on the element",function(){C.className="foo";D.addCls("foo");expect(C.className).toBe("foo")});describe("prefix & suffix",function(){describe("prefix only",function(){it("should attach the prefix to the class",function(){D.addCls("foo","a");expect(C.className).toBe("a-foo")});it("should use the prefix when comparing if the class exists",function(){C.className="foo";D.addCls("foo","a");expect(C.className).toBe("foo a-foo")})});describe("suffix only",function(){it("should attach the suffix to the class",function(){D.addCls("foo",null,"b");expect(C.className).toBe("foo-b")});it("should use the suffix when comparing if the class exists",function(){C.className="foo";D.addCls("foo",null,"b");expect(C.className).toBe("foo foo-b")})});describe("prefix and suffix",function(){it("should attach the prefix & suffix to the class",function(){D.addCls("foo","a","b");expect(C.className).toBe("a-foo-b")});it("should use the prefix & suffix when comparing if the class exists",function(){C.className="foo";D.addCls("foo","a","b");expect(C.className).toBe("foo a-foo-b")})})})});describe("with spaces",function(){it("should split class names by string and add them separately",function(){D.addCls("foo bar");expect(C.className).toBe("foo bar")});it("should split by multiple spaces",function(){D.addCls("foo    bar           baz");expect(C.className).toBe("foo bar baz")});it("should trim leading spaces",function(){expect(D.addCls("     foo bar"));expect(C.className).toBe("foo bar")});it("should trim trailing spaces",function(){expect(D.addCls("foo bar           "));expect(C.className).toBe("foo bar")});it("should only add new classes to the element",function(){D.dom.className="bar";D.addCls("foo bar");expect(C.className).toBe("bar foo")});describe("prefix & suffix",function(){describe("prefix only",function(){it("should attach the prefix to the class",function(){D.addCls("foo bar","a");expect(C.className).toBe("a-foo a-bar")});it("should use the prefix when comparing if the class exists",function(){C.className="foo";D.addCls("foo bar","a");expect(C.className).toBe("foo a-foo a-bar")})});describe("suffix only",function(){it("should attach the suffix to the class",function(){D.addCls("foo bar",null,"b");expect(C.className).toBe("foo-b bar-b")});it("should use the suffix when comparing if the class exists",function(){C.className="foo";D.addCls("foo bar",null,"b");expect(C.className).toBe("foo foo-b bar-b")})});describe("prefix and suffix",function(){it("should attach the prefix & suffix to the class",function(){D.addCls("foo bar","a","b");expect(C.className).toBe("a-foo-b a-bar-b")});it("should use the prefix & suffix when comparing if the class exists",function(){C.className="foo";D.addCls("foo bar","a","b");expect(C.className).toBe("foo a-foo-b a-bar-b")})})})})});describe("with an array",function(){it("should add all classes to the element",function(){D.addCls(["foo","bar"]);expect(C.className).toBe("foo bar")});it("should only add new classes to the element",function(){D.dom.className="bar";D.addCls(["foo","bar"]);expect(C.className).toBe("bar foo")});describe("prefix & suffix",function(){describe("prefix only",function(){it("should attach the prefix to the class",function(){D.addCls(["foo","bar"],"a");expect(C.className).toBe("a-foo a-bar")});it("should use the prefix when comparing if the class exists",function(){C.className="foo";D.addCls(["foo","bar"],"a");expect(C.className).toBe("foo a-foo a-bar")})});describe("suffix only",function(){it("should attach the suffix to the class",function(){D.addCls(["foo","bar"],null,"b");expect(C.className).toBe("foo-b bar-b")});it("should use the suffix when comparing if the class exists",function(){C.className="foo";D.addCls(["foo","bar"],null,"b");expect(C.className).toBe("foo foo-b bar-b")})});describe("prefix and suffix",function(){it("should attach the prefix & suffix to the class",function(){D.addCls(["foo","bar"],"a","b");expect(C.className).toBe("a-foo-b a-bar-b")});it("should use the prefix & suffix when comparing if the class exists",function(){C.className="foo";D.addCls(["foo","bar"],"a","b");expect(C.className).toBe("foo a-foo-b a-bar-b")})})})})});describe("matching",function(){it("should not match a leading substring as an existing class",function(){C.className="foobar";D.addCls("foo");expect(C.className).toBe("foobar foo")});it("should not match a trailing substring as an existing class",function(){C.className="barfoo";D.addCls("foo");expect(C.className).toBe("barfoo foo")});it("should not match a substring as an existing class",function(){C.className="xfooy";D.addCls("foo");expect(C.className).toBe("xfooy foo")})})});describe("removeCls",function(){beforeEach(function(){D=E();C=D.dom});it("should not throw an exception when className is null",function(){expect(function(){D.removeCls(null)}).not.toThrow()});describe("return type",function(){it("should return the element when the class is null",function(){expect(D.removeCls(null)).toBe(D)});it("should return the element when the class is a string",function(){expect(D.removeCls("foo")).toBe(D)});it("should return the element when the class is an array",function(){expect(D.removeCls(["foo","bar"])).toBe(D)})});describe("synchronization",function(){it("should keep the classList/classMap up to date",function(){C.className="foo bar baz";D.removeCls(["foo","bar"]);var F=D.getData();expect(F.classList).toEqual(["baz"]);expect(F.classMap).toEqual({baz:true})})});describe("argument types",function(){describe("with a string",function(){describe("without spaces",function(){it("should remove a class from the element",function(){C.className="foo bar";D.removeCls("foo");expect(C.className).toBe("bar")});it("should do nothing when the class is empty",function(){C.className="";D.removeCls("bar");expect(C.className).toBe("")});it("should only remove the specified class",function(){C.className="foo bar baz";D.removeCls("bar");expect(C.className).toBe("foo baz")});describe("prefix & suffix",function(){describe("prefix only",function(){it("should attacj the prefix to the class",function(){C.className="a-foo";D.removeCls("foo","a");expect(C.className).toBe("")});it("should use the prefix when comparing if the class exists",function(){C.className="foo";D.removeCls("foo","a");expect(C.className).toBe("foo")})});describe("suffix only",function(){it("should attach the suffix to the class",function(){C.className="foo-b";D.removeCls("foo",null,"b");expect(C.className).toBe("")});it("should use the suffix when comparing if the class exists",function(){C.className="foo";D.removeCls("foo",null,"b");expect(C.className).toBe("foo")})});describe("prefix and suffix",function(){it("should attach the prefix & suffix to the class",function(){C.className="a-foo-b";D.removeCls("foo","a","b");expect(C.className).toBe("")});it("should use the prefix & suffix when comparing if the class exists",function(){C.className="foo";D.removeCls("foo","a","b");expect(C.className).toBe("foo")})})})});describe("with spaces",function(){it("should split class names by string and remove them separately",function(){C.className="bar foo";D.removeCls("foo bar");expect(C.className).toBe("")});it("should split by multiple spaces",function(){C.className="foo bar baz";D.removeCls("foo    bar           baz");expect(C.className).toBe("")});it("should trim leading spaces",function(){C.className="foo bar baz";expect(D.removeCls("     foo bar"));expect(C.className).toBe("baz")});it("should trim trailing spaces",function(){C.className="foo bar baz";expect(D.removeCls("foo bar           "));expect(C.className).toBe("baz")});it("should only remove matching classes to the element",function(){D.dom.className="foo bar baz";D.removeCls("foo");expect(C.className).toBe("bar baz")});describe("prefix & suffix",function(){describe("prefix only",function(){it("should attach the prefix to the class",function(){C.className="a-foo a-bar";D.removeCls("foo bar","a");expect(C.className).toBe("")});it("should use the prefix when comparing if the class exists",function(){C.className="a-foo bar";D.removeCls("foo bar","a");expect(C.className).toBe("bar")})});describe("suffix only",function(){it("should attach the suffix to the class",function(){C.className="foo-b bar-b";D.removeCls("foo bar",null,"b");expect(C.className).toBe("")});it("should use the suffix when comparing if the class exists",function(){C.className="foo-b bar";D.removeCls("foo bar",null,"b");expect(C.className).toBe("bar")})});describe("prefix and suffix",function(){it("should attach the prefix & suffix to the class",function(){C.className="a-foo-b a-bar-b";D.removeCls("foo bar","a","b");expect(C.className).toBe("")});it("should use the prefix & suffix when comparing if the class exists",function(){C.className="foo a-bar-b";D.removeCls("foo bar","a","b");expect(C.className).toBe("foo")})})})})});describe("with an array",function(){it("should remove all classes from the element",function(){C.className="foo bar baz";D.removeCls(["foo","bar"]);expect(C.className).toBe("baz")});it("should only remove specified classes from the element",function(){C.className="foo bar baz";D.removeCls(["foo","baz"]);expect(C.className).toBe("bar")});describe("prefix & suffix",function(){describe("prefix only",function(){it("should attach the prefix to the class",function(){C.className="a-foo a-bar";D.removeCls(["foo","bar"],"a");expect(C.className).toBe("")});it("should use the prefix when comparing if the class exists",function(){C.className="a-foo bar";D.removeCls(["foo","bar"],"a");expect(C.className).toBe("bar")})});describe("suffix only",function(){it("should attach the suffix to the class",function(){C.className="foo-b bar-b";D.removeCls(["foo","bar"],null,"b");expect(C.className).toBe("")});it("should use the suffix when comparing if the class exists",function(){C.className="foo-b bar";D.removeCls(["foo","bar"],null,"b");expect(C.className).toBe("bar")})});describe("prefix and suffix",function(){it("should attach the prefix & suffix to the class",function(){C.className="a-foo-b a-bar-b";D.removeCls(["foo","bar"],"a","b");expect(C.className).toBe("")});it("should use the prefix & suffix when comparing if the class exists",function(){C.className="foo a-bar-b";D.removeCls(["foo","bar"],"a","b");expect(C.className).toBe("foo")})})})})});describe("matching",function(){it("should not match a leading substring as an existing class",function(){C.className="foobar";D.removeCls("foo");expect(C.className).toBe("foobar")});it("should not match a trailing substring as an existing class",function(){C.className="barfoo";D.removeCls("foo");expect(C.className).toBe("barfoo")});it("should not match a substring as an existing class",function(){C.className="xfooy";D.removeCls("foo");expect(C.className).toBe("xfooy")})})});describe("setCls",function(){beforeEach(function(){D=E();C=D.dom;C.className="some cls"});describe("synchronization",function(){it("should keep the classList/classMap up to date",function(){C.className="foo bar baz";D.setCls(["some","stuff"]);var F=D.getData();expect(F.classList).toEqual(["some","stuff"]);expect(F.classMap).toEqual({some:true,stuff:true})})});describe("argument types",function(){describe("with a string",function(){describe("without spaces",function(){it("should set the className",function(){D.setCls("foo");expect(C.className).toBe("foo")})});describe("with spaces",function(){it("should split on spaces",function(){D.setCls("foo bar baz");expect(C.className).toBe("foo bar baz")})})});describe("with an array",function(){it("should set all classes",function(){D.setCls(["foo","bar","baz"]);expect(C.className).toBe("foo bar baz")})})})});describe("toggleCls",function(){beforeEach(function(){D=E();C=D.dom;C.className="foo"});describe("synchronization",function(){it("should keep the classList/classMap up to date",function(){D.toggleCls("bar");var F=D.getData();expect(F.classList).toEqual(["foo","bar"]);expect(F.classMap).toEqual({foo:true,bar:true})})});describe("without state flag",function(){it("should add the class if it does not exist",function(){D.toggleCls("bar");expect(C.className).toBe("foo bar")});it("should remove the class if it exists",function(){D.toggleCls("foo");expect(C.className).toBe("")})});describe("with state flag",function(){describe("state: true",function(){it("should add a new class",function(){D.toggleCls("bar",true);expect(C.className).toBe("foo bar")});it("should not remove an existing class",function(){D.toggleCls("foo",true);expect(C.className).toBe("foo")})});describe("state: true",function(){it("should remove an existing class",function(){D.toggleCls("foo",false);expect(C.className).toBe("")});it("should not add a non-existing class",function(){D.toggleCls("bar",false);expect(C.className).toBe("foo")})})})});describe("hasCls",function(){beforeEach(function(){D=E();C=D.dom});it("should match if the class name is the first item",function(){C.className="foo bar baz";expect(D.hasCls("foo")).toBe(true)});it("should match if the class name is the last item",function(){C.className="foo bar baz";expect(D.hasCls("baz")).toBe(true)});it("should match if the class name is a middle item",function(){C.className="foo bar baz qux";expect(D.hasCls("baz")).toBe(true)});it("should match if there is only 1 class name",function(){C.className="foo";expect(D.hasCls("foo")).toBe(true)});it("should not match if there is only 1 class that is not the same",function(){C.className="foo";expect(D.hasCls("bar")).toBe(false)});it("should not match if none of the classes match",function(){C.className="foo bar baz";expect(D.hasCls("asdf")).toBe(false)});it("should not match a leading substring",function(){C.className="foobar";expect(D.hasCls("foo")).toBe(false)});it("should not match a trailing substring",function(){C.className="barfoo";expect(D.hasCls("foo")).toBe(false)});it("should not match a substring as an existing class",function(){C.className="xfooy";expect(D.hasCls("foo")).toBe(false)});it("should be able to match when there's a class that matches both the class & a leading subtring",function(){C.className="foobar foo";expect(D.hasCls("foo")).toBe(true)});it("should be able to match when there's a class that matches both the class & a trailing subtring",function(){C.className="barfoo foo";expect(D.hasCls("foo")).toBe(true)});it("should be able to match when there's a class that matches both the class & a subtring",function(){C.className="xfooy foo";expect(D.hasCls("foo")).toBe(true)})})});describe("set",function(){beforeEach(function(){D=E("div")});it("should call Ext.core.DomHelper.applyStyles if object passed as first argument has style property",function(){var F={width:"100px"};spyOn(D,"applyStyles");D.set({style:F});expect(D.applyStyles).toHaveBeenCalledWith(F)});it("should set dom element className if object passed as first argument has cls property",function(){var F="x-test-class";D.set({cls:F});expect(D.dom.className).toEqual(F)});it("should use setAttribute by default",function(){spyOn(D.dom,"setAttribute");D.set({align:"center"});expect(D.dom.setAttribute).toHaveBeenCalledWith("align","center")});it("should be able to use expandos",function(){spyOn(D.dom,"setAttribute");D.set({align:"center"},false);expect(D.dom.align).toEqual("center")})});describe("is",function(){beforeEach(function(){D=E("div")});it("Returns true if this element matches the passed simple selector",function(){D.set({cls:"x-test-class"});expect(D.is("div.x-test-class")).toBe(true)})});describe("focus",function(){beforeEach(function(){D=E("div")});it("should focus dom element",function(){spyOn(D.dom,"focus");D.focus();expect(D.dom.focus).toHaveBeenCalled()});it("should be able to defer dom element focus",function(){spyOn(D.dom,"focus");D.focus(1);waitsFor(function(){return D.dom.focus.calls.length===1},"element.dom.focus was never called");runs(function(){expect(D.dom.focus).toHaveBeenCalled()})});if(Ext.isIE8){it("should ignore any exception",function(){D.dom.focus=function(){throw"error"};expect(D.focus.bind(D)).not.toThrow("error")})}});describe("blur",function(){beforeEach(function(){D=E("div")});it("should blur dom element",function(){spyOn(D.dom,"blur");D.blur();expect(D.dom.blur).toHaveBeenCalled()});it("should ignore any exception",function(){D.dom.blur=function(){throw"error"};expect(D.blur.bind(D)).not.toThrow("error")})});describe("wrap/unwrap",function(){describe("wrap",function(){var F;beforeEach(function(){D=E("div")});afterEach(function(){F=Ext.destroy(F)});it("should wrap the element",function(){var G=D.dom.parentNode;F=D.wrap();expect(D.dom.parentNode.parentNode).toBe(G)});it("should wrap the element in place",function(){var H=Ext.getBody().createChild(),G=Ext.getBody().createChild();H.insertBefore(D);F=D.wrap();expect(F.prev()).toBe(H);expect(F.next()).toBe(G);Ext.destroy(H,G)});describe("config",function(){it("should apply the config to the wrapping element",function(){var G=Ext.id();F=D.wrap({cls:"foo",id:G});expect(F.dom.className).toBe("foo");expect(F.dom.id).toBe(G)})});describe("returnDom",function(){it("should return an Ext.dom.Element by default",function(){F=D.wrap();expect(F.isElement).toBe(true)});it("should return an Ext.dom.Element when passing false",function(){F=D.wrap({},false);expect(F.isElement).toBe(true)});it("should return an DOM element when passing true",function(){F=D.wrap({},true);expect(F.isElement).not.toBe(true);F=Ext.get(F)})});describe("selector",function(){it("should place the element in the element match the selector",function(){F=D.wrap({cls:"foo",children:[{cls:"bar",children:[{cls:"baz"}]}]},false,".baz");expect(D.dom.parentNode.className).toBe("baz");expect(D.dom.parentNode.parentNode.className).toBe("bar");expect(D.dom.parentNode.parentNode.parentNode.className).toBe("foo")})});describe("focus",function(){it("should keep focus if the active element is inside the wrapped element",function(){var G=D.createChild({tag:"a",html:"Foo",tabIndex:"0"});jasmine.focusAndWait(G);runs(function(){F=D.wrap()});jasmine.waitsForFocus(G);runs(function(){expect(Ext.dom.Element.getActiveElement()).toBe(G.dom)})});it("should not fire focus/blur events on the element",function(){var H=D.createChild({tag:"a",html:"Foo",tabIndex:"0"}),G=jasmine.createSpy();jasmine.focusAndWait(H);runs(function(){H.on("focus",G);H.on("blur",G);F=D.wrap()});jasmine.waitsForFocus(H);runs(function(){expect(G).not.toHaveBeenCalled();H.destroy()})});it("should not cause an exception when the focused element is not in the element cache",function(){var G=Ext.id();D.dom.innerHTML='<a tabIndex="0" id="'+G+'">Foo</a>';var H=D.dom.firstChild;jasmine.focusAndWait(H);runs(function(){expect(function(){F=D.wrap()}).not.toThrow();expect(Ext.cache[G]).toBeUndefined()});jasmine.waitsForFocus(H);runs(function(){expect(Ext.dom.Element.getActiveElement()).toBe(H)})})})});describe("unwrap",function(){var F;beforeEach(function(){D=E("div");F=D.wrap()});afterEach(function(){F=Ext.destroy(F)});describe("focus",function(){it("should keep focus if the active element is inside the wrapped element",function(){var G=D.createChild({tag:"a",html:"Foo",tabIndex:"0"});jasmine.focusAndWait(G);runs(function(){D.unwrap()});jasmine.waitsForFocus(G);runs(function(){expect(Ext.dom.Element.getActiveElement()).toBe(G.dom)})});it("should not fire focus/blur events on the element",function(){var H=D.createChild({tag:"a",html:"Foo",tabIndex:"0"}),G=jasmine.createSpy();jasmine.focusAndWait(H);runs(function(){H.on("focus",G);H.on("blur",G);D.unwrap()});jasmine.waitsForFocus(H);runs(function(){expect(G).not.toHaveBeenCalled();H.destroy()})});it("should not cause an exception when the focused element is not in the element cache",function(){var G=Ext.id();D.dom.innerHTML='<a tabIndex="0" id="'+G+'">Foo</a>';var H=D.dom.firstChild;jasmine.focusAndWait(H);runs(function(){expect(function(){D.unwrap()}).not.toThrow();expect(Ext.cache[G]).toBeUndefined()});jasmine.waitsForFocus(H);runs(function(){expect(Ext.dom.Element.getActiveElement()).toBe(H)})})})})});describe("getValue",function(){beforeEach(function(){D=E("div");D.dom.value="10"});it("should return the dom value",function(){expect(D.getValue()).toEqual("10")});it("should return the dom value as Number",function(){expect(D.getValue(true)).toEqual(10)})});describe("listeners",function(){var F;beforeEach(function(){F={delay:10}});xdescribe("deprecated (EventManager)",function(){describe("addListener",function(){beforeEach(function(){D=E("div")});it("should call Ext.EventManager.on",function(){spyOn(Ext.EventManager,"on");D.addListener("click",Ext.emptyFn,fakeScope,F);expect(Ext.EventManager.on).toHaveBeenCalledWith(D,"click",Ext.emptyFn,fakeScope,F)})});describe("removeListener",function(){beforeEach(function(){D=E("div")});it("should call Ext.EventManager.un",function(){spyOn(Ext.EventManager,"un");D.removeListener("click",Ext.emptyFn,fakeScope);expect(Ext.EventManager.un).toHaveBeenCalledWith(D,"click",Ext.emptyFn,fakeScope)})});describe("removeAllListener",function(){beforeEach(function(){D=E("div")});it("should call Ext.EventManager.removeAll",function(){spyOn(Ext.EventManager,"removeAll");D.removeAllListeners();expect(Ext.EventManager.removeAll).toHaveBeenCalledWith(D.dom)})});describe("purgeAllListener",function(){it("should call Ext.EventManager.purgeElement",function(){D=E("div");spyOn(Ext.EventManager,"purgeElement");D.purgeAllListeners();expect(Ext.EventManager.purgeElement).toHaveBeenCalledWith(D)});it("should work with images",function(){D=E("img");expect(function(){D.purgeAllListeners()}).not.toThrow();D.destroy()})})})});describe("addUnits",function(){beforeEach(function(){D=E("div")});it("should return an empty string if size passed is an empty string",function(){expect(D.addUnits("")).toEqual("")});it("should return auto if size passed is 'auto' string",function(){expect(D.addUnits("auto")).toEqual("auto")});it("should return an empty string if size passed is undefined",function(){expect(D.addUnits(undefined)).toEqual("")});it("should return an empty string if size passed is null",function(){expect(D.addUnits(null)).toEqual("")})});describe("destroy",function(){var G,F;beforeEach(function(){D=E("div");G=D.id;F=D.dom});beforeEach(function(){D.destroy()});it("should remove dom property",function(){expect(D.dom).toBe(null)});it("should should remove the cache entry",function(){expect(G in Ext.cache).toBe(false)});if(!Ext.isIE8){it("should remove the element from the dom",function(){expect(F.parentNode).toBeNull()})}});if(Ext.isIE8){describe("destroy (IE8)",function(){var F;beforeEach(function(){D=E("div");F=D.dom});it("should schedule element for garbage collection",function(){var H=Ext.Element.destroyQueue,G=H.length;D.destroy();expect(H.length).toBe(G+1);expect(H[G]).toBe(F)});it("should finally destroy the element after a timeout",function(){runs(function(){D.destroy()});waits(32);runs(function(){expect(F.parentNode).toBeFalsy()})})})}describe("contains",function(){});describe("mask",function(){describe("masking the body el",function(){var J,I,K,H,G;function F(L){J=new Ext.Component({height:L||200,renderTo:Ext.getBody()});I=Ext.getBody().mask({msg:"Tom Sawyer"});K=document.body;H=K.scrollHeight;G=K.scrollWidth}afterEach(function(){Ext.removeNode(I.dom.nextSibling);Ext.removeNode(I.dom);Ext.destroy(J,I);J=I=K=H=G=null})})});xdescribe("deprecated 5.0",function(){describe("getAttributeNS",function(){beforeEach(function(){D=E("div")});it("should call element getAttribute",function(){spyOn(D,"getAttribute");D.getAttributeNS("ns1","align");expect(D.getAttribute).toHaveBeenCalledWith("align","ns1")})})});describe("getAttribute",function(){var G,F;beforeEach(function(){D=E("div");G=Ext.getBody().createChild({tag:"div"});if(D.dom.setAttribute){D.dom.setAttribute("qtip","bar");G.dom.setAttribute("ext:qtip","foo")}else{D.dom["qtip"]="bar";G.dom["ext:qtip"]="foo"}if(D.dom.setAttributeNS){F=Ext.getBody().createChild({tag:"div"});F.dom.setAttributeNS("ext","qtip","foobar")}});afterEach(function(){G.destroy();if(F){F.destroy()}});describe("without namespace",function(){it("should return the attribute value if it exists",function(){expect(D.getAttribute("qtip")).toEqual("bar")});it("should return null if the attribute does not exist",function(){expect(D.getAttribute("nothing")).toBeNull()})});describe("with namespace",function(){it("should return null on a non-namespaced attribute",function(){expect(D.getAttribute("qtip","ext")).toBeNull()});it("should return null if the attribute belong to another namespace",function(){expect(G.getAttribute("qtip","nothing")).toBeNull()});it("should return the attribute value if it belongs to the namespace",function(){if(F){expect(F.getAttribute("qtip","ext")).toEqual("foobar")}});it("should handle xml namespace",function(){expect(G.getAttribute("qtip","ext")).toEqual("foo")})})});describe("getAttributes",function(){it("should return an empty object for element with no attributes",function(){var G=document.createElement("div");var F=Ext.fly(G).getAttributes();expect(F).toEqual({});Ext.fly(G).destroy()});it("should return all attributes",function(){var G=Ext.getBody().createChild({tag:"div",foo:42});var F=G.getAttributes();expect(F).toEqual({foo:"42",id:G.id});G.destroy()})});describe("update",function(){beforeEach(function(){D=E("div");D.dom.innerHTML="hello world"});it("should update dom element innerHTML",function(){D.update("foobar");expect(D.dom).hasHTML("foobar")});it("should return element",function(){expect(D.update("foobar")).toBe(D)})});describe("prototype aliases",function(){beforeEach(function(){D=E("div")});it("should aliases addListener with on",function(){expect(typeof (D.on)).toEqual("function")});it("should aliases removeListener with un",function(){expect(typeof (D.un)).toEqual("function")});it("should aliases removeAllListeners with clearListeners",function(){expect(typeof (D.clearListeners)).toEqual("function")})});describe("visibilityMode",function(){var G=["DISPLAY","VISIBILITY","OFFSETS","CLIP"],F;beforeEach(function(){D=E("div")});describe("setVisibilityMode and getVisibilityMode",function(){function H(I){it("should work with "+I,function(){var J=Ext.dom.Element[I];D.setVisibilityMode(J);expect(D.getVisibilityMode()).toBe(J)})}for(F=0;F<G.length;F++){H(G[F])}});describe("visibility mode on flyweights",function(){function H(I){it("should retain "+I,function(){var J=Ext.dom.Element[I];Ext.fly(D.dom).setVisibilityMode(J);expect(Ext.fly(D.dom).getVisibilityMode()).toBe(J)})}for(F=0;F<G.length;F++){H(G[F])}})});(Ext.toolkit==="modern"?describe:xdescribe)("setVisible",function(){var I=["DISPLAY","VISIBILITY","OFFSETS","CLIP"],H={DISPLAY:Ext.baseCSSPrefix+"hidden-display",VISIBILITY:Ext.baseCSSPrefix+"hidden-visibility",OFFSETS:Ext.baseCSSPrefix+"hidden-offsets",CLIP:Ext.baseCSSPrefix+"hidden-clip"},G;beforeEach(function(){D=E("div")});function F(J){describe("hiding with "+J,function(){var N=Ext.dom.Element[J],O=H[J],M=Ext.Array.difference(I,[J]),K,L;beforeEach(function(){D.setVisibilityMode(N);D.setVisible(false)});it("should assign "+O,function(){expect(D.hasCls(O)).toBe(true)});for(L=0;L<M.length;L++){K=H[M[L]];it("should remove "+K,function(){expect(D.hasCls(K)).toBe(false)})}describe("showing with "+J,function(){beforeEach(function(){D.setVisible(true)});it("should remove "+O,function(){expect(D.hasCls(O)).toBe(false)});for(L=0;L<M.length;L++){K=H[M[L]];it("should not add "+K,function(){expect(D.hasCls(K)).toBe(false)})}})})}for(G=0;G<I.length;G++){F(I[G])}});describe("visibility",function(){var H,F,G=[Ext.dom.Element.DISPLAY,Ext.dom.Element.VISIBILITY];beforeEach(function(){D=E("div");H=D.createChild({tag:"div"});if(H){H.setVisible(true);F=H.createChild({tag:"div"});if(F){F.setVisible(true)}}});afterEach(function(){if(F){F.destroy()}if(H){H.destroy()}});it("should toggle the visibility of the element itself",function(){for(var I in G){D.setVisibilityMode(G[I]);D.setVisible(false);expect(D.isVisible(false)).toBe(false);D.setVisible(true);expect(D.isVisible(false)).toBe(true)}});it("should toggle the 'deep' visibility of the grand-child",function(){for(var I in G){D.setVisibilityMode(G[I]);D.setVisible(false);expect(F.isVisible(true)).toBe(false);D.setVisible(true);expect(F.isVisible(true)).toBe(true)}})});describe("getMargin",function(){beforeEach(function(){D=E("div");D.setStyle({marginTop:"1px",marginRight:"11px",marginBottom:"21px",marginLeft:"31px"})});function F(){D.dom.style.marginTop="";D.dom.style.marginRight="";D.dom.style.marginBottom="";D.dom.style.marginLeft=""}describe("with sides",function(){it("should return the top",function(){expect(D.getMargin("t")).toBe(1)});it("should return the right",function(){expect(D.getMargin("r")).toBe(11)});it("should return the bottom",function(){expect(D.getMargin("b")).toBe(21)});it("should return the left",function(){expect(D.getMargin("l")).toBe(31)});it("should return the sum of the vertical margins",function(){expect(D.getMargin("tb")).toBe(22)});it("should return the sum of the horizontal margins",function(){expect(D.getMargin("lr")).toBe(42)});it("should return the sum of all margins",function(){expect(D.getMargin("trbl")).toBe(64)});it("should coerce missing margins to 0",function(){F();expect(D.getMargin("t")).toBe(0);expect(D.getMargin("r")).toBe(0);expect(D.getMargin("b")).toBe(0);expect(D.getMargin("l")).toBe(0);expect(D.getMargin("tb")).toBe(0);expect(D.getMargin("lr")).toBe(0)})});describe("with no sides",function(){it("should return the margins with each margin name & shortcut",function(){expect(D.getMargin()).toEqual({t:1,top:1,r:11,right:11,b:21,bottom:21,l:31,left:31})});it("should coerce missing margins to 0",function(){F();expect(D.getMargin()).toEqual({t:0,top:0,r:0,right:0,b:0,bottom:0,l:0,left:0})})})})})}A();A(true);describe("class methods",function(){var C,D,B,E,F;beforeEach(function(){C=Ext.getBody().createChild({tag:"div"});B=C.dom;F=Ext.id();E=document.createElement("div");E.id=F;document.body.appendChild(E)});afterEach(function(){spyOn(Ext.Logger,"warn");C.destroy();if(D){D.destroy()}if(E&&E.parentNode===document.body){document.body.removeChild(E)}});describe("get",function(){describe("alias",function(){it("should alias Ext.dom.Element.get with Ext.get",function(){spyOn(Ext.dom.Element,"get");Ext.get();expect(Ext.dom.Element.get).toHaveBeenCalled()})});describe("passing string id as first argument",function(){describe("with a dom element which is not already encapsulated",function(){it("should return a new Ext.dom.Element",function(){D=Ext.get(F);expect(D instanceof Ext.dom.Element).toBe(true)});it("should encapsulate the dom element in the Ext.dom.Element",function(){D=Ext.get(F);expect(D.dom).toBe(E)});it("should add element to Ext.cache",function(){D=Ext.get(F);expect(Ext.cache[F]===D)})});describe("with a dom element which is already encapsulated",function(){it("should return the corresponding Ext.Element",function(){expect(Ext.get(B)).toBe(C)})})});describe("passing dom element as first argument",function(){describe("with a dom element which is not already encapsulated",function(){it("should return a new Ext.dom.Element",function(){D=Ext.get(E);expect(D instanceof Ext.dom.Element).toBe(true)});it("should encapsulate the dom element in the Ext.dom.Element",function(){D=Ext.get(E);expect(D.dom).toBe(E)});it("should add element to Ext.cache",function(){expect(Ext.cache[E.id]===E)})});describe("with a dom element which is already encapsulated",function(){it("should return the corresponding Ext.Element",function(){expect(Ext.get(B.id)).toBe(C)})})});describe("passing an Ext.dom.Element as first argument",function(){it("should return Ext.dom.Element",function(){expect(Ext.get(C)).toBe(C)})});describe("passing a Ext.dom.FlyWeight as first argument",function(){it("should return Ext.dom.Element",function(){var G=Ext.get(Ext.fly(B));expect(G).toBe(C);expect(G.isFly).toBeUndefined()})});describe("passing a CompositeElement as first argument",function(){var G;beforeEach(function(){G=Ext.select("div")});it("should return Ext.dom.Element",function(){expect(Ext.get(G)).toBe(G)})});describe("passing an array as first argument",function(){it("should call Ext.dom.Element.select",function(){var G=[B,E];spyOn(Ext.dom.Element,"select");Ext.get(G);expect(Ext.dom.Element.select).toHaveBeenCalledWith(G)})});describe("passing document as first argument",function(){it("should return an Ext.dom.Element",function(){expect(Ext.get(document) instanceof Ext.dom.Element).toBe(true)});xit("should return a bogus Ext.dom.Element",function(){expect(Ext.get(document).id).not.toBeDefined()});it("should return an Ext.dom.Element that encapsulate document",function(){expect(Ext.get(document).dom).toBe(document)})});it("should not wrap a documentFragment",function(){var H=document.createDocumentFragment(),G=Ext.get(H);expect(G).toBe(null)});it("should wrap the window object",function(){var H=window,G=Ext.get(H);expect(G instanceof Ext.dom.Element).toBe(true);expect(G.dom).toBe(H)});it("should wrap the document object",function(){var H=document,G=Ext.get(H);expect(G instanceof Ext.dom.Element).toBe(true);expect(G.dom).toBe(H)});describe("document and window within iframe",function(){var H,G;beforeEach(function(){H=document.createElement("iframe");document.body.appendChild(H);waitsFor(function(){return !!H.contentWindow.document.body})});afterEach(function(){document.body.removeChild(H);G.destroy()});it("should wrap an iframe's window object",function(){var I=H.contentWindow;G=Ext.get(I);expect(G instanceof Ext.dom.Element).toBe(true);expect(G.dom).toBe(I)});it("should wrap an iframe's document object",function(){var I=H.contentWindow.document;G=Ext.get(I);expect(G instanceof Ext.dom.Element).toBe(true);expect(G.dom).toBe(I)})});it("should not wrap a text node",function(){expect(Ext.get(document.createTextNode(("foo")))).toBe(null)})});xdescribe("garbageCollector",function(){});describe("fly",function(){var G;beforeEach(function(){spyOn(Ext,"getDom").andCallThrough()});describe("use strict",function(){var H;beforeEach(function(){Ext.fly=(function(I){H=I;return function(K,J){return I(K,J||"_global")}}(Ext.fly))});afterEach(function(){Ext.fly=H});it("should work when called by strict mode function",function(){var I=Ext.fly(E)})});describe("global flyweight",function(){beforeEach(function(){G=Ext.fly(E)});it("should return an Ext.dom.Element.Fly",function(){expect(G instanceof Ext.dom.Fly).toBe(true)});it("should not cache a dom element",function(){expect(Ext.cache[E.id]).toBeUndefined()});it("should call Ext.getDom",function(){expect(Ext.getDom).toHaveBeenCalledWith(E)})});describe("named reusable flyweight",function(){beforeEach(function(){G=Ext.fly(E,"myflyweight")});it("should return an Ext.dom.Element.Flyweight",function(){expect(G instanceof Ext.dom.Fly).toBe(true)});it("should not cache a dom element",function(){expect(Ext.cache[E.id]).toBeUndefined()});it("should call Ext.getDom",function(){expect(Ext.getDom).toHaveBeenCalledWith(E)})});it("should wrap a documentFragment",function(){var I=document.createDocumentFragment(),H=Ext.fly(I);expect(H instanceof Ext.dom.Fly).toBe(true);expect(H.dom).toBe(I)});it("should wrap the window object",function(){var I=window,H=Ext.fly(I);expect(H instanceof Ext.dom.Element).toBe(true);expect(H.dom).toBe(I)});it("should wrap the document object",function(){var I=document,H=Ext.fly(I);expect(H instanceof Ext.dom.Element).toBe(true);expect(H.dom).toBe(I)});describe("document and window within iframe",function(){var H;beforeEach(function(){H=document.createElement("iframe");document.body.appendChild(H)});afterEach(function(){document.body.removeChild(H)});it("should wrap an iframe's window object",function(){var J=H.contentWindow,I=Ext.fly(J);expect(I instanceof Ext.dom.Fly).toBe(true);expect(I.dom).toBe(J)});it("should wrap an iframe's document object",function(){var J=H.contentWindow.document,I=Ext.fly(J);expect(I instanceof Ext.dom.Fly).toBe(true);expect(I.dom).toBe(J)})});it("should not wrap a text node",function(){expect(Ext.fly(document.createTextNode(("foo")))).toBe(null)})});describe("aliases",function(){it("should aliases Ext.dom.Element.get with Ext.get",function(){spyOn(Ext.dom.Element,"get");Ext.get();expect(Ext.dom.Element.get).toHaveBeenCalled()});it("should aliases Ext.fly with Ext.Element.fly",function(){spyOn(Ext,"fly");Ext.Element.fly();expect(Ext.fly).toHaveBeenCalled()})})});describe("getXY",function(){var B;beforeEach(function(){B=document.createElement("div")});it("should not throw when reading unattached element",function(){Ext.fly(B).getXY()})});describe("Ext",function(){it("should return false when an Ext.Element instance is passed to Ext.isElement",function(){expect(Ext.isElement(Ext.getBody())).toBe(false)});it("should return false when an Ext.Element instance is passed to Ext.isTextNode",function(){expect(Ext.isTextNode(Ext.getBody())).toBe(false)})});(Ext.toolkit==="classic"?describe:xdescribe)("Ext.isGarbage",function(){it("should return false if the element is the window",function(){expect(Ext.isGarbage(window)).toBe(false)});it("should return false if the element is the document",function(){expect(Ext.isGarbage(document)).toBe(false)});it("should return false if the element is the documentElement",function(){expect(Ext.isGarbage(document.documentElement)).toBe(false)});it("should return false if the element is in the DOM",function(){var B=Ext.getBody().createChild();expect(Ext.isGarbage(B.dom)).toBe(false);B.destroy()});it("should return true if the element is not in the DOM",function(){expect(Ext.isGarbage(document.createElement("div"))).toBe(true)});it("should return false if the element is in the detached body",function(){var B=Ext.getDetachedBody().createChild();expect(Ext.isGarbage(B.dom)).toBe(false);B.destroy()});it("should return false if the element is in the dom and the cache contains an element with the same id",function(){var B=Ext.getBody().createChild({id:"foo"});document.body.removeChild(B.dom);B=Ext.getBody().createChild({id:"foo"});expect(Ext.isGarbage(B.dom)).toBe(false);B.destroy()})});describe("shim",function(){var C;beforeEach(function(){C=Ext.getBody().createChild({style:"position:absolute;left:250px;top:150px;width:200px;height:100px;"})});afterEach(function(){if(!C.destroyed){C.destroy()}});function B(D,H,E,F){var G=C.shim.el.getBox();expect(G.x).toBe(D);expect(G.y).toBe(H);expect(G.width).toBe(E);expect(G.height).toBe(F)}it("should not have a shim by default",function(){expect(C.shim).toBeUndefined()});it("should create a shim",function(){C.enableShim();expect(C.shim instanceof Ext.dom.Shim).toBe(true)});it("should show the shim upon creation",function(){C.enableShim();expect(C.shim.el.isVisible()).toBe(true)});it("should insert the shim as the previousSibling of its target",function(){C.enableShim();expect(C.dom.previousSibling).toBe(C.shim.el.dom)});it("should be an iframe",function(){C.enableShim();expect(C.shim.el.dom.tagName).toBe("IFRAME")});it("should have a CSS class of 'x-shim'",function(){C.enableShim();expect(C.shim.el).toHaveCls("x-shim")});it("should have a role of 'presentation'",function(){C.enableShim();expect(C.shim.el.dom.getAttribute("role")).toBe("presentation")});it("should have frameBorder: '0' on the iframe",function(){C.enableShim();expect(C.shim.el.dom.getAttribute("frameBorder")).toBe("0")});it("should set the iframe's src to Ext.SSL_SECURE_URL",function(){C.enableShim();expect(C.shim.el.dom.getAttribute("src")).toBe(Ext.SSL_SECURE_URL)});it("should have a tabindex of '-1'",function(){C.enableShim();expect(C.shim.el.dom.getAttribute("tabIndex")).toBe("-1")});it("should not show the shim if the element is not visible",function(){C.hide();C.enableShim();expect(C.shim.el).toBeUndefined()});it("should not show the shim upon creation if ths isVisible parameter is false",function(){C.enableShim(null,false);expect(C.shim.el).toBeUndefined()});it("should hide the shim when the element is destroyed",function(){C.enableShim();var E=C.shim,D=E.el;C.destroy();expect(E.el).toBeNull();expect(D.isVisible()).toBe(false);expect(D.destroyed).toBeFalsy()});it("should use DISPLAY visibilityMode for the shim",function(){C.enableShim();expect(C.shim.el.getVisibilityMode()).toBe(Ext.Element.DISPLAY)});it("should allow fixed positioning to be configured",function(){C.enableShim({fixed:true});expect(C.shim.el.getStyle("position")).toBe("fixed")});it("should set the z-index of the shim when the z-index of the element is set",function(){C.enableShim();C.setZIndex(174);expect(parseInt(C.shim.el.getStyle("z-index"),10)).toBe(174)});it("should align the shim to the target element",function(){C.enableShim();B(250,150,200,100)});it("should realign the shim using passed coordinates",function(){C.enableShim();C.shim.realign(25,50,75,85);B(25,50,75,85)});it("should realign the shim in response to setLeft()",function(){C.enableShim();C.setLeft(300);B(300,150,200,100)});it("should realign the shim in response to setTop()",function(){C.enableShim();C.setTop(300);B(250,300,200,100)});it("should realign the shim in response to setLocalX()",function(){C.enableShim();C.setLocalX(300);B(300,150,200,100)});it("should realign the shim in response to setLocalY()",function(){C.enableShim();C.setLocalY(300);B(250,300,200,100)});it("should realign the shim in response to setLocalXY()",function(){C.enableShim();C.setLocalXY(300,400);B(300,400,200,100)});it("should realign the shim in response to setX()",function(){C.enableShim();C.setX(300);B(300,150,200,100)});it("should realign the shim in response to setY()",function(){C.enableShim();C.setY(300);B(250,300,200,100)});it("should realign the shim in response to setXY()",function(){C.enableShim();C.setXY([300,400]);B(300,400,200,100)});it("should realign the shim in response to setWidth()",function(){C.enableShim();C.setWidth(400);B(250,150,400,100)});it("should realign the shim in response to setHeight()",function(){C.enableShim();C.setHeight(400);B(250,150,200,400)});it("should realign the shim in response to setSize()",function(){C.enableShim();C.setSize(450,550);B(250,150,450,550)});it("should realign the shim in response to setBox()",function(){C.enableShim();C.setBox({x:300,y:400,width:500,height:600});B(300,400,500,600)});it("should disable the shim",function(){C.enableShim();var D=C.shim.el;C.disableShim();expect(C.shim.el).toBeNull();expect(D.isVisible()).toBe(false)});it("should re-enable the shim after disabling",function(){C.enableShim();C.disableShim();C.enableShim();expect(C.shim.el.isVisible()).toBe(true);B(250,150,200,100)});it("should realign the shim when re-enabling if the target el was moved",function(){C.enableShim();C.disableShim();C.setXY([500,450]);C.setSize(50,60);C.enableShim();B(500,450,50,60)});it("should hide the shim when the target element is hidden",function(){C.enableShim();var E=C.shim,D=E.el;C.hide();expect(E.el).toBeNull();expect(D.isVisible()).toBe(false)});it("should show and realign the shim when the target element is shown",function(){C.hide();C.enableShim();C.show();expect(C.shim.el.isVisible()).toBe(true);B(250,150,200,100)});it("should hide the shim when the target element is hidden using setDisplayed",function(){C.enableShim();var E=C.shim,D=E.el;C.setDisplayed(false);expect(E.el).toBeNull();expect(D.isVisible()).toBe(false)});it("should show and realign the shim when the target element is shown using setDisplayed",function(){C.setDisplayed(false);C.enableShim();C.setDisplayed(true);expect(C.shim.el.isVisible()).toBe(true);B(250,150,200,100)});it("should disable the shim when disableShim is called",function(){C.enableShim();var D=C.shim.el;expect(C.shim.disabled).toBe(false);expect(C.shim.el.isVisible()).toBe(true);C.disableShim();expect(C.shim.disabled).toBe(true);expect(D.isVisible()).toBe(false);expect(C.shim.el).toBeNull()});it("should enable a disabled shim when enableShim is called",function(){C.enableShim();C.disableShim();C.enableShim();expect(C.shim.disabled).toBe(false);expect(C.shim.el.isVisible()).toBe(true)});it("should realign a disabled shim when it is re-enabled",function(){C.enableShim();C.disableShim();C.setXY([575,325]);C.setSize(250,315);C.enableShim();B(575,325,250,315)});it("should not attempt to hide a disabled shim when the element is hidden",function(){C.enableShim();C.disableShim();spyOn(C.shim,"hide").andCallThrough();C.hide();expect(C.shim.hide).not.toHaveBeenCalled()});it("should not show a disabled shim when the element is shown",function(){C.enableShim();C.hide();C.disableShim();C.show();expect(C.shim.el).toBeNull();expect(C.shim.disabled).toBe(true)});if(Ext.toolkit==="classic"){it("should mask all iframes when resizing an element with shim and unmask when done.",function(){var D=Ext.getBody().createChild({tag:"iframe",src:"about:blank",style:"position:absolute;left:0px;top:0px;width:200px;height:100px;"});var E=Ext.create("Ext.window.Window",{width:100,height:100,title:"Test",shim:true}).show();jasmine.fireMouseEvent(E.resizer.south,"mousedown");expect(Ext.fly(D.dom.parentNode).isMasked()).toBe(true);jasmine.fireMouseEvent(E.resizer.south,"mouseup");expect(Ext.fly(D.dom.parentNode).isMasked()).toBe(false);D.destroy();E.destroy()})}});describe("shadow",function(){var D=Ext.isIE8?{x:-2,y:-2,w:6,h:6}:{x:4,y:4,w:-4,h:-4},C;beforeEach(function(){this.addMatchers({toBeWithin:function(E,F){var G=this.actual;if(E>0){return G>=(F-E)&&G<=(F+E)}else{return G>=(F+E)&&G<=(F-E)}}});C=Ext.getBody().createChild({style:"position:absolute;left:250px;top:150px;width:200px;height:100px;"})});afterEach(function(){if(!C.destroyed){C.destroy()}});function B(E,I,F,G){var H=C.shadow.el.getBox();expect(H.x).toBe(E+D.x);expect(H.y).toBe(I+D.y);expect(H.width).toBeWithin(1,F+D.w);expect(H.height).toBe(G+D.h)}it("should not have a shadow by default",function(){expect(C.shadow).toBeUndefined()});it("should create a shadow",function(){C.enableShadow();expect(C.shadow instanceof Ext.dom.Shadow).toBe(true)});it("should show the shadow upon creation",function(){C.enableShadow();expect(C.shadow.el.isVisible()).toBe(true)});it("should insert the shadow as the previousSibling of its target",function(){C.enableShadow();expect(C.dom.previousSibling).toBe(C.shadow.el.dom)});it("should have the correct CSS class",function(){C.enableShadow();expect(C.shadow.el).toHaveCls(Ext.supports.CSS3BoxShadow?"x-css-shadow":"x-ie-shadow")});it("should have a role of 'presentation'",function(){C.enableShadow();expect(C.shadow.el.dom.getAttribute("role")).toBe("presentation")});it("should not show the shadow if the element is not visible",function(){C.hide();C.enableShadow();expect(C.shadow.el).toBeUndefined()});it("should not show the shadow upon creation if ths isVisible parameter is false",function(){C.enableShadow(null,false);expect(C.shadow.el).toBeUndefined()});it("should hide the shadow when the element is destroyed",function(){C.enableShadow();var F=C.shadow,E=F.el;C.destroy();expect(F.el).toBeNull();expect(E.isVisible()).toBe(false);expect(E.destroyed).toBeFalsy()});it("should use DISPLAY visibilityMode for the shadow",function(){C.enableShadow();expect(C.shadow.el.getVisibilityMode()).toBe(Ext.Element.DISPLAY)});it("should allow fixed positioning to be configured",function(){C.enableShadow({fixed:true});expect(C.shadow.el.getStyle("position")).toBe("fixed")});it("should set the z-index of the shadow when the z-index of the element is set",function(){C.enableShadow();C.setZIndex(174);expect(parseInt(C.shadow.el.getStyle("z-index"),10)).toBe(174)});it("should set the shadow's offset",function(){C.enableShadow({offset:10});expect(C.shadow.offset).toBe(10)});it("should set the shadow's mode",function(){C.enableShadow({mode:"drop"});expect(C.shadow.mode).toBe("drop")});it("should align the shadow to the target element",function(){C.enableShadow();B(250,150,200,100)});it("should realign the shadow using passed coordinates",function(){C.enableShadow();C.shadow.realign(25,50,75,85);B(25,50,75,85)});it("should realign the shadow in response to setLeft()",function(){C.enableShadow();C.setLeft(300);B(300,150,200,100)});it("should not constrain the shadow when the element left position is < 0",function(){C.enableShadow();C.setLeft(-100);B(-100,150,200,100)});it("should realign the shadow in response to setTop()",function(){C.enableShadow();C.setTop(300);B(250,300,200,100)});it("should not constrain the shadow when the element top position is < 0",function(){C.enableShadow();C.setTop(-100);B(250,-100,200,100)});it("should realign the shadow in response to setLocalX()",function(){C.enableShadow();C.setLocalX(300);B(300,150,200,100)});it("should realign the shadow in response to setLocalY()",function(){C.enableShadow();C.setLocalY(300);B(250,300,200,100)});it("should realign the shadow in response to setLocalXY()",function(){C.enableShadow();C.setLocalXY(300,400);B(300,400,200,100)});it("should realign the shadow in response to setX()",function(){C.enableShadow();C.setX(300);B(300,150,200,100)});it("should realign the shadow in response to setY()",function(){C.enableShadow();C.setY(300);B(250,300,200,100)});it("should realign the shadow in response to setXY()",function(){C.enableShadow();C.setXY([300,400]);B(300,400,200,100)});it("should realign the shadow in response to setWidth()",function(){C.enableShadow();C.setWidth(400);B(250,150,400,100)});it("should realign the shadow in response to setHeight()",function(){C.enableShadow();C.setHeight(400);B(250,150,200,400)});it("should realign the shadow in response to setSize()",function(){C.enableShadow();C.setSize(450,550);B(250,150,450,550)});it("should realign the shadow in response to setBox()",function(){C.enableShadow();C.setBox({x:300,y:400,width:500,height:600});B(300,400,500,600)});it("should disable the shadow",function(){C.enableShadow();var E=C.shadow.el;C.disableShadow();expect(C.shadow.el).toBeNull();expect(E.isVisible()).toBe(false)});it("should re-enable the shadow after disabling",function(){C.enableShadow();C.disableShadow();C.enableShadow();expect(C.shadow.el.isVisible()).toBe(true);B(250,150,200,100)});it("should realign the shadow when re-enabling if the target el was moved",function(){C.enableShadow();C.disableShadow();C.setXY([500,450]);C.setSize(50,60);C.enableShadow();B(500,450,50,60)});it("should hide the shadow when the target element is hidden",function(){C.enableShadow();var F=C.shadow,E=F.el;C.hide();expect(F.el).toBeNull();expect(E.isVisible()).toBe(false)});it("should show and realign the shadow when the target element is shown",function(){C.hide();C.enableShadow();C.show();expect(C.shadow.el.isVisible()).toBe(true);B(250,150,200,100)});it("should hide the shadow when the target element is hidden using setDisplayed",function(){C.enableShadow();var F=C.shadow,E=F.el;C.setDisplayed(false);expect(F.el).toBeNull();expect(E.isVisible()).toBe(false)});it("should show and realign the shadow when the target element is shown using setDisplayed",function(){C.setDisplayed(false);C.enableShadow();C.setDisplayed(true);expect(C.shadow.el.isVisible()).toBe(true);B(250,150,200,100)});it("should disable the shadow when disableShadow is called",function(){C.enableShadow();var E=C.shadow.el;expect(C.shadow.disabled).toBe(false);expect(C.shadow.el.isVisible()).toBe(true);C.disableShadow();expect(C.shadow.disabled).toBe(true);expect(E.isVisible()).toBe(false);expect(C.shadow.el).toBeNull()});it("should enable a disabled shadow when enableShadow is called",function(){C.enableShadow();C.disableShadow();C.enableShadow();expect(C.shadow.disabled).toBe(false);expect(C.shadow.el.isVisible()).toBe(true)});it("should realign a disabled shadow when it is re-enabled",function(){C.enableShadow();C.disableShadow();C.setXY([575,325]);C.setSize(250,315);C.enableShadow();B(575,325,250,315)});it("should not attempt to hide a disabled shadow when the element is hidden",function(){C.enableShadow();C.disableShadow();spyOn(C.shadow,"hide").andCallThrough();C.hide();expect(C.shadow.hide).not.toHaveBeenCalled()});it("should not show a disabled shadow when the element is shown",function(){C.enableShadow();C.hide();C.disableShadow();C.show();expect(C.shadow.el).toBeNull();expect(C.shadow.disabled).toBe(true)});(Ext.supports.Opacity?it:xit)("should set the opacity of the shadow when the opacity of the element is changed",function(){C.enableShadow();C.setStyle("opacity","0.5");expect(C.shadow.el.getStyle("opacity")).toBe("0.5")});(Ext.toolkit==="classic"?describe:xdescribe)("animate:false (default)",function(){it("should hide the shadow during setWidth animation",function(){var E=false,G,F;C.enableShadow();G=C.shadow;F=G.el;expect(F.isVisible()).toBe(true);C.setWidth(400,{duration:200,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return !G.el&&!F.isVisible()},"Shadow was never hidden",150);waitsFor(function(){return E},"Animation never completed",300);runs(function(){expect(C.shadow.el.isVisible()).toBe(true);B(250,150,400,100)})});it("should hide the shadow during setHeight animation",function(){var E=false,G,F;C.enableShadow();G=C.shadow;F=G.el;expect(F.isVisible()).toBe(true);C.setHeight(500,{duration:200,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return !G.el&&!F.isVisible()},"Shadow was never hidden",150);waitsFor(function(){return E},"Animation never completed",300);runs(function(){expect(C.shadow.el.isVisible()).toBe(true);B(250,150,200,500)})});it("should hide the shadow during setSize animation",function(){var E=false,G,F;C.enableShadow();G=C.shadow;F=G.el;expect(F.isVisible()).toBe(true);C.setSize(500,400,{duration:200,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return !G.el&&!F.isVisible()},"Shadow was never hidden",150);waitsFor(function(){return E},"Animation never completed",300);runs(function(){expect(C.shadow.el.isVisible()).toBe(true);B(250,150,500,400)})});it("should hide the shadow during setX animation",function(){var E=false,G,F;C.enableShadow();G=C.shadow;F=G.el;expect(F.isVisible()).toBe(true);C.setX(300,{duration:200,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return !G.el&&!F.isVisible()},"Shadow was never hidden",150);waitsFor(function(){return E},"Animation never completed",300);runs(function(){expect(C.shadow.el.isVisible()).toBe(true);B(300,150,200,100)})});it("should hide the shadow during setY animation",function(){var E=false,G,F;C.enableShadow();G=C.shadow;F=G.el;expect(F.isVisible()).toBe(true);C.setY(350,{duration:200,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return !G.el&&!F.isVisible()},"Shadow was never hidden",150);waitsFor(function(){return E},"Animation never completed",300);runs(function(){expect(C.shadow.el.isVisible()).toBe(true);B(250,350,200,100)})});it("should hide the shadow during setXY animation",function(){var E=false,G,F;C.enableShadow();G=C.shadow;F=G.el;expect(F.isVisible()).toBe(true);C.setXY([350,400],{duration:200,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return !G.el&&!F.isVisible()},"Shadow was never hidden",150);waitsFor(function(){return E},"Animation never completed",300);runs(function(){expect(C.shadow.el.isVisible()).toBe(true);B(350,400,200,100)})});describe("with disabled shadow",function(){it("should not show the shadow after setWidth animation",function(){var E=false;C.enableShadow();C.disableShadow();spyOn(C.shadow,"show").andCallThrough();C.setWidth(400,{duration:10,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return E},"Animation never completed",100);runs(function(){expect(C.shadow.show).not.toHaveBeenCalled();expect(C.shadow.el).toBeNull()})});it("should not show the shadow after setHeight animation",function(){var E=false;C.enableShadow();C.disableShadow();spyOn(C.shadow,"show").andCallThrough();C.setHeight(400,{duration:10,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return E},"Animation never completed",100);runs(function(){expect(C.shadow.show).not.toHaveBeenCalled();expect(C.shadow.el).toBeNull()})});it("should not show the shadow after setSize animation",function(){var E=false;C.enableShadow();C.disableShadow();spyOn(C.shadow,"show").andCallThrough();C.setSize(400,500,{duration:10,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return E},"Animation never completed",100);runs(function(){expect(C.shadow.show).not.toHaveBeenCalled();expect(C.shadow.el).toBeNull()})});it("should not show the shadow after setX animation",function(){var E=false;C.enableShadow();C.disableShadow();spyOn(C.shadow,"show").andCallThrough();C.setX(300,{duration:10,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return E},"Animation never completed",100);runs(function(){expect(C.shadow.show).not.toHaveBeenCalled();expect(C.shadow.el).toBeNull()})});it("should not show the shadow after setY animation",function(){var E=false;C.enableShadow();C.disableShadow();spyOn(C.shadow,"show").andCallThrough();C.setY(300,{duration:10,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return E},"Animation never completed",100);runs(function(){expect(C.shadow.show).not.toHaveBeenCalled();expect(C.shadow.el).toBeNull()})});it("should not show the shadow after setXY animation",function(){var E=false;C.enableShadow();C.disableShadow();spyOn(C.shadow,"show").andCallThrough();C.setXY([400,350],{duration:10,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return E},"Animation never completed",100);runs(function(){expect(C.shadow.show).not.toHaveBeenCalled();expect(C.shadow.el).toBeNull()})})})});(Ext.toolkit==="classic"?describe:xdescribe)("animate:true",function(){it("should not hide the shadow during setWidth animation",function(){var E=false;C.enableShadow({animate:true});spyOn(C.shadow,"hide").andCallThrough();expect(C.shadow.el.isVisible()).toBe(true);C.setWidth(400,{duration:50,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return E},"Animation never completed",300);runs(function(){expect(C.shadow.hide).not.toHaveBeenCalled();expect(C.shadow.el.isVisible()).toBe(true);B(250,150,400,100)})});it("should not hide the shadow during setHeight animation",function(){var E=false;C.enableShadow({animate:true});spyOn(C.shadow,"hide").andCallThrough();expect(C.shadow.el.isVisible()).toBe(true);C.setHeight(500,{duration:50,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return E},"Animation never completed",300);runs(function(){expect(C.shadow.hide).not.toHaveBeenCalled();expect(C.shadow.el.isVisible()).toBe(true);B(250,150,200,500)})});it("should not hide the shadow during setSize animation",function(){var E=false;C.enableShadow({animate:true});spyOn(C.shadow,"hide").andCallThrough();expect(C.shadow.el.isVisible()).toBe(true);C.setSize(500,400,{duration:50,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return E},"Animation never completed",300);runs(function(){expect(C.shadow.hide).not.toHaveBeenCalled();expect(C.shadow.el.isVisible()).toBe(true);B(250,150,500,400)})});it("should not hide the shadow during setX animation",function(){var E=false;C.enableShadow({animate:true});spyOn(C.shadow,"hide").andCallThrough();expect(C.shadow.el.isVisible()).toBe(true);C.setX(300,{duration:50,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return E},"Animation never completed",300);runs(function(){expect(C.shadow.hide).not.toHaveBeenCalled();expect(C.shadow.el.isVisible()).toBe(true);B(300,150,200,100)})});it("should not hide the shadow during setY animation",function(){var E=false;C.enableShadow({animate:true});spyOn(C.shadow,"hide").andCallThrough();expect(C.shadow.el.isVisible()).toBe(true);C.setY(350,{duration:50,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return E},"Animation never completed",300);runs(function(){expect(C.shadow.hide).not.toHaveBeenCalled();expect(C.shadow.el.isVisible()).toBe(true);B(250,350,200,100)})});it("should not hide the shadow during setXY animation",function(){var E=false;C.enableShadow({animate:true});spyOn(C.shadow,"hide").andCallThrough();expect(C.shadow.el.isVisible()).toBe(true);C.setXY([350,400],{duration:50,listeners:{afteranimate:function(){E=true}}});waitsFor(function(){return E},"Animation never completed",300);runs(function(){expect(C.shadow.hide).not.toHaveBeenCalled();expect(C.shadow.el.isVisible()).toBe(true);B(350,400,200,100)})})})});describe("shim and shadow together",function(){var B;beforeEach(function(){B=Ext.getBody().createChild({style:"position:absolute;left:250px;top:150px;width:200px;height:100px;"})});afterEach(function(){B.destroy()});function C(D,H,E,F){var G=B.shim.el.getBox();expect(G.x).toBe(D);expect(G.y).toBe(H);expect(G.width).toBe(E);expect(G.height).toBe(F)}it("should place the shim before the shadow in the dom if the shadow was created first",function(){B.enableShadow();B.enableShim();expect(B.prev()).toBe(B.shadow.el);expect(B.shadow.el.prev()).toBe(B.shim.el)});it("should place the shim before the shadow in the dom if the shim was created first",function(){B.enableShim();B.enableShadow();expect(B.prev()).toBe(B.shadow.el);expect(B.shadow.el.prev()).toBe(B.shim.el)});it("should have the correct dom order after hiding and showing the shim",function(){B.enableShim();B.enableShadow();B.shim.hide();B.shim.getPool().reset();B.shim.show();expect(B.prev()).toBe(B.shadow.el);expect(B.shadow.el.prev()).toBe(B.shim.el)});it("should have the correct dom order after hiding and showing the shadow",function(){B.enableShim();B.enableShadow();B.shadow.hide();B.shadow.getPool().reset();B.shadow.show();expect(B.prev()).toBe(B.shadow.el);expect(B.shadow.el.prev()).toBe(B.shim.el)});it("should size the shim to include the target and shadow with mode=='drop'",function(){B.enableShim();B.enableShadow({mode:"drop",offset:30});C(250,150,230,130)});it("should size the shim to include the target and shadow with mode=='sides'",function(){B.enableShadow({mode:"sides",offset:30});B.enableShim();C(220,150,260,130)});it("should size the shim to include the target and shadow with mode=='frame'",function(){B.enableShim();B.enableShadow({mode:"frame",offset:30});C(220,120,260,160)});it("should size the shim to include the target and shadow with mode=='bottom'",function(){B.enableShadow({mode:"bottom",offset:30});B.enableShim();C(220,150,260,130)})});describe("using flyweights",function(){it("should be able to remove a class using a fly when the className is modified directly",function(){var B=document.createElement("div");Ext.fly(B).addCls(["foo","bar","baz"]);B.className+=" asdf";Ext.fly(B).removeCls("asdf");expect(B.className.indexOf("asdf")).toBe(-1)});it("should be able to check a class exists using a fly when the className is modified directly",function(){var B=document.createElement("div");Ext.fly(B).addCls(["foo","bar","baz"]);B.className+=" asdf";expect(Ext.fly(B).hasCls("asdf")).toBe(true)})});describe("events",function(){function B(C){describe("element "+(C?"(with delegated listeners)":"(with direct listeners)"),function(){var I,M,E,N,K,G,J,L;function D(O){I.addListener(Ext.apply({click:M,delegated:C,translate:false},O))}function H(O){I.removeListener(Ext.apply({click:M},O))}function F(P,O){jasmine.fireMouseEvent(P||I,O||"click")}beforeEach(function(){M=jasmine.createSpy();M.andCallFake(function(){N=this;K=arguments});E=jasmine.createSpy();I=Ext.getBody().createChild({id:"parent",cn:[{id:"child",cls:"child",cn:{id:"grandchild",cls:"grandchild"}},{id:"child2"}]});G=document.getElementById("child");J=document.getElementById("child2");L=document.getElementById("grandchild")});afterEach(function(){I.destroy()});describe("addListener",function(){it("should handle an event",function(){D();F();expect(M.callCount).toBe(1);expect(K[0] instanceof Ext.event.Event).toBe(true);expect(K[1]).toBe(I.dom);expect(K[2]).toEqual({click:M,delegated:C,translate:false});expect(N).toBe(I)});it("should handle an event that bubbled from a descendant element",function(){D();F(L);expect(M.callCount).toBe(1);expect(K[0] instanceof Ext.event.Event).toBe(true);expect(K[1]).toBe(L);expect(K[2]).toEqual({click:M,delegated:C,translate:false});expect(N).toBe(I)});it("should attach multiple handlers to the same event",function(){D();D({click:E});F();expect(M.callCount).toBe(1);expect(E.callCount).toBe(1)});it("should call the event handler with the correct scope when the scope option is used",function(){var O={};D({scope:O});F();expect(N).toBe(O)});it("should call the handler multiple times if the event fires more than once",function(){D();F();F();F();expect(M.callCount).toBe(3)});it("should remove a single listener after the first fire",function(){D({single:true});F();expect(M.callCount).toBe(1);F();expect(M.callCount).toBe(1)});it("should delay the listener",function(){D({delay:150});F();waits(30);runs(function(){expect(M).not.toHaveBeenCalled()});waits(150);runs(function(){expect(M).toHaveBeenCalled()})});it("should buffer the listener",function(){D({buffer:150});F();waits(100);runs(function(){expect(M).not.toHaveBeenCalled();F()});waits(100);runs(function(){expect(M).not.toHaveBeenCalled()});waits(100);runs(function(){expect(M).toHaveBeenCalled()})});it("should attach listeners with a delegate selector",function(){D({delegate:".grandchild"});F(G);expect(M).not.toHaveBeenCalled();F(L);expect(M).toHaveBeenCalled()});it("should attach listeners with a descendant delegate selector as a direct child",function(){D({delegate:".child"});F(J);expect(M).not.toHaveBeenCalled();F(G);expect(M).toHaveBeenCalled()});it("should attach listeners with a direct child delegate selector",function(){D({delegate:"> .child"});F(J);expect(M).not.toHaveBeenCalled();F(G);expect(M).toHaveBeenCalled()});it("should pass the target as the delegate item when the event occurs in a child and leave the event target untouched",function(){D({delegate:".child"});F(L);expect(M).toHaveBeenCalled();expect(M.mostRecentCall.args[0].target).toBe(L);expect(M.mostRecentCall.args[1]).toBe(G)});describe("propagation",function(){var O;beforeEach(function(){O=[];L=Ext.get("grandchild");G=Ext.get("child")});afterEach(function(){L.destroy();G.destroy()});it("should fire bubble listeners in bottom-up order",function(){I.on({click:function(){O.push(1)}});G.on({click:function(){O.push(2)}});L.on({click:function(){O.push(3)}});F(L);expect(O).toEqual([3,2,1])});it("should fire capture listeners in top-down order",function(){I.on({click:function(){O.push(1)},capture:true});G.on({click:function(){O.push(2)},capture:true});L.on({click:function(){O.push(3)},capture:true});F(L);expect(O).toEqual([1,2,3])});it("should stop bubbling when stopPropagation is called",function(){I.on({click:M});L.on({click:function(P){P.stopPropagation()}});F(L);expect(M).not.toHaveBeenCalled()});it("should stop propagating when stopPropagation is called during the capture phase",function(){I.on({click:function(P){P.stopPropagation()},capture:true});L.on({click:M,capture:true});F(L);expect(M).not.toHaveBeenCalled()});it("should skip the entire bubble phase if stopPropagation is called during the capture phase",function(){I.on({click:function(P){P.stopPropagation()},capture:true});I.on({click:M});L.on({click:E});F(L);expect(M).not.toHaveBeenCalled();expect(E).not.toHaveBeenCalled()});it("should propagate to elements that were not in the cache when propagation began",function(){var P=Ext.getBody().createChild({cn:[{}]},null,true),R=P.firstChild,Q=false;Ext.get(R).on("click",function(){Ext.get(P).on("click",function(){Q=true})});jasmine.fireMouseEvent(R,"click");expect(Q).toBe(true);Ext.get(P).destroy()})})});describe("removeListener",function(){it("should remove the event listener",function(){D();H();F();expect(M).not.toHaveBeenCalled()});it("should remove the event listener with scope",function(){var O={};D({scope:O});H({scope:O});F();expect(M).not.toHaveBeenCalled()});it("should remove multiple handlers from the same event",function(){D();D({click:E});H();F();expect(M).not.toHaveBeenCalled();expect(E.callCount).toBe(1);H({click:E});F();expect(E.callCount).toBe(1)});it("should remove a single event listener",function(){D({single:true});H();F();expect(M).not.toHaveBeenCalled()});it("should remove a delayed event listener",function(){D({delay:50});H();F();waits(100);runs(function(){expect(M).not.toHaveBeenCalled()})});it("should remove a buffered event listener",function(){D({buffer:50});H();F();waits(100);runs(function(){expect(M).not.toHaveBeenCalled()})});it("should remove listeners with a delegate selector",function(){D({delegate:".grandchild"});H();F(L);expect(M).not.toHaveBeenCalled()});it("should remove a capture listener",function(){D({capture:true});H();F(L);expect(M).not.toHaveBeenCalled()});it("should remove a translated listener",function(){var O=Ext.Element.prototype.eventMap;O.foo="click";I.addListener({foo:M});I.removeListener({foo:M});F(L);expect(M).not.toHaveBeenCalled();delete O.foo})});describe("clearListeners",function(){it("should remove all the listeners",function(){var O=jasmine.createSpy(),P=jasmine.createSpy();I.on({click:M});I.on({click:E,delegate:".grandchild"});I.on({click:O,capture:true});I.on({click:P});I.clearListeners();F(L);expect(M).not.toHaveBeenCalled();expect(E).not.toHaveBeenCalled();expect(O).not.toHaveBeenCalled();expect(P).not.toHaveBeenCalled()})})})}B(true);B(false);describe("Event Normalization",function(){var G,F,D,C,E;beforeEach(function(){G=Ext.getBody().createChild();E={mousedown:jasmine.createSpy(),mousemove:jasmine.createSpy(),mouseup:jasmine.createSpy(),touchstart:jasmine.createSpy(),touchmove:jasmine.createSpy(),touchend:jasmine.createSpy(),pointerdown:jasmine.createSpy(),pointermove:jasmine.createSpy(),pointerup:jasmine.createSpy()};G.on(E)});afterEach(function(){G.destroy()});if(Ext.supports.PointerEvents){D={start:"pointerdown",move:"pointermove",end:"pointerup"};F=function(H){jasmine.firePointerEvent(G,D[H])}}else{if(Ext.supports.MSPointerEvents){D={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"};F=function(H){jasmine.firePointerEvent(G,D[H])}}else{if(Ext.supports.TouchEvents){D={start:"touchstart",move:"touchmove",end:"touchend"};C={start:"mousedown",move:"mousemove",end:"mouseup"};F=function(I,H){if(H){jasmine.fireMouseEvent(G,C[I],100,100)}else{jasmine.fireTouchEvent(G,D[I],[{pageX:1,pageY:1}])}}}else{D={start:"mousedown",move:"mousemove",end:"mouseup"};F=function(H){jasmine.fireMouseEvent(G,D[H])}}}}it("should fire start events",function(){F("start");expect(E.pointerdown.callCount).toBe(1);expect(E.touchstart.callCount).toBe(1);expect(E.mousedown.callCount).toBe(1);expect(E.pointerdown.mostRecentCall.args[0].type).toBe("pointerdown");expect(E.touchstart.mostRecentCall.args[0].type).toBe("touchstart");expect(E.mousedown.mostRecentCall.args[0].type).toBe("mousedown")});it("should fire move events",function(){F("move");expect(E.pointermove.callCount).toBe(1);expect(E.touchmove.callCount).toBe(1);expect(E.mousemove.callCount).toBe(1);expect(E.pointermove.mostRecentCall.args[0].type).toBe("pointermove");expect(E.touchmove.mostRecentCall.args[0].type).toBe("touchmove");expect(E.mousemove.mostRecentCall.args[0].type).toBe("mousemove")});it("should fire end events",function(){F("end");expect(E.pointerup.callCount).toBe(1);expect(E.touchend.callCount).toBe(1);expect(E.mouseup.callCount).toBe(1);expect(E.pointerup.mostRecentCall.args[0].type).toBe("pointerup");expect(E.touchend.mostRecentCall.args[0].type).toBe("touchend");expect(E.mouseup.mostRecentCall.args[0].type).toBe("mouseup")});if(Ext.supports.TouchEvents&&Ext.isWebKit&&Ext.os.is.Desktop){it("should fire secondary start events",function(){F("start",true);expect(E.pointerdown.callCount).toBe(1);expect(E.touchstart.callCount).toBe(1);expect(E.mousedown.callCount).toBe(1);expect(E.pointerdown.mostRecentCall.args[0].type).toBe("pointerdown");expect(E.touchstart.mostRecentCall.args[0].type).toBe("touchstart");expect(E.mousedown.mostRecentCall.args[0].type).toBe("mousedown")});it("should fire secondary move events",function(){F("move",true);expect(E.pointermove.callCount).toBe(1);expect(E.touchmove.callCount).toBe(1);expect(E.mousemove.callCount).toBe(1);expect(E.pointermove.mostRecentCall.args[0].type).toBe("pointermove");expect(E.touchmove.mostRecentCall.args[0].type).toBe("touchmove");expect(E.mousemove.mostRecentCall.args[0].type).toBe("mousemove")});it("should fire secondary end events",function(){F("end",true);expect(E.pointerup.callCount).toBe(1);expect(E.touchend.callCount).toBe(1);expect(E.mouseup.callCount).toBe(1);expect(E.pointerup.mostRecentCall.args[0].type).toBe("pointerup");expect(E.touchend.mostRecentCall.args[0].type).toBe("touchend");expect(E.mouseup.mostRecentCall.args[0].type).toBe("mouseup")})}});describe("delegates event order",function(){var C,D;function E(F){jasmine.fireMouseEvent(F,"click")}beforeEach(function(){D=jasmine.createSpy()});afterEach(function(){C=D=Ext.destroy(C)});it("should fire an event when the event target matches the selector",function(){C=Ext.getBody().createChild({children:[{cls:"foo"}]});C.on("click",D,null,{delegate:".foo"});E(C.first());expect(D.callCount).toBe(1)});it("should not fire an event when the event target doesn't match the selector",function(){C=Ext.getBody().createChild({children:[{cls:"foo"}]});C.on("click",D,null,{delegate:".bar"});E(C.first());expect(D).not.toHaveBeenCalled()});it("should have the element that triggered the event as the event target",function(){C=Ext.getBody().createChild({children:[{cls:"foo",children:[{cls:"bar"}]}]});var F=C.down(".bar").dom;C.on("click",D,null,{delegate:".foo"});E(F);expect(D.mostRecentCall.args[0].target).toBe(F)});it("should pass the delegate target as the second parameter",function(){C=Ext.getBody().createChild({children:[{cls:"foo",children:[{cls:"bar"}]}]});var F=C.down(".bar").dom,G=C.down(".foo").dom;C.on("click",D,null,{delegate:".foo"});E(F);expect(D.mostRecentCall.args[1]).toBe(G)});describe("event order",function(){it("should fire delegate events at the 'level' of the root",function(){C=Ext.getBody().createChild({children:[{cls:"foo",children:[{cls:"bar",children:[{cls:"baz"}]}]}]});var I=C.down(".foo"),G=C.down(".bar"),H=C.down(".baz"),F=[];C.on("click",function(){F.push("baz")},null,{delegate:".baz"});G.on("click",function(){F.push("bar")});I.on("click",function(){F.push("foo")});E(H.dom);expect(F).toEqual(["bar","foo","baz"])});it("should fire delegate events in DOM order",function(){C=Ext.getBody().createChild({id:"root",children:[{id:"child1",children:[{id:"child1_1",children:[{cls:"foo"}]},{cls:"foo"}]},{id:"child2",children:[{cls:"foo"}]},{cls:"foo"}]});var I=Ext.get("child1"),H=Ext.get("child2"),G=Ext.get("child1_1"),F=[];C.on("click",function(){F.push("root")},null,{delegate:".foo"});I.on("click",function(){F.push("child1")},null,{delegate:".foo"});G.on("click",function(){F.push("child1_1")},null,{delegate:".foo"});H.on("click",function(){F.push("child2")},null,{delegate:".foo"});E(G.down(".foo",true),"click");expect(F).toEqual(["child1_1","child1","root"]);Ext.destroy(G,I,H)})})});describe("listener arguments",function(){it("should fire an event with the correct signature on every element in the bubble stack",function(){var H=Ext.getBody().appendChild({id:"c1",cn:{id:"c2",cn:{id:"c3",cn:{id:"c4"}}}}),G=Ext.get(H.dom.firstChild),F=Ext.get(G.dom.firstChild),E=Ext.get(F.dom.firstChild),D={el:H},C={el:G},K={el:F},J={el:E},I;H.on("click",function(M,L,N){expect(arguments.length).toBe(I);expect(M.$className).toBe("Ext.event.Event");expect(L).toBe(E.dom);expect(N.el===H).toBe(true)},null,D);G.on("click",function(M,L,N){expect(arguments.length).toBe(I);expect(M.$className).toBe("Ext.event.Event");expect(L).toBe(E.dom);expect(N.el===G).toBe(true)},null,C);F.on("click",function(M,L,N){expect(arguments.length).toBe(I);expect(M.$className).toBe("Ext.event.Event");expect(L).toBe(E.dom);expect(N.el===F).toBe(true)},null,K);E.on("click",function(M,L,N){I=arguments.length;expect(M.$className).toBe("Ext.event.Event");expect(L).toBe(E.dom);expect(N.el===E).toBe(true)},null,J);jasmine.fireMouseEvent(E,"click");H.destroy()})});it("should fire delegated, non-delegated, capture and bubble events in the correct order",function(){var D=Ext.getBody().createChild({cn:[{id:"child",cn:[{id:"grandchild"}]}]}),F=Ext.get("child"),E=Ext.get("grandchild"),C=[];D.on({mousedown:function(){C.push("p")}});D.on({mousedown:function(){C.push("pc")},capture:true});D.on({mousedown:function(){C.push("pd")},delegated:false});D.on({mousedown:function(){C.push("pdc")},delegated:false,capture:true});F.on({mousedown:function(){C.push("c")}});F.on({mousedown:function(){C.push("cc")},capture:true});F.on({mousedown:function(){C.push("cd")},delegated:false});F.on({mousedown:function(){C.push("cdc")},delegated:false,capture:true});E.on({mousedown:function(){C.push("g")}});E.on({mousedown:function(){C.push("gc")},capture:true});E.on({mousedown:function(){C.push("gdc")},delegated:false,capture:true});E.on({mousedown:function(){C.push("gd")},delegated:false});jasmine.fireMouseEvent(E,"mousedown");if(Ext.isIE9m){expect(C).toEqual(["gd","gdc","cdc","cd","pdc","pd","pc","cc","gc","g","c","p"])}else{expect(C).toEqual(["pdc","cdc","gdc","gd","cd","pd","pc","cc","gc","g","c","p"])}D.destroy()});it("should lowercase the event name before adding it to hasListeners",function(){var C=Ext.getBody().createChild({});C.on("foO","onFoo");expect(C.hasListeners.foO).toBeUndefined();expect(C.hasListeners.foo).toBe(1);C.destroy()});it("should translate the event name before adding it to hasListeners",function(){var C=Ext.getBody().createChild({});C.eventMap={click:"tap"};C.on("click","onClick");expect(C.hasListeners.click).toBeUndefined();expect(C.hasListeners.tap).toBe(1);C.destroy()});it("should translate and lowercase the event name before adding it to hasListeners",function(){var C=Ext.getBody().createChild({});C.eventMap={click:"tap"};C.on("cLicK","onClick");expect(C.hasListeners.cLicK).toBeUndefined();expect(C.hasListeners.click).toBeUndefined();expect(C.hasListeners.tap).toBe(1);C.destroy()});it("should fire a translated event",function(){var D=Ext.getBody().createChild({}),C=jasmine.createSpy();D.eventMap={click:"tap"};D.on("click",C);jasmine.fireMouseEvent(D,"mousedown");jasmine.fireMouseEvent(D,"mouseup");expect(C).toHaveBeenCalled();D.destroy()});it("should fire a lowercased event",function(){var D=Ext.getBody().createChild({}),C=jasmine.createSpy();D.on("cLicK",C);jasmine.fireMouseEvent(D,"click");expect(C).toHaveBeenCalled();D.destroy()});it("should fire a translated and lowercased event",function(){var D=Ext.getBody().createChild({}),C=jasmine.createSpy();D.eventMap={click:"tap"};D.on("cLicK",C);jasmine.fireMouseEvent(D,"mousedown");jasmine.fireMouseEvent(D,"mouseup");expect(C).toHaveBeenCalled();D.destroy()});describe("options",function(){var C;beforeEach(function(){C=Ext.getBody().createChild({})});afterEach(function(){C.destroy();C=null});it("should call preventDefault if the preventDefault option is passed",function(){var D=spyOn(Ext.event.Event.prototype,"preventDefault");C.on("click",function(){},null,{preventDefault:true});jasmine.fireMouseEvent(C,"click");expect(D.callCount).toBe(1)});it("should call stopPropagation if the stopPropagation option is passed",function(){var D=spyOn(Ext.event.Event.prototype,"stopPropagation");C.on("click",function(){},null,{stopPropagation:true});jasmine.fireMouseEvent(C,"click");expect(D.callCount).toBe(1)});it("should call stopEvent if the stopEvent option is passed",function(){var D=spyOn(Ext.event.Event.prototype,"stopEvent");C.on("click",function(){},null,{stopEvent:true});jasmine.fireMouseEvent(C,"click");expect(D.callCount).toBe(1)})})})},"/src/dom/Element.js")