(Ext.supports.Touch?describe:xdescribe)("Ext.event.gesture.Pinch",function(){var C=Ext.testHelper,N,L,G,J,K,E,A,I,P;function B(Q){C.touchStart(N,Q)}function D(Q){C.touchMove(N,Q)}function F(Q){C.touchEnd(N,Q)}function O(Q){C.touchCancel(N,Q)}function M(S,R){var Q;for(Q in R){expect(S[Q]).toBe(R[Q])}}function H(R,T,Q,S){return new Ext.util.Point(R,T).getDistanceTo({x:Q,y:S})}beforeEach(function(){N=Ext.getBody().createChild({});L=jasmine.createSpy();G=jasmine.createSpy();J=jasmine.createSpy();K=jasmine.createSpy();L.andCallFake(function(Q){E=Q});G.andCallFake(function(Q){A=Q});J.andCallFake(function(Q){I=Q});K.andCallFake(function(Q){I=Q});N.on("pinchstart",L);N.on("pinch",G);N.on("pinchend",J);N.on("pinchcancel",K)});afterEach(function(){N.destroy()});it("should fire pinchstart, pinch, and pinchend",function(){var R,Q;runs(function(){B({id:1,x:100,y:102});B({id:2,x:200,y:198});D({id:1,x:105,y:103})});waitsForAnimation();runs(function(){expect(L).toHaveBeenCalled();Q=R=H(105,103,200,198);expect(E.distance).toBe(R);expect(E.scale).toBe(1);D({id:2,x:195,y:190})});waitsForAnimation();runs(function(){R=H(105,103,195,190);expect(G.callCount).toBe(1);expect(A.distance).toBe(R);expect(A.scale).toBe(R/Q);D({id:1,x:125,y:133})});waitsForAnimation();runs(function(){R=H(125,133,195,190);expect(G.callCount).toBe(2);expect(A.distance).toBe(R);expect(A.scale).toBe(R/Q);F({id:1,x:125,y:133});F({id:2,x:195,y:190})});waitsForAnimation();runs(function(){expect(J).toHaveBeenCalled()})});if(Ext.supports.Touch){it("should fire pinchcancel and not pinchend if the first touch is canceled",function(){var R,Q;runs(function(){B({id:1,x:100,y:102});B({id:2,x:200,y:198});D({id:1,x:105,y:103})});waitsForAnimation();runs(function(){expect(L).toHaveBeenCalled();Q=R=H(105,103,200,198);expect(E.distance).toBe(R);expect(E.scale).toBe(1);D({id:2,x:195,y:190})});waitsForAnimation();runs(function(){R=H(105,103,195,190);expect(G.callCount).toBe(1);expect(A.distance).toBe(R);expect(A.scale).toBe(R/Q);O({id:1,x:125,y:133});F({id:2,x:195,y:190})});waitsForAnimation();runs(function(){expect(K).toHaveBeenCalled();expect(J).not.toHaveBeenCalled()})});it("should fire pinchcancel if the second touch is canceled",function(){var R,Q;runs(function(){B({id:1,x:100,y:102});B({id:2,x:200,y:198});D({id:1,x:105,y:103})});waitsForAnimation();runs(function(){expect(L).toHaveBeenCalled();Q=R=H(105,103,200,198);expect(E.distance).toBe(R);expect(E.scale).toBe(1);D({id:2,x:195,y:190})});waitsForAnimation();runs(function(){R=H(105,103,195,190);expect(G.callCount).toBe(1);expect(A.distance).toBe(R);expect(A.scale).toBe(R/Q);O({id:2,x:195,y:190});F({id:1,x:125,y:133})});waitsForAnimation();runs(function(){expect(K).toHaveBeenCalled();expect(J).not.toHaveBeenCalled()})})}})