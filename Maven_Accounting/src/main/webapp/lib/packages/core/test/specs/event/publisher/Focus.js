describe("Ext.event.publisher.Focus",function(){var C=document.body,E=false,D,B,F;function A(){E=true}beforeEach(function(){var H=['<div id="a1" tabindex="-1" style="width:300px;height:100px;">','<div id="b1" tabindex="-1" style="width:100px;height:100%;">','<div id="c1" tabindex="-1" style="width:50px;height:100%"></div>','<div id="c2" tabindex="-1" style="width:50px;height:100%"></div>',"</div>",'<div id="b2" tabindex="-1" style="width:100px;height:100%;">','<div id="c3" tabindex="-1" style="width:50px;height:100%"></div>','<div id="c4" tabindex="-1" style="width:50px;height:100%"></div>',"</div>",'<div id="b3" tabindex="-1" style="width:100px;height:100%;">','<div id="c5" tabindex="-1" style="width:50px;height:100%"></div>','<div id="c6" tabindex="-1" style="width:50px;height:100%"></div>',"</div>","</div>",'<div id="a2" tabindex="-1" style="width:340px;height:100px;">','<div id="b4" tabindex="-1" style="width:100px;height:100%;">','<div id="c7" tabindex="-1" style="width:50px;height:100%"></div>','<div id="c8" tabindex="-1" style="width:50px;height:100%"></div>',"</div>",'<div id="b5" tabindex="-1" style="width:100px;height:100%;">','<div id="c9" tabindex="-1" style="width:50px;height:100%"></div>','<div id="c10" tabindex="-1" style="width:50px;height:100%"></div>',"</div>",'<div id="b6" tabindex="-1" style="width:100px;height:100%;">','<div id="c11" tabindex="-1" style="width:50px;height:100%"></div>','<div id="c12" tabindex="-1" style="width:50px;height:100%"></div>',"</div>","</div>",'<div id="a3" tabindex="-1" style="width:340px;height:100px;">','<div id="b7" tabindex="-1" style="width:100px;height:100%;">','<div id="c13" tabindex="-1" style="width:50px;height:100%"></div>','<div id="c14" tabindex="-1" style="width:50px;height:100%"></div>',"</div>",'<div id="b8" tabindex="-1" style="width:100px;height:100%;">','<div id="c15" tabindex="-1" style="width:50px;height:100%"></div>','<div id="c16" tabindex="-1" style="width:50px;height:100%"></div>',"</div>",'<div id="b9" tabindex="-1" style="width:100px;height:100%;">','<div id="c16" tabindex="-1" style="width:50px;height:100%"></div>','<div id="c18" tabindex="-1" style="width:50px;height:100%"></div>',"</div>","</div>"],I,G;Ext.dom.Helper.insertFirst(C,H.join(""));E=false;D=[];B=[];F=[];for(I=1,G=4;I<G;I++){D[I]=Ext.get("a"+I)}for(I=1,G=10;I<G;I++){B[I]=Ext.get("b"+I)}for(I=1,G=19;I<G;I++){F[I]=Ext.get("c"+I)}C.setAttribute("tabIndex",-1)});afterEach(function(){Ext.each([D,B,F],function(G){Ext.each(G,function(H){if(H){H.destroy()}})});C.removeAttribute("tabIndex")});describe("focusenter",function(){describe("fires",function(){function G(H,I){describe(H,function(){if(I){beforeEach(I)}beforeEach(function(){B[1].on("focusenter",A)});it("fires when element itself is focused",function(){B[1].focus();expect(E).toBe(true)});it("fires when child is focused",function(){F[1].focus();expect(E).toBe(true)});it("doesn't fire when parent is focused",function(){D[1].focus();expect(E).toBe(false)})})}G("from out of the universe");G("from the document",function(){C.focus()});G("from its parent",function(){D[1].focus()});G("from a parent's sibling",function(){D[3].focus()});G("from a sibling el",function(){B[2].focus()})});describe("doesn't fire",function(){describe("within the element",function(){it("when focus moves between children",function(){B[1].focus();D[1].on("focusenter",A);B[2].focus();expect(E).toBe(false)});it("when focus moves between grancdhildren",function(){F[1].focus();D[1].on("focusenter",A);F[2].focus();expect(E).toBe(false)});it("when focus moves between child and el itself",function(){B[1].focus();D[1].on("focusenter",A);D[1].focus();expect(E).toBe(false)});it("when focus moves between el and child",function(){D[1].focus();D[1].on("focusenter",A);B[1].focus();expect(E).toBe(false)});it("when focus moves between el and grandchild",function(){D[1].focus();D[1].on("focusenter",A);F[1].focus();expect(E).toBe(false)})})})});describe("focusleave",function(){describe("fires",function(){beforeEach(function(){B[1].on("focusleave",A);B[1].focus()});it("when focus moves to its parent",function(){D[1].focus();expect(E).toBe(true)});it("when focus moves to parent's sibling",function(){D[2].focus();expect(E).toBe(true)});it("when focus moves to the document",function(){C.focus();expect(E).toBe(true)})});describe("doesn't fire",function(){beforeEach(function(){D[1].on("focusleave",A);B[1].focus()});it("when focus moves from one child to another",function(){B[2].focus();expect(E).toBe(false)});it("when focus moves from child to grandchild",function(){F[1].focus();expect(E).toBe(false)});it("when focus moves from one grandchild to another",function(){F[1].focus();F[2].focus();expect(E).toBe(false)});it("when focus moves from child to el itself",function(){D[1].focus();expect(E).toBe(false)});it("when focus moves from grandchild to el itself",function(){F[1].focus();D[1].focus();expect(E).toBe(false)})})});describe("focusmove",function(){it("should fire focusmove whenever focus moves within an element",function(){var G,I,J,H;D[1].on("focusmove",function(K){G=K});B[1].on("focusmove",function(K){I=K});B[2].on("focusmove",function(K){J=K});F[1].on("focus",function(){H=true});F[1].focus();waitsFor(function(){return H},"Focus to move to a[1]>b[1]>c[1]");runs(function(){expect(G).toBeUndefined();expect(I).toBeUndefined();expect(J).toBeUndefined();F[2].focus()});waitsFor(function(){return !!G});runs(function(){expect(I).toBe(G);expect(J).toBeUndefined();expect(G.target).toBe(F[2].dom);expect(G.relatedTarget).toBe(F[1].dom);G=I=null;F[3].focus()});waitsFor(function(){return !!G});runs(function(){expect(I).toBeNull();expect(J).toBeUndefined();expect(G.target).toBe(F[3].dom);expect(G.relatedTarget).toBe(F[2].dom);G=null;H=false;F[3].suspendFocusEvents();F[1].suspendFocusEvents();F[1].focus()});jasmine.waitForFocus(F[1],"Focus to move from a[1]>b[2]>c[3] to a[1]>b[1]>c[1]");runs(function(){expect(G).toBe(null);F[1].resumeFocusEvents();F[3].resumeFocusEvents()});jasmine.waitAWhile();runs(function(){F[2].focus()});waitsFor(function(){return !!G})})})})