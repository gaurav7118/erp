describe("Ext.list.TreeItem",function(){var A,F,C,E;var G=Ext.define(null,{extend:"Ext.data.TreeModel",fields:["customField"]});function B(J,I){if(!C&&!I){C=new Ext.data.TreeStore({model:G,root:{expanded:true,children:E}})}F=new Ext.list.Tree(Ext.apply({store:C,animation:false},J));F.render(Ext.getBody());if(F.getStore()){A=F.getStore().getRoot()}}beforeEach(function(){E=[{id:"i1",text:"Item 1",iconCls:"iconA",children:[{id:"i11",text:"Item 1.1",leaf:true},{id:"i12",text:"Item 1.2",leaf:true}]},{id:"i2",text:"Item 2",expandable:false},{id:"i3",iconCls:"iconB",text:"Item 3",children:[]},{id:"i4",text:"Item 4",expanded:true,children:[{id:"i41",iconCls:"iconC",text:"Item 4.1"},{id:"i42",text:"Item 4.2",iconCls:null},{id:"i43",text:"Item 4.3"}]}]});afterEach(function(){A=E=C=F=Ext.destroy(F,C)});function D(I){return C.getNodeById(I)}function H(I){return F.getItem(D(I))}describe("items",function(){beforeEach(function(){B()});describe("at creation",function(){it("should render child items in order",function(){var J=H("i1"),I=J.itemContainer;expect(I.dom.childNodes[0]).toBe(H("i11").el.dom);expect(I.dom.childNodes[1]).toBe(H("i12").el.dom);J=H("i4");I=J.itemContainer;expect(I.dom.childNodes[0]).toBe(H("i41").el.dom);expect(I.dom.childNodes[1]).toBe(H("i42").el.dom);expect(I.dom.childNodes[2]).toBe(H("i43").el.dom)});it("should set the text on the textElement",function(){expect(H("i1").textElement.dom).hasHTML("Item 1");expect(H("i11").textElement.dom).hasHTML("Item 1.1");expect(H("i12").textElement.dom).hasHTML("Item 1.2");expect(H("i2").textElement.dom).hasHTML("Item 2");expect(H("i3").textElement.dom).hasHTML("Item 3");expect(H("i4").textElement.dom).hasHTML("Item 4");expect(H("i41").textElement.dom).hasHTML("Item 4.1");expect(H("i42").textElement.dom).hasHTML("Item 4.2");expect(H("i43").textElement.dom).hasHTML("Item 4.3")});describe("leafCls",function(){it("should have the leafCls if an item is a leaf",function(){Ext.Array.forEach(["i11","i12"],function(J){var I=H(J);expect(I.element).toHaveCls(I.leafCls)});Ext.Array.forEach(["i1","i2","i3","i4","i41","i42","i43"],function(J){var I=H(J);expect(I.element).not.toHaveCls(I.leafCls)})})});describe("iconCls",function(){it("should add the withIconCls and set the iconCls if there is an iconCls",function(){var J=H("i1"),I=H("i3"),K=H("i41");expect(J.iconElement).toHaveCls("iconA");expect(I.iconElement).toHaveCls("iconB");expect(K.iconElement).toHaveCls("iconC");expect(J.element).toHaveCls(J.withIconCls);expect(I.element).toHaveCls(I.withIconCls);expect(K.element).toHaveCls(K.withIconCls)});it("should not have the withIconCls if there is no iconCls",function(){Ext.Array.forEach(["i11","i12","i2","i4","i42","i43"],function(J){var I=H(J);expect(I.element).not.toHaveCls(I.withIconCls)})});it("should have the hideIconCls if the iconCls is null",function(){var I=H("i42");expect(I.element).toHaveCls(I.hideIconCls)});it("should not have the hideIconCls if the iconCls is not null",function(){Ext.Array.forEach(["i1","i11","i12","i2","i3","i4","i41","i43"],function(J){var I=H(J);expect(I.element).not.toHaveCls(I.hideIconCls)})})});describe("expanded/collapsed",function(){it("should add the collapsedCls if the item is collapsed and expandable",function(){Ext.Array.forEach(["i1","i41","i42","i43"],function(J){var I=H(J);expect(I.element).toHaveCls(I.collapsedCls)});Ext.Array.forEach(["i11","i12","i2","i3","i4"],function(J){var I=H(J);expect(I.element).not.toHaveCls(I.collapsedCls)})});it("should add the expandedCls if the item is expanded and expandable",function(){Ext.Array.forEach(["i4"],function(J){var I=H(J);expect(I.element).toHaveCls(I.expandedCls)});Ext.Array.forEach(["i1","i11","i12","i2","i3","i41","i42","i43"],function(J){var I=H(J);expect(I.element).not.toHaveCls(I.expandedCls)})})});describe("expandable",function(){it("should add the expandableCls if the item is expandable",function(){Ext.Array.forEach(["i1","i4","i41","i42","i43"],function(J){var I=H(J);expect(I.element).toHaveCls(I.expandableCls)});Ext.Array.forEach(["i11","i12","i2","i3"],function(J){var I=H(J);expect(I.element).not.toHaveCls(I.expandableCls)})})})});describe("dynamic store modifications",function(){describe("adding nodes",function(){it("should insert nodes in the right position",function(){D("i1").insertBefore({id:"i9"},D("i12"));var I=H("i1").itemContainer.dom.childNodes;expect(I[0]).toBe(H("i11").el.dom);expect(I[1]).toBe(H("i9").el.dom);expect(I[2]).toBe(H("i12").el.dom)});it("should append nodes to the right position",function(){D("i1").appendChild({id:"i9"});var I=H("i1").itemContainer.dom.childNodes;expect(I[0]).toBe(H("i11").el.dom);expect(I[1]).toBe(H("i12").el.dom);expect(I[2]).toBe(H("i9").el.dom)});it("should add the expandableCls when adding the first item",function(){var J=H("i3"),I=J.element;expect(I).not.toHaveCls(J.expandableCls);D("i3").appendChild({id:"i9"});expect(I).toHaveCls(J.expandableCls)})});describe("removing nodes",function(){it("should remove the element from the DOM",function(){var J=H("i42"),I=H("i4").itemContainer;expect(I.contains(J.el)).toBe(true);expect(I.child("#"+J.id)).toBe(J.el);D("i4").removeChild(D("i42"));expect(J.destroyed).toBe(true);expect(I.child("#"+J.id)).toBeNull()});it("should remove the expandableCls when removing the last item",function(){var J=H("i1"),I=J.element;D("i1").removeChild(D("i12"));expect(I).toHaveCls(J.expandableCls);D("i1").removeChild(D("i11"));expect(I).not.toHaveCls(J.expandableCls)})});describe("collapse",function(){describe("when expanded",function(){it("should have the collapsedCls",function(){var I=H("i4");D("i4").collapse();expect(I.element).toHaveCls(I.collapsedCls)});it("should not have the expandedCls",function(){var I=H("i4");D("i4").collapse();expect(I.element).not.toHaveCls(I.expandedCls)});it("should hide the itemContainer",function(){var I=H("i4");D("i4").collapse();expect(I.itemContainer.isVisible()).toBe(false)})});describe("when collapsed",function(){it("should have the collapsedCls",function(){var I=H("i1");D("i1").collapse();expect(I.element).toHaveCls(I.collapsedCls)});it("should not have the expandedCls",function(){var I=H("i1");D("i1").collapse();expect(I.element).not.toHaveCls(I.expandedCls)});it("should hide the itemContainer",function(){var I=H("i1");D("i1").collapse();expect(I.itemContainer.isVisible()).toBe(false)})})});describe("expand",function(){describe("when collapsed",function(){it("should have the expandedCls",function(){var I=H("i1");D("i1").expand();expect(I.element).toHaveCls(I.expandedCls)});it("should not have the collapsedCls",function(){var I=H("i1");D("i1").expand();expect(I.element).not.toHaveCls(I.collapsedCls)});it("should show the itemContainer",function(){var I=H("i1");D("i1").expand();expect(I.itemContainer.isVisible()).toBe(true)});describe("loading",function(){it("should have the loadingCls while loading",function(){MockAjaxManager.addMethods();var I=H("i41");expect(I.element).not.toHaveCls(I.loadingCls);I.expand();expect(I.element).toHaveCls(I.loadingCls);Ext.Ajax.mockComplete({status:200,responseText:"[]"});expect(I.element).not.toHaveCls(I.loadingCls);MockAjaxManager.removeMethods()})})});describe("when expanded",function(){it("should have the expandedCls",function(){var I=H("i4");D("i4").expand();expect(I.element).toHaveCls(I.expandedCls)});it("should not have the collapsedCls",function(){var I=H("i4");D("i4").expand();expect(I.element).not.toHaveCls(I.collapsedCls)});it("should hide the itemContainer",function(){var I=H("i4");D("i4").expand();expect(I.itemContainer.isVisible()).toBe(true)})})});describe("updating node fields",function(){it("should update the text when the text is changed",function(){D("i1").set("text","Foo");expect(H("i1").textElement.dom).hasHTML("Foo")});describe("with iconCls: null",function(){it("should remove hideIconCls when setting to empty",function(){var I=H("i42");expect(I.element).toHaveCls(I.hideIconCls);expect(I.element).not.toHaveCls(I.withIconCls);D("i42").set("iconCls","");expect(I.element).not.toHaveCls(I.hideIconCls);expect(I.element).not.toHaveCls(I.withIconCls)});it("should remove hideIconCls, add iconCls and add withIconCls when setting a class",function(){var I=H("i42");expect(I.element).toHaveCls(I.hideIconCls);expect(I.element).not.toHaveCls(I.withIconCls);D("i42").set("iconCls","foo");expect(I.element).not.toHaveCls(I.hideIconCls);expect(I.element).toHaveCls(I.withIconCls);expect(I.iconElement).toHaveCls("foo")})});describe("with an empty iconCls",function(){it("should add hideIconCls when setting to null",function(){var I=H("i43");expect(I.element).not.toHaveCls(I.hideIconCls);expect(I.element).not.toHaveCls(I.withIconCls);D("i43").set("iconCls",null);expect(I.element).toHaveCls(I.hideIconCls);expect(I.element).not.toHaveCls(I.withIconCls)});it("should add withIconCls and set the icon when setting a class",function(){var I=H("i43");expect(I.element).not.toHaveCls(I.hideIconCls);expect(I.element).not.toHaveCls(I.withIconCls);D("i43").set("iconCls","foo");expect(I.element).not.toHaveCls(I.hideIconCls);expect(I.element).toHaveCls(I.withIconCls);expect(I.iconElement).toHaveCls("foo")})});describe("with an iconCls specified",function(){it("should remove withIconCls, clear iconCls and add hideIconCls when setting to null",function(){var I=H("i41");expect(I.element).not.toHaveCls(I.hideIconCls);expect(I.element).toHaveCls(I.withIconCls);expect(I.iconElement).toHaveCls("iconC");D("i41").set("iconCls",null);expect(I.element).toHaveCls(I.hideIconCls);expect(I.element).not.toHaveCls(I.withIconCls);expect(I.iconElement).not.toHaveCls("iconC")});it("should remove withIconCls and clear iconCls when setting to empty",function(){var I=H("i41");expect(I.element).not.toHaveCls(I.hideIconCls);expect(I.element).toHaveCls(I.withIconCls);expect(I.iconElement).toHaveCls("iconC");D("i41").set("iconCls","");expect(I.element).not.toHaveCls(I.hideIconCls);expect(I.element).not.toHaveCls(I.withIconCls);expect(I.iconElement).not.toHaveCls("iconC")});it("should change the iconCls",function(){var I=H("i1");expect(I.element).toHaveCls(I.withIconCls);D("i1").set("iconCls","iconZ");expect(I.iconElement).not.toHaveCls("iconA");expect(I.iconElement).toHaveCls("iconZ");expect(I.element).toHaveCls(I.withIconCls)})});it("should set the cls and set the withIconCls when setting a iconCls",function(){var J=H("i2"),I=J.iconElement;expect(J.element).not.toHaveCls(J.withIconCls);D("i2").set("iconCls","iconZ");expect(I).toHaveCls("iconZ");expect(J.element).toHaveCls(J.withIconCls)});it("should remove the cls and hide the iconElement when clearing a iconCls",function(){var J=H("i1"),I=J.iconElement;expect(J.element).toHaveCls(J.withIconCls);D("i1").set("iconCls","");expect(I).not.toHaveCls("iconA");expect(J.element).not.toHaveCls(J.withIconCls)});it("should change the class when modifying the iconCls",function(){var J=H("i1"),I=J.iconElement;expect(J.element).toHaveCls(J.withIconCls);D("i1").set("iconCls","iconZ");expect(I).not.toHaveCls("iconA");expect(I).toHaveCls("iconZ");expect(J.element).toHaveCls(J.withIconCls)})})})});xdescribe("expand/collapse via UI",function(){describe("with expanderOnly: false",function(){beforeEach(function(){E[3].children[0].leaf=true;B({expanderOnly:false})});it("should expand when clicking the expander of a collapsed item",function(){var I=H("i1");expect(I.isExpanded()).toBe(false);jasmine.fireMouseEvent(I.expanderElement.dom,"click");expect(I.isExpanded()).toBe(true)});it("should collapse when clicking the expander of a expanded item",function(){var I=H("i4");expect(I.isExpanded()).toBe(true);jasmine.fireMouseEvent(I.expanderElement.dom,"click");expect(I.isExpanded()).toBe(false)});it("should expand when clicking on the element of a collapsed item",function(){var I=H("i1");expect(I.isExpanded()).toBe(false);jasmine.fireMouseEvent(I.textElement.dom,"click");expect(I.isExpanded()).toBe(true)});it("should collapse when clicking on the element of an expanded item",function(){var I=H("i4");expect(I.isExpanded()).toBe(true);jasmine.fireMouseEvent(I.textElement.dom,"click");expect(I.isExpanded()).toBe(false)});it("should not collapse when clicking inside the itemContainer",function(){var I=H("i4");expect(I.isExpanded()).toBe(true);jasmine.fireMouseEvent(H("i41").textElement.dom,"click");expect(I.isExpanded()).toBe(true)})});describe("with expanderOnly: true",function(){beforeEach(function(){B({expanderOnly:true})});it("should expand when clicking the expander of a collapsed item",function(){var I=H("i1");expect(I.isExpanded()).toBe(false);jasmine.fireMouseEvent(I.expanderElement.dom,"click");expect(I.isExpanded()).toBe(true)});it("should collapse when clicking the expander of an expanded item",function(){var I=H("i4");expect(I.isExpanded()).toBe(true);jasmine.fireMouseEvent(I.expanderElement.dom,"click");expect(I.isExpanded()).toBe(false)});it("should not expand when clicking on the element of a collapsed item",function(){var I=H("i1");expect(I.isExpanded()).toBe(false);jasmine.fireMouseEvent(I.iconElement.dom,"click");jasmine.fireMouseEvent(I.textElement.dom,"click");jasmine.fireMouseEvent(I.element.dom,"click");expect(I.isExpanded()).toBe(false)});it("should not collapse when clicking on the element of an expanded item",function(){var I=H("i4");expect(I.isExpanded()).toBe(true);jasmine.fireMouseEvent(I.iconElement.dom,"click");jasmine.fireMouseEvent(I.textElement.dom,"click");jasmine.fireMouseEvent(I.element.dom,"click");expect(I.isExpanded()).toBe(true)})})})})