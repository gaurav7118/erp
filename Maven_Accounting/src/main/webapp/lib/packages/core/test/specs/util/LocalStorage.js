describe("Ext.util.LocalStorage",function(){var A;function B(){return new Ext.util.LocalStorage({id:"one",flushDelay:0})}beforeEach(function(){A=B()});afterEach(function(){A.clear();A.destroy();A=null});describe("initialization",function(){it("should start empty",function(){var C=A.getKeys();expect(C.length).toBe(0)});it("should start with last state",function(){A.setItem("foo","bar");A.destroy();A=B();var C=A.getKeys();expect(C.length).toBe(1);expect(C[0]).toBe("foo")})});describe("isolation",function(){var C;function D(){return new Ext.util.LocalStorage({id:"two",flushDelay:0})}beforeEach(function(){C=D()});afterEach(function(){C.clear();C.destroy();C=null});it("should isolate getKeys",function(){A.setItem("foo","bar");C.setItem("foo","42");var G=A.getKeys();expect(G.length).toBe(1);expect(G[0]).toBe("foo");var F=C.getKeys();expect(F.length).toBe(1);expect(F[0]).toBe("foo");expect(G).not.toBe(F);var H=A.getItem("foo");var E=C.getItem("foo");expect(H).toBe("bar");expect(E).toBe("42")});it("should isolate keys",function(){A.setItem("foo","bar");A.setItem("bar","foobar");C.setItem("foo","42");C.setItem("zip","abc");C.setItem("zap","xyz");var K=[A.key(0),A.key(1)];K.sort();expect(K[1]).toBe("foo");expect(K[0]).toBe("bar");expect(A.key(2)).toBe(null);var G=[C.key(0),C.key(1),C.key(2)];G.sort();expect(G[0]).toBe("foo");expect(G[1]).toBe("zap");expect(G[2]).toBe("zip");expect(C.key(3)).toBe(null);var J=A.getItem("foo");expect(J).toBe("bar");var I=A.getItem("bar");expect(I).toBe("foobar");var H=C.getItem("foo");expect(H).toBe("42");var F=C.getItem("zip");expect(F).toBe("abc");var E=C.getItem("zap");expect(E).toBe("xyz")});it("should isolate clear",function(){A.setItem("foo","bar");C.setItem("foo","42");A.clear();var G=A.getKeys();expect(G.length).toBe(0);var F=C.getItem("foo");var E=C.getKeys();expect(E.length).toBe(1);expect(F).toBe("42")});it("should isolate removeItem",function(){A.setItem("foo","bar");C.setItem("foo","42");A.removeItem("foo");var G=A.getKeys();expect(G.length).toBe(0);var F=C.getItem("foo");var E=C.getKeys();expect(E.length).toBe(1);expect(F).toBe("42")})});describe("cache",function(){it("should not share instances with the different id",function(){var D=Ext.util.LocalStorage.get("foo");var C=Ext.util.LocalStorage.get("bar");expect(D).not.toBe(C);D.release();C.release()});it("should share instances with the same id",function(){var D=Ext.util.LocalStorage.get("foo");var C=Ext.util.LocalStorage.get("foo");expect(D).toBe(C);D.release();C.release()});it("should destroy the instance on final release",function(){var C=Ext.util.LocalStorage.get("foo");expect(C._users).toBe(1);expect(C).toBe(Ext.util.LocalStorage.get("foo"));expect(C._users).toBe(2);C.release();expect(C._users).toBe(1);expect(C.destroyed).toBe(false);C.release();expect(C._users).toBe(0);expect(C.destroyed).toBe(true)})});describe("delayed operation",function(){var C;function D(){return new Ext.util.LocalStorage({id:"three",flushDelay:1})}beforeEach(function(){C=D()});afterEach(function(){C.clear();C.destroy();C=null});it("should delay writes",function(){if(C.el){runs(function(){C.setItem("foo","42");var E=C.el.getAttribute("xdata")||"{}";expect(E).toBe("{}")});waitsFor(function(){return !C._timer});runs(function(){var E=C.el.getAttribute("xdata");expect(E).toBe('{"foo":"42"}')})}});it("should flush writes when requested",function(){if(C.el){C.setItem("foo","42");var F=C.el.getAttribute("xdata")||"{}";expect(F).toBe("{}");expect(C._timer).not.toBe(null);C.save();expect(C._timer).toBe(null);var E=C.el.getAttribute("xdata");expect(E).toBe('{"foo":"42"}')}})})})