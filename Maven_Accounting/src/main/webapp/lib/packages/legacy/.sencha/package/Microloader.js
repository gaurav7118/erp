var Ext=Ext||window["Ext"]||{};Ext.Microloader=Ext.Microloader||(function(){var E=Ext.Boot,C=function(P){},F=function(P){console.log("[WARN] "+P)},I="_ext:"+location.pathname,D=function(P,Q){return I+P+"-"+(Q?Q+"-":"")+G.appId},L,H;try{H=window["localStorage"]}catch(M){}var B=window["applicationCache"],J={clearAllPrivate:function(R){if(H){H.removeItem(R.key);var Q,P,U=[],T=R.profile+"-"+G.appId,S=H.length;for(Q=0;Q<S;Q++){P=H.key(Q);if(P.indexOf(I)===0&&P.indexOf(T)!==-1){U.push(P)}}for(Q in U){C("Removing "+U[Q]+" from Local Storage");H.removeItem(U[Q])}}},retrieveAsset:function(P){try{return H.getItem(P)}catch(Q){return null}},setAsset:function(P,Q){try{if(Q===null||Q==""){H.removeItem(P)}else{H.setItem(P,Q)}}catch(R){if(H&&R.code==R.QUOTA_EXCEEDED_ERR){F("LocalStorage Quota exceeded, cannot store "+P+" locally")}}}};var A=function(P){if(typeof P.assetConfig==="string"){this.assetConfig={path:P.assetConfig}}else{this.assetConfig=P.assetConfig}this.type=P.type;this.key=D(this.assetConfig.path,P.manifest.profile);if(P.loadFromCache){this.loadFromCache()}};A.prototype={shouldCache:function(){return H&&this.assetConfig.update&&this.assetConfig.hash&&!this.assetConfig.remote},is:function(P){return(!!P&&this.assetConfig&&P.assetConfig&&(this.assetConfig.hash===P.assetConfig.hash))},cache:function(P){if(this.shouldCache()){J.setAsset(this.key,P||this.content)}},uncache:function(){J.setAsset(this.key,null)},updateContent:function(P){this.content=P},getSize:function(){return this.content?this.content.length:0},loadFromCache:function(){if(this.shouldCache()){this.content=J.retrieveAsset(this.key)}}};var N=function(Q){if(typeof Q.content==="string"){this.content=JSON.parse(Q.content)}else{this.content=Q.content}this.assetMap={};this.url=Q.url;this.fromCache=!!Q.cached;this.assetCache=!(Q.assetCache===false);this.key=D(this.url);this.profile=this.content.profile;this.hash=this.content.hash;this.loadOrder=this.content.loadOrder;this.deltas=this.content.cache?this.content.cache.deltas:null;this.cacheEnabled=this.content.cache?this.content.cache.enable:false;this.loadOrderMap=(this.loadOrder)?E.createLoadOrderMap(this.loadOrder):null;var R=this.content.tags,P=Ext.platformTags;if(R){if(R instanceof Array){for(var S=0;S<R.length;S++){P[R[S]]=true}}else{E.apply(P,R)}E.apply(P,E.loadPlatformsParam())}this.js=this.processAssets(this.content.js,"js");this.css=this.processAssets(this.content.css,"css")};N.prototype={processAsset:function(P,Q){var R=new A({manifest:this,assetConfig:P,type:Q,loadFromCache:this.assetCache});this.assetMap[P.path]=R;return R},processAssets:function(U,S){var R=[],T=U.length,Q,P;for(Q=0;Q<T;Q++){P=U[Q];R.push(this.processAsset(P,S))}return R},useAppCache:function(){return true},getAssets:function(){return this.css.concat(this.js)},getAsset:function(P){return this.assetMap[P]},shouldCache:function(){return this.hash&&this.cacheEnabled},cache:function(P){if(this.shouldCache()){J.setAsset(this.key,JSON.stringify(P||this.content))}else{C("Manifest caching is disabled.")}},is:function(P){C("Testing Manifest: "+this.hash+" VS "+P.hash);return this.hash===P.hash},uncache:function(){J.setAsset(this.key,null)},exportContent:function(){return E.apply({loadOrderMap:this.loadOrderMap},this.content)}};var K=[],O=false,G={init:function(){Ext.microloaded=true;var P=document.getElementById("microloader");G.appId=P?P.getAttribute("data-app"):"";if(Ext.beforeLoad){L=Ext.beforeLoad(Ext.platformTags)}var Q=Ext._beforereadyhandler;Ext._beforereadyhandler=function(){if(Ext.Boot!==E){Ext.apply(Ext.Boot,E);Ext.Boot=E}if(Q){Q()}}},applyCacheBuster:function(R){var P=new Date().getTime(),Q=R.indexOf("?")===-1?"?":"&";R=R+Q+"_dc="+P;return R},run:function(){G.init();var R=Ext.manifest;if(typeof R==="string"){var T=".json",P=R.indexOf(T)===R.length-T.length?R:R+".json",Q=D(P),S=J.retrieveAsset(Q);if(S){C("Manifest file, '"+P+"', was found in Local Storage");R=new N({url:P,content:S,cached:true});if(L){L(R)}G.load(R)}else{E.fetch(G.applyCacheBuster(P),function(U){C("Manifest file was not found in Local Storage, loading: "+P);R=new N({url:P,content:U.content});R.cache();if(L){L(R)}G.load(R)})}}else{C("Manifest was embedded into application javascript file");R=new N({content:R});G.load(R)}},load:function(T){G.urls=[];G.manifest=T;Ext.manifest=G.manifest.exportContent();var V=T.getAssets(),W=[],S,R,Q,P,U;for(Q=V.length,R=0;R<Q;R++){S=V[R];P=G.filterAsset(S);if(P){if(T.shouldCache()&&S.shouldCache()){if(S.content){C("Asset: "+S.assetConfig.path+" was found in local storage. No remote load for this file");U=E.registerContent(S.assetConfig.path,S.type,S.content);if(U.evaluated){F("Asset: "+S.assetConfig.path+" was evaluated prior to local storage being consulted.")}}else{C("Asset: "+S.assetConfig.path+" was NOT found in local storage. Adding to load queue");W.push(S)}}G.urls.push(S.assetConfig.path);E.assetConfig[S.assetConfig.path]=E.apply({type:S.type},S.assetConfig)}}if(W.length>0){G.remainingCachedAssets=W.length;while(W.length>0){S=W.pop();C("Preloading/Fetching Cached Assets from: "+S.assetConfig.path);E.fetch(S.assetConfig.path,(function(X){return function(Y){G.onCachedAssetLoaded(X,Y)}})(S))}}else{G.onCachedAssetsReady()}},onCachedAssetLoaded:function(Q,P){var R;P=G.parseResult(P);G.remainingCachedAssets--;if(!P.error){R=G.checksum(P.content,Q.assetConfig.hash);if(!R){F("Cached Asset '"+Q.assetConfig.path+"' has failed checksum. This asset will be uncached for future loading");Q.uncache()}C("Checksum for Cached Asset: "+Q.assetConfig.path+" is "+R);E.registerContent(Q.assetConfig.path,Q.type,P.content);Q.updateContent(P.content);Q.cache()}else{F("There was an error pre-loading the asset '"+Q.assetConfig.path+"'. This asset will be uncached for future loading");Q.uncache()}if(G.remainingCachedAssets===0){G.onCachedAssetsReady()}},onCachedAssetsReady:function(){E.load({url:G.urls,loadOrder:G.manifest.loadOrder,loadOrderMap:G.manifest.loadOrderMap,sequential:true,success:G.onAllAssetsReady,failure:G.onAllAssetsReady})},onAllAssetsReady:function(){O=true;G.notify();if(navigator.onLine!==false){C("Application is online, checking for updates");G.checkAllUpdates()}else{C("Application is offline, adding online listener to check for updates");if(window["addEventListener"]){window.addEventListener("online",G.checkAllUpdates,false)}}},onMicroloaderReady:function(P){if(O){P()}else{K.push(P)}},notify:function(){C("notifying microloader ready listeners.");var P;while((P=K.shift())){P()}},patch:function(T,U){var P=[],Q,R,S;if(U.length===0){return T}for(R=0,S=U.length;R<S;R++){Q=U[R];if(typeof Q==="number"){P.push(T.substring(Q,Q+U[++R]))}else{P.push(Q)}}return P.join("")},checkAllUpdates:function(){C("Checking for All Updates");if(window["removeEventListener"]){window.removeEventListener("online",G.checkAllUpdates,false)}if(B){G.checkForAppCacheUpdate()}if(G.manifest.fromCache){G.checkForUpdates()}},checkForAppCacheUpdate:function(){C("Checking App Cache status");if(B.status===B.UPDATEREADY||B.status===B.OBSOLETE){C("App Cache is already in an updated");G.appCacheState="updated"}else{if(B.status!==B.IDLE&&B.status!==B.UNCACHED){C("App Cache is checking or downloading updates, adding listeners");G.appCacheState="checking";B.addEventListener("error",G.onAppCacheError);B.addEventListener("noupdate",G.onAppCacheNotUpdated);B.addEventListener("cached",G.onAppCacheNotUpdated);B.addEventListener("updateready",G.onAppCacheReady);B.addEventListener("obsolete",G.onAppCacheObsolete)}else{C("App Cache is current or uncached");G.appCacheState="current"}}},checkForUpdates:function(){C("Checking for updates at: "+G.manifest.url);E.fetch(G.applyCacheBuster(G.manifest.url),G.onUpdatedManifestLoaded)},onAppCacheError:function(P){F(P.message);G.appCacheState="error";G.notifyUpdateReady()},onAppCacheReady:function(){B.swapCache();G.appCacheUpdated()},onAppCacheObsolete:function(){G.appCacheUpdated()},appCacheUpdated:function(){C("App Cache Updated");G.appCacheState="updated";G.notifyUpdateReady()},onAppCacheNotUpdated:function(){C("App Cache Not Updated Callback");G.appCacheState="current";G.notifyUpdateReady()},filterAsset:function(Q){var P=(Q&&Q.assetConfig)||{};if(P.platform||P.exclude){return E.filterPlatform(P.platform,P.exclude)}return true},onUpdatedManifestLoaded:function(a){a=G.parseResult(a);if(!a.error){var Y,W,V,X,R,U,S,T,Q,Z=[],P=new N({url:G.manifest.url,content:a.content,assetCache:false});G.remainingUpdatingAssets=0;G.updatedAssets=[];G.removedAssets=[];G.updatedManifest=null;G.updatedAssetsReady=false;if(!P.shouldCache()){C("New Manifest has caching disabled, clearing out any private storage");G.updatedManifest=P;J.clearAllPrivate(P);G.onAllUpdatedAssetsReady();return }if(!G.manifest.is(P)){G.updatedManifest=P;Y=G.manifest.getAssets();W=P.getAssets();for(R in W){X=W[R];V=G.manifest.getAsset(X.assetConfig.path);Q=G.filterAsset(X);if(Q&&(!V||(X.shouldCache()&&(!V.is(X))))){C("New/Updated Version of Asset: "+X.assetConfig.path+" was found in new manifest");Z.push({_new:X,_current:V})}}for(R in Y){V=Y[R];X=P.getAsset(V.assetConfig.path);Q=!G.filterAsset(X);if(!Q||!X||(V.shouldCache()&&!X.shouldCache())){C("Asset: "+V.assetConfig.path+" was not found in new manifest, has been filtered out or has been switched to not cache. Marked for removal");G.removedAssets.push(V)}}if(Z.length>0){G.remainingUpdatingAssets=Z.length;while(Z.length>0){U=Z.pop();X=U._new;V=U._current;if(X.assetConfig.update==="full"||!V){if(X.assetConfig.update==="delta"){C("Delta updated asset found without current asset available: "+X.assetConfig.path+" fetching full file")}else{C("Full update found for: "+X.assetConfig.path+" fetching")}E.fetch(X.assetConfig.path,(function(b){return function(c){G.onFullAssetUpdateLoaded(b,c)}}(X)))}else{if(X.assetConfig.update==="delta"){S=P.deltas;T=S+"/"+X.assetConfig.path+"/"+V.assetConfig.hash+".json";C("Delta update found for: "+X.assetConfig.path+" fetching");E.fetch(T,(function(c,b){return function(d){G.onDeltaAssetUpdateLoaded(c,b,d)}}(X,V)))}}}}else{C("No Assets needed updating");G.onAllUpdatedAssetsReady()}}else{C("Manifest files have matching hash's");G.onAllUpdatedAssetsReady()}}else{F("Error loading manifest file to check for updates");G.onAllUpdatedAssetsReady()}},onFullAssetUpdateLoaded:function(Q,P){var R;P=G.parseResult(P);G.remainingUpdatingAssets--;if(!P.error){R=G.checksum(P.content,Q.assetConfig.hash);C("Checksum for Full asset: "+Q.assetConfig.path+" is "+R);if(!R){C("Full Update Asset: "+Q.assetConfig.path+" has failed checksum. This asset will be uncached for future loading");Q.uncache()}else{Q.updateContent(P.content);G.updatedAssets.push(Q)}}else{C("Error loading file at"+Q.assetConfig.path+". This asset will be uncached for future loading");Q.uncache()}if(G.remainingUpdatingAssets===0){G.onAllUpdatedAssetsReady()}},onDeltaAssetUpdateLoaded:function(S,Q,P){var R,U,T;P=G.parseResult(P);G.remainingUpdatingAssets--;if(!P.error){C("Delta patch loaded successfully, patching content");try{R=JSON.parse(P.content);T=G.patch(Q.content,R);U=G.checksum(T,S.assetConfig.hash);C("Checksum for Delta Patched asset: "+S.assetConfig.path+" is "+U);if(!U){C("Delta Update Asset: "+S.assetConfig.path+" has failed checksum. This asset will be uncached for future loading");S.uncache()}else{S.updateContent(T);G.updatedAssets.push(S)}}catch(V){F("Error parsing delta patch for "+S.assetConfig.path+" with hash "+Q.assetConfig.hash+" . This asset will be uncached for future loading");S.uncache()}}else{F("Error loading delta patch for "+S.assetConfig.path+" with hash "+Q.assetConfig.hash+" . This asset will be uncached for future loading");S.uncache()}if(G.remainingUpdatingAssets===0){G.onAllUpdatedAssetsReady()}},onAllUpdatedAssetsReady:function(){var P;G.updatedAssetsReady=true;if(G.updatedManifest){while(G.removedAssets.length>0){P=G.removedAssets.pop();C("Asset: "+P.assetConfig.path+" was removed, un-caching");P.uncache()}if(G.updatedManifest){C("Manifest was updated, re-caching");G.updatedManifest.cache()}while(G.updatedAssets.length>0){P=G.updatedAssets.pop();C("Asset: "+P.assetConfig.path+" was updated, re-caching");P.cache()}}G.notifyUpdateReady()},notifyUpdateReady:function(){if(G.appCacheState!=="checking"&&G.updatedAssetsReady){if(G.appCacheState==="updated"||G.updatedManifest){C("There was an update here you will want to reload the app, trigger an event");G.appUpdate={updated:true,app:G.appCacheState==="updated",manifest:G.updatedManifest&&G.updatedManifest.exportContent()};G.fireAppUpdate()}else{C("AppCache and LocalStorage Cache are current, no updating needed");G.appUpdate={}}}},fireAppUpdate:function(){if(Ext.GlobalEvents){Ext.defer(function(){Ext.GlobalEvents.fireEvent("appupdate",G.appUpdate)},100)}},checksum:function(R,S){if(!R||!S){return false}var T=true,Q=S.length,P=R.substring(0,1);if(P=="/"){if(R.substring(2,Q+2)!==S){T=false}}else{if(P=="f"){if(R.substring(10,Q+10)!==S){T=false}}else{if(P=="."){if(R.substring(1,Q+1)!==S){T=false}}}}return T},parseResult:function(P){var Q={};if((P.exception||P.status===0)&&!E.env.phantom){Q.error=true}else{if((P.status>=200&&P.status<300)||P.status===304||E.env.phantom||(P.status===0&&P.content.length>0)){Q.content=P.content}else{Q.error=true}}return Q}};return G}());Ext.manifest=Ext.manifest||"bootstrap";Ext.Microloader.run()