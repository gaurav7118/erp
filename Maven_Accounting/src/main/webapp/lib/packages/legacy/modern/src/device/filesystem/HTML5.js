Ext.define("Ext.device.filesystem.HTML5",{extend:"Ext.device.filesystem.Abstract",requestFileSystem:function(B){if(!B.success){Ext.Logger.error("Ext.device.filesystem#requestFileSystem: You must specify a `success` callback.");return null}var C=this;var A=function(D){var E=Ext.create("Ext.device.filesystem.FileSystem",D);B.success.call(B.scope||C,E)};window.requestFileSystem(B.type,B.size,A,B.failure||Ext.emptyFn)}},function(){Ext.define("Ext.device.filesystem.FileSystem",{fs:null,root:null,constructor:function(A){this.fs=A;this.root=Ext.create("Ext.device.filesystem.DirectoryEntry","/",this)},getRoot:function(){return this.root}},function(){Ext.define("Ext.device.filesystem.Entry",{directory:false,path:0,fileSystem:null,entry:null,constructor:function(A,C,B){this.directory=A;this.path=C;this.fileSystem=B},isFile:function(){return !this.directory},isDirectory:function(){return this.directory},getName:function(){var B=this.path.split("/");for(var A=B.length-1;A>=0;--A){if(B[A].length>0){return B[A]}}return"/"},getFullPath:function(){return this.path},getFileSystem:function(){return this.fileSystem},getEntry:function(){return null},moveTo:function(A){if(A.parent==null){Ext.Logger.error("Ext.device.filesystem.Entry#moveTo: You must specify a new `parent` of the entry.");return null}var B=this;this.getEntry({options:A.options||{},success:function(C){A.parent.getEntry({options:A.options||{},success:function(D){if(A.copy){C.copyTo(D,A.newName,function(E){A.success.call(A.scope||B,E.isDirectory?Ext.create("Ext.device.filesystem.DirectoryEntry",E.fullPath,B.fileSystem):Ext.create("Ext.device.filesystem.FileEntry",E.fullPath,B.fileSystem))},A.failure)}else{C.moveTo(D,A.newName,function(E){A.success.call(A.scope||B,E.isDirectory?Ext.create("Ext.device.filesystem.DirectoryEntry",E.fullPath,B.fileSystem):Ext.create("Ext.device.filesystem.FileEntry",E.fullPath,B.fileSystem))},A.failure)}},failure:A.failure})},failure:A.failure})},copyTo:function(A){this.moveTo(Ext.apply(A,{copy:true}))},remove:function(A){this.getEntry({success:function(B){if(A.recursively&&this.directory){B.removeRecursively(A.success,A.failure)}else{B.remove(A.success,A.failure)}},failure:A.failure})},getParent:function(A){if(!A.success){Ext.Logger.error("Ext.device.filesystem.Entry#getParent: You must specify a `success` callback.");return null}var B=this;this.getEntry({options:A.options||{},success:function(C){C.getParent(function(D){A.success.call(A.scope||B,D.isDirectory?Ext.create("Ext.device.filesystem.DirectoryEntry",D.fullPath,B.fileSystem):Ext.create("Ext.device.filesystem.FileEntry",D.fullPath,B.fileSystem))},A.failure)},failure:A.failure})}});Ext.define("Ext.device.filesystem.DirectoryEntry",{extend:"Ext.device.filesystem.Entry",cachedDirectory:null,constructor:function(B,A){this.callParent([true,B,A])},getEntry:function(B){var D=this;var E=B.success;if((B.options&&B.options.create)&&this.path){var C=this.path.split("/");if(C[0]=="."||C[0]==""){C=C.slice(1)}var A=function(F){if(C.length){F.getDirectory(C.shift(),B.options,A,B.failure)}else{E(F)}};A(this.fileSystem.fs.root)}else{this.fileSystem.fs.root.getDirectory(this.path,B.options,function(F){B.success.call(B.scope||D,F)},B.failure)}},readEntries:function(A){if(!A.success){Ext.Logger.error("Ext.device.filesystem.DirectoryEntry#readEntries: You must specify a `success` callback.");return null}var B=this;this.getEntry({success:function(D){var C=D.createReader();C.readEntries(function(H){var F=[],G=0,E=H.length;for(;G<E;G++){entryInfo=H[G];F[G]=entryInfo.isDirectory?Ext.create("Ext.device.filesystem.DirectoryEntry",entryInfo.fullPath,B.fileSystem):Ext.create("Ext.device.filesystem.FileEntry",entryInfo.fullPath,B.fileSystem)}A.success.call(A.scope||this,F)},function(E){if(A.failure){A.failure.call(A.scope||this,E)}})},failure:A.failure})},getFile:function(B){if(B.path==null){Ext.Logger.error("Ext.device.filesystem.DirectoryEntry#getFile: You must specify a `path` of the file.");return null}var C=this;var A=this.path+B.path;var D=Ext.create("Ext.device.filesystem.FileEntry",A,this.fileSystem);D.getEntry({success:function(){B.success.call(B.scope||C,D)},options:B.options||{},failure:B.failure})},getDirectory:function(C){if(C.path==null){Ext.Logger.error("Ext.device.filesystem.DirectoryEntry#getFile: You must specify a `path` of the file.");return null}var D=this;var B=this.path+C.path;var A=Ext.create("Ext.device.filesystem.DirectoryEntry",B,this.fileSystem);A.getEntry({success:function(){C.success.call(C.scope||D,A)},options:C.options||{},failure:C.failure})},removeRecursively:function(A){this.remove(Ext.apply(A,{recursively:true}))}});Ext.define("Ext.device.filesystem.FileEntry",{extend:"Ext.device.filesystem.Entry",length:0,offset:0,constructor:function(B,A){this.callParent([false,B,A]);this.offset=0;this.length=0},getEntry:function(B){var C=this;var D=Ext.applyIf({},B);if(this.fileSystem){var A=function(E){if((B.options&&B.options.create)&&Ext.isString(this.path)){var F=this.path.split("/");if(F[0]=="."||F[0]==""){F=F.slice(1)}if(F.length>1&&!B.recursive===true){F.pop();var G=Ext.create("Ext.device.filesystem.DirectoryEntry",F.join("/"),C.fileSystem);G.getEntry({options:B.options,success:function(){D.recursive=true;C.getEntry(D)},failure:B.failure})}else{if(B.failure){B.failure.call(B.scope||C,E)}}}else{if(B.failure){B.failure.call(B.scope||C,E)}}};this.fileSystem.fs.root.getFile(this.path,B.options||null,function(E){E.file(function(F){C.length=F.size;D.success.call(B.scope||C,E)},function(F){A.call(B.scope||C,F)})},function(E){A.call(B.scope||C,E)})}else{B.failure({code:-1,message:"FileSystem not Initialized"})}},getOffset:function(){return this.offset},seek:function(A){if(A.offset==null){Ext.Logger.error("Ext.device.filesystem.FileEntry#seek: You must specify an `offset` in the file.");return null}this.offset=A.offset||0;if(A.success){A.success.call(A.scope||this)}},read:function(A){var B=this;this.getEntry({success:function(C){C.file(function(E){if(Ext.isNumber(A.length)){if(Ext.isFunction(E.slice)){E=E.slice(B.offset,A.length)}else{if(A.failure){A.failure.call(A.scope||B,{code:-2,message:"File missing slice functionality"})}return }}var D=new FileReader();D.onloadend=function(F){A.success.call(A.scope||B,F.target.result)};D.onerror=function(F){A.failure.call(A.scope||B,F)};if(A.reader){D=Ext.applyIf(D,A.reader)}A.encoding=A.encoding||"UTF8";switch(A.type){default:case"text":D.readAsText(E,A.encoding);break;case"dataURL":D.readAsDataURL(E);break;case"binaryString":D.readAsBinaryString(E);break;case"arrayBuffer":D.readAsArrayBuffer(E);break}},function(D){A.failure.call(A.scope||B,D)})},failure:function(C){A.failure.call(A.scope||B,C)}})},write:function(A){if(A.data==null){Ext.Logger.error("Ext.device.filesystem.FileEntry#write: You must specify `data` to write into the file.");return null}var B=this;this.getEntry({options:A.options||{},success:function(C){C.createWriter(function(D){D.onwriteend=function(E){B.length=E.target.length;A.success.call(A.scope||B,E.result)};D.onerror=function(E){A.failure.call(A.scope||B,E)};if(A.writer){D=Ext.applyIf(D,A.writer)}if(B.offset){D.seek(B.offset)}else{if(A.append){D.seek(B.length)}}B.writeData(D,A.data)},function(D){A.failure.call(A.scope||B,D)})},failure:function(C){A.failure.call(A.scope||B,C)}})},writeData:function(B,A){B.write(new Blob([A]))},truncate:function(A){if(A.size==null){Ext.Logger.error("Ext.device.filesystem.FileEntry#write: You must specify a `size` of the file.");return null}var B=this;this.getEntry({success:function(C){C.createWriter(function(D){D.truncate(A.size);A.success.call(A.scope||B,B)},function(D){A.failure.call(A.scope||B,D)})},failure:function(C){A.failure.call(A.scope||B,C)}})}})})})