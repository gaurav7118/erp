Ext.define("Ext.ux.CellDragDrop",{extend:"Ext.plugin.Abstract",alias:"plugin.celldragdrop",uses:["Ext.view.DragZone"],enforceType:false,applyEmptyText:false,emptyText:"",dropBackgroundColor:"green",noDropBackgroundColor:"red",dragText:"{0} selected row{1}",ddGroup:"GridDD",enableDrop:true,enableDrag:true,containerScroll:false,init:function(A){var B=this;A.on("render",B.onViewRender,B,{single:true})},destroy:function(){var A=this;A.dragZone=A.dropZone=Ext.destroy(A.dragZone,A.dropZone);A.callParent()},enable:function(){var A=this;if(A.dragZone){A.dragZone.unlock()}if(A.dropZone){A.dropZone.unlock()}A.callParent()},disable:function(){var A=this;if(A.dragZone){A.dragZone.lock()}if(A.dropZone){A.dropZone.lock()}A.callParent()},onViewRender:function(A){var B=this,C;if(B.enableDrag){if(B.containerScroll){C=A.getEl()}B.dragZone=new Ext.view.DragZone({view:A,ddGroup:B.dragGroup||B.ddGroup,dragText:B.dragText,containerScroll:B.containerScroll,scrollEl:C,getDragData:function(I){var G=this.view,H=I.getTarget(G.getItemSelector()),F=G.getRecord(H),E=I.getTarget(G.getCellSelector()),D,J;if(H){D=document.createElement("div");D.className="x-form-text";D.appendChild(document.createTextNode(E.textContent||E.innerText));J=G.getHeaderByCell(E);return{event:new Ext.EventObjectImpl(I),ddel:D,item:I.target,columnName:J.dataIndex,record:F}}},onInitDrag:function(E,K){var H=this,J=H.dragData,G=H.view,D=G.getSelectionModel(),F=J.record,I=J.ddel;if(!D.isSelected(F)){D.select(F,true)}Ext.fly(H.ddel).update(I.textContent||I.innerText);H.proxy.update(H.ddel);H.onStartDrag(E,K);return true}})}if(B.enableDrop){B.dropZone=new Ext.dd.DropZone(A.el,{view:A,ddGroup:B.dropGroup||B.ddGroup,containerScroll:true,getTargetFromEvent:function(G){var F=this,E=F.view,D=G.getTarget(E.cellSelector),H,I;if(D){H=E.findItemByChild(D);I=E.getHeaderByCell(D);if(H&&I){return{node:D,record:E.getRecord(H),columnName:I.dataIndex}}}},onNodeEnter:function(J,D,I,H){var E=this,G=J.record.getField(J.columnName).type.toUpperCase(),F=H.record.getField(H.columnName).type.toUpperCase();delete E.dropOK;if(!J||J.node===H.item.parentNode){return }if(B.enforceType&&G!==F){E.dropOK=false;if(B.noDropCls){Ext.fly(J.node).addCls(B.noDropCls)}else{Ext.fly(J.node).applyStyles({backgroundColor:B.noDropBackgroundColor})}return false}E.dropOK=true;if(B.dropCls){Ext.fly(J.node).addCls(B.dropCls)}else{Ext.fly(J.node).applyStyles({backgroundColor:B.dropBackgroundColor})}},onNodeOver:function(G,D,F,E){return this.dropOK?this.dropAllowed:this.dropNotAllowed},onNodeOut:function(H,D,G,F){var E=this.dropOK?B.dropCls:B.noDropCls;if(E){Ext.fly(H.node).removeCls(E)}else{Ext.fly(H.node).applyStyles({backgroundColor:""})}},onNodeDrop:function(G,D,F,E){if(this.dropOK){G.record.set(G.columnName,E.record.get(E.columnName));if(B.applyEmptyText){E.record.set(E.columnName,B.emptyText)}return true}},onCellDrop:Ext.emptyFn})}}})