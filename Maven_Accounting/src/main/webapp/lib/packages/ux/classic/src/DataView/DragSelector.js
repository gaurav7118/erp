Ext.define("Ext.ux.DataView.DragSelector",{requires:["Ext.dd.DragTracker","Ext.util.Region"],init:function(A){this.dataview=A;A.mon(A,{beforecontainerclick:this.cancelClick,scope:this,render:{fn:this.onRender,scope:this,single:true}})},onRender:function(){this.tracker=Ext.create("Ext.dd.DragTracker",{dataview:this.dataview,el:this.dataview.el,dragSelector:this,onBeforeStart:this.onBeforeStart,onStart:this.onStart,onDrag:this.onDrag,onEnd:this.onEnd});this.dragRegion=Ext.create("Ext.util.Region")},onBeforeStart:function(A){return A.target==this.dataview.getEl().dom},onStart:function(B){var C=this.dragSelector,A=this.dataview;this.dragging=true;C.fillRegions();C.getProxy().show();A.getSelectionModel().deselectAll()},cancelClick:function(){return !this.tracker.dragging},onDrag:function(J){var B=this.dragSelector,I=B.dataview.getSelectionModel(),O=B.dragRegion,N=B.bodyRegion,L=B.getProxy(),F=B.regions,C=F.length,K=this.startXY,Q=this.getXY(),E=Math.min(K[0],Q[0]),D=Math.min(K[1],Q[1]),A=Math.abs(K[0]-Q[0]),P=Math.abs(K[1]-Q[1]),M,G,H;Ext.apply(O,{top:D,left:E,right:E+A,bottom:D+P});O.constrainTo(N);L.setBox(O);for(H=0;H<C;H++){M=F[H];G=O.intersect(M);if(G){I.select(H,true)}else{I.deselect(H)}}},onEnd:Ext.Function.createDelayed(function(C){var A=this.dataview,B=A.getSelectionModel(),D=this.dragSelector;this.dragging=false;D.getProxy().hide()},1),getProxy:function(){if(!this.proxy){this.proxy=this.dataview.getEl().createChild({tag:"div",cls:"x-view-selector"})}return this.proxy},fillRegions:function(){var A=this.dataview,B=this.regions=[];A.all.each(function(C){B.push(C.getRegion())});this.bodyRegion=A.getEl().getRegion()}})