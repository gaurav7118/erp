Ext.define("Ext.ux.DataView.Draggable",{requires:"Ext.dd.DragZone",ghostCls:"x-dataview-draggable-ghost",ghostTpl:['<tpl for=".">',"{title}","</tpl>"],init:function(A,B){this.dataview=A;A.on("render",this.onRender,this);Ext.apply(this,{itemSelector:A.itemSelector,ghostConfig:{}},B||{});Ext.applyIf(this.ghostConfig,{itemSelector:"img",cls:this.ghostCls,tpl:this.ghostTpl})},onRender:function(){var A=Ext.apply({},this.ddConfig||{},{dvDraggable:this,dataview:this.dataview,getDragData:this.getDragData,getTreeNode:this.getTreeNode,afterRepair:this.afterRepair,getRepairXY:this.getRepairXY});this.dragZone=Ext.create("Ext.dd.DragZone",this.dataview.getEl(),A)},getDragData:function(G){var A=this.dvDraggable,B=this.dataview,C=B.getSelectionModel(),F=G.getTarget(A.itemSelector),D,E;if(F){if(!B.isSelected(F)){C.select(B.getRecord(F))}D=B.getSelectedNodes();E={copy:true,nodes:D,records:C.getSelection(),item:true};if(D.length===1){E.single=true;E.ddel=F}else{E.multi=true;E.ddel=A.prepareGhost(C.getSelection())}return E}return false},getTreeNode:function(){},afterRepair:function(){this.dragging=false;var A=this.dragData.nodes,C=A.length,B;for(B=0;B<C;B++){Ext.get(A[B]).frame("#8db2e3",1)}},getRepairXY:function(C){if(this.dragData.multi){return false}else{var A=Ext.get(this.dragData.ddel),B=A.getXY();B[0]+=A.getPadding("t")+A.getMargin("t");B[1]+=A.getPadding("l")+A.getMargin("l");return B}},prepareGhost:function(A){return this.createGhost(A).getEl().dom},createGhost:function(B){var C=this,A;if(C.ghost){(A=C.ghost.store).loadRecords(B)}else{A=Ext.create("Ext.data.Store",{model:B[0].self});A.loadRecords(B);C.ghost=Ext.create("Ext.view.View",Ext.apply({renderTo:document.createElement("div"),store:A},C.ghostConfig));C.ghost.container.skipGarbageCollection=C.ghost.el.skipGarbageCollection=true}A.clearData();return C.ghost},destroy:function(){var A=this.ghost;if(A){A.container.destroy();A.destroy()}this.callParent()}})