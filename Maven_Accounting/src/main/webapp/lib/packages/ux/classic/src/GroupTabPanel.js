Ext.define("Ext.ux.GroupTabPanel",{extend:"Ext.Container",alias:"widget.grouptabpanel",requires:["Ext.tree.Panel","Ext.ux.GroupTabRenderer"],baseCls:Ext.baseCSSPrefix+"grouptabpanel",initComponent:function(A){var B=this;Ext.apply(B,A);B.store=B.createTreeStore();B.layout={type:"hbox",align:"stretch"};B.defaults={border:false};B.items=[{xtype:"treepanel",cls:"x-tree-panel x-grouptabbar",width:150,rootVisible:false,store:B.store,hideHeaders:true,animate:false,processEvent:Ext.emptyFn,border:false,plugins:[{ptype:"grouptabrenderer"}],viewConfig:{overItemCls:"",getRowClass:B.getRowClass},columns:[{xtype:"treecolumn",sortable:false,dataIndex:"text",flex:1,renderer:function(J,D,I,H,G,F,C){var E="";if(I.parentNode&&I.parentNode.parentNode===null){E+=" x-grouptab-first";if(I.previousSibling){E+=" x-grouptab-prev"}if(!I.get("expanded")||I.firstChild==null){E+=" x-grouptab-last"}}else{if(I.nextSibling===null){E+=" x-grouptab-last"}else{E+=" x-grouptab-center"}}if(I.data.activeTab){E+=" x-active-tab"}D.tdCls="x-grouptab"+E;return J}}]},{xtype:"container",flex:1,layout:"card",activeItem:B.mainItem,baseCls:Ext.baseCSSPrefix+"grouptabcontainer",items:B.cards}];B.callParent(arguments);B.setActiveTab(B.activeTab);B.setActiveGroup(B.activeGroup);B.mon(B.down("treepanel").getSelectionModel(),"select",B.onNodeSelect,B)},getRowClass:function(D,E,C,B){var A="";if(D.data.activeGroup){A+=" x-active-group"}return A},onNodeSelect:function(A,E){var D=this,B=D.store.getRootNode(),C;if(E.parentNode&&E.parentNode.parentNode===null){C=E}else{C=E.parentNode}if(D.setActiveGroup(C.get("id"))===false||D.setActiveTab(E.get("id"))===false){return false}while(B){B.set("activeTab",false);B.set("activeGroup",false);B=B.firstChild||B.nextSibling||B.parentNode.nextSibling}C.set("activeGroup",true);C.eachChild(function(F){F.set("activeGroup",true)});E.set("activeTab",true);A.view.refresh()},setActiveTab:function(B){var A=this,D=B,C;if(Ext.isString(B)){D=Ext.getCmp(D)}if(D===A.activeTab){return false}C=A.activeTab;if(A.fireEvent("beforetabchange",A,D,C)!==false){A.activeTab=D;if(A.rendered){A.down("container[baseCls="+Ext.baseCSSPrefix+"grouptabcontainer]").getLayout().setActiveItem(D)}A.fireEvent("tabchange",A,D,C)}return true},setActiveGroup:function(C){var B=this,D=C,A;if(Ext.isString(C)){D=Ext.getCmp(D)}if(D===B.activeGroup){return true}A=B.activeGroup;if(B.fireEvent("beforegroupchange",B,D,A)!==false){B.activeGroup=D;B.fireEvent("groupchange",B,D,A)}else{return false}return true},createTreeStore:function(){var B=this,A=B.prepareItems(B.items),C={text:".",children:[]},D=B.cards=[];B.activeGroup=B.activeGroup||0;Ext.each(A,function(G,E){var H=G.items.items,F=(H[G.mainItem]||H[0]),I={children:[]};I.id=F.id;I.text=F.title;I.iconCls=F.iconCls;I.expanded=true;I.activeGroup=(B.activeGroup===E);I.activeTab=I.activeGroup?true:false;if(I.activeTab){B.activeTab=I.id}if(I.activeGroup){B.mainItem=G.mainItem||0;B.activeGroup=I.id}Ext.each(H,function(J){if(J.id!==I.id){var K={id:J.id,leaf:true,text:J.title,iconCls:J.iconCls,activeGroup:I.activeGroup,activeTab:false};I.children.push(K)}delete J.title;delete J.iconCls;D.push(J)});C.children.push(I)});return Ext.create("Ext.data.TreeStore",{fields:["id","text","activeGroup","activeTab"],root:{expanded:true},proxy:{type:"memory",data:C}})},getActiveTab:function(){return this.activeTab},getActiveGroup:function(){return this.activeGroup}})