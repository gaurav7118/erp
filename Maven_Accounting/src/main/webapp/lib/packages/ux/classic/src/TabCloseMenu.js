Ext.define("Ext.ux.TabCloseMenu",{extend:"Ext.plugin.Abstract",alias:"plugin.tabclosemenu",mixins:{observable:"Ext.util.Observable"},closeTabText:"Close Tab",showCloseOthers:true,closeOthersTabsText:"Close Other Tabs",showCloseAll:true,closeAllTabsText:"Close All Tabs",extraItemsHead:null,extraItemsTail:null,constructor:function(A){this.callParent([A]);this.mixins.observable.constructor.call(this,A)},init:function(A){this.tabPanel=A;this.tabBar=A.down("tabbar");this.mon(this.tabPanel,{scope:this,afterlayout:this.onAfterLayout,single:true})},onAfterLayout:function(){this.mon(this.tabBar.el,{scope:this,contextmenu:this.onContextMenu,delegate:".x-tab"})},destroy:function(){this.callParent();Ext.destroy(this.menu)},onContextMenu:function(D,F){var C=this,G=C.createMenu(),E=true,H=true,B=C.tabBar.getChildByElement(F),A=C.tabBar.items.indexOf(B);C.item=C.tabPanel.getComponent(A);G.child("#close").setDisabled(!C.item.closable);if(C.showCloseAll||C.showCloseOthers){C.tabPanel.items.each(function(I){if(I.closable){E=false;if(I!==C.item){H=false;return false}}return true});if(C.showCloseAll){G.child("#closeAll").setDisabled(E)}if(C.showCloseOthers){G.child("#closeOthers").setDisabled(H)}}D.preventDefault();C.fireEvent("beforemenu",G,C.item,C);G.showAt(D.getXY())},createMenu:function(){var B=this;if(!B.menu){var A=[{itemId:"close",text:B.closeTabText,scope:B,handler:B.onClose}];if(B.showCloseAll||B.showCloseOthers){A.push("-")}if(B.showCloseOthers){A.push({itemId:"closeOthers",text:B.closeOthersTabsText,scope:B,handler:B.onCloseOthers})}if(B.showCloseAll){A.push({itemId:"closeAll",text:B.closeAllTabsText,scope:B,handler:B.onCloseAll})}if(B.extraItemsHead){A=B.extraItemsHead.concat(A)}if(B.extraItemsTail){A=A.concat(B.extraItemsTail)}B.menu=Ext.create("Ext.menu.Menu",{items:A,listeners:{hide:B.onHideMenu,scope:B}})}return B.menu},onHideMenu:function(){var A=this;A.fireEvent("aftermenu",A.menu,A)},onClose:function(){this.tabPanel.remove(this.item)},onCloseOthers:function(){this.doClose(true)},onCloseAll:function(){this.doClose(false)},doClose:function(B){var A=[];this.tabPanel.items.each(function(C){if(C.closable){if(!B||C!==this.item){A.push(C)}}},this);Ext.suspendLayouts();Ext.Array.forEach(A,function(C){this.tabPanel.remove(C)},this);Ext.resumeLayouts(true)}})