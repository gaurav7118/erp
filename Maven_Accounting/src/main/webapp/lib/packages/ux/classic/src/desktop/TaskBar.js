Ext.define("Ext.ux.desktop.TaskBar",{extend:"Ext.toolbar.Toolbar",requires:["Ext.button.Button","Ext.resizer.Splitter","Ext.menu.Menu","Ext.ux.desktop.StartMenu"],alias:"widget.taskbar",cls:"ux-taskbar",startBtnText:"Start",initComponent:function(){var A=this;A.startMenu=new Ext.ux.desktop.StartMenu(A.startConfig);A.quickStart=new Ext.toolbar.Toolbar(A.getQuickStart());A.windowBar=new Ext.toolbar.Toolbar(A.getWindowBarConfig());A.tray=new Ext.toolbar.Toolbar(A.getTrayConfig());A.items=[{xtype:"button",cls:"ux-start-button",iconCls:"ux-start-button-icon",menu:A.startMenu,menuAlign:"bl-tl",text:A.startBtnText},A.quickStart,{xtype:"splitter",html:"&#160;",height:14,width:2,cls:"x-toolbar-separator x-toolbar-separator-horizontal"},A.windowBar,"-",A.tray];A.callParent()},afterLayout:function(){var A=this;A.callParent();A.windowBar.el.on("contextmenu",A.onButtonContextMenu,A)},getQuickStart:function(){var B=this,A={minWidth:20,width:Ext.themeName==="neptune"?70:60,items:[],enableOverflow:true};Ext.each(this.quickStart,function(C){A.items.push({tooltip:{text:C.name,align:"bl-tl"},overflowText:C.name,iconCls:C.iconCls,module:C.module,handler:B.onQuickStartClick,scope:B})});return A},getTrayConfig:function(){var A={items:this.trayItems};delete this.trayItems;return A},getWindowBarConfig:function(){return{flex:1,cls:"ux-desktop-windowbar",items:["&#160;"],layout:{overflowHandler:"Scroller"}}},getWindowBtnFromEl:function(A){var B=this.windowBar.getChildByElement(A);return B||null},onQuickStartClick:function(B){var A=this.app.getModule(B.module),C;if(A){C=A.createWindow();C.show()}},onButtonContextMenu:function(D){var C=this,B=D.getTarget(),A=C.getWindowBtnFromEl(B);if(A){D.stopEvent();C.windowMenu.theWin=A.win;C.windowMenu.showBy(B)}},onWindowBtnClick:function(A){var B=A.win;if(B.minimized||B.hidden){A.disable();B.show(null,function(){A.enable()})}else{if(B.active){A.disable();B.on("hide",function(){A.enable()},null,{single:true});B.minimize()}else{B.toFront()}}},addTaskButton:function(C){var A={iconCls:C.iconCls,enableToggle:true,toggleGroup:"all",width:140,margin:"0 2 0 3",text:Ext.util.Format.ellipsis(C.title,20),listeners:{click:this.onWindowBtnClick,scope:this},win:C};var B=this.windowBar.add(A);B.toggle(true);return B},removeTaskButton:function(A){var C,B=this;B.windowBar.items.each(function(D){if(D===A){C=D}return !C});if(C){B.windowBar.remove(C)}return C},setActiveButton:function(A){if(A){A.toggle(true)}else{this.windowBar.items.each(function(B){if(B.isButton){B.toggle(false)}})}}});Ext.define("Ext.ux.desktop.TrayClock",{extend:"Ext.toolbar.TextItem",alias:"widget.trayclock",cls:"ux-desktop-trayclock",html:"&#160;",timeFormat:"g:i A",tpl:"{time}",initComponent:function(){var A=this;A.callParent();if(typeof (A.tpl)=="string"){A.tpl=new Ext.XTemplate(A.tpl)}},afterRender:function(){var A=this;Ext.Function.defer(A.updateTime,100,A);A.callParent()},onDestroy:function(){var A=this;if(A.timer){window.clearTimeout(A.timer);A.timer=null}A.callParent()},updateTime:function(){var A=this,B=Ext.Date.format(new Date(),A.timeFormat),C=A.tpl.apply({time:B});if(A.lastText!=C){A.setText(C);A.lastText=C}A.timer=Ext.Function.defer(A.updateTime,10000,A)}})