Ext.define("Ext.ux.form.ItemSelector",{extend:"Ext.ux.form.MultiSelect",alias:["widget.itemselectorfield","widget.itemselector"],alternateClassName:["Ext.ux.ItemSelector"],requires:["Ext.button.Button","Ext.ux.form.MultiSelect"],hideNavIcons:false,buttons:["top","up","add","remove","down","bottom"],buttonsText:{top:"Move to Top",up:"Move Up",add:"Add to Selected",remove:"Remove from Selected",down:"Move Down",bottom:"Move to Bottom"},layout:{type:"hbox",align:"stretch"},ariaRole:"group",initComponent:function(){var A=this;A.ddGroup=A.id+"-dd";A.ariaRenderAttributes=A.ariaRenderAttributes||{};A.ariaRenderAttributes["aria-labelledby"]=A.id+"-labelEl";A.callParent();A.bindStore(A.store)},createList:function(B){var A=this;return Ext.create("Ext.ux.form.MultiSelect",{submitValue:false,getSubmitData:function(){return null},getModelData:function(){return null},flex:1,dragGroup:A.ddGroup,dropGroup:A.ddGroup,title:B,store:{model:A.store.model,data:[]},displayField:A.displayField,valueField:A.valueField,disabled:A.disabled,listeners:{boundList:{scope:A,itemdblclick:A.onItemDblClick,drop:A.syncValue}}})},setupItems:function(){var A=this;A.fromField=A.createList(A.fromTitle);A.toField=A.createList(A.toTitle);return[A.fromField,{xtype:"toolbar",margin:"0 4",padding:0,layout:{type:"vbox",pack:"center"},items:A.createButtons()},A.toField]},createButtons:function(){var B=this,A=[];if(!B.hideNavIcons){Ext.Array.forEach(B.buttons,function(C){A.push({xtype:"button",ui:"default",tooltip:B.buttonsText[C],ariaLabel:B.buttonsText[C],handler:B["on"+Ext.String.capitalize(C)+"BtnClick"],cls:Ext.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext.baseCSSPrefix+"form-itemselector-"+C,navBtn:true,scope:B,margin:"4 0 0 0"})})}return A},getSelections:function(B){var A=B.getStore();return Ext.Array.sort(B.getSelectionModel().getSelection(),function(D,C){D=A.indexOf(D);C=A.indexOf(C);if(D<C){return -1}else{if(D>C){return 1}}return 0})},onTopBtnClick:function(){var C=this.toField.boundList,A=C.getStore(),B=this.getSelections(C);A.suspendEvents();A.remove(B,true);A.insert(0,B);A.resumeEvents();C.refresh();this.syncValue();C.getSelectionModel().select(B)},onBottomBtnClick:function(){var C=this.toField.boundList,A=C.getStore(),B=this.getSelections(C);A.suspendEvents();A.remove(B,true);A.add(B);A.resumeEvents();C.refresh();this.syncValue();C.getSelectionModel().select(B)},onUpBtnClick:function(){var F=this.toField.boundList,B=F.getStore(),E=this.getSelections(F),G,D=0,A=E.length,C=0;B.suspendEvents();for(;D<A;++D,C++){G=E[D];C=Math.max(C,B.indexOf(G)-1);B.remove(G,true);B.insert(C,G)}B.resumeEvents();F.refresh();this.syncValue();F.getSelectionModel().select(E)},onDownBtnClick:function(){var E=this.toField.boundList,A=E.getStore(),D=this.getSelections(E),F,C=D.length-1,B=A.getCount()-1;A.suspendEvents();for(;C>-1;--C,B--){F=D[C];B=Math.min(B,A.indexOf(F)+1);A.remove(F,true);A.insert(B,F)}A.resumeEvents();E.refresh();this.syncValue();E.getSelectionModel().select(D)},onAddBtnClick:function(){var B=this,A=B.getSelections(B.fromField.boundList);B.moveRec(true,A);B.toField.boundList.getSelectionModel().select(A)},onRemoveBtnClick:function(){var B=this,A=B.getSelections(B.toField.boundList);B.moveRec(false,A);B.fromField.boundList.getSelectionModel().select(A)},moveRec:function(F,E){var C=this,G=C.fromField,A=C.toField,B=F?G.store:A.store,D=F?A.store:G.store;B.suspendEvents();D.suspendEvents();B.remove(E);D.add(E);B.resumeEvents();D.resumeEvents();if(G.boundList.containsFocus){G.boundList.focus()}G.boundList.refresh();A.boundList.refresh();C.syncValue()},syncValue:function(){var A=this;A.mixins.field.setValue.call(A,A.setupValue(A.toField.store.getRange()))},onItemDblClick:function(A,B){this.moveRec(A===this.fromField.boundList,B)},setValue:function(F){var D=this,G=D.fromField,A=D.toField,B=G.store,E=A.store,C;if(!D.fromStorePopulated){D.fromField.store.on({load:Ext.Function.bind(D.setValue,D,[F]),single:true});return }F=D.setupValue(F);D.mixins.field.setValue.call(D,F);C=D.getRecordsForValue(F);B.suspendEvents();E.suspendEvents();B.removeAll();E.removeAll();D.populateFromStore(D.store);Ext.Array.forEach(C,function(H){if(B.indexOf(H)>-1){B.remove(H)}E.add(H)});B.resumeEvents();E.resumeEvents();Ext.suspendLayouts();G.boundList.refresh();A.boundList.refresh();Ext.resumeLayouts(true)},onBindStore:function(A,B){var C=this;if(C.fromField){C.fromField.store.removeAll();C.toField.store.removeAll();if(A.getCount()){C.populateFromStore(A)}else{C.store.on("load",C.populateFromStore,C)}}},populateFromStore:function(A){var B=this.fromField.store;this.fromStorePopulated=true;B.add(A.getRange());B.fireEvent("load",B)},onEnable:function(){var A=this;A.callParent();A.fromField.enable();A.toField.enable();Ext.Array.forEach(A.query("[navBtn]"),function(B){B.enable()})},onDisable:function(){var A=this;A.callParent();A.fromField.disable();A.toField.disable();Ext.Array.forEach(A.query("[navBtn]"),function(B){B.disable()})},onDestroy:function(){this.bindStore(null);this.callParent()}})