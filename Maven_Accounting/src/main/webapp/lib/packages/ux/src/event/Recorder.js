Ext.define("Ext.ux.event.Recorder",function(C){function A(){var F=arguments,I=F.length,H={kind:"other"},G;for(G=0;G<I;++G){Ext.apply(H,arguments[G])}if(H.alt&&!H.event){H.event=H.alt}return H}function D(F){return A({kind:"keyboard",modKeys:true,key:true},F)}function B(F){return A({kind:"mouse",button:true,modKeys:true,xy:true},F)}var E={keydown:D(),keypress:D(),keyup:D(),dragmove:B({alt:"mousemove",pageCoords:true,whileDrag:true}),mousemove:B({pageCoords:true}),mouseover:B(),mouseout:B(),click:B(),wheel:B({wheel:true}),mousedown:B({press:true}),mouseup:B({release:true}),scroll:A({listen:false}),focus:A(),blur:A()};for(var D in E){if(!E[D].event){E[D].event=D}}E.wheel.event=null;return{extend:"Ext.ux.event.Driver",eventsToRecord:E,ignoreIdRegEx:/ext-gen(?:\d+)/,inputRe:/^(input|textarea)$/i,constructor:function(F){var H=this,G=F&&F.eventsToRecord;if(G){H.eventsToRecord=Ext.apply(Ext.apply({},H.eventsToRecord),G);delete F.eventsToRecord}H.callParent(arguments);H.clear();H.modKeys=[];H.attachTo=H.attachTo||window},clear:function(){this.eventsRecorded=[]},listenToEvent:function(J){var I=this,H=I.attachTo.document.body,G=function(){return I.onEvent.apply(I,arguments)},F={};if(H.attachEvent&&H.ownerDocument.documentMode<10){J="on"+J;H.attachEvent(J,G);F.destroy=function(){if(G){H.detachEvent(J,G);G=null}}}else{H.addEventListener(J,G,true);F.destroy=function(){if(G){H.removeEventListener(J,G,true);G=null}}}return F},coalesce:function(M,K){var J=this,G=J.eventsRecorded,I=G.length,F=I&&G[I-1],L=(I>1)&&G[I-2],H=(I>2)&&G[I-3];if(!F){return false}if(M.type==="mousemove"){if(F.type==="mousemove"&&M.ts-F.ts<200){M.ts=F.ts;G[I-1]=M;return true}}else{if(M.type==="click"){if(L&&F.type==="mouseup"&&L.type==="mousedown"){if(M.button==F.button&&M.button==L.button&&M.target==F.target&&M.target==L.target&&J.samePt(M,F)&&J.samePt(M,L)){G.pop();L.type="mduclick";return true}}}else{if(M.type==="keyup"){if(L&&F.type==="keypress"&&L.type==="keydown"){if(M.target===F.target&&M.target===L.target){G.pop();L.type="type";L.text=String.fromCharCode(F.charCode);delete L.charCode;delete L.keyCode;if(H&&H.type==="type"){if(H.text&&H.target===L.target){H.text+=L.text;G.pop()}}return true}}else{if(J.completeKeyStroke(F,M)){F.type="type";J.completeSpecialKeyStroke(K.target,F,M);return true}else{if(F.type==="scroll"&&J.completeKeyStroke(L,M)){L.type="type";J.completeSpecialKeyStroke(K.target,L,M);G.pop();G.pop();G.push(F,L);return true}}}}}}return false},completeKeyStroke:function(G,F){if(G&&G.type==="keydown"&&G.keyCode===F.keyCode){delete G.charCode;return true}return false},completeSpecialKeyStroke:function(H,I,F){var G=this.specialKeysByCode[F.keyCode];if(G&&this.inputRe.test(H.tagName)){delete I.keyCode;I.key=G;I.selection=this.getTextSelection(H);if(I.selection[0]===I.selection[1]){I.caret=I.selection[0];delete I.selection}return true}return false},getElementXPath:function(J){var M=this,L=false,G=[],K,I,H,F;for(H=J;H;H=H.parentNode){if(H==M.attachTo.document.body){G.unshift("~");L=true;break}if(H.id&&!M.ignoreIdRegEx.test(H.id)){G.unshift("#"+H.id);L=true;break}for(K=1,I=H;!!(I=I.previousSibling);){if(I.tagName==H.tagName){++K}}F=H.tagName.toLowerCase();if(K<2){G.unshift(F)}else{G.unshift(F+"["+K+"]")}}return L?G.join("/"):null},getRecordedEvents:function(){return this.eventsRecorded},onEvent:function(K){var J=this,H=new Ext.event.Event(K),F=J.eventsToRecord[H.type],L,M,I,G={type:H.type,ts:J.getTimestamp(),target:J.getElementXPath(H.target)},N;if(!F||!G.target){return }L=H.target.ownerDocument;L=L.defaultView||L.parentWindow;if(L!==J.attachTo){return }if(J.eventsToRecord.scroll){J.syncScroll(H.target)}if(F.xy){N=H.getXY();if(F.pageCoords||!G.target){G.px=N[0];G.py=N[1]}else{I=Ext.fly(H.getTarget()).getXY();N[0]-=I[0];N[1]-=I[1];G.x=N[0];G.y=N[1]}}if(F.button){if("buttons" in K){G.button=K.buttons}else{G.button=K.button}if(!G.button&&F.whileDrag){return }}if(F.wheel){G.type="wheel";if(F.event==="wheel"){G.dx=K.deltaX;G.dy=K.deltaY}else{if(typeof K.wheelDeltaX==="number"){G.dx=-1/40*K.wheelDeltaX;G.dy=-1/40*K.wheelDeltaY}else{if(K.wheelDelta){G.dy=-1/40*K.wheelDelta}else{if(K.detail){G.dy=K.detail}}}}}if(F.modKeys){J.modKeys[0]=H.altKey?"A":"";J.modKeys[1]=H.ctrlKey?"C":"";J.modKeys[2]=H.metaKey?"M":"";J.modKeys[3]=H.shiftKey?"S":"";M=J.modKeys.join("");if(M){G.modKeys=M}}if(F.key){G.charCode=H.getCharCode();G.keyCode=H.getKey()}if(J.coalesce(G,H)){J.fireEvent("coalesce",J,G)}else{J.eventsRecorded.push(G);J.fireEvent("add",J,G)}},onStart:function(){var H=this,I=H.attachTo.Ext.dd.DragDropManager,F=H.attachTo.Ext.EventObjectImpl.prototype,G=[];C.prototype.eventsToRecord.wheel.event=("onwheel" in H.attachTo.document)?"wheel":"mousewheel";H.listeners=[];Ext.Object.each(H.eventsToRecord,function(J,K){if(K&&K.listen!==false){if(!K.event){K.event=J}if(K.alt&&K.alt!==J){if(!H.eventsToRecord[K.alt]){G.push(K)}}else{H.listeners.push(H.listenToEvent(K.event))}}});Ext.each(G,function(J){H.eventsToRecord[J.alt]=J;H.listeners.push(H.listenToEvent(J.alt))});H.ddmStopEvent=I.stopEvent;I.stopEvent=Ext.Function.createSequence(I.stopEvent,function(J){H.onEvent(J)});H.evStopEvent=F.stopEvent;F.stopEvent=Ext.Function.createSequence(F.stopEvent,function(){H.onEvent(this)})},onStop:function(){var F=this;Ext.destroy(F.listeners);F.listeners=null;F.attachTo.Ext.dd.DragDropManager.stopEvent=F.ddmStopEvent;F.attachTo.Ext.EventObjectImpl.prototype.stopEvent=F.evStopEvent},samePt:function(G,F){return G.x==F.x&&G.y==F.y},syncScroll:function(H){var K=this,J=K.getTimestamp(),O,N,M,L,G,I;for(var F=H;F;F=F.parentNode){O=F.$lastScrollLeft;N=F.$lastScrollTop;M=F.scrollLeft;L=F.scrollTop;G=false;if(O!==M){if(M){G=true}F.$lastScrollLeft=M}if(N!==L){if(L){G=true}F.$lastScrollTop=L}if(G){K.eventsRecorded.push(I={type:"scroll",target:K.getElementXPath(F),ts:J,pos:[M,L]});K.fireEvent("add",K,I)}if(F.tagName==="BODY"){break}}}}})