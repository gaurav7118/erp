Wtf.common.Permissions=function(A){Wtf.apply(this,A);this.PerRecord=new Wtf.data.Record.create(["featureid","permission"]);this.PerStore=new Wtf.data.Store({url:"PermissionHandler/getRolePermissions.do",baseParams:{mode:7},reader:new Wtf.data.KwlJsonReader({root:"data"},this.PerRecord)});this.roleRecord=new Wtf.data.Record.create(["roleid","rolename"]);this.roleStore=new Wtf.data.Store({url:"PermissionHandler/getRoleList.do",baseParams:{mode:8},reader:new Wtf.data.KwlJsonReader({root:"data"},this.roleRecord)});this.roleCmb=new Wtf.form.FnComboBox({fieldLabel:WtfGlobal.getLocaleText("acc.userAdmin.role"),hiddenName:"roleid",store:this.roleStore,valueField:"roleid",displayField:"rolename",anchor:"90%",editable:false});Wtf.apply(this,{buttons:[{text:WtfGlobal.getLocaleText("acc.userAdmin.apply"),scope:this,handler:this.ApplyPermission},{text:WtfGlobal.getLocaleText("acc.common.close"),scope:this,handler:this.cancel}]},A);Wtf.common.Permissions.superclass.constructor.call(this,A);this.addEvents({"update":true,"afterRenderAll":true})};Wtf.extend(Wtf.common.Permissions,Wtf.Window,{title:WtfGlobal.getLocaleText("acc.userAdmin.assignPerm"),id:"AP",height:600,width:700,onRender:function(A){this.featureRecord=new Wtf.data.Record.create(["featureid","featurename","displayfeaturename"]);this.featureStore=new Wtf.data.Store({url:"PermissionHandler/getFeatureList.do",baseParams:{mode:1},reader:new Wtf.data.KwlJsonReader({root:"data"},this.featureRecord)});this.PerStore.on("load",this.checkActivities,this);this.featureStore.on("load",this.loadActivities,this);this.roleStore.on("load",function(){this.roleCmb.setValue(this.roleid);if(this.roleid==1){this.roleCmb.setDisabled(true)}else{this.roleCmb.setDisabled(false)}this.loadPermissions()},this);this.roleCmb.on("select",this.loadPermissions,this);Wtf.common.Permissions.superclass.onRender.call(this,A);this.featureStore.load()},loadActivities:function(){this.ActRecord=new Wtf.data.Record.create(["featureid","activityid","activityname","displayactivityname","alignright","parentid"]);this.ActStore=new Wtf.data.Store({url:"PermissionHandler/getActivityList.do",baseParams:{mode:2},reader:new Wtf.data.KwlJsonReader({root:"data"},this.ActRecord)});this.ActStore.on("load",this.createWindow,this);this.ActStore.load()},openNewRoleWindow:function(){Wtf.Msg.prompt(WtfGlobal.getLocaleText("acc.field.NewRole"),WtfGlobal.getLocaleText("acc.field.Rolename"),function(A,B){if(A=="ok"){if(B.length>0&&B.trim()!=""){Wtf.Ajax.requestEx({url:"PermissionHandler/saveRoleList.do",params:{mode:9,userid:this.userid,displayrolename:B,rolename:B}},this,this.genRoleSuccessResponse,this.genRoleFailureResponse)}else{Wtf.MessageBox.confirm(WtfGlobal.getLocaleText("acc.field.NewRole"),WtfGlobal.getLocaleText("acc.field.NoRolenameentered.Doyouwanttocontinue?"),function(C){if(C!="yes"){this.openNewRoleWindow()}},this)}}},this)},loadPermissions:function(){this.PerStore.load({params:{roleid:this.roleCmb.getValue(),userid:this.userid}})},createForm:function(){this.AssPerForm=new Wtf.FormPanel({region:"center",cls:"x-panel-body x-panel-body-noheader x-panel-body-noborder",bodyStyle:"background: transparent;",border:false,autoScroll:true,bodyBorder:false,style:"background: transparent;",id:"AssPerForm",items:[{name:"userid",xtype:"hidden"},{layout:"column",style:"padding:20px",border:false,items:[{columnWidth:0.73,layout:"form",border:false,labelWidth:50,items:this.roleCmb},{columnWidth:0.23,layout:"form",border:false,labelWidth:50,items:{xtype:"button",text:WtfGlobal.getLocaleText("acc.field.DeleteRole"),scope:this,hidden:true,handler:this.deleteRole}}]},{layout:"column",border:false,items:[{columnWidth:0.48,layout:"form",labelWidth:250,id:this.id+"-col0",border:false},{columnWidth:0.48,layout:"form",labelWidth:250,id:this.id+"-col1",border:false}]}]});this.fCount=this.featureStore.getCount();for(var A=0;A<this.fCount;A++){this.createFeatureSet(A,A%2)}},createWindow:function(){this.createForm();this.MainWinPanel=new Wtf.Panel({border:false,height:533,layout:"border",items:[{region:"north",height:75,border:false,bodyStyle:"background:white;border-bottom:1px solid #bfbfbf;",html:getTopHtml(WtfGlobal.getLocaleText("acc.userAdmin.setPerm"),WtfGlobal.getLocaleText("acc.userAdmin.setPermUsers")+" : <b>"+this.userFullName+"</b>","../../images/accounting_image/role-assign.gif")},{region:"center",border:false,layout:"fit",bodyStyle:"background: rgb(241, 241, 241);",items:[this.AssPerForm]}]});this.add(this.MainWinPanel);this.doLayout();this.roleStore.load()},createFeatureSet:function(C,B){var G=this.featureStore.getAt(C);var E=new Wtf.form.FieldSet({id:"feature"+G.data["featureid"],xtype:"fieldset",style:"margin:10px",collapsible:true,collapsed:true,autoHeight:true,title:G.data["displayfeaturename"]});this.ActStore.filter("featureid",G.data["featureid"]);var F=this.ActStore.getCount();for(var D=0;D<F;D++){this.createActivity(D,E);if(C==(this.fCount-1)&&D==(F-1)){var A=this.ActStore.getAt(D);Wtf.getCmp("activity"+A.data["activityid"]).on("render",function(){this.fireEvent("afterRenderAll",this);this.doLayout()},this)}}this.ActStore.clearFilter();Wtf.getCmp(this.id+"-col"+B).add(E)},createActivity:function(A,B){var D=this.ActStore.getAt(A);var C=new Wtf.form.Checkbox({fieldLabel:(D.data.alignright?"...":"")+D.data["displayactivityname"],labelStyle:(D.data.alignright?"padding-left:25px;width:225px;":"width:250px; font-weight:bold;"),name:"act"+D.data["activityid"],id:"activity"+D.data["activityid"]});B.add(C)},enableDisableChild:function(E,D){if(D){this.ActStore.filter("parentid",E.getId().substring(8,E.getId().length));for(var A=0;A<this.ActStore.getCount();A++){var C=this.ActStore.getAt(A);var B=Wtf.getCmp("activity"+C.data["activityid"]);Wtf.getCmp("activity"+C.data["activityid"]).setValue(true)}}else{this.ActStore.filter("parentid",E.getId().substring(8,E.getId().length));for(A=0;A<this.ActStore.getCount();A++){C=this.ActStore.getAt(A);B=Wtf.getCmp("activity"+C.data["activityid"]);B.setValue(false);Wtf.getCmp("activity"+C.data["activityid"]).setValue(false)}}this.ActStore.clearFilter()},isChecked:function(A,B){var C=this.PerStore.getAt(this.PerStore.find("featureid",A.data["featureid"]));if(C==null){return false}var D=C.data["permission"];while(B>0){D=Math.floor(D/2);B--}return D%2==1},checkActivities:function(){var C;var F=this.ActStore.collect("featureid");var D=this.roleCmb.getValue();for(var E=0;E<F.length;E++){this.ActStore.filter("featureid",F[E]);for(var A=0;A<this.ActStore.getCount();A++){var B=this.ActStore.getAt(A);C=Wtf.getCmp("activity"+B.data["activityid"]);C.setValue(this.isChecked(B,A));C.setDisabled(D=="1");if(!B.data.alignright){C.on("check",this.enableDisableChild,this)}}}},ApplyPermission:function(){var E=[];var D=[];var A=this.AssPerForm.getForm().getValues();for(var C=0;C<this.featureStore.getCount();C++){var B=this.featureStore.getAt(C).data["featureid"];D.push(B);E.push(this.getNewFeatureValue(B,A))}Wtf.Ajax.requestEx({url:"PermissionHandler/setPermissions.do",params:{mode:15,userid:this.userid,roleid:this.roleCmb.getValue(),features:D,permissions:E}},this,this.genSuccessResponse,this.genFailureResponse)},getNewFeatureValue:function(featureid,formVal){var code=0;var tmp=1;this.ActStore.filter("featureid",featureid);if(featureid=="ff80808122f3cb640122f44bd982000f"){var t=""}for(var i=0;i<this.ActStore.getCount();i++){var id=this.ActStore.getAt(i).data["activityid"];if(eval("(formVal.act"+id+")")){code=code+tmp}tmp=2*tmp}this.ActStore.clearFilter();return code},cancel:function(){this.close()},genSuccessResponse:function(A){this.fireEvent("update",this);WtfComMsgBox([WtfGlobal.getLocaleText("acc.userAdmin.setPerm"),A.msg],A.success*2+1);this.close()},genFailureResponse:function(A){var B=WtfGlobal.getLocaleText("acc.common.msg1");if(A.msg){B=A.msg}WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.alert"),B],2)},deleteRole:function(){Wtf.MessageBox.confirm(WtfGlobal.getLocaleText("acc.common.confirm"),WtfGlobal.getLocaleText("acc.field.Areyousure?"),function(A){if(A!="yes"){return }Wtf.Ajax.requestEx({url:"PermissionHandler/deleteRole.do",params:{mode:10,roleid:this.roleCmb.getValue()}},this,this.genRoleSuccessResponse,this.genRoleFailureResponse)},this)},genRoleSuccessResponse:function(A){WtfComMsgBox([WtfGlobal.getLocaleText("acc.userAdmin.setPerm"),A.msg],A.success*2+1);this.roleStore.reload()},genRoleFailureResponse:function(A){var B=WtfGlobal.getLocaleText("acc.common.msg1");if(A.msg){B=A.msg}WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.alert"),B],2)}});Wtf.common.UserGrid=function(A){this.usersRec=new Wtf.data.Record.create([{name:"userid"},{name:"username"},{name:"fname"},{name:"lname"},{name:"image"},{name:"emailid"},{name:"lastlogin",type:"date"},{name:"aboutuser"},{name:"address"},{name:"contactno"},{name:"rolename"},{name:"roleid"}]);this.userds=new Wtf.data.Store({reader:new Wtf.data.KwlJsonReader({totalProperty:"count",root:"data"},this.usersRec),url:"ProfileHandler/getAllUserDetails.do",baseParams:{mode:11}});this.userds.load({params:{start:0,limit:15}});WtfComMsgBox(29,4,true);this.userds.on("datachanged",function(){if(this.pP.combo){var B=this.pP.combo.value;this.quickPanelSearch.setPage(B)}},this);this.userds.on("load",this.storeloaded,this);this.selectionModel=new Wtf.grid.RadioSelectionModel();this.gridcm=new Wtf.grid.ColumnModel([this.selectionModel,{header:WtfGlobal.getLocaleText("acc.userAdmin.image"),dataIndex:"image",width:30,renderer:function(B){if(!B||B==""){B=Wtf.DEFAULT_USER_URL}return String.format("<img src='{0}' style='height:18px;width:18px;vertical-align:text-top;'/>",B)}},{header:WtfGlobal.getLocaleText("acc.userAdmin.name"),dataIndex:"fullname",autoWidth:true,sortable:true,groupable:true,renderer:function(C,D,B){return(B.data["fname"]+" "+B.data["lname"])}},{header:WtfGlobal.getLocaleText("acc.userAdmin.userName"),dataIndex:"username",autoWidth:true,sortable:true,groupable:true},{header:WtfGlobal.getLocaleText("acc.userAdmin.role"),dataIndex:"rolename",autoWidth:true,sortable:true,groupable:true},{header:WtfGlobal.getLocaleText("acc.userAdmin.emailAddress"),dataIndex:"emailid",autoSize:true,sortable:true,renderer:WtfGlobal.renderEmailTo,groupable:true},{header:WtfGlobal.getLocaleText("acc.userAdmin.lastLogin"),dataIndex:"lastlogin",renderer:WtfGlobal.dateRenderer,autoSize:true,sortable:true,groupable:true},{header:WtfGlobal.getLocaleText("acc.userAdmin.Address"),dataIndex:"address",autoSize:true,sortable:true,groupable:true}]);this.usergrid=new Wtf.grid.GridPanel({stripeRows:true,layout:"fit",store:this.userds,id:"usergrid",cm:this.gridcm,sm:this.selectionModel,border:false,viewConfig:{forceFit:true,emptyText:WtfGlobal.emptyGridRenderer(WtfGlobal.getLocaleText("acc.common.norec"))}});this.resetBttn=new Wtf.Toolbar.Button({text:WtfGlobal.getLocaleText("acc.common.reset"),tooltip:WtfGlobal.getLocaleText("acc.userAdmin.resetTT"),id:"btnRec"+this.id,scope:this,iconCls:getButtonIconCls(Wtf.etype.resetbutton),disabled:false});this.resetBttn.on("click",this.handleResetClick,this);this.UsergridPanel=new Wtf.Panel({autoLoad:false,paging:false,layout:"fit",items:[this.usergrid]});this.btnArr=[this.quickPanelSearch=new Wtf.KWLTagSearch({emptyText:WtfGlobal.getLocaleText("acc.userAdmin.search"),width:200,field:"username"}),this.resetBttn];this.enableBtnArrSingleSelect=new Array();this.btnArr.push("-");if(!WtfGlobal.EnableDisable(Wtf.UPerm.useradmin,Wtf.Perm.useradmin.assperm)){this.assignPermission=new Wtf.Toolbar.Button({text:WtfGlobal.getLocaleText("acc.userAdmin.assignPerm"),id:"permissions"+this.id,allowDomMove:false,iconCls:getButtonIconCls(Wtf.etype.permission),scope:this,tooltip:{text:WtfGlobal.getLocaleText("acc.userAdmin.assignPermTTeText"),dtext:WtfGlobal.getLocaleText("acc.userAdmin.assignPermTTdText")},disabled:true,handler:this.requestPermissions});this.setPrivilege=new Wtf.Toolbar.Button({text:WtfGlobal.getLocaleText("acc.field.SetAmendingPricePermissions"),tooltip:WtfGlobal.getLocaleText("acc.field.SetAmendingPricePermissions"),disabled:true,scope:this,handler:function(){this.privWin=new Wtf.Window({title:WtfGlobal.getLocaleText("acc.field.AmendPriceSetting"),resizable:false,width:400,height:330,modal:true,layout:"border",scope:this,buttons:[{text:WtfGlobal.getLocaleText("acc.msgbox.ok"),scope:this,handler:function(){this.saveAmendingPrice()}},{text:WtfGlobal.getLocaleText("acc.msgbox.cancel"),scope:this,handler:function(){this.privWin.close()}}],items:[{region:"north",height:75,border:false,bodyStyle:"background:white;border-bottom:1px solid #bfbfbf;",html:getTopHtml(WtfGlobal.getLocaleText("acc.field.AmendPriceSetting"),WtfGlobal.getLocaleText("acc.field.Checkto")+" <b>"+WtfGlobal.getLocaleText("acc.field.Remove")+"</b> "+WtfGlobal.getLocaleText("acc.field.AmendPricePermissionforuser")+" <b>"+this.selectionModel.getSelected().data.fname+" "+this.selectionModel.getSelected().data.lname+"</b>","../../images/createuser.png")},{region:"center",layout:"form",border:false,labelWidth:70,bodyStyle:"background:#f1f1f1;padding:15px",items:[{xtype:"fieldset",width:(Wtf.isIE)?"91%":"85%",height:"75%",title:WtfGlobal.getLocaleText("acc.field.Modules"),border:false,labelWidth:150,items:[{layout:"column",border:false,items:[{columnWidth:".50",layout:"form",border:false,items:[this.CQCheck=new Wtf.form.Checkbox({fieldLabel:WtfGlobal.getLocaleText("acc.dimension.module.12"),name:"CQCheck",style:"margin-top: 3px;",id:"CQCheckid"})]},{columnWidth:".50",layout:"form",border:false,items:[this.VQCheck=new Wtf.form.Checkbox({fieldLabel:WtfGlobal.getLocaleText("acc.dimension.module.11"),name:"VQCheck",style:"margin-top: 5px;",id:"VQCheckid"})]}]},{layout:"column",border:false,items:[{columnWidth:".50",layout:"form",border:false,items:[this.SOCheck=new Wtf.form.Checkbox({fieldLabel:WtfGlobal.getLocaleText("acc.dimension.module.9"),name:"SOCheck",style:"margin-top: 5px;",id:"SOCheckid"})]},{columnWidth:".50",layout:"form",border:false,items:[this.POCheck=new Wtf.form.Checkbox({fieldLabel:WtfGlobal.getLocaleText("acc.dimension.module.10"),name:"POCheck",style:"margin-top: 5px;",id:"POCheckid"})]}]},{layout:"column",border:false,items:[{columnWidth:".50",layout:"form",border:false,items:[this.CICheck=new Wtf.form.Checkbox({fieldLabel:WtfGlobal.getLocaleText("acc.dimension.module.1"),name:"CICheck",style:"margin-top: 5px;",id:"CICheckid"})]},{columnWidth:".50",layout:"form",border:false,items:[this.VICheck=new Wtf.form.Checkbox({fieldLabel:WtfGlobal.getLocaleText("acc.dimension.module.2"),name:"VICheck",style:"margin-top: 5px;",labelWidth:200,id:"VICheckid"})]}]}]}]}]});Wtf.Ajax.requestEx({url:"ACCReports/GetUserAmendingPrice.do",params:{userid:this.selectionModel.getSelected().data.userid}},this,function(C,B){var D=C;if(D.success){this.CICheck.setValue(D.data[0].CInvoice);this.VICheck.setValue(D.data[0].VInvoice);this.SOCheck.setValue(D.data[0].SalesOrder);this.POCheck.setValue(D.data[0].PurchaseOrder);this.VQCheck.setValue(D.data[0].VendorQuotation);this.CQCheck.setValue(D.data[0].CustomerQuotation)}},function(B){});this.privWin.show()}});this.setPermissionsforFilteringReportsData=new Wtf.Toolbar.Button({text:WtfGlobal.getLocaleText("acc.field.permissionsforFilteringReportsData"),tooltip:WtfGlobal.getLocaleText("acc.field.permissionsforFilteringReportsData"),disabled:true,scope:this,handler:function(){this.privWin=new Wtf.Window({title:WtfGlobal.getLocaleText("acc.field.permissionsforFilteringReportsData"),resizable:false,width:400,height:330,modal:true,layout:"border",scope:this,buttons:[{text:WtfGlobal.getLocaleText("acc.msgbox.ok"),scope:this,handler:function(){this.savePermissionsforFilteringReportsData()}},{text:WtfGlobal.getLocaleText("acc.msgbox.cancel"),scope:this,handler:function(){this.privWin.close()}}],items:[{region:"north",height:75,border:false,bodyStyle:"background:white;border-bottom:1px solid #bfbfbf;",html:getTopHtml(WtfGlobal.getLocaleText("acc.field.permissionsforFilteringReportsData"),WtfGlobal.getLocaleText("acc.field.reportsfromselectedmodule"),"../../images/createuser.png")},{region:"center",layout:"form",border:false,labelWidth:70,bodyStyle:"background:#f1f1f1;padding:15px",items:[{xtype:"fieldset",width:(Wtf.isIE)?"91%":"85%",height:"75%",title:WtfGlobal.getLocaleText("acc.field.Modules"),border:false,labelWidth:150,items:[{layout:"column",border:false,items:[{columnWidth:".50",layout:"form",border:false,items:[this.customerInvoiceCheck=new Wtf.form.Checkbox({fieldLabel:WtfGlobal.getLocaleText("acc.dimension.module.1"),name:"customerInvoiceCheck",style:"margin-top: 5px;",id:"customerInvoiceCheckId"})]},{columnWidth:".50",layout:"form",border:false,items:[this.salesOrderCheck=new Wtf.form.Checkbox({fieldLabel:WtfGlobal.getLocaleText("acc.dimension.module.9"),name:"salesOrderCheck",style:"margin-top: 5px;",id:"salesOrderCheckId"})]}]},{layout:"column",border:false,items:[{columnWidth:".50",layout:"form",border:false,items:[this.customerQuotationCheck=new Wtf.form.Checkbox({fieldLabel:WtfGlobal.getLocaleText("acc.dimension.module.12"),name:"customerQuotationCheck",style:"margin-top: 5px;",id:"customerQuotationCheckId"})]}]}]}]}]});Wtf.Ajax.requestEx({url:"ACCReports/getPermissionsforFilteringReportsData.do",params:{userid:this.selectionModel.getSelected().data.userid}},this,function(C,B){var D=C;if(D.success){this.customerInvoiceCheck.setValue(D.data[0].customerInvoiceCheck);this.salesOrderCheck.setValue(D.data[0].salesOrderCheck);this.customerQuotationCheck.setValue(D.data[0].customerQuotationCheck)}},function(B){});this.privWin.show()}});this.setUserActiveDays=new Wtf.Toolbar.Button({text:WtfGlobal.getLocaleText("acc.field.setUserActiveDays"),tooltip:WtfGlobal.getLocaleText("acc.field.setUserActiveDays"),id:"setActiveDays"+this.id,allowDomMove:false,iconCls:getButtonIconCls(Wtf.etype.permission),scope:this,disabled:true,handler:this.handleSetActiveDaysForUser});this.btnArr.push(this.assignPermission);this.btnArr.push("-",this.getUserManagementBtns());this.btnArr.push(this.setPrivilege);this.btnArr.push(this.setPermissionsforFilteringReportsData);this.btnArr.push(this.setUserActiveDays);this.enableBtnArrSingleSelect.push(this.btnArr.length-6);this.enableBtnArrSingleSelect.push(this.btnArr.length-3);this.enableBtnArrSingleSelect.push(this.btnArr.length-2);this.enableBtnArrSingleSelect.push(this.btnArr.length-1)}this.innerpanel=new Wtf.Panel({layout:"fit",cls:"backcolor",border:false,items:[this.UsergridPanel],tbar:this.btnArr,bbar:this.pagingToolbar=new Wtf.PagingSearchToolbar({pageSize:15,store:this.userds,searchField:this.quickPanelSearch,displayInfo:true,emptyMsg:WtfGlobal.getLocaleText("acc.common.nores"),plugins:this.pP=new Wtf.common.pPageSize({id:"pPageSize_"+this.id})})});Wtf.apply(this,{layout:"fit",defaults:{border:false,bodyStyle:"background: transparent;"},autoScroll:true,items:[this.innerpanel]});this.usergrid.getSelectionModel().on("selectionchange",this.SelChange,this);Wtf.common.UserGrid.superclass.constructor.call(this,A)},Wtf.extend(Wtf.common.UserGrid,Wtf.Panel,{saveAmendingPrice:function(){Wtf.Ajax.request({method:"POST",url:"ACCReports/AssignAmendingPrice.do",scope:this,params:{CInvoice:this.CICheck.getValue(),VInvoice:this.VICheck.getValue(),SalesOrder:this.SOCheck.getValue(),PurchaseOrder:this.POCheck.getValue(),VendorQuotation:this.VQCheck.getValue(),CustomerQuotation:this.CQCheck.getValue(),userid:this.selectionModel.getSelected().data.userid},success:function(){this.privWin.close()}})},savePermissionsforFilteringReportsData:function(){Wtf.Ajax.request({method:"POST",url:"ACCReports/savePermissionsforFilteringReportsData.do",scope:this,params:{customerInvoiceCheck:this.customerInvoiceCheck.getValue(),salesOrderCheck:this.salesOrderCheck.getValue(),customerQuotationCheck:this.customerQuotationCheck.getValue(),userid:this.selectionModel.getSelected().data.userid},success:function(){this.privWin.close()}})},SelChange:function(){WtfGlobal.enableDisableBtnArr(this.btnArr,this.usergrid,this.enableBtnArrSingleSelect,[]);WtfGlobal.enableDisableBtnArr(this.menubtns,this.usergrid,this.enableBtnArrSingleSelect1,[])},handleResetClick:function(){if(this.quickPanelSearch.getValue()){this.quickPanelSearch.reset();this.userds.load({params:{start:0,limit:this.pP.combo.value}});WtfComMsgBox(29,4,true)}},storeloaded:function(A){Wtf.MessageBox.hide();this.quickPanelSearch.StorageChanged(A);if(this.usergrid.getStore().getCount()==0){this.usergrid.getView().emptyText=WtfGlobal.emptyGridRenderer(WtfGlobal.getLocaleText("acc.common.norec"));this.usergrid.getView().refresh()}},requestPermissions:function(){var B=this.usergrid.getSelectionModel().getSelected();var A=B.data["fname"]+" "+B.data["lname"];var C=new Wtf.common.Permissions({title:WtfGlobal.getLocaleText("acc.userAdmin.role&perm"),resizable:false,iconCls:getButtonIconCls(Wtf.etype.deskera),roleid:B.data["roleid"],userid:B.data["userid"],userFullName:A,modal:true});Wtf.getCmp("AP").on("update",function(){(function(){this.usergrid.getStore().reload()}).defer(WtfGlobal.gridReloadDelay(),this)},this);C.show()},handleSetActiveDaysForUser:function(){var A=this.usergrid.getSelectionModel().getSelected();this.userRecord=new Wtf.data.Record.create([{name:"userid"},{name:"fullname"}]);this.userReader=new Wtf.data.KwlJsonReader({root:"data",totalProperty:"count"},this.userRecord);this.userStore=new Wtf.data.Store({url:"ProfileHandler/getAllUserDetails.do",reader:this.userReader});this.userStore.load();this.userStore.on("load",function(B,D){var C=new Wtf.data.Record({userid:"All",fullname:"All"});this.userStore.insert(0,C);if(A){this.users.setValue(A.data.userid)}},this);this.users=new Wtf.common.Select({labelStyle:"width:150px;margin-left: 5px;",fieldLabel:WtfGlobal.getLocaleText("acc.field.User")+"*",multiSelect:true,forceSelection:true,name:"users",xtype:"select",hiddenName:"users",valueField:"userid",displayField:"fullname",store:this.userStore,emptyText:WtfGlobal.getLocaleText("acc.field.SelectUser"),mode:"local",triggerAction:"all",typeAhead:true,scope:this,allowBlank:false,width:260});this.users.on("select",function(D,B,C){if(B.get("userid")=="All"){D.clearValue();D.setValue("All")}else{if(D.getValue().indexOf("All")>=0){D.clearValue();D.setValue(B.get("userid"))}}},this);this.moduleStore=new Wtf.data.SimpleStore({fields:[{name:"moduleid"},{name:"name"}],data:[[Wtf.Acc_Delivery_Order_ModuleId,"Delivery Order"],]});this.moduleType=new Wtf.form.ComboBox({fieldLabel:WtfGlobal.getLocaleText("acc.designerTemplate.ModuleName")+"*",labelStyle:"width:120px;margin-left: 5px;",name:"modules",hiddenName:"modules",store:this.moduleStore,valueField:"moduleid",displayField:"name",mode:"local",disableKeyFilter:true,allowBlank:false,triggerAction:"all",forceSelection:true,typeAhead:true,emptyText:WtfGlobal.getLocaleText("acc.field.SelectaModule")});this.days=new Wtf.form.NumberField({fieldLabel:WtfGlobal.getLocaleText("acc.masterConfig.days")+"*",name:"days",allowNegative:false,allowDecimals:false,labelStyle:"width:150px;margin-left: 5px;",allowBlank:false,minValue:0,maxValue:365,disabled:false,emptyText:WtfGlobal.getLocaleText("acc.field.EnterDays"),width:260});this.deleteRec=new Wtf.data.Record.create([{name:"rowid"},{name:"moduleid"},{name:"days"}]);this.deleteStore=new Wtf.data.Store({reader:new Wtf.data.KwlJsonReader({root:"data"},this.deleteRec)});this.userActiveDaysGridStoreRec=new Wtf.data.Record.create([{name:"rowid"},{name:"moduleid"},{name:"days"}]);this.userActiveDaysGridStore=new Wtf.data.Store({reader:new Wtf.data.KwlJsonReader({root:"data",totalProperty:"count"},this.userActiveDaysGridStoreRec),url:"ACCCompanyPref/getUserActiveDaysDetails.do",baseParams:{userID:A.data.userid}});this.userActiveDaysGridStore.load();this.userActiveDaysGridcm=new Wtf.grid.ColumnModel([{header:WtfGlobal.getLocaleText("acc.importLog.module"),dataIndex:"moduleid",align:"left",autoWidth:true,renderer:Wtf.comboBoxRenderer(this.moduleType),editor:this.moduleType},{header:WtfGlobal.getLocaleText("acc.field.ActiveDays"),dataIndex:"days",align:"right",autoWidth:true,editor:this.days},{header:WtfGlobal.getLocaleText("acc.masterConfig.costCenter.action"),renderer:this.deleteRenderer.createDelegate(this),width:50}]);this.userActiveDaysGrid=new Wtf.grid.EditorGridPanel({id:"userActiveDaysGrid"+this.id,layout:"fit",store:this.userActiveDaysGridStore,cm:this.userActiveDaysGridcm,clicksToEdit:1,autoScroll:true,height:150,width:450,border:false,loadMask:true,cls:"vline-on",viewConfig:{forceFit:true,emptyText:WtfGlobal.emptyGridRenderer(WtfGlobal.getLocaleText("acc.common.norec"))}});this.setUserActiveDaysWin=new Wtf.Window({title:WtfGlobal.getLocaleText("acc.field.setUserActiveDays"),resizable:false,width:550,height:400,modal:true,layout:"border",scope:this,buttons:[{text:WtfGlobal.getLocaleText("acc.common.saveBtn"),scope:this,handler:function(){this.saveUserAciveDays()}},{text:WtfGlobal.getLocaleText("acc.msgbox.cancel"),scope:this,handler:function(){this.setUserActiveDaysWin.close()}}],items:[{region:"north",height:75,border:false,bodyStyle:"background:white;border-bottom:1px solid #bfbfbf;",html:getTopHtml(WtfGlobal.getLocaleText("acc.field.setUserActiveDays"),WtfGlobal.getLocaleText("acc.field.setUserActiveDaysWinDesc"),"../../images/createuser.png")},{region:"center",layout:"fit",border:false,bodyStyle:"background:#f1f1f1;padding:15px",items:[{xtype:"form",border:false,id:this.id+"useractivedaysfrm",autoScroll:true,labelWidth:150,items:[this.users,{xtype:"fieldset",width:(Wtf.isIE)?"91%":"85%",height:"75%",title:WtfGlobal.getLocaleText("acc.field.selectModulesAndActiveDays"),border:false,labelWidth:150,items:[this.userActiveDaysGrid]}]}]}]});this.userActiveDaysGrid.on("afteredit",this.updateRow,this);this.userActiveDaysGrid.on("rowclick",this.handleRowClick,this);this.userActiveDaysGrid.on("validateedit",this.validateRow,this);this.userActiveDaysGrid.getStore().on("load",this.addBlankRow,this);this.setUserActiveDaysWin.show()},deleteRenderer:function(D,B,G){var C=true;var A=this.userActiveDaysGrid.getColumnModel();var F=A.getColumnCount();for(var E=0;E<F-1;E++){if(G.data[A.getDataIndex(E)].length<=0){if(E==1){C=true}else{C=false;break}}}if(C){var H=getButtonIconCls(Wtf.etype.deletegridrow);return"<div class='"+H+"'></div>"}return""},addBlankRow:function(){var A=this.userActiveDaysGridStore.reader.recordType,F=A.prototype.fields,H=F.items,E=F.length;var B={},G={};for(var C=0;C<E;C++){F=H[C];if(F.name!="rowid"){G[F.name]="";if(!Wtf.isEmpty(F.defValue)){G[F.name]=F.convert((typeof F.defValue=="function"?F.defValue.call():F.defValue))}}}var D=new A(G);this.userActiveDaysGridStore.add(D)},updateRow:function(A){if(this.userActiveDaysGridStore.getCount()>0&&this.userActiveDaysGridStore.getAt(this.userActiveDaysGridStore.getCount()-1).data["moduleid"].length<=0){return }this.addBlankRow()},handleRowClick:function(B,A,C){if(C.getTarget(".delete-gridrow")){Wtf.MessageBox.confirm(WtfGlobal.getLocaleText("acc.common.warning"),WtfGlobal.getLocaleText("acc.nee.48"),function(I){if(I!="yes"){return }var E=B.getStore();var J=E.getCount();var D=E.getAt(A);var H=D.data.moduleid;H=(H=="NaN"||H==undefined||H==null)?0:H;if(D.data.moduleid!=undefined){var G=[];var F=new this.deleteRec({rowid:D.data.rowid,moduleid:D.data.moduleid,days:D.data.days});G.push(F);this.deleteStore.add(G)}E.remove(E.getAt(A));if(A==J-1){this.addBlankRow()}},this)}},validateRow:function(B){if(B!=null){if(B.field=="moduleid"){var A=false;this.userActiveDaysGrid.getStore().each(function(D){var C=D.get("moduleid");if(C==B.value){A=true;return false}},this);if(A){WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.alert"),WtfGlobal.getLocaleText("acc.field.moduleNameAlreadySelected")],0);B.record.set("moduleid",B.originalValue);return false}}}},saveUserAciveDays:function(){var A=this.formPanel=Wtf.getCmp(this.id+"useractivedaysfrm").form.isValid();var D=this.getModuleAndActiveDaysDetails();if(D==undefined||D=="[]"){WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.warning"),WtfGlobal.getLocaleText("acc.field.modulesAndActiveDaysDetailsAreNotValid")],2);return }for(var C=0;C<this.userActiveDaysGrid.getStore().getCount()-1;C++){var B=this.userActiveDaysGrid.getStore().getAt(C).data["moduleid"];if(B===""||B==undefined){WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.alert"),WtfGlobal.getLocaleText("acc.field.Pleaseselectmoduleforadding")],2);return }var F=this.userActiveDaysGrid.getStore().getAt(C).data["days"];if(F===""||F==undefined){WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.alert"),WtfGlobal.getLocaleText("acc.field.pleaseSelectActiveDays")],2);return }}if(!A){WtfComMsgBox(2,2);return }var E=Wtf.getCmp(this.id+"useractivedaysfrm").form.getValues();E.detail=D;Wtf.Ajax.requestEx({url:"ACCCompanyPref/setUserActiveDays.do",params:E},this,this.successResponse,this.failureResponse)},successResponse:function(A){this.setUserActiveDaysWin.close();WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.success"),WtfGlobal.getLocaleText("acc.field.userActiveDaysSavedSuccessfully")],A.success*2+1)},failureResponse:function(A){WtfComMsgBox([WtfGlobal.getLocaleText("acc.field.Failure"),WtfGlobal.getLocaleText("acc.common.msg1")],A.success*2+1)},getModuleAndActiveDaysDetails:function(){var A=[];this.userActiveDaysGridStore.each(function(C){A.push(this.userActiveDaysGridStore.indexOf(C))},this);var B=WtfGlobal.getJSONArray(this.userActiveDaysGrid,true,A);return B},getUserManagementBtns:function(){this.createUser=new Wtf.Action({text:WtfGlobal.getLocaleText("acc.field.CreateUser"),tooltip:WtfGlobal.getLocaleText("acc.field.CreateUser"),iconCls:getButtonIconCls(Wtf.etype.menuadd),id:this.id+"createUser",scope:this,handler:function(){new Wtf.common.ManageUser({id:"createUserForm",isEdit:false}).show()}});this.editUser=new Wtf.Action({text:WtfGlobal.getLocaleText("acc.field.EditUser"),tooltip:WtfGlobal.getLocaleText("acc.field.EditUser"),iconCls:getButtonIconCls(Wtf.etype.menuedit),id:this.id+"editUser",scope:this,disabled:true,handler:function(){if(this.selectionModel.getCount()==1){new Wtf.common.ManageUser({id:"editUserForm",isEdit:true,rec:this.selectionModel.getSelected()}).show()}}});this.deleteUser=new Wtf.Action({text:WtfGlobal.getLocaleText("acc.field.Deleteuser"),tooltip:WtfGlobal.getLocaleText("acc.field.Deleteuser"),iconCls:getButtonIconCls(Wtf.etype.menudelete),id:this.id+"deleteUser",scope:this,disabled:true,handler:this.deleteHandler});this.menubtns=[this.createUser,this.editUser,this.deleteUser];this.enableBtnArrSingleSelect1=new Array();this.enableBtnArrSingleSelect1.push(this.menubtns.length-1);this.enableBtnArrSingleSelect1.push(this.menubtns.length-2);var A=new Wtf.Toolbar.Button({text:WtfGlobal.getLocaleText("acc.field.UserManagement"),iconCls:getButtonIconCls(Wtf.etype.customer),id:this.id+"userManagement",menu:new Wtf.menu.Menu({items:this.menubtns}),hidden:!Wtf.account.companyAccountPref.standalone});return A},deleteUser:function(){var A=[];var C=[];this.recArr=this.usergrid.getSelectionModel().getSelections();for(var B=0;B<this.recArr.length;B++){C.push(this.recArr[B].data.userid)}Wtf.Ajax.requestEx({url:"ProfileHandler/standAloneDeleteUser.do",params:{userids:C}},this,this.genSuccessResponse,this.genFailureResponse)},genSuccessResponse:function(A){if(!A.valid){this.usergrid.getStore().reload();WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.success"),WtfGlobal.getLocaleText("acc.field.UserDeletedSuccessfully.")],A.success*2+1)}else{WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.alert"),WtfGlobal.getLocaleText("acc.field.CannotdeleteCompanyCreatororself.")],A.success*2+1)}},genFailureResponse:function(){WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.failure"),WtfGlobal.getLocaleText("acc.field.Cannotdeleteuser.")],response.success*2+1)},deleteHandler:function(){Wtf.MessageBox.show({title:WtfGlobal.getLocaleText("acc.common.warning"),msg:WtfGlobal.getLocaleText("acc.field.Areyousureyouwanttodeletetheselecteduser?"),width:350,buttons:Wtf.MessageBox.OKCANCEL,animEl:"upbtn",icon:Wtf.MessageBox.QUESTION,scope:this,fn:function(C){if(C=="ok"){var A=[];var D=[];this.recArr=this.usergrid.getSelectionModel().getSelections();for(var B=0;B<this.recArr.length;B++){D.push(this.recArr[B].data.userid)}Wtf.Ajax.requestEx({url:"ProfileHandler/standAloneDeleteUser.do",params:{userids:D}},this,this.genSuccessResponse,this.genFailureResponse)}}})}});Wtf.common.MainAdmin=function(A){Wtf.common.MainAdmin.superclass.constructor.call(this,A)};Wtf.extend(Wtf.common.MainAdmin,Wtf.Panel,{onRender:function(A){Wtf.common.MainAdmin.superclass.onRender.call(this,A);this.adminUser=new Wtf.common.UserGrid({layout:"fit",iconCls:"useradmin",border:false});this.add(this.adminUser)}});var profile=new Wtf.common.MainAdmin({id:"mainAdmin",companyid:"",layout:"fit",border:false});Wtf.getCmp("tabcompanyadminpanel").add(profile);Wtf.getCmp("tabcompanyadminpanel").doLayout();Wtf.common.ManageUser=function(A){this.isEdit=A.isEdit;Wtf.apply(this,{title:A.isEdit?WtfGlobal.getLocaleText("acc.field.EditUser"):WtfGlobal.getLocaleText("acc.field.CreateUser"),id:this.id+"updateProfileWin",closable:true,modal:true,iconCls:getButtonIconCls(Wtf.etype.deskera),width:450,height:370,autoScroll:true,resizable:false,layout:"border",buttonAlign:"right",renderTo:document.body,buttons:[{text:A.isEdit?WtfGlobal.getLocaleText("acc.field.EditUser"):WtfGlobal.getLocaleText("acc.field.CreateUser"),scope:this,handler:this.saveForm.createDelegate(this)},{text:WtfGlobal.getLocaleText("acc.common.cancelBtn"),scope:this,handler:function(){this.close()}}]},A);Wtf.common.ManageUser.superclass.constructor.call(this,A)};Wtf.extend(Wtf.common.ManageUser,Wtf.Window,{onRender:function(A){Wtf.common.ManageUser.superclass.onRender.call(this,A);this.createUserForm();this.add({region:"north",height:75,border:false,bodyStyle:"background:white;border-bottom:1px solid #bfbfbf;",html:getTopHtml(this.isEdit?WtfGlobal.getLocaleText("acc.field.EditUser"):WtfGlobal.getLocaleText("acc.field.CreateUser"),this.isEdit?WtfGlobal.getLocaleText("acc.field.Edituserprofile"):WtfGlobal.getLocaleText("acc.field.Useruserprofile"))},{region:"center",border:false,bodyStyle:"background:#f1f1f1;font-size:10px;",autoScroll:true,items:this.userinfo})},createUserForm:function(){this.dfRec=Wtf.data.Record.create([{name:"formatid"},{name:"name"}]);this.dfStore=new Wtf.data.Store({url:"kwlCommonTables/getAllDateFormats.do",reader:new Wtf.data.KwlJsonReader({root:"data"},this.dfRec)});this.roleStore=new Wtf.data.SimpleStore({fields:["id","name"],data:[[1,"Company Administrator"],[2,"Company User"]]});this.username=new Wtf.form.TextField({fieldLabel:WtfGlobal.getLocaleText("acc.field.Username")+"*",name:"username",id:"username",readOnly:this.isEdit,cls:"readOnly",width:220,allowBlank:false,maxLength:30,regex:/^\w[\w|\.]*$/,validator:WtfGlobal.validateUserName});this.emailAdd=new Wtf.form.TextField({fieldLabel:WtfGlobal.getLocaleText("acc.userAdmin.emailAddress")+"*",name:"emailid",allowBlank:false,validator:WtfGlobal.noBlankCheck,width:220,maxLength:50,vtype:"email"});this.fname=new Wtf.form.TextField({fieldLabel:WtfGlobal.getLocaleText("acc.field.FirstName")+"*",name:"fname",id:"fname",width:220,maxLength:50,validator:WtfGlobal.noBlankCheck,allowBlank:false});this.lname=new Wtf.form.TextField({fieldLabel:WtfGlobal.getLocaleText("acc.profile.lName")+"*",name:"lname",id:"lname",maxLength:50,width:220,validator:WtfGlobal.noBlankCheck,allowBlank:false});this.roleCmb=new Wtf.form.ComboBox({fieldLabel:WtfGlobal.getLocaleText("acc.userAdmin.role")+"*",hiddenName:"roleid",id:"rolecombo"+this.id,name:"roleid",store:this.roleStore,valueField:"id",allowBlank:false,displayField:"name",width:220,mode:"local",triggerAction:"all",forceSelection:true});this.dfCmb=new Wtf.form.ComboBox({fieldLabel:WtfGlobal.getLocaleText("acc.profile.dateFmt"),hiddenName:"formatid",name:"formatid",id:"dfcombo"+this.id,store:this.dfStore,valueField:"formatid",displayField:"name",mode:"local",width:220,triggerAction:"all",forceSelection:true});chktimezoneload();this.tzCmb=new Wtf.form.ComboBox({fieldLabel:WtfGlobal.getLocaleText("acc.profile.timeZone"),hiddenName:"tzid",id:"tzcombo"+this.id,name:"tzid",store:Wtf.timezoneStore,valueField:"id",displayField:"name",mode:"local",width:220,triggerAction:"all",forceSelection:true});this.genderstore=new Wtf.data.SimpleStore({fields:["id","gender"],data:[["1",WtfGlobal.getLocaleText("acc.field.Male")],["2",WtfGlobal.getLocaleText("acc.field.Female")]]});this.gender=new Wtf.form.ComboBox({fieldLabel:WtfGlobal.getLocaleText("acc.field.Gender"),hiddenName:"gender",store:this.genderstore,displayField:"gender",valueField:"gender",forceSelection:true,selectOnFocus:true,triggerAction:"all",typeAhead:true,mode:"local",width:220,allowBlank:false});this.contactno=new Wtf.form.TextField({fieldLabel:WtfGlobal.getLocaleText("acc.field.ContactNo."),name:"contactno",width:220,validationDelay:0,maxLength:20,id:"contactno",xtype:"textfield"});this.address=new Wtf.form.TextArea({fieldLabel:WtfGlobal.getLocaleText("acc.customerList.gridAddress"),name:"address",width:220,id:"address",maxLength:255,xtype:"textarea"});this.password=new Wtf.form.TextField({fieldLabel:WtfGlobal.getLocaleText("acc.field.Password"),name:"password",width:220,id:"password",maxLength:255,readOnly:this.isEdit,xtype:"password",allowBlank:!this.isEdit,hidden:this.isEdit,disabled:this.isEdit,hideLabel:this.isEdit});this.setFormValues();var A=[{name:"userid",id:"userid",hideLabel:true,hidden:true,value:(this.rec!=null&&this.rec!=undefined)?this.rec.data.userid:""},this.username,this.emailAdd,this.fname,this.lname,this.roleCmb,this.dfCmb,this.tzCmb,this.contactno,this.address];this.userinfo=new Wtf.form.FormPanel({fileUpload:true,baseParams:{mode:12,formname:"account"},url:this.isEdit?"ProfileHandler/standAloneEditUser.do":"ProfileHandler/standAloneSaveUser.do",region:"center",cls:"visibleDisabled",bodyStyle:"background: transparent;",border:false,style:"background: transparent;padding:20px;",defaultType:"striptextfield",labelWidth:125,items:A,scope:this});this.dfStore.load()},saveForm:function(){if(!this.userinfo.getForm().isValid()){WtfComMsgBox(2,2)}else{this.userinfo.getForm().submit({waitMsg:WtfGlobal.getLocaleText("acc.field.SavingUserInformation"),waitTitle:WtfGlobal.getLocaleText("acc.field.PleaseWait"),success:function(B,A){if(!A.result.data.success){if(A.result.data.duplicateEmail){WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.alert"),WtfGlobal.getLocaleText("acc.field.DuplicateuserEmailID.PleaseEnterdifferentEmailID.")],B.success*2+1)}else{var C=WtfGlobal.getLocaleText("acc.field.Duplicateusername.PleaseEnterdifferentusername.");if(A.result.data.msg){C=A.result.data.msg}WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.alert"),C],B.success*2+1)}}else{this.close();Wtf.getCmp("usergrid").getStore().reload();Wtf.getCmp("usergrid").getView().refresh();WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.success"),WtfGlobal.getLocaleText("acc.field.UserInformationsavedSuccessfully.")],B.success*2+1)}},failure:function(B,A){var C=WtfGlobal.getLocaleText("acc.common.msg1");if(A.result.data.msg){C=A.result.data.msg}WtfComMsgBox([WtfGlobal.getLocaleText("acc.common.alert"),C],B.success*2+1)},scope:this})}},setFormValues:function(){if(this.isEdit){this.username.setValue(this.rec.data.username);this.emailAdd.setValue(this.rec.data.emailid);this.fname.setValue(this.rec.data.fname);this.lname.setValue(this.rec.data.lname);this.contactno.setValue(this.rec.json.contactno);this.address.setValue(this.rec.data.address);this.roleCmb.setValue(this.rec.data.roleid);this.dfCmb.setValue(this.rec.json.formatid);this.tzCmb.setValue(this.rec.json.tzid)}}})